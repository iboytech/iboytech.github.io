<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Alpineä¸‹ä½¿ç”¨Dockeræ„å»ºLNMPå¤šç«™ç‚¹ç¯å¢ƒ</title>
    <url>//post/44464.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MySqlçš„éƒ¨ç½²</span><br><span class="line">docker pull mysql:5.6</span><br><span class="line">docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD&#x3D;123456 -v &#x2F;www&#x2F;mysql:&#x2F;var&#x2F;lib&#x2F;mysql --name mysql mysql:5.6</span><br><span class="line">docker exec -it mysql bash</span><br><span class="line">mysql -u root -p</span><br><span class="line">use mysql;</span><br><span class="line">update user set host &#x3D; &quot;%&quot; where user &#x3D; &quot;root&quot;;</span><br></pre></td></tr></table></figure><a id="more"></a>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PHPçš„éƒ¨ç½²</span><br><span class="line">docker run -d -p 9000:9000 -v &#x2F;www&#x2F;php:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;php  -v &#x2F;www&#x2F;nginx&#x2F;html:&#x2F;var&#x2F;www --name php --link mysql:mysql  --volumes-from mysql --privileged&#x3D;true cs2ag&#x2F;php5.6-devtest;</span><br><span class="line">docker exec -it php bash;</span><br><span class="line"></span><br><span class="line">docker stop php;</span><br><span class="line">docker rm php;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Nginxçš„éƒ¨ç½²</span><br><span class="line">docker run -p 80:80  -p 81:81 --name nginx -v &#x2F;www&#x2F;nginx&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html -v &#x2F;www&#x2F;nginx&#x2F;conf.d&#x2F;default.conf:&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf  --link php:php  --link mysql:mysql -d nginx:latest;</span><br><span class="line">docker stop nginx;</span><br><span class="line">docker rm nginx;</span><br><span class="line"></span><br><span class="line">docker run -p 80:80  -p 81:81 --name nginx -v &#x2F;www&#x2F;nginx&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html -v &#x2F;www&#x2F;nginx&#x2F;conf.d&#x2F;default.conf:&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf  --link php:php  --link mysql:mysql -d nginx:latest;</span><br><span class="line">docker stop nginx;</span><br><span class="line">docker rm nginx;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### å‚æ•°è§£æ</span><br><span class="line">-v å°†æœ¬åœ°ç£ç›˜ä¸Šçš„phpä»£ç æŒ‚è½½åˆ°docker ç¯å¢ƒä¸­ï¼Œå¯¹åº”dockerçš„ç›®å½•æ˜¯ &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">--name æ–°å»ºçš„å®¹å™¨åç§° php-with-mysql</span><br><span class="line">--link é“¾æ¥çš„å®¹å™¨ï¼Œé“¾æ¥çš„å®¹å™¨åç§°ï¼šåœ¨è¯¥å®¹å™¨ä¸­çš„åˆ«åï¼Œè¿è¡Œè¿™ä¸ªå®¹å™¨æ˜¯ï¼Œdockerä¸­ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªhostè¯†åˆ«è¢«é“¾æ¥çš„å®¹å™¨ip</span><br><span class="line">--privileged&#x3D;true æƒé™é—®é¢˜</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>2019æš‘æœŸç­”è¾©</title>
    <url>//post/48363.html</url>
    <content><![CDATA[<h1 id="ç­¾åˆ°å›å¸–æƒ…å†µç»Ÿè®¡"><a href="#ç­¾åˆ°å›å¸–æƒ…å†µç»Ÿè®¡" class="headerlink" title="ç­¾åˆ°å›å¸–æƒ…å†µç»Ÿè®¡"></a>ç­¾åˆ°å›å¸–æƒ…å†µç»Ÿè®¡</h1><h4 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h4><p>2019å¯æ˜æ˜Ÿå·¥ä½œå®¤æš‘æœŸç­”è¾©</p><h4 id="è½¯ä»¶ç¯å¢ƒ"><a href="#è½¯ä»¶ç¯å¢ƒ" class="headerlink" title="è½¯ä»¶ç¯å¢ƒ"></a>è½¯ä»¶ç¯å¢ƒ</h4><ol>
<li>IDEA</li>
<li>PyCharm</li>
<li>MySQL8.0</li>
</ol><a id="more"></a>

<h4 id="ä¸»è¦æŠ€æœ¯"><a href="#ä¸»è¦æŠ€æœ¯" class="headerlink" title="ä¸»è¦æŠ€æœ¯"></a>ä¸»è¦æŠ€æœ¯</h4><ol>
<li>SpringBootã€MyBatis</li>
<li>JavaScriptã€jQueryï¼Œhtmlï¼Œcss</li>
<li>Python3</li>
</ol>
<h4 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h4><h5 id="è®¾è®¡ç›®çš„ï¼š"><a href="#è®¾è®¡ç›®çš„ï¼š" class="headerlink" title="è®¾è®¡ç›®çš„ï¼š"></a>è®¾è®¡ç›®çš„ï¼š</h5><pre><code>&lt;u&gt;æ–¹ä¾¿ä¾‹ä¼šæ€»ç»“ ï¼Œæ›´åŠ æ¸…æ¥šçš„äº†è§£æˆå‘˜çš„çŠ¶æ€ç›®å½•ç»“æ„&lt;/u&gt;</code></pre><h4 id="JavaWebéƒ¨åˆ†"><a href="#JavaWebéƒ¨åˆ†" class="headerlink" title="JavaWebéƒ¨åˆ†"></a>JavaWebéƒ¨åˆ†</h4><h5 id="ç›®å½•ç»“æ„ï¼š"><a href="#ç›®å½•ç»“æ„ï¼š" class="headerlink" title="ç›®å½•ç»“æ„ï¼š"></a>ç›®å½•ç»“æ„ï¼š</h5><p><img src="https://ae01.alicdn.com/kf/Hdcc1d653c52c4ec1b02f34250c19a079Z.png" alt></p>
<ul>
<li><u>JAVAæ–‡ä»¶ç›®å½•è¯´æ˜ï¼ˆjavaç›®å½•ï¼‰</u>                </li>
</ul>
<table>
<thead>
<tr>
<th>ç›®å½•å‘½å</th>
<th>æ–‡ä»¶è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>config</td>
<td>æœ‰å„ä¸ªé¡µé¢çš„æ¥å£ï¼Œä»¥åŠç™»å½•çš„æ‹¦æˆªå™¨</td>
</tr>
<tr>
<td>controller</td>
<td>å­˜æ”¾controllerå±‚çš„javaæ–‡ä»¶</td>
</tr>
<tr>
<td>dao</td>
<td>MyBatisç”Ÿæˆçš„Mapperæ–‡ä»¶</td>
</tr>
<tr>
<td>dto</td>
<td>æ­¤ç›®å½•ä¸‹çš„å®ä½“ç±»æ²¡æœ‰å¯¹åº”çš„è¡¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä½œä¸ºå‰ç«¯æ•°æ®å±•ç¤ºçš„åª’ä»‹</td>
</tr>
<tr>
<td>pojo</td>
<td>MyBatisé€†å‘ç”Ÿæˆçš„å®ä½“ç±»ï¼Œåœ¨æ•°æ®åº“ä¸­æœ‰ç›¸åº”çš„è¡¨ä¸ä¹‹å¯¹åº”</td>
</tr>
<tr>
<td>service</td>
<td>serviceå±‚çš„ç›¸åº”æ–‡ä»¶</td>
</tr>
</tbody></table>
<p><img src="https://ae01.alicdn.com/kf/H6d882001c8834cddbd75e8803515625bP.png" alt></p>
<ul>
<li><u>é™æ€èµ„æºç›®å½•è¯´æ˜ï¼ˆresourcsç›®å½•ï¼‰</u></li>
</ul>
<table>
<thead>
<tr>
<th>ç›®å½•åç§°</th>
<th>æ–‡ä»¶è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>mapper</td>
<td>å­˜æ”¾MyBatisæ‰€ç”Ÿæˆçš„mapperæ˜ å°„æ–‡ä»¶</td>
</tr>
<tr>
<td>static&gt;ajax</td>
<td>é‡Œé¢çš„ä¸»è¦ç”¨äºå‰åç«¯æ•°æ®äº¤äº’ï¼ŒåŒ…å«æ•´ä¸ªé¡¹ç›®çš„ajaxå®ç°çš„jsæ–‡ä»¶</td>
</tr>
<tr>
<td>static&gt;templates</td>
<td>é¡µé¢HTMLæ–‡ä»¶ï¼Œåªç”¨åˆ°äº†éƒ¨åˆ†ï¼Œè‹¥æ”¹å˜æ–‡ä»¶åç§°ï¼Œéœ€è¦æ”¹å˜java&gt;config&gt;Page.javaä¸­æ¥å£å¯¹åº”çš„åç§°</td>
</tr>
</tbody></table>
<p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p>
<ol>
<li>ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ï¼ˆåˆ†ç±»å±•ç¤ºï¼‰</li>
<li>å›å¸–ä»¥åŠç­¾åˆ°æƒ…å†µçš„ç»Ÿè®¡ï¼ˆåˆ†ç±»å±•ç¤ºï¼‰</li>
<li>å„ç»„å‘¨å¹³å‡ç­¾åˆ°æ¬¡æ•°çš„å¯è§†åŒ–å±•ç¤º</li>
<li>ç®¡ç†å‘˜ç™»å½•æ—¥å¿—çš„è®°å½•åŠŸèƒ½</li>
</ol>
<h4 id="Pyhonéƒ¨åˆ†ï¼š"><a href="#Pyhonéƒ¨åˆ†ï¼š" class="headerlink" title="Pyhonéƒ¨åˆ†ï¼š"></a>Pyhonéƒ¨åˆ†ï¼š</h4><p><strong>ä¸€ã€æ‰€ç”¨çš„åº“ä¸»è¦æœ‰ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fake_useragent&#x3D;&#x3D;0.1.11</span><br><span class="line">PyMySQL&#x3D;&#x3D;0.9.3</span><br><span class="line">requests&#x3D;&#x3D;2.22.0</span><br><span class="line">beautifulsoup4&#x3D;&#x3D;4.8.0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨ä¾èµ–æ–‡ä»¶</span><br><span class="line">è¿è¡Œé¡¹ç›®ä¹‹å‰è¿›å…¥å·¥ç¨‹ç›®å½•ï¼Œåœ¨å…¶ä¸­æ‰§è¡Œ</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p><strong>äºŒã€ä¸»è¦çš„åŠŸèƒ½ï¼š</strong></p>
<ol>
<li><p>postè¡¨å’Œuserpostè¡¨çš„å¢åˆ æ”¹æŸ¥ </p>
</li>
<li><p>signè¡¨çš„æ—¥æœŸè·å–ä»¥åŠå‘¨æ•°çš„è®¡ç®— </p>
</li>
</ol>
<p>   â€‹                </p>
<p>   <strong>ä¸‰ã€å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼š</strong></p>
<pre><code>ç›®å‰ä¸ºæ­¢è„šæœ¬å·²ç»åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œäº†åå¤šå¤©äº†ï¼ŒåŸºæœ¬æ²¡å‡ºä»€ä¹ˆé”™è¯¯ï¼Œä½†æ˜¯å¼€å­¦çš„æ—¶å€™å‡ºç°äº†ä¸€äº›æŠ¥é”™ï¼Œä»¥ä¸ºæ˜¯ç‰¹æ®Šæƒ…å†µæŠ›å‡ºçš„å¼‚å¸¸ï¼Œæ²¡å¤ªåœ¨æ„ï¼Œä½†æ˜¯æ¯æ¬¡æ‰§è¡Œéƒ½ä¼šå‡ºç°è¿™ä¸ªå¼‚å¸¸ï¼Œé—®é¢˜åœ¨ä¸å›å¤å¸–å­ä¹‹åçš„ä¸€æ®µæ—¶é—´ä¹‹å†…ï¼Œå¹¶ä¸ä¼šæ˜¾ç¤ºå…·ä½“çš„æ—¶é—´èŒƒå›´ï¼Œè€Œæ˜¯æ˜¾ç¤ºçš„æ˜¯æ—¶é—´èŒƒå›´</code></pre><p>   <img src="https://ae01.alicdn.com/kf/H8e25118f3a264c148f67087769a02c5cj.png" alt></p>
<pre><code>å¦‚æœæƒ³é‡‡é›†ç²¾ç¡®åˆ°åˆ†é’Ÿçš„å›å¸–æ—¶é—´è¿™ä¸ªé—®é¢˜æš‚æ—¶æ— æ³•è§£å†³ï¼Œä½†æ˜¯å¹¶ä¸å½±å“æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œä¸€æ®µæ—¶é—´ä¹‹            åæŠ¥é”™å°±ä¼šæ¶ˆå¤±</code></pre><h4 id="ä½¿ç”¨è¯´æ˜ä¸æ³¨æ„äº‹é¡¹ï¼š"><a href="#ä½¿ç”¨è¯´æ˜ä¸æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="ä½¿ç”¨è¯´æ˜ä¸æ³¨æ„äº‹é¡¹ï¼š"></a>ä½¿ç”¨è¯´æ˜ä¸æ³¨æ„äº‹é¡¹ï¼š</h4><ol>
<li><p>æ¯å­¦æœŸä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆè®¾ç½®å¼€å­¦çš„æ—¶é—´æ‰èƒ½å¤Ÿä½¿ç”¨ï¼Œå›å¸–æƒ…å†µç»Ÿè®¡ä»¥åŠç­¾åˆ°æ¬¡æ•°çš„ç»Ÿè®¡éƒ½ä¾èµ–äºå¼€å­¦è®¾ç½®çš„æ—¶é—´</p>
<p><img src="https://ae01.alicdn.com/kf/H6b898ab682354e0e89858cbb51909d3f5.png" alt></p>
</li>
</ol>
<p>2.ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚ä¾‹ä¼šæ—¶é—´æ”¹å˜ã€ç­¾åˆ°æˆ–è®ºå›æœåŠ¡å™¨æ•…éšœã€æˆ–è€…é‡‡é›†çš„è„šæœ¬å‡ºç°æ•…éšœéƒ½æœ‰å¯èƒ½å¯¼è‡´ç»Ÿè®¡çš„ç»“æœå‡ºç°é—®é¢˜</p>
<h4 id="é¡¹ç›®ä¸è¶³ï¼š"><a href="#é¡¹ç›®ä¸è¶³ï¼š" class="headerlink" title="é¡¹ç›®ä¸è¶³ï¼š"></a>é¡¹ç›®ä¸è¶³ï¼š</h4><ol>
<li>å¯¹äºç­¾åˆ°è¯¦æƒ…ï¼Œåœ¨ä¸ªäººä¸Šä½“ç°çš„åªæœ‰æ¯å‘¨çš„ç­¾åˆ°æ€»æ•°ï¼Œæ²¡æœ‰ä¸€ä¸ªæ˜ŸæœŸçš„æ¯ä¸€å¤©çš„å…·ä½“ç­¾åˆ°çš„æ—¶é—´èŒƒå›´</li>
<li>ç»“æœå±•ç¤ºå¤§å¤šæ˜¯ä»¥å‘¨ä¸ºå•ä½çš„ï¼Œæ²¡æœ‰å®ç°æ—¶é—´æ®µçš„é€‰æ‹©åŠŸèƒ½</li>
<li>æ²¡åšç®¡ç†å‘˜çš„æƒé™æ§åˆ¶</li>
<li>åœ¨å‰åç«¯çš„æœ‰äº›ä»£ç è€¦åˆåº¦æ¯”è¾ƒé«˜ï¼Œæ²¡æœ‰åœ¨æœ€å¼€å§‹å°±æŠ½è±¡ä¸€äº›æ–¹æ³•</li>
</ol>
]]></content>
      <tags>
        <tag>æš‘æœŸç­”è¾©</tag>
      </tags>
  </entry>
  <entry>
    <title>Androidé€†å‘åŸºç¡€</title>
    <url>//post/11667.html</url>
    <content><![CDATA[<p><a href="https://blog.csdn.net/micaaa/article/details/82426710" target="_blank" rel="noopener">https://blog.csdn.net/micaaa/article/details/82426710</a></p>]]></content>
      <categories>
        <category>Android</category>
        <category>é€†å‘</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>Centoså†…æ ¸å‡çº§</title>
    <url>//post/3261.html</url>
    <content><![CDATA[<p>ç¯å¢ƒï¼š</p><p>centos-release-7-9.2009.1.el7.centos.x86_64</p><p>Docker version 23.0.5, build bc4487a</p><a id="more"></a>


<p><strong>1ã€é—®é¢˜</strong></p>
<p>å®‰è£… Docker æ€»æ˜¯å‡ºç°è¿™ä¸ªé”™è¯¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kernel:unregister_netdevice: waiting for lo to become free. Usage count = 1</span><br></pre></td></tr></table></figure>

<p>2ã€<strong>è§£å†³</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum update -y kernel</span><br><span class="line">cat /etc/grub2.cfg | awk -F\' '$1=="menuentry " &#123;print i++ " : " $2&#125;'</span><br><span class="line">vim /etc/default/grub #ä¿®æ”¹æˆ GRUB_DEFAULT=0</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬æ˜¯å¦&gt;=3.10.0-1160</span></span><br><span class="line">reboot</span><br><span class="line">uname -a</span><br></pre></td></tr></table></figure>

<p><strong>å‚è€ƒ</strong></p>
<ul>
<li>[1] <a href="https://help.aliyun.com/document_detail/416769.html" target="_blank" rel="noopener">å†…æ ¸bugä¿®å¤æ–¹æ¡ˆï¼šç½‘ç»œè®¾å¤‡å¼•ç”¨è®¡æ•°æ³„æ¼</a></li>
</ul>
]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerä¸‹ä½¿ç”¨Nginxé…ç½®å¤šç«™ç‚¹</title>
    <url>//post/24743.html</url>
    <content><![CDATA[<p><code>docker run -p 80:80 -p 81:81 --name nginx -v /root/nginx/www/dvwa/:/usr/share/nginx/html/dvwa -v /root/nginx/conf.d:/etc/nginx/conf.d  -v /root/nginx/www/xss:/usr/share/nginx/html/xss   --link php:php --link mysql:mysql -d nginx:latest</code></p><a id="more"></a>
<p><code>æ–¹å¼ä¸€ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆéœ€åœæ­¢dockeræœåŠ¡ï¼‰</code><br><code>1ã€åœæ­¢dockeræœåŠ¡</code><br><code>systemctl stop docker.serviceï¼ˆå…³é”®ï¼Œä¿®æ”¹ä¹‹å‰å¿…é¡»åœæ­¢dockeræœåŠ¡ï¼‰</code><br><code>2ã€vim /var/lib/docker/containers/container-ID/config.v2.json</code><br><code>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç›®å½•ä½ç½®ï¼Œç„¶åä¿å­˜é€€å‡º</code></p>
<p> <code>&quot;MountPoints&quot;:{&quot;/home&quot;:{&quot;Source&quot;:&quot;/docker&quot;,&quot;Destination&quot;:&quot;/home&quot;,&quot;RW&quot;:true,&quot;Name&quot;:&quot;&quot;,&quot;Driver&quot;:&quot;&quot;,&quot;Type&quot;:&quot;bind&quot;,&quot;Propagation&quot;:&quot;rprivate&quot;,&quot;Spec&quot;:{&quot;Type&quot;:&quot;bind&quot;,&quot;Source&quot;:&quot;//docker/&quot;,&quot;Target&quot;:&quot;/home&quot;}}}</code><br><code>1</code><br><code>3ã€å¯åŠ¨dockeræœåŠ¡</code><br><code>systemctl start docker.service</code><br><code>4ã€å¯åŠ¨dockerå®¹å™¨</code><br><code>docker start &lt;container-name/ID&gt;</code></p>
]]></content>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>64ä½ç³»ç»Ÿè¿è¡Œ32ä½å¯æ‰§è¡Œæ–‡ä»¶</title>
    <url>//post/undefined.html</url>
    <content><![CDATA[<p>å½“ä½ æ‰§è¡Œä¸€ä¸ª32ä½ç¨‹åºçš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šå‘ç°æç¤ºNo such file ordirectoryï¼Œè¿™å°±æ˜¯è¯´æ˜ä½ çš„64ä½ç³»ç»Ÿæ²¡æœ‰å®‰è£…32ä½çš„libåº“ï¼Œå¦‚ä½•çŸ¥é“ä¸€ä¸ªç¨‹åºæ˜¯32ä½è¿˜æ˜¯64ä½å‘¢ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡readelfæ¥çœ‹ã€‚å‘ƒï¼Œå¦‚æœä½ ç¡®å®šä½ æ‰§è¡Œçš„æ˜¯32ä½ç¨‹åºï¼Œè€Œä½ æ˜¯64ä½ç³»ç»Ÿï¼Œåˆ™å‡ºç°Nosuch file or directoryé”™è¯¯å°±æ˜¯å› ä¸ºä½ ç¼ºå°‘äº†32ä½çš„åº“æ–‡ä»¶ã€‚è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname -a </span><br><span class="line">æŸ¥çœ‹CPUæ¶æ„</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2021/01/14/ad06d31bcadc885b4e9b9a172e7e168e.png" alt="image-20210114112003303"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file æ–‡ä»¶åæŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2021/01/14/2a33ae84d91cf89bbe07ff151d92a0cc.png" alt="image-20210114112124794"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å®‰è£…32ä½çš„åº“</span></span><br><span class="line">apt-get update</span><br><span class="line">apt install lib32z1</span><br><span class="line"><span class="meta">#</span><span class="bash">æˆ–è€…apt install lib32ncurses5</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2021/01/14/dc0a0c7a729eadcc6583973c5afb8b25.png" alt="image-20210114112507406"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®‰è£…å…±äº«åº“</span><br><span class="line">apt install g++-multilib</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹CPUå‹å·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;cpuinfo</span><br><span class="line">#æŸ¥çœ‹è‡ªè¡Œä½æ•°ï¼ˆCPUå­—é•¿ï¼‰</span><br><span class="line">getconf LONG_BIT</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2021/01/14/9afe6dff116178fcd51ac84d6d9c81d4.png" alt="image-20210114113728795"></p>
]]></content>
  </entry>
  <entry>
    <title>ChatGPTèŠ‚ç‚¹</title>
    <url>//post/65427.html</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>æ—¥æœŸ</th>
<th>èŠ‚ç‚¹</th>
<th>å»¶æ—¶</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>4.28</td>
<td>_GB_è‹±å›½ 2</td>
<td>497</td>
<td></td>
</tr>
<tr>
<td>4.28</td>
<td>_KE_è‚¯å°¼äºš</td>
<td>467</td>
<td></td>
</tr>
<tr>
<td>4.29</td>
<td>_US_ç¾å›½ 7</td>
<td>432</td>
<td>y</td>
</tr>
<tr>
<td>5.1</td>
<td>_US_ç¾å›½-&gt;ğŸ‡³ğŸ‡±_NL_è·å…°</td>
<td>586</td>
<td></td>
</tr>
<tr>
<td>5.2</td>
<td>ğŸ‡¨ğŸ‡¾ _CY_å¡æµ¦è·¯æ–¯</td>
<td>946</td>
<td></td>
</tr>
<tr>
<td>5.2</td>
<td>_US_ç¾å›½-&gt;ğŸ‡¦ğŸ‡·_AR_é˜¿æ ¹å»·</td>
<td>1140</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>]]></content>
  </entry>
  <entry>
    <title>Dockeræ­å»ºHadoopé›†ç¾¤</title>
    <url>//post/61036.html</url>
    <content><![CDATA[<p>Dockerå®‰è£…</p><p>hadoop 2.7.2çš„Dockeré•œåƒ  twinsen/hadoop:2.7.2</p><a id="more"></a>

<h5 id="3-åˆ›å»ºhadoopå®¹å™¨"><a href="#3-åˆ›å»ºhadoopå®¹å™¨" class="headerlink" title="3)åˆ›å»ºhadoopå®¹å™¨"></a>3)åˆ›å»ºhadoopå®¹å™¨</h5><p>ï¼ˆ1ï¼‰åˆ›å»ºmasterèŠ‚ç‚¹<br><code>docker run --name master -d -h master twinsen/hadoop:2.7.2</code><br><strong>å‚æ•°è¯´æ˜:</strong><br>-h ä¸ºå®¹å™¨è®¾ç½®ä¸»æœºå<br>â€“name è®¾ç½®å®¹å™¨çš„åç§°<br>-d åœ¨åå°è¿è¡Œ</p>
<p>ï¼ˆ2ï¼‰ä»¥æ­¤æ–¹æ³•åˆ›å»ºslave1å’Œslave2èŠ‚ç‚¹<br><code>docker run --name slave1 -d -h slave1 twinsen/hadoop:2.7.2</code><br><code>docker run --name slave2 -d -h slave2 twinsen/hadoop:2.7.2</code><br>ï¼ˆ3ï¼‰æŸ¥çœ‹å®¹å™¨<br><code>docker ps -s</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">/root/hadoop/sbin</span><br><span class="line"></span><br><span class="line">docker run --name master  --rm  twinsen/hadoop:<span class="number">2.7</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">docker run --name  hadoop-slave1 -itd   -P --network hadoop twinsen/hadoop:<span class="number">2.7</span><span class="number">.2</span> </span><br><span class="line"></span><br><span class="line">docker run --name  hadoop-slave2 -itd   -P --network hadoop twinsen/hadoop:<span class="number">2.7</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">docker run --name  hadoop-slave3 -itd -P  --network hadoop twinsen/hadoop:<span class="number">2.7</span><span class="number">.2</span></span><br><span class="line">    </span><br><span class="line">docker run --name  hadoop-master -it  -d  -P  --network hadoop  twinsen/hadoop:<span class="number">2.7</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<p>cd /</p>
]]></content>
  </entry>
  <entry>
    <title>Dockeræ­å»º SoftEther VPN</title>
    <url>//post/43889.html</url>
    <content><![CDATA[<p>1ã€è¿è¡ŒDockeré•œåƒ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">	--name=softethervpn \</span><br><span class="line">       	--restart=always --cap-add NET_ADMIN \</span><br><span class="line">	-p 500:500/udp \</span><br><span class="line">       	-p 4500:4500/udp \</span><br><span class="line">	-p 1701:1701/tcp \</span><br><span class="line">	-p 1194:1194/udp \</span><br><span class="line">	-p 5555:5555/tcp \</span><br><span class="line">       	-e SPW=è¶…çº§ç®¡ç†å‘˜å¯†ç  \</span><br><span class="line">	-e HPW=æ™®é€šç®¡ç†å‘˜å¯†ç  \</span><br><span class="line">       	-e PSK=vpn \</span><br><span class="line">	-e USERNAME=ç”¨æˆ·å \</span><br><span class="line">	-v /dev/null:/usr/vpnserver/server_log \</span><br><span class="line">	-v /dev/null:/usr/vpnserver/packet_log \</span><br><span class="line">        -v /dev/null:/usr/vpnserver/security_log\</span><br><span class="line">        -e PASSWORD=å¯†ç  \</span><br><span class="line">	siomiz/softethervpn:alpine</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Celeryåå°å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—</title>
    <url>//post/905.html</url>
    <content><![CDATA[<p>å®˜æ–¹ä¸­æ–‡æ–‡æ¡£</p><p><a href="https://dormousehole.readthedocs.io/en/latest/patterns/celery.html" target="_blank" rel="noopener">https://dormousehole.readthedocs.io/en/latest/patterns/celery.html</a></p><a id="more"></a>

<p>å®˜æ–¹è‹±æ–‡æ–‡æ¡£</p>
<p><a href="https://pypi.org/project/celery_once/#backends" target="_blank" rel="noopener">https://pypi.org/project/celery_once/#backends</a></p>
<p>æè¾‰ Flaskå¼€å‘ç•ªå¤–ç¯‡ <a href="https://www.zhihu.com/topic/20203769/hot" target="_blank" rel="noopener">https://www.zhihu.com/topic/20203769/hot</a></p>
<p><a href="https://www.tuicool.com/articles/UziEN3I" target="_blank" rel="noopener">https://www.tuicool.com/articles/UziEN3I</a></p>
<p>åŠ åˆ†å¸ƒå¼é” <a href="http://einverne.github.io/post/2018/01/use-celery-once-to-prevent-multiple-execution.html" target="_blank" rel="noopener">http://einverne.github.io/post/2018/01/use-celery-once-to-prevent-multiple-execution.html</a></p>
<p><a href="https://pypi.org/project/celery_once/#backends" target="_blank" rel="noopener">https://pypi.org/project/celery_once/#backends</a></p>
<p><a href="https://www.jianshu.com/p/b1934ff22b06" target="_blank" rel="noopener">https://www.jianshu.com/p/b1934ff22b06</a></p>
<p>æ¨èï¼ˆä¸­æ–‡ï¼‰</p>
<p><a href="https://www.celerycn.io/ru-men/celery-jin-jie-shi-yong" target="_blank" rel="noopener">https://www.celerycn.io/ru-men/celery-jin-jie-shi-yong</a></p>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Celery</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockeréƒ¨ç½²Flask</title>
    <url>//post/49387.html</url>
    <content><![CDATA[<p>Dokcerçš„å®‰è£…</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨è„šæœ¬è‡ªåŠ¨å®‰è£…</span><br><span class="line">åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­ Docker å®˜æ–¹ä¸ºäº†ç®€åŒ–å®‰è£…æµç¨‹ï¼Œæä¾›äº†ä¸€å¥—ä¾¿æ·çš„å®‰è£…è„šæœ¬ï¼ŒUbuntu ç³»ç»Ÿä¸Šå¯ä»¥ä½¿ç”¨è¿™å¥—è„šæœ¬å®‰è£…ï¼Œå¦å¤–å¯ä»¥é€šè¿‡ --mirror é€‰é¡¹ä½¿ç”¨å›½å†…æºè¿›è¡Œå®‰è£…ï¼š</span><br><span class="line">curl -fsSL get.docker.com -o get-docker.sh</span><br><span class="line">sudo sh get-docker.sh --mirror Aliyun</span><br><span class="line"># $ sudo sh get-docker.sh --mirror AzureChinaCloud</span><br><span class="line">æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨çš„å°†ä¸€åˆ‡å‡†å¤‡å·¥ä½œåšå¥½ï¼Œå¹¶ä¸”æŠŠ Docker CE çš„ç¨³å®š(stable)ç‰ˆæœ¬å®‰è£…åœ¨ç³»ç»Ÿä¸­ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ubuntu 16.04+ã€Debian 8+ã€CentOS 7</span><br><span class="line">åœ¨ &#x2F;etc&#x2F;docker&#x2F;daemon.json ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨è¯·æ–°å»ºè¯¥æ–‡ä»¶ï¼‰</span><br><span class="line">&#123;</span><br><span class="line">&quot;registry-mirrors&quot;: [</span><br><span class="line">&quot;https:&#x2F;&#x2F;hub-mirror.c.163.com&quot;,</span><br><span class="line">&quot;https:&#x2F;&#x2F;mirror.baidubce.com&quot;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>


<h1 id="å¯åŠ¨-Docker-CE"><a href="#å¯åŠ¨-Docker-CE" class="headerlink" title="å¯åŠ¨ Docker CE"></a>å¯åŠ¨ Docker CE</h1><p>é•œåƒåŠ é€Ÿ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> docker</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start docker</span></span><br></pre></td></tr></table></figure>

<h1 id="å»ºç«‹-docker-ç”¨æˆ·ç»„"><a href="#å»ºç«‹-docker-ç”¨æˆ·ç»„" class="headerlink" title="å»ºç«‹ docker ç”¨æˆ·ç»„"></a>å»ºç«‹ docker ç”¨æˆ·ç»„</h1><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>docker</code> å‘½ä»¤ä¼šä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Unix_domain_socket" target="_blank" rel="noopener">Unix socket</a> ä¸ Docker å¼•æ“é€šè®¯ã€‚è€Œåªæœ‰ <code>root</code> ç”¨æˆ·å’Œ <code>docker</code> ç»„çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—® Docker å¼•æ“çš„ Unix socketã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸€èˆ¬ Linux ç³»ç»Ÿä¸Šä¸ä¼šç›´æ¥ä½¿ç”¨ <code>root</code> ç”¨æˆ·ã€‚å› æ­¤ï¼Œæ›´å¥½åœ°åšæ³•æ˜¯å°†éœ€è¦ä½¿ç”¨ <code>docker</code> çš„ç”¨æˆ·åŠ å…¥ <code>docker</code> ç”¨æˆ·ç»„ã€‚</p>
<p>å»ºç«‹ <code>docker</code> ç»„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo groupadd docker</span><br></pre></td></tr></table></figure>

<p>å°†å½“å‰ç”¨æˆ·åŠ å…¥ <code>docker</code> ç»„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure>

<p>é€€å‡ºå½“å‰ç»ˆç«¯å¹¶é‡æ–°ç™»å½•ï¼Œè¿›è¡Œå¦‚ä¸‹æµ‹è¯•ã€‚</p>
<h1 id="æµ‹è¯•-Docker-æ˜¯å¦å®‰è£…æ­£ç¡®"><a href="#æµ‹è¯•-Docker-æ˜¯å¦å®‰è£…æ­£ç¡®" class="headerlink" title="æµ‹è¯• Docker æ˜¯å¦å®‰è£…æ­£ç¡®"></a>æµ‹è¯• Docker æ˜¯å¦å®‰è£…æ­£ç¡®</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ docker run hello-world</span><br></pre></td></tr></table></figure>

<p>1ã€Dockerå¯è§†åŒ–é¢æ¿å®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 5471:10086 -v /var/run/docker.sock:/var/run/docker.sock tobegit3hub/seagull</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -p 8888:8888 --name swzl cb1642485ca7  -v &#x2F;www&#x2F;wwwroot&#x2F;ctguswzl.cn:&#x2F;www&#x2F;wwwroot&#x2F;ctguswzl.cn flask:latest</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -it  --rm&#x3D;true -p 8888:8888  -v &#x2F;www&#x2F;wwwroot&#x2F;ctguswzl.cn:&#x2F;www&#x2F;wwwroot&#x2F;ctguswzl.cn flask:latest	 &#x2F;bin&#x2F;sh</span><br><span class="line"></span><br><span class="line">docker run -it  -p 8888:8888  -v &#x2F;www&#x2F;wwwroot&#x2F;ctguswzl.cn:&#x2F;www&#x2F;wwwroot&#x2F;ctguswzl.cn flask:latest	 &#x2F;bin&#x2F;sh</span><br><span class="line"></span><br><span class="line">docker run -it  -p 8888:8888 --name flask -v &#x2F;www&#x2F;wwwroot&#x2F;ctguswzl.cn:&#x2F;www&#x2F;wwwroot&#x2F;ctguswzl.cn registry.cn-hangzhou.aliyuncs.com&#x2F;iboy&#x2F;ctguswzl:1.0	 &#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<p>mkdir -p /www/wwwroot/ctguswzl.cn<br>mkdir -p /www/server</p>
<p>è¿ç§»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tar -zcvf server.tar.gz  *</span><br></pre></td></tr></table></figure>

<p>cerbootå®ç°æ³›åŸŸåè¯ä¹¦è‡ªåŠ¨ç»­æœŸ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºç›®å½•</span><br><span class="line">mkdir -p &#x2F;www&#x2F;server&#x2F;certbot</span><br><span class="line"></span><br><span class="line"># è¿›å…¥ç›®å½•</span><br><span class="line">cd &#x2F;www&#x2F;server&#x2F;certbot</span><br><span class="line"></span><br><span class="line"># ä¸‹è½½</span><br><span class="line">wget https:&#x2F;&#x2F;dl.eff.org&#x2F;certbot-auto</span><br><span class="line"></span><br><span class="line"># è®¾ä¸ºå¯æ‰§è¡Œæƒé™</span><br><span class="line">chmod +x certbot-auto</span><br><span class="line"></span><br><span class="line"># åŠ å…¥åˆ°ç³»ç»Ÿå¯æ‰§è¡Œç›®å½•</span><br><span class="line">ln -s &#x2F;www&#x2F;server&#x2F;certbot&#x2F;certbot-auto &#x2F;usr&#x2F;bin&#x2F;</span><br><span class="line"></span><br><span class="line"># ç”³è¯·è¯ä¹¦ï¼Œæ›¿æ¢æˆä½ è‡ªå·±çš„åŸŸå</span><br><span class="line">ln -s &#x2F;www&#x2F;server&#x2F;certbot&#x2F;certbot-auto &#x2F;usr&#x2F;bin&#x2F; </span><br><span class="line">ln -s &#x2F;www&#x2F;server&#x2F;certbot&#x2F;certbot-auto &#x2F;usr&#x2F;bin&#x2F; \</span><br><span class="line">&amp;&amp; certbot-auto -d &quot;*.ctguswzl.cn&quot;  -d  &quot;ctguswzl.cn&quot; --manual --preferred-challenges dns-01 certonly --server https:&#x2F;&#x2F;acme-v02.api.letsencrypt.org&#x2F;directory</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 0 *&#x2F;1 * * root certbot-auto renew --manual --preferred-challenges dns --deploy-hook  &quot;docker start nginx&quot; --manual-auth-hook &quot;&#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh python aly add&quot; --manual-cleanup-hook &quot;&#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh python aly clean&quot; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">certbot-auto renew --cert-name ctguswzl.cn --manual-auth-hook &#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh --dry-run</span><br><span class="line"></span><br><span class="line">0 3 1 * * certbot-auto renew --renew-hook &quot;sudo nginx -s reload&quot;</span><br><span class="line">0 3 1 * * certbot-auto renew --renew-hook &quot;sudo nginx -s reload&quot;</span><br><span class="line"></span><br><span class="line">0 1 *&#x2F;1 * * certbot renew  --force-renewal --cert-name ctguswzl.cn --preferred-challenges dns --server https:&#x2F;&#x2F;acme-v02.api.letsencrypt.org&#x2F;directory --manual --manual-auth-hook &quot;&#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh python txy add&quot; --manual-cleanup-hook &quot;&#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh python txy clean&quot; &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;bin&#x2F;sh -c cd &#x2F;www&#x2F;server&#x2F;certbot &amp;&amp; certbot-auto renew  --force-renewal --cert-name ctguswzl.cn --preferred-challenges dns --server https:&#x2F;&#x2F;acme-v02.api.letsencrypt.org&#x2F;directory --manual --manual-auth-hook &quot;&#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh python txy add&quot; --manual-cleanup-hook &quot;&#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh python txy clean&quot; --renew-hook &quot;docker restart nginx&quot;  &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ç»­ç­¾è¯ä¹¦</span><br><span class="line">0 1 * * * &#x2F;bin&#x2F;sh -c  &#x2F;www&#x2F;server&#x2F;certbot&#x2F;certbot-auto renew  --force-renewal --cert-name ctguswzl.cn --preferred-challenges dns --server https:&#x2F;&#x2F;acme-v02.api.letsencrypt.org&#x2F;directory --manual --manual-auth-hook &quot;&#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh python txy add&quot; --manual-cleanup-hook &quot;&#x2F;www&#x2F;server&#x2F;certbot&#x2F;tool&#x2F;au.sh python txy clean&quot; --renew-hook &quot;docker restart nginx&quot;  &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line">sudo apt-get install python3.6-venv</span><br></pre></td></tr></table></figure>

<p>æ­£è§£</p>
<p>apt-get purge python-virtualenv python3-virtualenv virtualenv<br>pip install virtualenv</p>
<p> pip install virtualenv==16.1</p>
<h2 id="Dockerå¯è§†åŒ–é¢æ¿"><a href="#Dockerå¯è§†åŒ–é¢æ¿" class="headerlink" title="Dockerå¯è§†åŒ–é¢æ¿"></a>Dockerå¯è§†åŒ–é¢æ¿</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 9000:9000 \</span><br><span class="line">-v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock \</span><br><span class="line">-v portainer_data:&#x2F;data \</span><br><span class="line">portainer&#x2F;portainer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -d -p 9000:9000 -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock -v portainer_data:&#x2F;data -v &#x2F;public:&#x2F;public portainer&#x2F;portainer:1.20.2</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> docker commit -a &quot;iBoy&quot; -m &quot;Portainerä¸­æ–‡æ±‰åŒ–&quot; 398562fad864  registry.cn-hangzhou.aliyuncs.com&#x2F;iboy&#x2F;portainer:1.0</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">docker run -d \</span><br><span class="line">-p 9001:9000 \</span><br><span class="line">-v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock \</span><br><span class="line">-v portainer_data:&#x2F;data \</span><br><span class="line"> registry.cn-hangzhou.aliyuncs.com&#x2F;iboy&#x2F;portainer:1.0	</span><br><span class="line"> </span><br><span class="line"> https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_42851117&#x2F;article&#x2F;details&#x2F;106645555</span><br><span class="line"> </span><br><span class="line"> docker run -d -p 9000:9000 --restart&#x3D;always  -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock --name prtainer  registry.cn-zhangjiakou.aliyuncs.com&#x2F;ctgu&#x2F;portainer</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  docker run -d -p 9000:9000 --restart&#x3D;always  -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock -v pcn_data:&#x2F;data  --name prtainer5  registry.cn-zhangjiakou.aliyuncs.com&#x2F;ctgu&#x2F;portainer</span><br><span class="line">  </span><br><span class="line">  docker cp &#x2F;root&#x2F;public&#x2F;. 2a8:&#x2F;public&#x2F; </span><br><span class="line"></span><br><span class="line">registry.cn-zhangjiakou.aliyuncs.com&#x2F;ctgu&#x2F;portainer</span><br></pre></td></tr></table></figure>

<h4 id="docker-composeå®‰è£…"><a href="#docker-composeå®‰è£…" class="headerlink" title="docker-composeå®‰è£…"></a>docker-composeå®‰è£…</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo curl -L https://github.wuyanzheshui.workers.dev/docker/compose/releases/download/1.26.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>ç§˜é’¥ç™»å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scp id_rsa.pub root@192.168.19.7:~&#x2F;.ssh</span><br><span class="line">æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ PuTTY ç­‰ SSH å®¢æˆ·ç«¯æ¥è¿œç¨‹ç®¡ç† Linux æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œä¸€èˆ¬çš„å¯†ç æ–¹å¼ç™»å½•ï¼Œå®¹æ˜“æœ‰å¯†ç è¢«æš´åŠ›ç ´è§£çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°† SSH çš„ç«¯å£è®¾ç½®ä¸ºé»˜è®¤çš„ 22 ä»¥å¤–çš„ç«¯å£ï¼Œæˆ–è€…ç¦ç”¨ root è´¦æˆ·ç™»å½•ã€‚å…¶å®ï¼Œæœ‰ä¸€ä¸ªæ›´å¥½çš„åŠæ³•æ¥ä¿è¯å®‰å…¨ï¼Œè€Œä¸”è®©ä½ å¯ä»¥æ”¾å¿ƒåœ°ç”¨ root è´¦æˆ·ä»è¿œç¨‹ç™»å½•â€”â€”é‚£å°±æ˜¯é€šè¿‡å¯†é’¥æ–¹å¼ç™»å½•ã€‚</span><br><span class="line"></span><br><span class="line">å¯†é’¥å½¢å¼ç™»å½•çš„åŸç†æ˜¯ï¼šåˆ©ç”¨å¯†é’¥ç”Ÿæˆå™¨åˆ¶ä½œä¸€å¯¹å¯†é’¥â€”â€”ä¸€åªå…¬é’¥å’Œä¸€åªç§é’¥ã€‚å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨çš„æŸä¸ªè´¦æˆ·ä¸Šï¼Œç„¶ååœ¨å®¢æˆ·ç«¯åˆ©ç”¨ç§é’¥å³å¯å®Œæˆè®¤è¯å¹¶ç™»å½•ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ²¡æœ‰ç§é’¥ï¼Œä»»ä½•äººéƒ½æ— æ³•é€šè¿‡ SSH æš´åŠ›ç ´è§£ä½ çš„å¯†ç æ¥è¿œç¨‹ç™»å½•åˆ°ç³»ç»Ÿã€‚æ­¤å¤–ï¼Œå¦‚æœå°†å…¬é’¥å¤åˆ¶åˆ°å…¶ä»–è´¦æˆ·ç”šè‡³ä¸»æœºï¼Œåˆ©ç”¨ç§é’¥ä¹Ÿå¯ä»¥ç™»å½•ã€‚</span><br><span class="line"></span><br><span class="line">ä¸‹é¢æ¥è®²è§£å¦‚ä½•åœ¨ Linux æœåŠ¡å™¨ä¸Šåˆ¶ä½œå¯†é’¥å¯¹ï¼Œå°†å…¬é’¥æ·»åŠ ç»™è´¦æˆ·ï¼Œè®¾ç½® SSHï¼Œæœ€åé€šè¿‡å®¢æˆ·ç«¯ç™»å½•ã€‚</span><br><span class="line"></span><br><span class="line">1. åˆ¶ä½œå¯†é’¥å¯¹</span><br><span class="line"></span><br><span class="line">é¦–å…ˆåœ¨æœåŠ¡å™¨ä¸Šåˆ¶ä½œå¯†é’¥å¯¹ã€‚é¦–å…ˆç”¨å¯†ç ç™»å½•åˆ°ä½ æ‰“ç®—ä½¿ç”¨å¯†é’¥ç™»å½•çš„è´¦æˆ·ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</span><br><span class="line"></span><br><span class="line">[root@host ~]$ ssh-keygen  &lt;&#x3D;&#x3D; å»ºç«‹å¯†é’¥å¯¹</span><br><span class="line">Generating public&#x2F;private rsa key pair.</span><br><span class="line">Enter file in which to save the key (&#x2F;root&#x2F;.ssh&#x2F;id_rsa): &lt;&#x3D;&#x3D; æŒ‰ Enter</span><br><span class="line">Created directory &#39;&#x2F;root&#x2F;.ssh&#39;.</span><br><span class="line">Enter passphrase (empty for no passphrase): &lt;&#x3D;&#x3D; è¾“å…¥å¯†é’¥é”ç ï¼Œæˆ–ç›´æ¥æŒ‰ Enter ç•™ç©º</span><br><span class="line">Enter same passphrase again: &lt;&#x3D;&#x3D; å†è¾“å…¥ä¸€éå¯†é’¥é”ç </span><br><span class="line">Your identification has been saved in &#x2F;root&#x2F;.ssh&#x2F;id_rsa. &lt;&#x3D;&#x3D; ç§é’¥</span><br><span class="line">Your public key has been saved in &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub. &lt;&#x3D;&#x3D; å…¬é’¥</span><br><span class="line">The key fingerprint is:</span><br><span class="line">0f:d3:e7:1a:1c:bd:5c:03:f1:19:f1:22:df:9b:cc:08 root@host</span><br><span class="line">å¯†é’¥é”ç åœ¨ä½¿ç”¨ç§é’¥æ—¶å¿…é¡»è¾“å…¥ï¼Œè¿™æ ·å°±å¯ä»¥ä¿æŠ¤ç§é’¥ä¸è¢«ç›—ç”¨ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç•™ç©ºï¼Œå®ç°æ— å¯†ç ç™»å½•ã€‚</span><br><span class="line"></span><br><span class="line">ç°åœ¨ï¼Œåœ¨ root ç”¨æˆ·çš„å®¶ç›®å½•ä¸­ç”Ÿæˆäº†ä¸€ä¸ª .ssh çš„éšè—ç›®å½•ï¼Œå†…å«ä¸¤ä¸ªå¯†é’¥æ–‡ä»¶ã€‚id_rsa ä¸ºç§é’¥ï¼Œid_rsa.pub ä¸ºå…¬é’¥ã€‚</span><br><span class="line"></span><br><span class="line">2. åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å…¬é’¥</span><br><span class="line"></span><br><span class="line">é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å…¬é’¥ï¼š</span><br><span class="line"></span><br><span class="line">[root@host ~]$ cd .ssh</span><br><span class="line">[root@host .ssh]$ cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line">å¦‚æ­¤ä¾¿å®Œæˆäº†å…¬é’¥çš„å®‰è£…ã€‚ä¸ºäº†ç¡®ä¿è¿æ¥æˆåŠŸï¼Œè¯·ä¿è¯ä»¥ä¸‹æ–‡ä»¶æƒé™æ­£ç¡®ï¼š</span><br><span class="line"></span><br><span class="line">[root@host .ssh]$ chmod 600 authorized_keys</span><br><span class="line">[root@host .ssh]$ chmod 700 ~&#x2F;.ssh</span><br><span class="line">3. è®¾ç½® SSHï¼Œæ‰“å¼€å¯†é’¥ç™»å½•åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">ç¼–è¾‘ &#x2F;etc&#x2F;ssh&#x2F;sshd_config æ–‡ä»¶ï¼Œè¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š</span><br><span class="line"></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">å¦å¤–ï¼Œè¯·ç•™æ„ root ç”¨æˆ·èƒ½å¦é€šè¿‡ SSH ç™»å½•ï¼š</span><br><span class="line"></span><br><span class="line">PermitRootLogin yes</span><br><span class="line">å½“ä½ å®Œæˆå…¨éƒ¨è®¾ç½®ï¼Œå¹¶ä»¥å¯†é’¥æ–¹å¼ç™»å½•æˆåŠŸåï¼Œå†ç¦ç”¨å¯†ç ç™»å½•ï¼š</span><br><span class="line"></span><br><span class="line">PasswordAuthentication no</span><br><span class="line">æœ€åï¼Œé‡å¯ SSH æœåŠ¡ï¼š</span><br><span class="line"></span><br><span class="line">[root@host .ssh]$ service sshd restart</span><br><span class="line">4. å°†ç§é’¥ä¸‹è½½åˆ°å®¢æˆ·ç«¯ï¼Œç„¶åè½¬æ¢ä¸º PuTTY èƒ½ä½¿ç”¨çš„æ ¼å¼</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨Â WinSCPã€SFTP ç­‰å·¥å…·å°†ç§é’¥æ–‡ä»¶ id_rsa ä¸‹è½½åˆ°å®¢æˆ·ç«¯æœºå™¨ä¸Šã€‚ç„¶åæ‰“å¼€Â PuTTYGenï¼Œå•å‡» Actions ä¸­çš„ Load æŒ‰é’®ï¼Œè½½å…¥ä½ åˆšæ‰ä¸‹è½½åˆ°çš„ç§é’¥æ–‡ä»¶ã€‚å¦‚æœä½ åˆšæ‰è®¾ç½®äº†å¯†é’¥é”ç ï¼Œè¿™æ—¶åˆ™éœ€è¦è¾“å…¥ã€‚</span><br><span class="line"></span><br><span class="line">è½½å…¥æˆåŠŸåï¼ŒPuTTYGen ä¼šæ˜¾ç¤ºå¯†é’¥ç›¸å…³çš„ä¿¡æ¯ã€‚åœ¨ Key comment ä¸­é”®å…¥å¯¹å¯†é’¥çš„è¯´æ˜ä¿¡æ¯ï¼Œç„¶åå•å‡» Save private key æŒ‰é’®å³å¯å°†ç§é’¥æ–‡ä»¶å­˜æ”¾ä¸º PuTTY èƒ½ä½¿ç”¨çš„æ ¼å¼ã€‚</span><br><span class="line"></span><br><span class="line">ä»Šåï¼Œå½“ä½ ä½¿ç”¨ PuTTY ç™»å½•æ—¶ï¼Œå¯ä»¥åœ¨å·¦ä¾§çš„ Connection -&gt; SSH -&gt; Auth ä¸­çš„ Private key file for authentication: å¤„é€‰æ‹©ä½ çš„ç§é’¥æ–‡ä»¶ï¼Œç„¶åå³å¯ç™»å½•äº†ï¼Œè¿‡ç¨‹ä¸­åªéœ€è¾“å…¥å¯†é’¥é”ç å³å¯ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>C++</title>
    <url>//post/15279.html</url>
    <content><![CDATA[<h1 id="C-åŸºæœ¬æ•°æ®ç±»å‹å å­—èŠ‚æ•°"><a href="#C-åŸºæœ¬æ•°æ®ç±»å‹å å­—èŠ‚æ•°" class="headerlink" title="C++åŸºæœ¬æ•°æ®ç±»å‹å å­—èŠ‚æ•°"></a><a href="https://www.cnblogs.com/home123/p/7397267.html" target="_blank" rel="noopener">C++åŸºæœ¬æ•°æ®ç±»å‹å å­—èŠ‚æ•°</a></h1><p><strong>32ä½ç¼–è¯‘å™¨</strong></p><p>char ï¼š1ä¸ªå­—èŠ‚<br>char<em>ï¼ˆå³æŒ‡é’ˆå˜é‡ï¼‰: 4ä¸ªå­—èŠ‚ï¼ˆ32ä½çš„å¯»å€ç©ºé—´æ˜¯2^32, å³32ä¸ªbitï¼Œä¹Ÿå°±æ˜¯4ä¸ªå­—èŠ‚ã€‚åŒç†64ä½ç¼–è¯‘å™¨ï¼‰<br>short int : 2ä¸ªå­—èŠ‚<br>intï¼š 4ä¸ªå­—èŠ‚<br>unsigned int : 4ä¸ªå­—èŠ‚<br>float: 4ä¸ªå­—èŠ‚<br>double:  8ä¸ªå­—èŠ‚<br>*</em>long:  4ä¸ªå­—èŠ‚**<br>long long: 8ä¸ªå­—èŠ‚<br>unsigned long: 4ä¸ªå­—èŠ‚</p><a id="more"></a>

<p><strong>64ä½ç¼–è¯‘å™¨</strong></p>
<p>char ï¼š1ä¸ªå­—èŠ‚<br>char<em>(å³æŒ‡é’ˆå˜é‡): 8ä¸ªå­—èŠ‚<br>short int : 2ä¸ªå­—èŠ‚<br>intï¼š 4ä¸ªå­—èŠ‚<br>unsigned int : 4ä¸ªå­—èŠ‚<br>float: 4ä¸ªå­—èŠ‚<br>double:  8ä¸ªå­—èŠ‚<br>*</em>long:  8ä¸ªå­—èŠ‚**<br>long long: 8ä¸ªå­—èŠ‚<br>unsigned long: 8ä¸ªå­—èŠ‚</p>
<h1 id="greater-å’Œless"><a href="#greater-å’Œless" class="headerlink" title="greater() å’Œless ()"></a>greater<t>() å’Œless<t> ()</t></t></h1><blockquote>
<p><a href="https://blog.csdn.net/Ginsn/article/details/81590473?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param" target="_blank" rel="noopener">https://blog.csdn.net/Ginsn/article/details/81590473?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>Dockeræ­å»ºNginx+Mysql+PHPç¯å¢ƒ</title>
    <url>//post/21932.html</url>
    <content><![CDATA[<p>mysql -u root -p<br>use mysql;<br>update user set host = â€œ%â€ where user = â€œrootâ€;<br>docker run -d -p 9000:9000 -v /home/sail/codelife/code/be/php/:/var/www/html/ â€“name php-with-mysql â€“link test_mysql:mysql  â€“volumes-php-from test_mysql â€“privileged=true php-fpm5.6/v2</p><a id="more"></a>
<p>docker run -p 9000:9000 â€“name php -v /root/php:/var/www/html  â€“link mysql:mysql  â€“privileged=true -d php:5.6-fpm</p>
<p>root           /var/www/html; # ä»£ç ç›®å½•</p>
<p>docker run -p 80:80  â€“name nginx -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf.d:/etc/nginx/conf.d  â€“link php:php  â€“link mysql:mysql -d nginx:latest</p>
<p>docker run -p 81:80  â€“name nginx -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf.d:/etc/nginx/conf.d  â€“link php:phpfpm -d nginx:latest<br>docker run -p 80:80 â€“name nginx-test -d nginx:latest</p>
<p>docker run -d nginx:latest â€“link php:php   â€“volumes-from php -p 80:80 -v /root/nginx/conf/default.conf:/etc/nginx/conf.d/default.conf â€“name nginx-php â€“privileged=true</p>
<p>docker build -t=â€phpâ€ .</p>
<p>docker run -d -p 9000:9000 -v /root/php/:/var/www/html/ â€“name php â€“link mysql:mysql  â€“volumes-from mysql â€“privileged=true php</p>
<h3 id="å‚æ•°è§£æ"><a href="#å‚æ•°è§£æ" class="headerlink" title="å‚æ•°è§£æ"></a>å‚æ•°è§£æ</h3><p>ï¼v å°†æœ¬åœ°ç£ç›˜ä¸Šçš„phpä»£ç æŒ‚è½½åˆ°docker ç¯å¢ƒä¸­ï¼Œå¯¹åº”dockerçš„ç›®å½•æ˜¯ /var/www/html/<br>â€“name æ–°å»ºçš„å®¹å™¨åç§° php-with-mysql<br>â€“link é“¾æ¥çš„å®¹å™¨ï¼Œé“¾æ¥çš„å®¹å™¨åç§°ï¼šåœ¨è¯¥å®¹å™¨ä¸­çš„åˆ«åï¼Œè¿è¡Œè¿™ä¸ªå®¹å™¨æ˜¯ï¼Œdockerä¸­ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªhostè¯†åˆ«è¢«é“¾æ¥çš„å®¹å™¨ip<br>â€“privileged=true æƒé™é—®é¢˜</p>
<p>docker run -d -p 9000:9000 -v /root/php/:/var/www/html/ â€“name php â€“link mysql:mysql  â€“volumes-from mysql â€“privileged=true -d php:5.6-fpm<br>docker exec -it php bash<br>cd /var/www/html &amp;&amp; ls</p>
<p>docker run -d -p 9000:9000 -v /www/php/:/var/www/html/ â€“name php â€“link mysql:mysql  â€“volumes-from mysql â€“privileged=true php:5.6-fpm</p>
<h3 id="å‚æ•°è§£æ-1"><a href="#å‚æ•°è§£æ-1" class="headerlink" title="å‚æ•°è§£æ"></a>å‚æ•°è§£æ</h3><p>ï¼v å°†æœ¬åœ°ç£ç›˜ä¸Šçš„phpä»£ç æŒ‚è½½åˆ°docker ç¯å¢ƒä¸­ï¼Œå¯¹åº”dockerçš„ç›®å½•æ˜¯ /var/www/html/<br>â€“name æ–°å»ºçš„å®¹å™¨åç§° php-with-mysql<br>â€“link é“¾æ¥çš„å®¹å™¨ï¼Œé“¾æ¥çš„å®¹å™¨åç§°ï¼šåœ¨è¯¥å®¹å™¨ä¸­çš„åˆ«åï¼Œè¿è¡Œè¿™ä¸ªå®¹å™¨æ˜¯ï¼Œdockerä¸­ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªhostè¯†åˆ«è¢«é“¾æ¥çš„å®¹å™¨ip<br>â€“privileged=true æƒé™é—®é¢˜</p>
<p>mod_php</p>
]]></content>
      <tags>
        <tag>Docker</tag>
        <tag>PHP</tag>
        <tag>Web</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockeréƒ¨ç½²acmh.shå®ç°è¯ä¹¦ç­¾å‘</title>
    <url>//post/822.html</url>
    <content><![CDATA[<h1 id="1ã€å¯åŠ¨å®¹å™¨"><a href="#1ã€å¯åŠ¨å®¹å™¨" class="headerlink" title="1ã€å¯åŠ¨å®¹å™¨"></a>1ã€å¯åŠ¨å®¹å™¨</h1><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">acme.sh:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">neilpang/acme.sh</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">acme.sh</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">daemon</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Ali_Key=xxxxxxxx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Ali_Secret=xxxxxxxxxx</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/nginx/ssl:/acme.sh</span></span><br></pre></td></tr></table></figure><a id="more"></a>

<h1 id="2ã€ç”³è¯·è¯ä¹¦"><a href="#2ã€ç”³è¯·è¯ä¹¦" class="headerlink" title="2ã€ç”³è¯·è¯ä¹¦"></a>2ã€ç”³è¯·è¯ä¹¦</h1><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">sudo</span> <span class="string">docker</span> <span class="string">exec</span> <span class="string">acme.sh</span> <span class="string">--issue</span> <span class="string">--dns</span> <span class="string">dns_ali</span> <span class="string">-d</span> <span class="string">example.com</span> <span class="string">-d</span> <span class="string">'*.example.com'</span> <span class="string">--keylength</span> <span class="string">ec-384</span></span><br></pre></td></tr></table></figure>

<h1 id="3ã€å®šæ—¶ä»»åŠ¡è‡ªåŠ¨ç»­ç­¾"><a href="#3ã€å®šæ—¶ä»»åŠ¡è‡ªåŠ¨ç»­ç­¾" class="headerlink" title="3ã€å®šæ—¶ä»»åŠ¡è‡ªåŠ¨ç»­ç­¾"></a>3ã€å®šæ—¶ä»»åŠ¡è‡ªåŠ¨ç»­ç­¾</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">3.4 è®¾ç½® crontab ä»»åŠ¡è‡ªåŠ¨ç»­ç­¾</span><br><span class="line">è¿è¡Œ crontab -e æ¥ç¼–è¾‘ crontab æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œä¿å­˜å³å¯</span><br><span class="line">æ¯éš”30è‡ªåŠ¨æ›´æ–°è¯ä¹¦</span><br><span class="line">0 0 */30 * * docker exec acme.sh --cron	--force &gt; /dev/null &amp;&amp; docker restart nginx	# acme.shä¸ºå®¹å™¨å</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockeréƒ¨ç½²ES+SpringBoot+Mysql+Reids+Node.js</title>
    <url>//post/30091.html</url>
    <content><![CDATA[<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">admin:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">node:10.16-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'8081:8080'</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/www/wwwroot/admin</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># æ–‡ä»¶å¤¹æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot/admin:/www/wwwroot/admin</span> <span class="comment"># æŒ‚è½½æºç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/sh</span> <span class="string">-c</span> <span class="string">"npm config set unsafe-perm true &amp;&amp; npm config set registry http://registry.npm.taobao.org &amp;&amp; npm install echarts -S &amp;&amp; npm install webpack-dev-server -g &amp;&amp; npm install webpack-dev-server -g &amp;&amp; npm i &amp;&amp; npm run dev"</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">node:10.16-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">client</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'8080:8080'</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/www/wwwroot/client</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># æ–‡ä»¶å¤¹æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot/client:/www/wwwroot/client</span> <span class="comment"># æŒ‚è½½æºç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/sh</span> <span class="string">-c</span> <span class="string">"npm config set unsafe-perm true &amp;&amp; npm config set registry http://registry.npm.taobao.org &amp;&amp;npm install webpack-dev-server -g &amp;&amp; npm install webpack-dev-server -g  &amp;&amp; npm i --unsafe-perm &amp;&amp; npm run dev"</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">springboot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">openjdk:8-jdk-alpine</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/www/wwwroot/java</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">springboot</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'8088:8088'</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># å®¹å™¨æ•°æ®å·æŒ‚è½½</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot/java/fmall-0.0.1-SNAPSHOT.jar:/www/wwwroot/java/app.jar</span> <span class="comment"># æŒ‚è½½æºç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/sh</span> <span class="string">-c</span> <span class="string">"nohup java -jar app.jar"</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/data:/var/lib/mysql</span> <span class="comment"># æŒ‚è½½æ•°æ®ç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/conf:/etc/mysql/conf.d</span> <span class="comment"># æŒ‚è½½é…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/logs:/var/log/mysql</span> <span class="comment"># æŒ‚è½½é…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="string">'true'</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/mysql.env</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--character-set-server=utf8mb4</span> <span class="string">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">net</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis/conf/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'80:80'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'7000:7000'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'443:443'</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># æ–‡ä»¶å¤¹æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/conf.d:/etc/nginx/conf.d</span> <span class="comment"># nginxç«™ç‚¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot:/etc/nginx/sites-available</span> <span class="comment"># å®¿ä¸»:docker:åªè¯»  ,wwwç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/conf/nginx.conf:/etc/nginx/nginx.conf</span> <span class="comment"># nginxé…ç½®æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/logs:/var/log/nginx</span> <span class="comment"># ç½‘ç«™æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶é—´</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot:/www/wwwroot</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">net</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">springboot</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">admin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">client</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.6.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=elasticsearch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line"><span class="comment">#      - discovery.seed_hosts=192.168.0.1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=elasticsearch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'ES_JAVA_OPTS=-Xms1g -Xmx1g'</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./elasticsearch/data:/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./elasticsearch/logs:/usr/share/elasticsearch/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./elasticsearch/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./elasticsearch/elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure><a id="more"></a>

<blockquote>
<p>ç›¸å…³æ•™ç¨‹ï¼š<a href="https://www.cnblogs.com/woshimrf/p/docker-es7.html" target="_blank" rel="noopener">https://www.cnblogs.com/woshimrf/p/docker-es7.html</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>Dockeråˆ©ç”¨Tomcatéƒ¨ç½²waråŒ…</title>
    <url>//post/31230.html</url>
    <content><![CDATA[<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment">  contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment">  this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment">  The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment">  (the "License"); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment">  the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- <span class="doctag">Note:</span>  A "Server" is not itself a "Container", so you may not</span></span><br><span class="line"><span class="comment">     define subcomponents such as "Valves" at this level.</span></span><br><span class="line"><span class="comment">     Documentation at /docs/config/server.html</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8005"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.startup.VersionLoggerListener"</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Security listener. Documentation at /docs/config/listeners.html</span></span><br><span class="line"><span class="comment">  &lt;Listener className="org.apache.catalina.security.SecurityListener" /&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--APR library loader. Documentation at /docs/apr.html --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.AprLifecycleListener"</span> <span class="attr">SSLEngine</span>=<span class="string">"on"</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Prevent memory leaks due to use of particular java/javax APIs--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.JreMemoryLeakPreventionListener"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Global JNDI resources</span></span><br><span class="line"><span class="comment">       Documentation at /docs/jndi-resources-howto.html</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Editable user database that can also be used by</span></span><br><span class="line"><span class="comment">         UserDatabaseRealm to authenticate users</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">"UserDatabase"</span> <span class="attr">auth</span>=<span class="string">"Container"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">"org.apache.catalina.UserDatabase"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">description</span>=<span class="string">"User database that can be updated and saved"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">factory</span>=<span class="string">"org.apache.catalina.users.MemoryUserDatabaseFactory"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">pathname</span>=<span class="string">"conf/tomcat-users.xml"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- A "Service" is a collection of one or more "Connectors" that share</span></span><br><span class="line"><span class="comment">       a single "Container" <span class="doctag">Note:</span>  A "Service" is not itself a "Container",</span></span><br><span class="line"><span class="comment">       so you may not define subcomponents such as "Valves" at this level.</span></span><br><span class="line"><span class="comment">       Documentation at /docs/config/service.html</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--The connectors can use a shared executor, you can define one or more named thread pools--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;Executor name="tomcatThreadPool" namePrefix="catalina-exec-"</span></span><br><span class="line"><span class="comment">        maxThreads="150" minSpareThreads="4"/&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- A "Connector" represents an endpoint by which requests are received</span></span><br><span class="line"><span class="comment">         and responses are returned. Documentation at :</span></span><br><span class="line"><span class="comment">         Java HTTP Connector: /docs/config/http.html</span></span><br><span class="line"><span class="comment">         Java AJP  Connector: /docs/config/ajp.html</span></span><br><span class="line"><span class="comment">         APR (HTTP/AJP) Connector: /docs/apr.html</span></span><br><span class="line"><span class="comment">         Define a non-SSL/TLS HTTP/1.1 Connector on port 8080</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- A "Connector" using the shared thread pool--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;Connector executor="tomcatThreadPool"</span></span><br><span class="line"><span class="comment">               port="8080" protocol="HTTP/1.1"</span></span><br><span class="line"><span class="comment">               connectionTimeout="20000"</span></span><br><span class="line"><span class="comment">               redirectPort="8443" /&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Define an SSL/TLS HTTP/1.1 Connector on port 8443</span></span><br><span class="line"><span class="comment">         This connector uses the NIO implementation. The default</span></span><br><span class="line"><span class="comment">         SSLImplementation will depend on the presence of the APR/native</span></span><br><span class="line"><span class="comment">         library and the useOpenSSL attribute of the</span></span><br><span class="line"><span class="comment">         AprLifecycleListener.</span></span><br><span class="line"><span class="comment">         Either JSSE or OpenSSL style configuration may be used regardless of</span></span><br><span class="line"><span class="comment">         the SSLImplementation selected. JSSE style configuration is used below.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;Connector port="8443" protocol="org.apache.coyote.http11.Http11NioProtocol"</span></span><br><span class="line"><span class="comment">               maxThreads="150" SSLEnabled="true"&gt;</span></span><br><span class="line"><span class="comment">        &lt;SSLHostConfig&gt;</span></span><br><span class="line"><span class="comment">            &lt;Certificate certificateKeystoreFile="conf/localhost-rsa.jks"</span></span><br><span class="line"><span class="comment">                         type="RSA" /&gt;</span></span><br><span class="line"><span class="comment">        &lt;/SSLHostConfig&gt;</span></span><br><span class="line"><span class="comment">    &lt;/Connector&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Define an SSL/TLS HTTP/1.1 Connector on port 8443 with HTTP/2</span></span><br><span class="line"><span class="comment">         This connector uses the APR/native implementation which always uses</span></span><br><span class="line"><span class="comment">         OpenSSL for TLS.</span></span><br><span class="line"><span class="comment">         Either JSSE or OpenSSL style configuration may be used. OpenSSL style</span></span><br><span class="line"><span class="comment">         configuration is used below.</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;Connector port="8443" protocol="org.apache.coyote.http11.Http11AprProtocol"</span></span><br><span class="line"><span class="comment">               maxThreads="150" SSLEnabled="true" &gt;</span></span><br><span class="line"><span class="comment">        &lt;UpgradeProtocol className="org.apache.coyote.http2.Http2Protocol" /&gt;</span></span><br><span class="line"><span class="comment">        &lt;SSLHostConfig&gt;</span></span><br><span class="line"><span class="comment">            &lt;Certificate certificateKeyFile="conf/localhost-rsa-key.pem"</span></span><br><span class="line"><span class="comment">                         certificateFile="conf/localhost-rsa-cert.pem"</span></span><br><span class="line"><span class="comment">                         certificateChainFile="conf/localhost-rsa-chain.pem"</span></span><br><span class="line"><span class="comment">                         type="RSA" /&gt;</span></span><br><span class="line"><span class="comment">        &lt;/SSLHostConfig&gt;</span></span><br><span class="line"><span class="comment">    &lt;/Connector&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;Connector protocol="AJP/1.3"</span></span><br><span class="line"><span class="comment">               address="::1"</span></span><br><span class="line"><span class="comment">               port="8009"</span></span><br><span class="line"><span class="comment">               redirectPort="8443" /&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- An Engine represents the entry point (within Catalina) that processes</span></span><br><span class="line"><span class="comment">         every request.  The Engine implementation for Tomcat stand alone</span></span><br><span class="line"><span class="comment">         analyzes the HTTP headers included with the request, and passes them</span></span><br><span class="line"><span class="comment">         on to the appropriate Host (virtual host).</span></span><br><span class="line"><span class="comment">         Documentation at /docs/config/engine.html --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- You should set jvmRoute to support load-balancing via AJP ie :</span></span><br><span class="line"><span class="comment">    &lt;Engine name="Catalina" defaultHost="localhost" jvmRoute="jvm1"&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Engine</span> <span class="attr">name</span>=<span class="string">"Catalina"</span> <span class="attr">defaultHost</span>=<span class="string">"localhost"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--For clustering, please take a look at documentation at:</span></span><br><span class="line"><span class="comment">          /docs/cluster-howto.html  (simple how to)</span></span><br><span class="line"><span class="comment">          /docs/config/cluster.html (reference documentation) --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      &lt;Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster"/&gt;</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Use the LockOutRealm to prevent attempts to guess user passwords</span></span><br><span class="line"><span class="comment">           via a brute-force attack --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.LockOutRealm"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- This Realm uses the UserDatabase configured in the global JNDI</span></span><br><span class="line"><span class="comment">             resources under the key "UserDatabase".  Any edits</span></span><br><span class="line"><span class="comment">             that are performed against this UserDatabase are immediately</span></span><br><span class="line"><span class="comment">             available for use by the Realm.  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.UserDatabaseRealm"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">resourceName</span>=<span class="string">"UserDatabase"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Realm</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span>  <span class="attr">appBase</span>=<span class="string">"webapps"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">""</span> <span class="attr">docBase</span>=<span class="string">"../webapps/app"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- SingleSignOn valve, share authentication between web applications</span></span><br><span class="line"><span class="comment">             Documentation at: /docs/config/valve.html --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;Valve className="org.apache.catalina.authenticator.SingleSignOn" /&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Access log processes all example.</span></span><br><span class="line"><span class="comment">             Documentation at: /docs/config/valve.html</span></span><br><span class="line"><span class="comment">             <span class="doctag">Note:</span> The pattern used is equivalent to using pattern="common" --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="attr">directory</span>=<span class="string">"logs"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">prefix</span>=<span class="string">"localhost_access_log"</span> <span class="attr">suffix</span>=<span class="string">".txt"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">pattern</span>=<span class="string">"%h %l %u %t <span class="symbol">&amp;quot;</span>%r<span class="symbol">&amp;quot;</span> %s %b"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a>

<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">springboot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">tomcat:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">web</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="number">80</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># å®¹å™¨æ•°æ®å·æŒ‚è½½</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./java/app.war:/usr/local/tomcat/webapps/app.war</span> <span class="comment"># æŒ‚è½½æºç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./java/server.xml:/usr/local/tomcat/conf/server.xml</span> <span class="comment"># æŒ‚è½½æºç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./java/logs:/usr/local/tomcat/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Flaskå¸¸ç”¨æ‰©å±•</title>
    <url>//post/26946.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Flask-SQLalchemyï¼šæ“ä½œæ•°æ®åº“ï¼›</span><br><span class="line">Flask-scriptï¼šæ’å…¥è„šæœ¬ï¼›</span><br><span class="line">Flask-migrateï¼šç®¡ç†è¿ç§»æ•°æ®åº“ï¼›</span><br><span class="line">Flask-Sessionï¼šSessionå­˜å‚¨æ–¹å¼æŒ‡å®šï¼›</span><br><span class="line">Flask-WTFï¼šè¡¨å•ï¼›</span><br><span class="line">Flask-Mailï¼šé‚®ä»¶ï¼›</span><br><span class="line">Flask-Bableï¼šæä¾›å›½é™…åŒ–å’Œæœ¬åœ°åŒ–æ”¯æŒï¼Œç¿»è¯‘ï¼›</span><br><span class="line">Flask-Loginï¼šè®¤è¯ç”¨æˆ·çŠ¶æ€ï¼›</span><br><span class="line">Flask-OpenIDï¼šè®¤è¯ï¼›</span><br><span class="line">Flask-RESTfulï¼šå¼€å‘REST APIçš„å·¥å…·ï¼›</span><br><span class="line">Flask-Bootstrapï¼šé›†æˆå‰ç«¯Twitter Bootstrapæ¡†æ¶ï¼›</span><br><span class="line">Flask-Momentï¼šæœ¬åœ°åŒ–æ—¥æœŸå’Œæ—¶é—´ï¼›</span><br><span class="line">Flask-Adminï¼šç®€å•è€Œå¯æ‰©å±•çš„ç®¡ç†æ¥å£çš„æ¡†æ¶</span><br><span class="line">æ‰©å±•åˆ—è¡¨ï¼šhttp:&#x2F;&#x2F;flask.pocoo.org&#x2F;extensions&#x2F;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Web</category>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockeréƒ¨ç½²Frpå®ç°å†…ç½‘ç©¿é€</title>
    <url>//post/17273.html</url>
    <content><![CDATA[<p>1ã€è¿è¡ŒFrpæœåŠ¡ç«¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --restart=always --network host -d -v /root/frp/frps.ini:/etc/frp/frps.ini --name frps snowdreamtech/frps</span><br></pre></td></tr></table></figure><a id="more"></a>


<p>2ã€frpæœåŠ¡ç«¯é…ç½®æ–‡ä»¶</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">bind_udp_port</span> = <span class="number">7001</span></span><br><span class="line"><span class="attr">kcp_bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">81</span></span><br><span class="line"><span class="attr">vhost_https_port</span> = <span class="number">444</span></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">7500</span></span><br><span class="line"><span class="attr">dashboard_user</span> = ç”¨æˆ·å</span><br><span class="line"><span class="attr">dashboard_pwd</span> = å¯†ç </span><br><span class="line"><span class="attr">subdomain_host</span> = å­åŸŸå</span><br><span class="line"><span class="attr">log_max_days</span> = <span class="number">7</span></span><br><span class="line"><span class="attr">authentication_timeout</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">token</span> = tokenå€¼</span><br><span class="line"><span class="attr">allow_ports</span> = <span class="number">1</span>-<span class="number">65535</span></span><br><span class="line"><span class="attr">max_pool_count</span> = <span class="number">20</span></span><br><span class="line"><span class="attr">max_ports_per_client</span> = <span class="number">20</span></span><br><span class="line"><span class="attr">log_file</span> = ./frps.log</span><br><span class="line"><span class="attr">log_level</span> = info</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Frp</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskåœ¨Windowsä¸‹é¢è¿è¡Œçš„æ³¨æ„äº‹é¡¹</title>
    <url>//post/32613.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Flaskå¯¹è±¡é…ç½®</title>
    <url>//post/53944.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;DEBUG&#39;: False,  # æ˜¯å¦å¼€å¯Debugæ¨¡å¼</span><br><span class="line">ã€€ã€€&#39;TESTING&#39;: False,  # æ˜¯å¦å¼€å¯æµ‹è¯•æ¨¡å¼</span><br><span class="line">ã€€ã€€&#39;SECRET_KEY&#39;: None # åœ¨å¯ç”¨Flaskå†…ç½®Sessionçš„æ—¶å€™&#x2F;å¼€å¯flash,ä¸€å®šè¦æœ‰å®ƒ</span><br><span class="line">ã€€ã€€&#39;PERMANENT_SESSION_LIFETIME&#39;: 31,  # days , Sessionçš„ç”Ÿå‘½å‘¨æœŸ(å¤©)é»˜è®¤31å¤©</span><br><span class="line">ã€€ã€€&#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;,  # åœ¨cookiesä¸­å­˜æ”¾sessionåŠ å¯†å­—ç¬¦ä¸²çš„åå­—</span><br><span class="line"></span><br><span class="line">ã€€ã€€&#39;PROPAGATE_EXCEPTIONS&#39;: None,  # å¼‚å¸¸ä¼ æ’­(æ˜¯å¦åœ¨æ§åˆ¶å°æ‰“å°LOG) å½“Debugæˆ–è€…testingå¼€å¯å,è‡ªåŠ¨ä¸ºTrue</span><br><span class="line">ã€€ã€€&#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;: None,  # ä¸€ä¸¤å¥è¯è¯´ä¸æ¸…æ¥š,ä¸€èˆ¬ä¸ç”¨å®ƒ</span><br><span class="line">ã€€ã€€&#39;SECRET_KEY&#39;: None,  # ä¹‹å‰é‡åˆ°è¿‡,åœ¨å¯ç”¨Sessionçš„æ—¶å€™,ä¸€å®šè¦æœ‰å®ƒ</span><br><span class="line">ã€€ã€€&#39;PERMANENT_SESSION_LIFETIME&#39;: 31,  # days , Sessionçš„ç”Ÿå‘½å‘¨æœŸ(å¤©)é»˜è®¤31å¤©</span><br><span class="line">ã€€ã€€&#39;USE_X_SENDFILE&#39;: False,  # æ˜¯å¦å¼ƒç”¨ x_sendfile</span><br><span class="line">ã€€ã€€&#39;LOGGER_NAME&#39;: None,  # æ—¥å¿—è®°å½•å™¨çš„åç§°</span><br><span class="line">ã€€ã€€&#39;LOGGER_HANDLER_POLICY&#39;: &#39;always&#39;,</span><br><span class="line">ã€€ã€€&#39;SERVER_NAME&#39;: None,  # æœåŠ¡è®¿é—®åŸŸå</span><br><span class="line">ã€€ã€€&#39;APPLICATION_ROOT&#39;: None,  # é¡¹ç›®çš„å®Œæ•´è·¯å¾„</span><br><span class="line">ã€€ã€€&#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;,  # åœ¨cookiesä¸­å­˜æ”¾sessionåŠ å¯†å­—ç¬¦ä¸²çš„åå­—</span><br><span class="line">ã€€ã€€&#39;SESSION_COOKIE_DOMAIN&#39;: None,  # åœ¨å“ªä¸ªåŸŸåä¸‹ä¼šäº§ç”Ÿsessionè®°å½•åœ¨cookiesä¸­</span><br><span class="line">ã€€ã€€&#39;SESSION_COOKIE_PATH&#39;: None,  # cookiesçš„è·¯å¾„</span><br><span class="line">ã€€ã€€&#39;SESSION_COOKIE_HTTPONLY&#39;: True,  # æ§åˆ¶ cookie æ˜¯å¦åº”è¢«è®¾ç½® httponly çš„æ ‡å¿—ï¼Œ</span><br><span class="line">ã€€ã€€&#39;SESSION_COOKIE_SECURE&#39;: False,  # æ§åˆ¶ cookie æ˜¯å¦åº”è¢«è®¾ç½®å®‰å…¨æ ‡å¿—</span><br><span class="line">ã€€ã€€&#39;SESSION_REFRESH_EACH_REQUEST&#39;: True,  # è¿™ä¸ªæ ‡å¿—æ§åˆ¶æ°¸ä¹…ä¼šè¯å¦‚ä½•åˆ·æ–°</span><br><span class="line">ã€€ã€€&#39;MAX_CONTENT_LENGTH&#39;: None,  # å¦‚æœè®¾ç½®ä¸ºå­—èŠ‚æ•°ï¼Œ Flask ä¼šæ‹’ç»å†…å®¹é•¿åº¦å¤§äºæ­¤å€¼çš„è¯·æ±‚è¿›å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ª 413 çŠ¶æ€ç </span><br><span class="line">ã€€ã€€&#39;SEND_FILE_MAX_AGE_DEFAULT&#39;: 12,  # hours é»˜è®¤ç¼“å­˜æ§åˆ¶çš„æœ€å¤§æœŸé™</span><br><span class="line">ã€€ã€€&#39;TRAP_BAD_REQUEST_ERRORS&#39;: False,</span><br><span class="line">ã€€ã€€# å¦‚æœè¿™ä¸ªå€¼è¢«è®¾ç½®ä¸º True ï¼ŒFlaskä¸ä¼šæ‰§è¡Œ HTTP å¼‚å¸¸çš„é”™è¯¯å¤„ç†ï¼Œè€Œæ˜¯åƒå¯¹å¾…å…¶å®ƒå¼‚å¸¸ä¸€æ ·ï¼Œ</span><br><span class="line">ã€€ã€€# é€šè¿‡å¼‚å¸¸æ ˆè®©å®ƒå†’æ³¡åœ°æŠ›å‡ºã€‚è¿™å¯¹äºéœ€è¦æ‰¾å‡º HTTP å¼‚å¸¸æºå¤´çš„å¯æ€•è°ƒè¯•æƒ…å½¢æ˜¯æœ‰ç”¨çš„ã€‚</span><br><span class="line">ã€€ã€€&#39;TRAP_HTTP_EXCEPTIONS&#39;: False,</span><br><span class="line">ã€€ã€€# Werkzeug å¤„ç†è¯·æ±‚ä¸­çš„ç‰¹å®šæ•°æ®çš„å†…éƒ¨æ•°æ®ç»“æ„ä¼šæŠ›å‡ºåŒæ ·ä¹Ÿæ˜¯â€œé”™è¯¯çš„è¯·æ±‚â€å¼‚å¸¸çš„ç‰¹æ®Šçš„ key errors ã€‚</span><br><span class="line">ã€€ã€€# åŒæ ·åœ°ï¼Œä¸ºäº†ä¿æŒä¸€è‡´ï¼Œè®¸å¤šæ“ä½œå¯ä»¥æ˜¾å¼åœ°æŠ›å‡º BadRequest å¼‚å¸¸ã€‚</span><br><span class="line">ã€€ã€€# å› ä¸ºåœ¨è°ƒè¯•ä¸­ï¼Œä½ å¸Œæœ›å‡†ç¡®åœ°æ‰¾å‡ºå¼‚å¸¸çš„åŸå› ï¼Œè¿™ä¸ªè®¾ç½®ç”¨äºåœ¨è¿™äº›æƒ…å½¢ä¸‹è°ƒè¯•ã€‚</span><br><span class="line">ã€€ã€€&#39;EXPLAIN_TEMPLATE_LOADING&#39;: False,  # å¦‚æœè¿™ä¸ªå€¼è¢«è®¾ç½®ä¸ºTrueï¼Œä½ åªä¼šå¾—åˆ°å¸¸è§„çš„å›æº¯ã€‚</span><br><span class="line">ã€€ã€€&#39;PREFERRED_URL_SCHEME&#39;: &#39;http&#39;,  # ç”ŸæˆURLçš„æ—¶å€™å¦‚æœæ²¡æœ‰å¯ç”¨çš„ URL æ¨¡å¼è¯å°†ä½¿ç”¨è¿™ä¸ªå€¼</span><br><span class="line">ã€€ã€€&#39;JSON_AS_ASCII&#39;: True,</span><br><span class="line">ã€€ã€€# é»˜è®¤æƒ…å†µä¸‹ Flask ä½¿ç”¨ ascii ç¼–ç æ¥åºåˆ—åŒ–å¯¹è±¡ã€‚å¦‚æœè¿™ä¸ªå€¼è¢«è®¾ç½®ä¸º False ï¼Œ</span><br><span class="line">ã€€ã€€# Flaskä¸ä¼šå°†å…¶ç¼–ç ä¸º ASCIIï¼Œå¹¶ä¸”æŒ‰åŸæ ·è¾“å‡ºï¼Œè¿”å›å®ƒçš„ unicode å­—ç¬¦ä¸²ã€‚</span><br><span class="line">ã€€ã€€# æ¯”å¦‚ jsonfiy ä¼šè‡ªåŠ¨åœ°é‡‡ç”¨ utf-8 æ¥ç¼–ç å®ƒç„¶åæ‰è¿›è¡Œä¼ è¾“ã€‚</span><br><span class="line">ã€€ã€€&#39;JSON_SORT_KEYS&#39;: True,</span><br><span class="line">ã€€ã€€# é»˜è®¤æƒ…å†µä¸‹ Flask æŒ‰ç…§ JSON å¯¹è±¡çš„é”®çš„é¡ºåºæ¥åºæ¥åºåˆ—åŒ–å®ƒã€‚</span><br><span class="line">ã€€ã€€# è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿é”®çš„é¡ºåºä¸ä¼šå—åˆ°å­—å…¸çš„å“ˆå¸Œç§å­çš„å½±å“ï¼Œä»è€Œè¿”å›çš„å€¼æ¯æ¬¡éƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šé€ æˆæ— ç”¨çš„é¢å¤– HTTP ç¼“å­˜ã€‚</span><br><span class="line">ã€€ã€€# ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™ä¸ªé…ç½®çš„å€¼æ¥è¦†ç›–é»˜è®¤çš„æ“ä½œã€‚ä½†è¿™æ˜¯ä¸è¢«æ¨èçš„åšæ³•å› ä¸ºè¿™ä¸ªé»˜è®¤çš„è¡Œä¸ºå¯èƒ½ä¼šç»™ä½ åœ¨æ€§èƒ½çš„ä»£ä»·ä¸Šå¸¦æ¥æ”¹å–„ã€‚</span><br><span class="line">ã€€ã€€&#39;JSONIFY_PRETTYPRINT_REGULAR&#39;: True,</span><br><span class="line">ã€€ã€€&#39;JSONIFY_MIMETYPE&#39;: &#39;application&#x2F;json&#39;,</span><br><span class="line">ã€€ã€€&#39;TEMPLATES_AUTO_RELOAD&#39;: None,</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskå¼€å‘ç¯å¢ƒæ­å»º</title>
    <url>//post/26850.html</url>
    <content><![CDATA[<blockquote>
<p>PyPIï¼ˆ<a href="https://pypi.org" target="_blank" rel="noopener">https://pypi.org</a> ï¼‰æ˜¯ä¸€ä¸ªPythonåŒ…çš„åœ¨çº¿ä»“åº“ï¼Œæˆªè‡³2018å¹´5æœˆï¼Œ<br>å…±æœ‰13ä¸‡å¤šä¸ªåŒ…å­˜å‚¨åœ¨è¿™é‡Œã€‚åé¢æˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•ç¼–å†™è‡ªå·±çš„Flaskæ‰©å±•ï¼Œå¹¶æŠŠå®ƒ<br>ä¸Šä¼ åˆ°PyPIä¸Šã€‚åˆ°æ—¶ä½ å°±å¯ä»¥ä½¿ç”¨ä¸Šé¢è¿™æ¡å‘½ä»¤å®‰è£…è‡ªå·±ç¼–å†™çš„åŒ…ã€‚<br>ç°åœ¨ä½¿ç”¨pipå®‰è£…Pipenvï¼š<br>$ pip install pipenv<br>åœ¨Linuxæˆ–macOSç³»ç»Ÿä¸­ä½¿ç”¨sudoä»¥å…¨å±€å®‰è£…ï¼š<br><code>$ sudo pip install pipenv</code><br>é™„æ³¨<br>å¦‚æœä½ ä¸æƒ³å…¨å±€å®‰è£…ï¼Œå¯ä»¥æ·»åŠ â€“useré€‰é¡¹æ‰§è¡Œç”¨æˆ·å®‰è£…ï¼ˆå³pip installâ€“<br>user pipenvï¼‰ï¼Œå¹¶æ‰‹åŠ¨å°†ç”¨æˆ·åŸºç¡€äºŒè¿›åˆ¶ç›®å½•æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡ä¸­ï¼Œå…·ä½“å¯å‚<br>è€ƒ<a href="https://docs.pipenv.org/install/#installing-pipenv" target="_blank" rel="noopener">https://docs.pipenv.org/install/#installing-pipenv</a> ã€‚<br>æç¤º<br>PyPIä¸­çš„åŒ…åç§°ä¸åŒºåˆ†å¤§å°å†™ã€‚å‡ºäºæ–¹ä¾¿çš„è€ƒè™‘ï¼Œåé¢çš„å®‰è£…å‘½ä»¤éƒ½å°†ä½¿ç”¨å°<br>å†™åç§°ã€‚<br>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥Pipenvæ˜¯å¦å·²ç»å®‰è£…ï¼š<br><code>$ pipenv --version</code><br><code>pipenv, version 11.10.4</code><br>2.åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ<br>åœ¨Pythonä¸­ï¼Œè™šæ‹Ÿç¯å¢ƒï¼ˆvirtual enviromentï¼‰å°±æ˜¯éš”ç¦»çš„Pythonè§£é‡Šå™¨ç¯<br>å¢ƒã€‚é€šè¿‡åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œä½ å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„Pythonè§£é‡Šå™¨ç¯å¢ƒã€‚è¿™æ ·åšçš„å¥½å¤„<br>æ˜¯å¯ä»¥ä¸ºæ¯ä¸€ä¸ªé¡¹ç›®åˆ›å»ºç‹¬ç«‹çš„Pythonè§£é‡Šå™¨ç¯å¢ƒï¼Œå› ä¸ºä¸åŒçš„é¡¹ç›®å¸¸å¸¸ä¼šä¾èµ–ä¸<br>åŒç‰ˆæœ¬çš„åº“æˆ–Pythonç‰ˆæœ¬ã€‚ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå¯ä»¥ä¿æŒå…¨å±€Pythonè§£é‡Šå™¨ç¯å¢ƒçš„å¹²å‡€ï¼Œ<br>é¿å…åŒ…å’Œç‰ˆæœ¬çš„æ··ä¹±ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°åŒºåˆ†å’Œè®°å½•æ¯ä¸ªé¡¹ç›®çš„ä¾èµ–ï¼Œä»¥ä¾¿åœ¨æ–°ç¯å¢ƒ<br>ä¸‹å¤ç°ä¾èµ–ç¯å¢ƒã€‚<br>è™šæ‹Ÿç¯å¢ƒé€šå¸¸ä½¿ç”¨Virtualenvæ¥åˆ›å»ºï¼Œä½†æ˜¯ä¸ºäº†æ›´æ–¹ä¾¿åœ°ç®¡ç†è™šæ‹Ÿç¯å¢ƒå’Œä¾èµ–<br>åŒ…ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨é›†æˆäº†Virtualenvçš„Pipenvã€‚é¦–å…ˆç¡®ä¿æˆ‘ä»¬å½“å‰å·¥ä½œç›®å½•åœ¨ç¤ºä¾‹<br>ç¨‹åºé¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå³helloflaskæ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åä½¿ç”¨pipenv installå‘½ä»¤ä¸ºå½“<br>å‰çš„é¡¹ç›®åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š<br><code>$ pipenv install</code><br><code>Creating a virtualenv for this projectâ€¦</code><br><code>...</code><br><code>Virtualenv location: /path/to/virtualenv/helloflask-5Pa0ZfZw</code><br><code>...</code><br>è¿™ä¼šä¸ºå½“å‰é¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«éš”ç¦»çš„Pythonè§£é‡Šå™¨ç¯å¢ƒï¼Œå¹¶ä¸”å®‰<br>è£…pipã€wheelã€setuptoolsç­‰åŸºæœ¬çš„åŒ…ã€‚å› ä¸ºç¤ºä¾‹ç¨‹åºä»“åº“é‡ŒåŒ…å«Pipfileæ–‡ä»¶ï¼Œ<br>æ‰€ä»¥è¿™ä¸ªæ–‡ä»¶ä¸­åˆ—å‡ºçš„ä¾èµ–åŒ…ä¹Ÿä¼šä¸€å¹¶è¢«å®‰è£…ï¼Œä¸‹é¢ä¼šå…·ä½“ä»‹ç»ã€‚<br>é™„æ³¨<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPipenvä¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒã€‚åœ¨Windowsç³»ç»Ÿä¸­ï¼Œè™šæ‹Ÿç¯å¢ƒ<br>æ–‡ä»¶å¤¹ä¼šåœ¨Cï¼š\Users\Administrator.virtualenvs\ç›®å½•ä¸‹åˆ›å»ºï¼Œè€ŒLinuxæˆ–<br>macOSä¼šåœ¨~/.local/share/virtualenvs/ç›®å½•ä¸‹åˆ›å»ºã€‚å¦‚æœä½ æƒ³åœ¨é¡¹ç›®ç›®å½•å†…åˆ›<br>å»ºè™šæ‹Ÿç¯å¢ƒæ–‡ä»¶å¤¹ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡PIPENV_VENV_IN_PROJECTï¼Œè¿™æ—¶å<br>ä¸º.venvçš„è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶å¤¹å°†åœ¨é¡¹ç›®æ ¹ç›®å½•è¢«åˆ›å»ºã€‚<br>è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶å¤¹çš„ç›®å½•åç§°çš„å½¢å¼ä¸ºâ€œå½“å‰é¡¹ç›®ç›®å½•å+ä¸€ä¸²éšæœºå­—ç¬¦â€ï¼Œæ¯”å¦‚<br>helloflask-5Pa0ZfZwã€‚<br>æç¤º<br>ä½ å¯ä»¥é€šè¿‡â€“threeå’Œâ€“twoé€‰é¡¹æ¥å£°æ˜è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨çš„Pythonç‰ˆæœ¬ï¼ˆåˆ†åˆ«<br>å¯¹åº”Python3å’ŒPython2ï¼‰ï¼Œæˆ–æ˜¯ä½¿ç”¨â€“pythoné€‰é¡¹æŒ‡å®šå…·ä½“çš„ç‰ˆæœ¬å·ã€‚åŒæ—¶è¦ç¡®<br>ä¿å¯¹åº”ç‰ˆæœ¬çš„Pythonå·²ç»å®‰è£…åœ¨ç”µè„‘ä¸­ã€‚<br>åœ¨å•ç‹¬ä½¿ç”¨Virtualenvæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ˜¾å¼åœ°æ¿€æ´»è™šæ‹Ÿç¯å¢ƒã€‚åœ¨Pipenvä¸­ï¼Œå¯<br>ä»¥ä½¿ç”¨pipenv shellå‘½ä»¤æ˜¾å¼åœ°æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š<br><code>$ pipenv shell</code><br><code>Loading .env environment variablesâ€¦</code><br><code>Launching subshell in virtual environment. Type &#39;exit&#39; to return.</code></p>
</blockquote><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¯å¢ƒå˜é‡åŠ è½½</span><br><span class="line">pipenv install python-dotenv</span><br><span class="line">.flaskenv</span><br><span class="line">.evn</span><br><span class="line">SOME_VAR&#x3D;1</span><br><span class="line"># è¿™æ˜¯æ³¨é‡Š</span><br><span class="line">FOO&#x3D;&quot;BAR&quot;</span><br><span class="line">FLASK_APP&#x3D;app.py</span><br><span class="line">FLASK_ENV&#x3D;development</span><br><span class="line">FLASK_RUN_PORT&#x3D;80</span><br><span class="line">FLASK_RUN_HOST&#x3D;127.0.0.1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è‡ªåŠ¨é‡å¯æœåŠ¡å™¨</span><br><span class="line">é»˜è®¤ä¼šä½¿ç”¨Werkzeugå†…ç½®çš„staté‡è½½å™¨ï¼Œå®ƒçš„ç¼ºç‚¹æ˜¯è€—ç”µè¾ƒä¸¥é‡ï¼Œè€Œä¸”å‡†ç¡®æ€§</span><br><span class="line">ä¸€èˆ¬ã€‚ä¸ºäº†è·å¾—æ›´ä¼˜ç§€çš„ä½“éªŒï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£…å¦ä¸€ä¸ªç”¨äºç›‘æµ‹æ–‡ä»¶å˜åŠ¨çš„Pythonåº“</span><br><span class="line">Watchdogï¼Œå®‰è£…åWerkzeugä¼šè‡ªåŠ¨ä½¿ç”¨å®ƒæ¥ç›‘æµ‹æ–‡ä»¶å˜åŠ¨ï¼š</span><br><span class="line">$ pipenv install watchdog --dev</span><br><span class="line">å› ä¸ºè¿™ä¸ªåŒ…åªåœ¨å¼€å‘æ—¶æ‰ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®‰è£…å‘½ä»¤åæ·»åŠ äº†ä¸€ä¸ª--devé€‰</span><br><span class="line">é¡¹ï¼Œè¿™ç”¨æ¥æŠŠè¿™ä¸ªåŒ…å£°æ˜ä¸ºå¼€å‘ä¾èµ–ã€‚åœ¨Pipfileæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªåŒ…ä¼šè¢«æ·»åŠ åˆ°dev-</span><br><span class="line">packageséƒ¨åˆ†ã€‚</span><br><span class="line">ä¸è¿‡ï¼Œå¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨äº†å•ç‹¬çš„CSSæˆ–JavaScriptæ–‡ä»¶æ—¶ï¼Œé‚£ä¹ˆæµè§ˆå™¨å¯èƒ½ä¼š</span><br><span class="line">ç¼“å­˜è¿™äº›æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´å¯¹æ–‡ä»¶åšå‡ºçš„ä¿®æ”¹ä¸èƒ½ç«‹åˆ»ç”Ÿæ•ˆã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥</span><br><span class="line">æŒ‰ä¸‹Crtl+F5æˆ–Shift+F5æ‰§è¡Œç¡¬é‡è½½ï¼ˆhard reloadï¼‰ï¼Œå³å¿½ç•¥ç¼“å­˜å¹¶é‡è½½ï¼ˆåˆ·</span><br><span class="line">æ–°ï¼‰é¡µé¢ã€‚</span><br><span class="line">æç¤º</span><br><span class="line">å½“åœ¨ä¸€ä¸ªæ–°ç”µè„‘åˆ›å»ºè¿è¡Œç¯å¢ƒæ—¶ï¼Œä½¿ç”¨pipenv installå‘½ä»¤æ—¶éœ€è¦æ·»åŠ é¢å¤–</span><br><span class="line">çš„--devé€‰é¡¹æ‰ä¼šå®‰è£…dev-packageséƒ¨åˆ†å®šä¹‰çš„å¼€å‘ä¾èµ–åŒ…</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Flask</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Flask</tag>
        <tag>Python Web</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskå¼€å‘ç¬”è®°</title>
    <url>//post/575.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Flask-sqlacodegen</span><br><span class="line">ORMæ“ä½œæœ‰ä¸¤ç§æ–¹å¼ã€‚</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">1.æ¨¡å‹è¿ç§»åˆ°æ•°æ®åº“ä¸­ç”Ÿæˆè¡¨ï¼Œcodefirstï¼šä½¿ç”¨flask-migrate:</span><br><span class="line"></span><br><span class="line">éœ€è¦flask-scriptï¼š</span><br><span class="line"></span><br><span class="line">from flask_script import Manager</span><br><span class="line">from flask_migrate import Migrate ,MigrateCommand</span><br><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">manager &#x3D; Manager(app)  # æ³¨å†ŒAppåˆ°è„šæœ¬</span><br><span class="line">Migrate(app,db)  # æ³¨å†ŒAppå’ŒORMå¯¹è±¡</span><br><span class="line">manager.add_command(&#39;db&#39;,MigrateCommand)  # dbä¸ºå‘½ä»¤ å³æ‰§è¡Œpython manager.py db å‘½ä»¤</span><br><span class="line"></span><br><span class="line">python setup.py db init:åˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line">python setup.py db migrate:ç”Ÿæˆè¿ç§»è„šæœ¬</span><br><span class="line"></span><br><span class="line">python setup.py db upgrade:æ˜ å°„åˆ°æ•°æ®åº“</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">2.å·²ç»å»ºå¥½æ•°æ®åº“&#x3D;&#x3D;&gt;æ¨¡å‹:ä½¿ç”¨flask-sqlacodegen:</span><br><span class="line"></span><br><span class="line">å®‰è£…ï¼špip install flask-sqlacodegen</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨windowç¯å¢ƒä¸‹ï¼š</span><br><span class="line"></span><br><span class="line"># æ•´ä½“æ˜ å°„databaseæ•°æ®åº“å¹¶å†™å…¥model.pyæ–‡ä»¶</span><br><span class="line">flask-sqlacodegen \</span><br><span class="line">mysql:&#x2F;&#x2F;username:password@127.0.0.1&#x2F;database \</span><br><span class="line">--outfile &#39;model.py&#39; \</span><br><span class="line">--flask</span><br><span class="line"></span><br><span class="line"># æ˜ å°„tableæ•°æ®è¡¨å¹¶å†™å…¥table.pyæ–‡ä»¶</span><br><span class="line">flask-sqlacodegen \</span><br><span class="line">mysql:&#x2F;&#x2F;username:password@127.0.0.1&#x2F;database \</span><br><span class="line">--table table \</span><br><span class="line">--outfile &#39;model.py&#39; \</span><br><span class="line">--flask</span><br><span class="line">flask-sqlacodegen mysql:&#x2F;&#x2F;root:@127.0.0.1&#x2F;db_name --outfile &quot;models&#x2F;model.py&quot;  --flask</span><br><span class="line"></span><br><span class="line">flask-sqlacodegenÂ &#39;mysql:&#x2F;&#x2F;root:root@127.0.0.1&#x2F;swzl&#39;Â --table tableÂ  --outfileÂ &quot;app&#x2F;models&#x2F;user_model.py&quot;Â Â --flask</span><br><span class="line"></span><br><span class="line">flask-sqlacodegen mysql:&#x2F;&#x2F;root:root@127.0.0.1&#x2F;swzl --outfile all.py</span><br><span class="line">flask-sqlacodegen mysql:&#x2F;&#x2F;root:root@127.0.0.1&#x2F;swzl --tables t_user --outfile User.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flask-sqlacodegenÂ &#39;mysql:&#x2F;&#x2F;root:root@127.0.0.1&#x2F;swzl&#39;Â --tables t_userÂ  --outfileÂ &quot;app&#x2F;models&#x2F;user_model.py&quot;Â Â --flask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flask-sqlacodegen mysql:&#x2F;&#x2F;root:@127.0.0.1&#x2F;db_name --tables user --outfile &quot;models&#x2F;user.py&quot;  --flask</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskç¯å¢ƒå˜é‡åŠ è½½è¸©å‘</title>
    <url>//post/52596.html</url>
    <content><![CDATA[<p><strong>å…¶å®æœ¬è´¨éƒ½æ˜¯python-dotenvåŠ è½½ç¯å¢ƒå˜é‡å‡ºç°çš„é—®é¢˜ã€‚</strong></p><h1 id="å‘ä¸€ï¼špython-dotenvåŠ è½½çš„Valueéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹"><a href="#å‘ä¸€ï¼špython-dotenvåŠ è½½çš„Valueéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="å‘ä¸€ï¼špython-dotenvåŠ è½½çš„Valueéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹"></a>å‘ä¸€ï¼špython-dotenvåŠ è½½çš„Valueéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹</h1><a id="more"></a>
<p>ç¬¬ä¸€ä¸ªå‘æ˜¯<strong>python-dotenvåŠ è½½çš„Valueéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹</strong>ï¼ˆ<code>python-dotenv</code>ç‰ˆæœ¬0.10.1ï¼‰ï¼Œå› æ­¤å¯¼è‡´æ•´å‹ã€æµ®ç‚¹å‹å’Œå¸ƒå°”ç±»å‹éœ€è¦è½¬æ¢ä¸€ä¸‹ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ç›®å‰è§£å†³åŠæ³•åªèƒ½æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># `.env`</span></span><br><span class="line">MAIL_PORT = 465</span><br><span class="line">MAIL_USE_SSL = <span class="literal">false</span></span><br><span class="line">MAIL_USE_TLS = <span class="literal">true</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseConfig</span><span class="params">(object)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    MAIL_PORT = int(os.getenv(<span class="string">'MAIL_PORT'</span>, default=<span class="number">587</span>))</span><br><span class="line">    MAIL_USE_SSL = <span class="literal">True</span> <span class="keyword">if</span> <span class="string">'true'</span> == os.getenv(<span class="string">'MAIL_USE_SSL'</span>) <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">    MAIL_USE_TLS = <span class="literal">True</span> <span class="keyword">if</span> <span class="string">'true'</span> == os.getenv(<span class="string">'MAIL_USE_TLS'</span>) <span class="keyword">else</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>ç›¸å…³å¸–å­ï¼š<a href="https://discuss.helloflask.com/t/topic/127/3?u=angelliang" target="_blank" rel="noopener">https://discuss.helloflask.com/t/topic/127/3?u=angelliang</a></p>
<h1 id="å‘äºŒï¼špipenvå½±å“äº†flaskåŠ è½½-envç¯å¢ƒå˜é‡"><a href="#å‘äºŒï¼špipenvå½±å“äº†flaskåŠ è½½-envç¯å¢ƒå˜é‡" class="headerlink" title="å‘äºŒï¼špipenvå½±å“äº†flaskåŠ è½½.envç¯å¢ƒå˜é‡"></a>å‘äºŒï¼špipenvå½±å“äº†flaskåŠ è½½<code>.env</code>ç¯å¢ƒå˜é‡</h1><p>ç¬¬äºŒä¸ªå‘å’Œ<code>pipenv</code>æœ‰å…³ï¼Œä¼—æ‰€å‘¨çŸ¥Flaské¡¹ç›®å¯ä»¥é€šè¿‡<code>.env</code>åŠ è½½ç¯å¢ƒå˜é‡ï¼Œä½†æ˜¯ï¼Œ<code>pipenv</code>ä¹Ÿå¯ä»¥é€šè¿‡<code>.env</code>åŠ è½½ç¯å¢ƒå˜é‡ï¼é—®é¢˜å°±å‡ºç°äº†ï¼Œè¿›å…¥<code>pipenv shell</code>è™šæ‹Ÿç¯å¢ƒåï¼Œä¿®æ”¹.envç¯å¢ƒå˜é‡åå†å¯åŠ¨Flask appï¼š<code>flask run</code>ï¼ŒFlaskè¿˜æ˜¯ç”¨äº†åŸæ¥çš„ç¯å¢ƒå˜é‡ï¼ï¼ï¼</p>
<p>ç©¶å…¶åŸå› ï¼Œæ˜¯<code>pipenv shell</code>åŠ è½½äº†ç¯å¢ƒå˜é‡å¹¶è¿›è¡Œäº†ç¼“å­˜ï¼Œç„¶åflaskåŠ è½½ç¯å¢ƒå˜é‡æ—¶æ²¡æœ‰è¿›è¡Œè¦†ç›–</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">&gt; pipenv shell</span><br><span class="line">Loading .env environment variablesâ€¦</span><br><span class="line">Launching subshell <span class="keyword">in</span> <span class="keyword">virtual</span> environmentâ€¦</span><br><span class="line">...</span><br><span class="line">&gt; flask run  <span class="meta"># æ­£å¸¸é¢„æœŸ</span></span><br><span class="line"><span class="meta"># åœæ­¢flaskï¼Œä¿®æ”¹ .env ç¯å¢ƒå˜é‡ï¼Œä¿å­˜</span></span><br><span class="line">&gt; flask run  <span class="meta"># æ²¡è¾¾åˆ°ä¿®æ”¹å˜é‡åçš„é¢„æœŸæ•ˆæœ</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°¤å…¶æ˜¯éƒ¨ç½²Flaskåˆ°æœåŠ¡å™¨åï¼Œä»¥ä¸‹æ­¥éª¤è‚¯å®šæœ‰é—®é¢˜çš„ï¼ï¼ï¼</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">$ pipenv shell</span><br><span class="line">$ vim .env</span><br><span class="line">...</span><br><span class="line">$ flask run</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ–¹æ¡ˆä¸€ï¼šé‡è¿›pipenv-shell"><a href="#æ–¹æ¡ˆä¸€ï¼šé‡è¿›pipenv-shell" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šé‡è¿›pipenv shell"></a>æ–¹æ¡ˆä¸€ï¼šé‡è¿›<code>pipenv shell</code></h3><p>ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯é€€å‡º<code>pipenv shell</code>ç¯å¢ƒå†è¿›å…¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; pipenv shell</span><br><span class="line">&gt; <span class="comment"># ç¼–è¾‘ .env</span></span><br><span class="line">...</span><br><span class="line">&gt; <span class="built_in">exit</span></span><br><span class="line">&gt; pipenv shell</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ¡ˆäºŒï¼šæ–°å»ºå¹¶ä½¿ç”¨app-pyå¯åŠ¨"><a href="#æ–¹æ¡ˆäºŒï¼šæ–°å»ºå¹¶ä½¿ç”¨app-pyå¯åŠ¨" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šæ–°å»ºå¹¶ä½¿ç”¨app.pyå¯åŠ¨"></a>æ–¹æ¡ˆäºŒï¼šæ–°å»ºå¹¶ä½¿ç”¨<code>app.py</code>å¯åŠ¨</h3><p>å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯åœ¨ä¸»ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>app.py</code>ï¼Œæ‹·è´ä¸‹é¢ä»£ç ï¼Œä»¥åä½¿ç”¨<code>python app.py</code>å¯åŠ¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">python app.py</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line">dotenv_path = os.path.join(os.path.abspath(os.path.dirname(__file__)), <span class="string">'.env'</span>)</span><br><span class="line"><span class="keyword">if</span> os.path.exists(dotenv_path):</span><br><span class="line">    load_dotenv(dotenv_path, override=<span class="literal">True</span>)  <span class="comment">#  override=True: è¦†å†™å·²å­˜åœ¨çš„å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> apps.web <span class="keyword">import</span> create_app</span><br><span class="line"></span><br><span class="line">app = create_app()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>è¿™ç§ä»£ç æœ‰æ—¶ä¹Ÿä¼šç»™ä¸€äº›wsgiï¼ˆæ¯”å¦‚gunicornï¼‰æä¾›ã€‚</p>
<h3 id="æ–¹æ¡ˆä¸‰ï¼šè®¾ç½®PIPENV-DONT-LOAD-ENV-1"><a href="#æ–¹æ¡ˆä¸‰ï¼šè®¾ç½®PIPENV-DONT-LOAD-ENV-1" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šè®¾ç½®PIPENV_DONT_LOAD_ENV=1"></a>æ–¹æ¡ˆä¸‰ï¼šè®¾ç½®<code>PIPENV_DONT_LOAD_ENV=1</code></h3><p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ¡ˆæ˜¯è®¾ç½®<code>PIPENV_DONT_LOAD_ENV=1</code>ï¼Œä¸è®©pipenvåŠ è½½<code>.env</code>ã€‚</p>
<p>PowerShellç¤ºä¾‹ï¼ˆæ³¨æ„æ²¡æœ‰äº†<code>Loading .env environment variablesâ€¦</code>ä¿¡æ¯ï¼‰ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">&gt; <span class="variable">$env:PIPENV_DONT_LOAD_ENV</span>=<span class="number">1</span></span><br><span class="line">&gt; pipenv shell</span><br><span class="line">Launching subshell <span class="keyword">in</span> virtual environmentâ€¦</span><br><span class="line">Windows PowerShell</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ¡ˆå››ï¼šä½¿ç”¨-flaskenv"><a href="#æ–¹æ¡ˆå››ï¼šä½¿ç”¨-flaskenv" class="headerlink" title="æ–¹æ¡ˆå››ï¼šä½¿ç”¨.flaskenv"></a>æ–¹æ¡ˆå››ï¼šä½¿ç”¨<code>.flaskenv</code></h3><p><code>pipenv shell</code>ä¸ä¼šä»<code>.flaskenv</code>åŠ è½½å˜é‡ï¼Œæ‰€ä»¥å¦‚æœæœ‰ç»å¸¸éœ€è¦ä¿®æ”¹çš„ç¯å¢ƒå˜é‡ä¹Ÿå¯ä»¥æ”¾åœ¨<code>.flaskenv</code>ã€‚ä½†æ˜¯æˆ‘æ„Ÿè§‰ä¸€ç‚¹ä¹Ÿä¸ä¼˜é›…ï¼Œå› ä¸ºæˆ‘ä¹ æƒ¯æŠŠ<code>.flaskenv</code>ä¹Ÿæäº¤åˆ°ä»“åº“ï¼Œè€Œç•™ä¸‹<code>.env</code>åœ¨éƒ¨ç½²ç«¯å®¢åˆ¶åŒ–ã€‚</p>
<hr>
<p>ç›¸åŒå¸–å­ï¼š<a href="https://discuss.helloflask.com/t/topic/128" target="_blank" rel="noopener">https://discuss.helloflask.com/t/topic/128</a></p>
]]></content>
      <tags>
        <tag>Web</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Flask-SQLAlchemyåŸºç¡€æ“ä½œ</title>
    <url>//post/21407.html</url>
    <content><![CDATA[<h2 id="5-8-1-åˆ›å»ºè¡¨"><a href="#5-8-1-åˆ›å»ºè¡¨" class="headerlink" title="5.8.1ã€€åˆ›å»ºè¡¨"></a>5.8.1ã€€åˆ›å»ºè¡¨</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦è®© Flask-SQLAlchemy æ ¹æ®æ¨¡å‹ç±»åˆ›å»ºæ•°æ®åº“ã€‚æ–¹æ³•æ˜¯ä½¿ç”¨ db.create_all()<br>å‡½æ•°ï¼š<br>(venv) $ python hello.py shell</p><a id="more"></a>
<blockquote>
<blockquote>
<blockquote>
<p>from hello import db<br>db.create_all()<br>å¦‚æœä½ æŸ¥çœ‹ç¨‹åºç›®å½•ï¼Œä¼šå‘ç°æ–°å»ºäº†ä¸€ä¸ªåä¸º data.sqlite çš„æ–‡ä»¶ã€‚è¿™ä¸ª SQLite æ•°æ®åº“æ–‡ä»¶<br>çš„åå­—å°±æ˜¯åœ¨é…ç½®ä¸­æŒ‡å®šçš„ã€‚å¦‚æœæ•°æ®åº“è¡¨å·²ç»å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆ db.create_all()<br>ä¸ä¼šé‡æ–°åˆ›å»ºæˆ–è€…æ›´æ–°è¿™ä¸ªè¡¨ã€‚å¦‚æœä¿®æ”¹æ¨¡å‹åè¦æŠŠæ”¹åŠ¨åº”ç”¨åˆ°ç°æœ‰çš„æ•°æ®åº“ä¸­ï¼Œè¿™ä¸€ç‰¹<br>æ€§ä¼šå¸¦æ¥ä¸ä¾¿ã€‚æ›´æ–°ç°æœ‰æ•°æ®åº“è¡¨çš„ç²—æš´æ–¹å¼æ˜¯å…ˆåˆ é™¤æ—§è¡¨å†é‡æ–°åˆ›å»ºï¼š<br>db.drop_all()<br>db.create_all()<br>ï¼ˆç»­ï¼‰<br>æ•°æ®åº“ ï½œ 51<br>é—æ†¾çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸ªæˆ‘ä»¬ä¸æƒ³çœ‹åˆ°çš„å‰¯ä½œç”¨ï¼Œå®ƒæŠŠæ•°æ®åº“ä¸­åŸæœ‰çš„æ•°æ®éƒ½é”€æ¯äº†ã€‚æœ¬<br>ç« æœ«å°¾å°†ä¼šä»‹ç»ä¸€ç§æ›´å¥½çš„æ–¹å¼ç”¨äºæ›´æ–°æ•°æ®åº“ã€‚</p>
</blockquote>
</blockquote>
</blockquote>
<p>ä¸‹é¢è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€äº›è§’è‰²å’Œç”¨æˆ·ï¼š</p>
<blockquote>
<blockquote>
<blockquote>
<p>from hello import Role, User<br>admin_role = Role(name=â€™Adminâ€™)<br>mod_role = Role(name=â€™Moderatorâ€™)<br>user_role = Role(name=â€™Userâ€™)<br>user_john = User(username=â€™johnâ€™, role=admin_role)<br>user_susan = User(username=â€™susanâ€™, role=user_role)<br>user_david = User(username=â€™davidâ€™, role=user_role)<br>æ¨¡å‹çš„æ„é€ å‡½æ•°æ¥å—çš„å‚æ•°æ˜¯ä½¿ç”¨å…³é”®å­—å‚æ•°æŒ‡å®šçš„æ¨¡å‹å±æ€§åˆå§‹å€¼ã€‚æ³¨æ„ï¼Œ role å±æ€§ä¹Ÿ<br>å¯ä½¿ç”¨ï¼Œè™½ç„¶å®ƒä¸æ˜¯çœŸæ­£çš„æ•°æ®åº“åˆ—ï¼Œä½†å´æ˜¯ä¸€å¯¹å¤šå…³ç³»çš„é«˜çº§è¡¨ç¤ºã€‚è¿™äº›æ–°å»ºå¯¹è±¡çš„ id<br>å±æ€§å¹¶æ²¡æœ‰æ˜ç¡®è®¾å®šï¼Œå› ä¸ºä¸»é”®æ˜¯ç”± Flask-SQLAlchemy ç®¡ç†çš„ã€‚ç°åœ¨è¿™äº›å¯¹è±¡åªå­˜åœ¨äº<br>Python ä¸­ï¼Œè¿˜æœªå†™å…¥æ•°æ®åº“ã€‚å› æ­¤ id å°šæœªèµ‹å€¼ï¼š<br>print(admin_role.id)<br>None<br>print(mod_role.id)<br>None<br>print(user_role.id)<br>None<br>é€šè¿‡æ•°æ®åº“ä¼šè¯ç®¡ç†å¯¹æ•°æ®åº“æ‰€åšçš„æ”¹åŠ¨ï¼Œåœ¨ Flask-SQLAlchemy ä¸­ï¼Œä¼šè¯ç”± db.session<br>è¡¨ç¤ºã€‚å‡†å¤‡æŠŠå¯¹è±¡å†™å…¥æ•°æ®åº“ä¹‹å‰ï¼Œå…ˆè¦å°†å…¶æ·»åŠ åˆ°ä¼šè¯ä¸­ï¼š<br>db.session.add(admin_role)<br>db.session.add(mod_role)<br>db.session.add(user_role)<br>db.session.add(user_john)<br>db.session.add(user_susan)<br>db.session.add(user_david)<br>æˆ–è€…ç®€å†™æˆï¼š<br>db.session.add_all([admin_role, mod_role, user_role,<br>â€¦ user_john, user_susan, user_david])<br>ä¸ºäº†æŠŠå¯¹è±¡å†™å…¥æ•°æ®åº“ï¼Œæˆ‘ä»¬è¦è°ƒç”¨ commit() æ–¹æ³•æäº¤ä¼šè¯ï¼š<br>db.session.commit()<br>å†æ¬¡æŸ¥çœ‹ id å±æ€§ï¼Œç°åœ¨å®ƒä»¬å·²ç»èµ‹å€¼äº†ï¼š<br>52 ï½œ ç¬¬ 5 ç« <br>print(admin_role.id)<br>1<br>print(mod_role.id)<br>2<br>print(user_role.id)<br>3<br>æ•°æ®åº“ä¼šè¯ db.session å’Œç¬¬ 4 ç« ä»‹ç»çš„ Flask session å¯¹è±¡æ²¡æœ‰å…³ç³»ã€‚æ•°æ®åº“<br>ä¼šè¯ä¹Ÿç§°ä¸ºäº‹åŠ¡ã€‚<br>æ•°æ®åº“ä¼šè¯èƒ½ä¿è¯æ•°æ®åº“çš„ä¸€è‡´æ€§ã€‚æäº¤æ“ä½œä½¿ç”¨åŸå­æ–¹å¼æŠŠä¼šè¯ä¸­çš„å¯¹è±¡å…¨éƒ¨å†™å…¥æ•°æ®<br>åº“ã€‚å¦‚æœåœ¨å†™å…¥ä¼šè¯çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œæ•´ä¸ªä¼šè¯éƒ½ä¼šå¤±æ•ˆã€‚å¦‚æœä½ å§‹ç»ˆæŠŠç›¸å…³æ”¹åŠ¨æ”¾<br>åœ¨ä¼šè¯ä¸­æäº¤ï¼Œå°±èƒ½é¿å…å› éƒ¨åˆ†æ›´æ–°å¯¼è‡´çš„æ•°æ®åº“ä¸ä¸€è‡´æ€§ã€‚<br>æ•°æ®åº“ä¼šè¯ä¹Ÿå¯ å›æ»š ã€‚è°ƒç”¨ db.session.rollback() åï¼Œæ·»åŠ åˆ°æ•°æ®åº“ä¼šè¯<br>ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šè¿˜åŸåˆ°å®ƒä»¬åœ¨æ•°æ®åº“æ—¶çš„çŠ¶æ€ã€‚</p>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">8.4.1ã€€å‡†å¤‡ç”¨äºç™»å½•çš„ç”¨æˆ·æ¨¡å‹</span><br><span class="line">è¦æƒ³ä½¿ç”¨ Flask-Login æ‰©å±•ï¼Œç¨‹åºçš„ User æ¨¡å‹å¿…é¡»å®ç°å‡ ä¸ªæ–¹æ³•ã€‚éœ€è¦å®ç°çš„æ–¹æ³•å¦‚è¡¨ 8-1</span><br><span class="line">æ‰€ç¤ºã€‚</span><br><span class="line">82 ï½œ ç¬¬ 8 ç« </span><br><span class="line">è¡¨8-1ã€€Flask-Loginè¦æ±‚å®ç°çš„ç”¨æˆ·æ–¹æ³•</span><br><span class="line">æ–¹ã€€ã€€æ³• è¯´ã€€ã€€æ˜</span><br><span class="line">is_authenticated() å¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œå¿…é¡»è¿”å› True ï¼Œå¦åˆ™è¿”å› False</span><br><span class="line">is_active() å¦‚æœå…è®¸ç”¨æˆ·ç™»å½•ï¼Œå¿…é¡»è¿”å› True ï¼Œå¦åˆ™è¿”å› False ã€‚å¦‚æœè¦ç¦ç”¨è´¦æˆ·ï¼Œå¯ä»¥è¿”å› False</span><br><span class="line">is_anonymous() å¯¹æ™®é€šç”¨æˆ·å¿…é¡»è¿”å› False</span><br><span class="line">get_id() å¿…é¡»è¿”å›ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä½¿ç”¨ Unicode ç¼–ç å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Flask-SQLAlchemy</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskå¾®ä¿¡å…¬ä¼—å·å¼€å‘</title>
    <url>//post/29173.html</url>
    <content><![CDATA[<h3 id="å¾®ä¿¡æœåŠ¡å™¨è®¤è¯"><a href="#å¾®ä¿¡æœåŠ¡å™¨è®¤è¯" class="headerlink" title="å¾®ä¿¡æœåŠ¡å™¨è®¤è¯"></a>å¾®ä¿¡æœåŠ¡å™¨è®¤è¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;wx_flask&#39;,methods&#x3D;[&#39;GET&#39;,&#39;POST&#39;])</span><br><span class="line">def wechat():</span><br><span class="line">    # ç¬¬ä¸€æ¬¡æ¥å…¥æœåŠ¡å™¨çš„éªŒè¯</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;GET&#39;:</span><br><span class="line">        #è¿™é‡Œæ”¹å†™ä½ åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é‡Œè¾“å…¥çš„token</span><br><span class="line">        token &#x3D; &#39;ctgu&#39;</span><br><span class="line">        #è·å–è¾“å…¥å‚æ•°</span><br><span class="line">        data &#x3D; request.args</span><br><span class="line">        signature &#x3D; data.get(&#39;signature&#39;,&#39;&#39;)</span><br><span class="line">        timestamp &#x3D; data.get(&#39;timestamp&#39;,&#39;&#39;)</span><br><span class="line">        nonce &#x3D; data.get(&#39;nonce&#39;,&#39;&#39;)</span><br><span class="line">        echostr &#x3D; data.get(&#39;echostr&#39;,&#39;&#39;)</span><br><span class="line">        #å­—å…¸æ’åº</span><br><span class="line">        list &#x3D; [token, timestamp, nonce]</span><br><span class="line">        list.sort()</span><br><span class="line"></span><br><span class="line">        s &#x3D; list[0] + list[1] + list[2]</span><br><span class="line">        #sha1åŠ å¯†ç®—æ³•        </span><br><span class="line">        hascode &#x3D; hashlib.sha1(s.encode(&#39;utf-8&#39;)).hexdigest()</span><br><span class="line">        #å¦‚æœæ˜¯æ¥è‡ªå¾®ä¿¡çš„è¯·æ±‚ï¼Œåˆ™å›å¤echostr</span><br><span class="line">        if hascode &#x3D;&#x3D; signature:</span><br><span class="line">            return echostr</span><br><span class="line">        else:</span><br><span class="line">            return &quot;éå¾®ä¿¡å®˜æ–¹è¯·æ±‚&quot;</span><br><span class="line">    #å›å¤ç”¨æˆ·æ¶ˆæ¯</span><br><span class="line">    elif request.method &#x3D;&#x3D; &quot;POST&quot;:</span><br><span class="line">        # è¡¨ç¤ºå¾®ä¿¡æœåŠ¡å™¨è½¬å‘æ¶ˆæ¯è¿‡æ¥</span><br><span class="line">        xml_str &#x3D; request.data</span><br><span class="line">        if not xml_str:</span><br><span class="line">            return &quot;ä¸æ”¯æŒæ­¤æ­¤ç±»å‹æ¶ˆæ¯å¤„ç†ï¼&quot;</span><br><span class="line">        # å¯¹xmlå­—ç¬¦ä¸²è¿›è¡Œè§£æ</span><br><span class="line">        xml_dict &#x3D; xmltodict.parse(xml_str)</span><br><span class="line">        xml_dict &#x3D; xml_dict.get(&quot;xml&quot;)</span><br><span class="line">        return resp_by_msg_type(xml_dict)</span><br></pre></td></tr></table></figure><a id="more"></a>

<h3 id="è‡ªåŠ¨å›å¤ç”¨æˆ·æ¶ˆæ¯"><a href="#è‡ªåŠ¨å›å¤ç”¨æˆ·æ¶ˆæ¯" class="headerlink" title="è‡ªåŠ¨å›å¤ç”¨æˆ·æ¶ˆæ¯"></a>è‡ªåŠ¨å›å¤ç”¨æˆ·æ¶ˆæ¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def resp_by_msg_type(xml_dict):</span><br><span class="line"></span><br><span class="line">    # æå–æ¶ˆæ¯ç±»å‹</span><br><span class="line"></span><br><span class="line">â€‹    msg_type &#x3D; xml_dict.get(&quot;MsgType&quot;)</span><br><span class="line">â€‹    if msg_type &#x3D;&#x3D; &quot;text&quot;:</span><br><span class="line"></span><br><span class="line">        # è¡¨ç¤ºå‘é€çš„æ˜¯æ–‡æœ¬æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">        # æ„é€ è¿”å›å€¼ï¼Œç»ç”±å¾®ä¿¡æœåŠ¡å™¨å›å¤ç»™ç”¨æˆ·çš„æ¶ˆæ¯å†…å®¹</span><br><span class="line"></span><br><span class="line">â€‹        resp_dict &#x3D; &#123;</span><br><span class="line">â€‹            &quot;xml&quot;: &#123;</span><br><span class="line">â€‹                &quot;ToUserName&quot;: xml_dict.get(&quot;FromUserName&quot;),</span><br><span class="line">â€‹                &quot;FromUserName&quot;: xml_dict.get(&quot;ToUserName&quot;),</span><br><span class="line">â€‹                &quot;CreateTime&quot;: int(time.time()),</span><br><span class="line">â€‹                &quot;MsgType&quot;: &quot;text&quot;,</span><br><span class="line">â€‹                &quot;Content&quot;: &quot;you say:&quot; + xml_dict.get(&quot;Content&quot;)</span><br><span class="line">â€‹            &#125;</span><br><span class="line">â€‹        &#125;</span><br><span class="line"></span><br><span class="line">        # å°†å­—å…¸è½¬æ¢ä¸ºxmlå­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">â€‹        resp_xml_str &#x3D; xmltodict.unparse(resp_dict)</span><br><span class="line"></span><br><span class="line">        # è¿”å›æ¶ˆæ¯æ•°æ®ç»™å¾®ä¿¡æœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">â€‹        return resp_xml_str</span><br><span class="line"></span><br><span class="line">    # æ”¶åˆ°å›¾ç‰‡æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">â€‹    if msg_type &#x3D;&#x3D; &quot;image&quot;:</span><br><span class="line"></span><br><span class="line">        # è¡¨ç¤ºå‘é€çš„æ˜¯æ–‡æœ¬æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">        # æ„é€ è¿”å›å€¼ï¼Œç»ç”±å¾®ä¿¡æœåŠ¡å™¨å›å¤ç»™ç”¨æˆ·çš„æ¶ˆæ¯å†…å®¹</span><br><span class="line"></span><br><span class="line">â€‹        resp_dict &#x3D; &#123;</span><br><span class="line">â€‹            &quot;xml&quot;: &#123;</span><br><span class="line">â€‹                &quot;ToUserName&quot;: xml_dict.get(&quot;FromUserName&quot;),</span><br><span class="line">â€‹                &quot;FromUserName&quot;: xml_dict.get(&quot;ToUserName&quot;),</span><br><span class="line">â€‹                &quot;CreateTime&quot;: int(time.time()),</span><br><span class="line">â€‹                &quot;MsgType&quot;: &quot;text&quot;,</span><br><span class="line">â€‹                &quot;PicUrl&quot;: xml_dict.get(&quot;PicUrl&quot;),</span><br><span class="line">â€‹                &quot;MediaId&quot;: xml_dict.get(&quot;MediaId&quot;),</span><br><span class="line"></span><br><span class="line">                # &quot;MsgId&quot; : xml_dict.get(&quot;MsgId&quot;)</span><br><span class="line"></span><br><span class="line">â€‹                &quot;MsgId&quot;: &quot;1234567890123456&quot;</span><br><span class="line">â€‹            &#125;</span><br><span class="line">â€‹        &#125;</span><br><span class="line"></span><br><span class="line">        # å°†å­—å…¸è½¬æ¢ä¸ºxmlå­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">â€‹        resp_xml_str &#x3D; xmltodict.unparse(resp_dict)</span><br><span class="line"></span><br><span class="line">        # è¿”å›æ¶ˆæ¯æ•°æ®ç»™å¾®ä¿¡æœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">â€‹        return resp_xml_str</span><br><span class="line">â€‹    else:</span><br><span class="line">â€‹        resp_dict &#x3D; &#123;</span><br><span class="line">â€‹            &quot;xml&quot;: &#123;</span><br><span class="line">â€‹                &quot;ToUserName&quot;: xml_dict.get(&quot;FromUserName&quot;),</span><br><span class="line">â€‹                &quot;FromUserName&quot;: xml_dict.get(&quot;ToUserName&quot;),</span><br><span class="line">â€‹                &quot;CreateTime&quot;: int(time.time()),</span><br><span class="line">â€‹                &quot;MsgType&quot;: &quot;text&quot;,</span><br><span class="line">â€‹                &quot;Content&quot;: &quot;æ¬¢è¿å…³æ³¨iBoyåšå®¢ï¼&quot;</span><br><span class="line">â€‹            &#125;</span><br><span class="line">â€‹        &#125;</span><br><span class="line">â€‹        resp_xml_str &#x3D; xmltodict.unparse(resp_dict)</span><br><span class="line"></span><br><span class="line">        # è¿”å›æ¶ˆæ¯æ•°æ®ç»™å¾®ä¿¡æœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">â€‹        return resp_xml_str</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Flask</category>
        <category>å…¬ä¼—å·</category>
      </categories>
      <tags>
        <tag>Flask</tag>
        <tag>å¾®ä¿¡å…¬ä¼—å·</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskéƒ¨ç½²</title>
    <url>//post/63618.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨ supervisor ç®¡ç†è¿›ç¨‹</span><br><span class="line">http:&#x2F;&#x2F;liyangliang.me&#x2F;posts&#x2F;2015&#x2F;06&#x2F;using-supervisor&#x2F;</span><br><span class="line">sudo pip3 install supervisor</span><br><span class="line"></span><br><span class="line">é¦–å…ˆæ¥çœ‹ supervisord çš„é…ç½®æ–‡ä»¶ã€‚å®‰è£…å®Œ supervisor ä¹‹åï¼Œå¯ä»¥è¿è¡Œecho_supervisord_conf å‘½ä»¤è¾“å‡ºé»˜è®¤çš„é…ç½®é¡¹ï¼Œä¹Ÿå¯ä»¥é‡å®šå‘åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œï¼š</span><br><span class="line"></span><br><span class="line">echo_supervisord_conf &gt; &#x2F;etc&#x2F;supervisord.conf</span><br></pre></td></tr></table></figure><a id="more"></a>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">å»é™¤é‡Œé¢å¤§éƒ¨åˆ†æ³¨é‡Šå’Œâ€œä¸ç›¸å…³â€çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹è¿™äº›é…ç½®ï¼š</span><br><span class="line"></span><br><span class="line">[unix_http_server]</span><br><span class="line">file=/tmp/supervisor.sock   ; UNIX socket æ–‡ä»¶ï¼Œsupervisorctl ä¼šä½¿ç”¨</span><br><span class="line">;chmod=<span class="number">0700</span>                 ; socket æ–‡ä»¶çš„ modeï¼Œé»˜è®¤æ˜¯ <span class="number">0700</span></span><br><span class="line">;chown=nobody:nogroup       ; socket æ–‡ä»¶çš„ ownerï¼Œæ ¼å¼ï¼š uid:gid</span><br><span class="line"></span><br><span class="line">;[inet_http_server]         ; HTTP æœåŠ¡å™¨ï¼Œæä¾› web ç®¡ç†ç•Œé¢</span><br><span class="line">;port=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9001</span>        ; Web ç®¡ç†åå°è¿è¡Œçš„ IP å’Œç«¯å£ï¼Œå¦‚æœå¼€æ”¾åˆ°å…¬ç½‘ï¼Œéœ€è¦æ³¨æ„å®‰å…¨æ€§</span><br><span class="line">;username=user              ; ç™»å½•ç®¡ç†åå°çš„ç”¨æˆ·å</span><br><span class="line">;password=<span class="number">123</span>               ; ç™»å½•ç®¡ç†åå°çš„å¯†ç </span><br><span class="line"></span><br><span class="line">[supervisord]</span><br><span class="line">logfile=/tmp/supervisord.log ; æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ $CWD/supervisord.log</span><br><span class="line">logfile_maxbytes=<span class="number">50</span>MB        ; æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œè¶…å‡ºä¼š rotateï¼Œé»˜è®¤ <span class="number">50</span>MB</span><br><span class="line">logfile_backups=<span class="number">10</span>           ; æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤‡ä»½æ•°é‡é»˜è®¤ <span class="number">10</span></span><br><span class="line">loglevel=info                ; æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ infoï¼Œå…¶å®ƒ: debug,warn,trace</span><br><span class="line">pidfile=/tmp/supervisord.pid ; pid æ–‡ä»¶</span><br><span class="line">nodaemon=false               ; æ˜¯å¦åœ¨å‰å°å¯åŠ¨ï¼Œé»˜è®¤æ˜¯ falseï¼Œå³ä»¥ daemon çš„æ–¹å¼å¯åŠ¨</span><br><span class="line">minfds=<span class="number">1024</span>                  ; å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å°å€¼ï¼Œé»˜è®¤ <span class="number">1024</span></span><br><span class="line">minprocs=<span class="number">200</span>                 ; å¯ä»¥æ‰“å¼€çš„è¿›ç¨‹æ•°çš„æœ€å°å€¼ï¼Œé»˜è®¤ <span class="number">200</span></span><br><span class="line"></span><br><span class="line">; the below section must remain <span class="keyword">in</span> the config file <span class="keyword">for</span> RPC</span><br><span class="line">; (supervisorctl/web interface) to work, additional interfaces may be</span><br><span class="line">; added by defining them <span class="keyword">in</span> separate rpcinterface: sections</span><br><span class="line">[rpcinterface:supervisor]</span><br><span class="line">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class="line"></span><br><span class="line">[supervisorctl]</span><br><span class="line">serverurl=unix:///tmp/supervisor.sock ; é€šè¿‡ UNIX socket è¿æ¥ supervisordï¼Œè·¯å¾„ä¸ unix_http_server éƒ¨åˆ†çš„ file ä¸€è‡´</span><br><span class="line">;serverurl=http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9001</span> ; é€šè¿‡ HTTP çš„æ–¹å¼è¿æ¥ supervisord</span><br><span class="line"></span><br><span class="line">; åŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶</span><br><span class="line">[include]</span><br><span class="line">files = relative/directory/*.ini    ; å¯ä»¥æ˜¯ *.conf æˆ– *.ini</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬æŠŠä¸Šé¢è¿™éƒ¨åˆ†é…ç½®ä¿å­˜åˆ° &#x2F;etc&#x2F;supervisord.confï¼ˆæˆ–å…¶ä»–ä»»æ„æœ‰æƒé™è®¿é—®çš„æ–‡ä»¶ï¼‰ï¼Œç„¶åå¯åŠ¨ supervisordï¼ˆé€šè¿‡ -c é€‰é¡¹æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœä¸æŒ‡å®šä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºæŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼š$CWD&#x2F;supervisord.conf, $CWD&#x2F;etc&#x2F;supervisord.conf, &#x2F;etc&#x2F;supervisord.confï¼‰ï¼š</span><br><span class="line"></span><br><span class="line">supervisord -c &#x2F;etc&#x2F;supervisord.conf</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ supervisord æ˜¯å¦åœ¨è¿è¡Œï¼š</span><br><span class="line">ps aux | grep supervisord</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">WSGIæœåŠ¡å™¨</span><br><span class="line">pip3 install gunicorn</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;xmxj0707&#x2F;p&#x2F;8452881.html</span><br><span class="line">$ gunicorn -w 4 app:app --error-logfile - --worker-class eventlet</span><br><span class="line"></span><br><span class="line">é…ç½®æ–‡ä»¶ç¼–å†™</span><br><span class="line">gunicorn -c gunicorn.conf run:app   -k eventlet</span><br><span class="line">python3 run.py  --host&#x3D;0.0.0.0 --port&#x3D;8888 --no-reload</span><br><span class="line">sudo apt-get install gunicorn</span><br><span class="line">gunicorn -b 0.0.0.0:8889 run:app -k eventlet</span><br><span class="line"></span><br><span class="line">#é…ç½®æ–‡ä»¶å†…å®¹</span><br><span class="line">import  os</span><br><span class="line">from  gevent import monkey</span><br><span class="line">monkey.patch_all()</span><br><span class="line">import multiprocessing</span><br><span class="line">debug &#x3D; False</span><br><span class="line">bind &#x3D; &quot;0.0.0.0:5001&quot;</span><br><span class="line">pidfile &#x3D; &quot;gunicorn.pid&quot;</span><br><span class="line">logfile &#x3D; &quot;error.log&quot;</span><br><span class="line">workers &#x3D; multiprocessing.cpu_count()*2 + 1</span><br><span class="line">worker_class &#x3D; &quot;gevent&quot; # å¼‚æ­¥éé˜»å¡</span><br><span class="line">reload &#x3D; True # è‡ªåŠ¨é‡æ–°åŠ è½½</span><br><span class="line">#daemon &#x3D; True</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸»è¦é—®é¢˜ï¼šhttpçš„socketå¦‚ä½•åœ¨httpsçš„ç½‘ç«™ä½¿ç”¨ï¼Ÿï¼Ÿ</span><br><span class="line">https:&#x2F;&#x2F;segmentfault.com&#x2F;q&#x2F;1010000013762709</span><br><span class="line"># socketä»£ç†é…ç½®</span><br><span class="line">    location &#x2F;socket.io&#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;192.54.2.1:3000;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    æ³¨æ„ï¼š</span><br><span class="line">é…ç½®å‰ç«¯socketè¿æ¥æ—¶åˆ«å¸¦ç«¯å£ï¼Œä½†è¦é…ç½®åˆ°https:&#x2F;&#x2F;ineedtm.com&#x2F;è€Œä¸æ˜¯htt...:&#x2F;&#x2F;ineedtm.com&#x2F;socket.io&#x2F;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;260f18aa5462</span><br><span class="line">é…ç½®è¯ä¹¦</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;gunicorn  -c  &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech&#x2F;config.py run:app</span><br><span class="line"></span><br><span class="line">gunicorn -c config.py run:app</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¼€å¯å¼‚æ­¥é˜Ÿåˆ—</span><br><span class="line">celery worker -A run.celery --loglevel&#x3D;info --pool&#x3D;eventlet  -E</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">celery worker -A run.celery --loglevel&#x3D;info --pool&#x3D;eventlet  -E</span><br><span class="line">export C_FORCE_ROOT&#x3D;&quot;True&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¯åŠ¨</span><br><span class="line">è¿™ä¸¤ä¸ªå‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ï¼Œsupervisord æ˜¯å¯åŠ¨ supervisor å®ˆæŠ¤è¿›ç¨‹ï¼ˆç±»ä¼¼äº systemd æˆ– init.d è¿™ç§ç”¨äºæ‰˜ç®¡è¿›ç¨‹çš„æœåŠ¡ï¼‰ï¼Œsupervisorctl æ˜¯ supervisord çš„å‘½ä»¤è¡Œæ§åˆ¶å°ã€‚</span><br><span class="line">supervisorctl -c  &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech&#x2F;supervisord.conf</span><br><span class="line"></span><br><span class="line">supervisord  -c  &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech&#x2F;supervisord.conf</span><br><span class="line"></span><br><span class="line">é‡å¯æœåŠ¡ supervisord  -c  -n &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech&#x2F;supervisord.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¯åŠ¨supervisor</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">$ supervisor â€“c &#x2F;etc&#x2F;supervisor&#x2F;supervisor.conf</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">8ã€ å¯åŠ¨æœåŠ¡å¹¶æ·»åŠ å¼€æœºå¯åŠ¨</span><br><span class="line">#å¯åŠ¨æœåŠ¡</span><br><span class="line">$ &#x2F;usr&#x2F;local&#x2F;bin&#x2F;supervisord -c &#x2F;etc&#x2F;supervisor&#x2F;supervisor.conf</span><br><span class="line"> </span><br><span class="line">#æ·»åŠ å¼€æœºå¯åŠ¨</span><br><span class="line">$ sudo vim &#x2F;etc&#x2F;rc.local</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;supervisord  -c  &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech&#x2F;supervisord.conf</span><br><span class="line"></span><br><span class="line">åå°è¿è¡Œ</span><br><span class="line">nohup &#x2F;usr&#x2F;local&#x2F;bin&#x2F;gunicorn  -c  &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech&#x2F;config.py run:app </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šè¿›å…¥ supervisorctl çš„ shell ç•Œé¢ï¼Œç„¶åå¯ä»¥æ‰§è¡Œä¸åŒçš„å‘½ä»¤äº†ï¼š</span><br><span class="line">&gt; status    # æŸ¥çœ‹ç¨‹åºçŠ¶æ€</span><br><span class="line">&gt; stop swzl   # å…³é—­ swzl ç¨‹åº</span><br><span class="line">&gt; start swzl  # å¯åŠ¨ swzl ç¨‹åº</span><br><span class="line">&gt; restart swzl    # é‡å¯ swzl ç¨‹åº</span><br><span class="line">&gt; reread    ï¼ƒ è¯»å–æœ‰æ›´æ–°ï¼ˆå¢åŠ ï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œä¸ä¼šå¯åŠ¨æ–°æ·»åŠ çš„ç¨‹åº</span><br><span class="line">&gt; update    ï¼ƒ é‡å¯é…ç½®æ–‡ä»¶ä¿®æ”¹è¿‡çš„ç¨‹åº</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¸Šé¢è¿™äº›å‘½ä»¤éƒ½æœ‰ç›¸åº”çš„è¾“å‡ºï¼Œé™¤äº†è¿›å…¥ supervisorctl çš„ shell ç•Œé¢ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ bash ç»ˆç«¯è¿è¡Œï¼š</span><br><span class="line"></span><br><span class="line">$ supervisorctl status</span><br><span class="line">$ supervisorctl stop swzl</span><br><span class="line">$ supervisorctl start swzl</span><br><span class="line">$ supervisorctl restart swzl</span><br><span class="line">$ supervisorctl reread</span><br><span class="line">$ supervisorctl update</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¿›ç¨‹ ps -ef | grep supervisord</span><br><span class="line">æ€æ‰</span><br><span class="line">åˆ›å»ºsupervisor.sock</span><br><span class="line"></span><br><span class="line">sudo touch &#x2F;var&#x2F;run&#x2F;supervisor.sock</span><br><span class="line">sudo chmod 777 &#x2F;var&#x2F;run&#x2F;supervisor.sock</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Nginxæ“ä½œ</span><br><span class="line">Centos nginxé‡å¯</span><br><span class="line"></span><br><span class="line">é‡å¯Nginx</span><br><span class="line"></span><br><span class="line">service nginx restart</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;nginx stop</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;nginx start</span><br><span class="line"></span><br><span class="line">Ubuntu Nginx</span><br><span class="line"></span><br><span class="line">$sudo service nginx start</span><br><span class="line">$sudo service nginx stop</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;info&#x2F;</span><br><span class="line">util-linux</span><br><span class="line"> python-gunicorn</span><br><span class="line"> gunicorn</span><br><span class="line"> supervisor</span><br><span class="line"> è¿™é‡Œåªåˆ—å‡ºäº†éƒ¨åˆ†é”™è¯¯ä¿¡æ¯ï¼Œå®é™…ä¸Šè¾“å‡ºçš„å†…å®¹æå¤šï¼Œå¤šå¾—è®©äººçœ¼éƒ½çã€‚</span><br><span class="line">åŸå› æˆ‘ä¸çŸ¥é“ï¼Œä½†ç»è¿‡ä¸€ç•ªGoogleï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªè§£å†³åŠæ³•ï¼š</span><br><span class="line">cd &#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;info&#x2F;</span><br><span class="line">sudo mv python-gunicorn python-gunicorn.bak</span><br><span class="line">sudo mv gunicorn gunicorn.bak</span><br><span class="line">sudo mv util-linux util-linux.bak</span><br><span class="line">sudo mv supervisor supervisor.bak</span><br></pre></td></tr></table></figure>

<h4 id="Docker-Gunicornéƒ¨ç½²Flask"><a href="#Docker-Gunicornéƒ¨ç½²Flask" class="headerlink" title="Docker+Gunicornéƒ¨ç½²Flask"></a>Docker+Gunicornéƒ¨ç½²Flask</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;wizardforcel.gitbooks.io&#x2F;the-flask-mega-tutorial-2017-zh&#x2F;docs&#x2F;19.html</span><br><span class="line">ç”¨dockeréƒ¨ç½²flask+gunicorn+nginx</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;xuanmanstein&#x2F;p&#x2F;7692256.html</span><br><span class="line"></span><br><span class="line">çŸ¥ä¹Flaskéƒ¨ç½² Flask + Docker æ— è„‘éƒ¨ç½²æ–°æ‰‹æ•™ç¨‹ - çŸ¥ä¹</span><br><span class="line">https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;78432719</span><br><span class="line"></span><br><span class="line">dockeræ•™ç¨‹</span><br><span class="line">https:&#x2F;&#x2F;yeasy.gitbooks.io&#x2F;docker_practice&#x2F;image&#x2F;dockerfile&#x2F;workdir.html</span><br><span class="line"></span><br><span class="line">åˆ é™¤é•œåƒ</span><br><span class="line">docker rmi imgid</span><br><span class="line">åˆ é™¤å®¹å™¨</span><br><span class="line">docker rm conid</span><br><span class="line">è¿›å…¥å®¹å™¨</span><br><span class="line">docker exec -it conid bash</span><br><span class="line"></span><br><span class="line">é‡å¯å®¹å™¨æœåŠ¡</span><br><span class="line">service docker restart</span><br><span class="line"></span><br><span class="line">æ„å»ºå®¹å™¨é•œåƒ</span><br><span class="line">å•æ­¥æµ‹è¯•</span><br><span class="line">docker build -t flask-copy:latest  -f Dockerfile1 --no-cache . </span><br><span class="line"></span><br><span class="line">docker build -t flask   --no-cache . </span><br><span class="line"></span><br><span class="line">sudo docker build -t &#39;testflask&#39; .</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å®¹å™¨é…ç½®</span><br><span class="line">docker logs swzl</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¿›ç¨‹</span><br><span class="line">docker ps |grep swzl</span><br><span class="line"></span><br><span class="line">åå°å®ˆæŠ¤è¿›ç¨‹</span><br><span class="line">Docker Dockerfile å®šåˆ¶é•œåƒ</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;lienhua34&#x2F;p&#x2F;5170335.html</span><br><span class="line"></span><br><span class="line">sudo docker run -it  --rm&#x3D;true 698277f85e44 ls  </span><br><span class="line"></span><br><span class="line">è¿›å…¥ç»ˆç«¯</span><br><span class="line">docker run -it  --rm&#x3D;true 698277f85e44 &#x2F;bin&#x2F;sh</span><br><span class="line"></span><br><span class="line">è¿›å…¥python</span><br><span class="line">docker run -it  --rm&#x3D;true 698277f85e44</span><br><span class="line"></span><br><span class="line">dockerä¹‹Dockerfileå®è·µ</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;lienhua34&#x2F;p&#x2F;5170335.html</span><br><span class="line"></span><br><span class="line">è¿è¡Œ ç”Ÿäº§ç¯å¢ƒè¿è¡Œ(ä»¥daemonæ–¹å¼è¿è¡Œ)</span><br><span class="line">sudo docker run -d -p 5000:5000 --name swzl swzl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">source venv&#x2F;bin&#x2F;activate</span><br><span class="line"></span><br><span class="line">ä»å®¹å™¨ä¸­æ„å»ºæ–°çš„é•œåƒ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker commit -m&#x3D;&quot;Created from img&quot; -a&#x3D;&quot;iBoy&quot; e537d42ba392 flask-v1:1.0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">FROM python:3.6-alpine</span><br><span class="line">WORKDIR &#x2F;www&#x2F;wwwroot&#x2F;test</span><br><span class="line">COPY requirements.txt requirements.txt</span><br><span class="line">RUN python -m venv venv</span><br><span class="line">RUN venv&#x2F;bin&#x2F;pip   install  -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple  --upgrade pip</span><br><span class="line">RUN venv&#x2F;bin&#x2F;pip install -r requirements.txt -i  https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br><span class="line">RUN mkdir -p &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech</span><br><span class="line">COPY app.py  &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech</span><br><span class="line">COPY wsgi.conf  &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech</span><br><span class="line">RUN pip --no-cache-dir install  -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple --upgrade pip</span><br><span class="line">#CMD gunicorn  -c gun.conf app:app</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;gunicorn  -c  &#x2F;www&#x2F;wwwroot&#x2F;swzl.iboy.tech&#x2F;config.py run:app </span><br><span class="line"></span><br><span class="line">docker run -p 8889:8889 --name swzl bc678a304 gunicorn config.py run:app</span><br><span class="line">  </span><br><span class="line">æµ‹è¯•è¿è¡Œï¼šdocker run -p 8889:8889 --name swzl bc678a304 gunicorn config.py run:app</span><br><span class="line"></span><br><span class="line">docker run -p 5000:5000 --name swzl flask-v1:1.0</span><br><span class="line"></span><br><span class="line">docker run --rm -p 8889:8889 --name swzl</span><br><span class="line"></span><br><span class="line">docker run --name swzl -d -p 8889:8889 --rm swzl:latest</span><br><span class="line"></span><br><span class="line">docker history node-vanilla</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PWDä½¿ç”¨</span><br><span class="line">base&#x3D;https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;machine&#x2F;releases&#x2F;download&#x2F;v0.14.0 &amp;&amp;</span><br><span class="line">  curl -L $base&#x2F;docker-machine-$(uname -s)-$(uname -m) &gt;&#x2F;tmp&#x2F;docker-machine &amp;&amp;</span><br><span class="line">  sudo install &#x2F;tmp&#x2F;docker-machine &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-machine</span><br></pre></td></tr></table></figure>



<h4 id="VsCodeè¿œç¨‹è¿æ¥Docker"><a href="#VsCodeè¿œç¨‹è¿æ¥Docker" class="headerlink" title="VsCodeè¿œç¨‹è¿æ¥Docker"></a>VsCodeè¿œç¨‹è¿æ¥Docker</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service</span><br><span class="line">åŸdocker.serviceé…ç½®ä¸­çš„ExecStarté…ç½®é¡¹</span><br><span class="line"></span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd -H unix:&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹ä¸º</span><br><span class="line"></span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd -H unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock -H tcp:&#x2F;&#x2F;0.0.0.0:2375</span><br><span class="line"></span><br><span class="line">é‡å¯Dockeré…ç½®ç”Ÿæ•ˆ</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br></pre></td></tr></table></figure>



<h2 id="1-ç™»å½•é˜¿é‡Œäº‘Docker-Registry"><a href="#1-ç™»å½•é˜¿é‡Œäº‘Docker-Registry" class="headerlink" title="1. ç™»å½•é˜¿é‡Œäº‘Docker Registry"></a>1. ç™»å½•é˜¿é‡Œäº‘Docker Registry</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo docker login --username&#x3D;yang.hao@aliyun.com registry.cn-hangzhou.aliyuncs.com</span><br></pre></td></tr></table></figure>

<p>ç”¨äºç™»å½•çš„ç”¨æˆ·åä¸ºé˜¿é‡Œäº‘è´¦å·å…¨åï¼Œå¯†ç ä¸ºå¼€é€šæœåŠ¡æ—¶è®¾ç½®çš„å¯†ç ã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨è®¿é—®å‡­è¯é¡µé¢ä¿®æ”¹å‡­è¯å¯†ç ã€‚</p>
<h2 id="2-ä»Registryä¸­æ‹‰å–é•œåƒ"><a href="#2-ä»Registryä¸­æ‹‰å–é•œåƒ" class="headerlink" title="2. ä»Registryä¸­æ‹‰å–é•œåƒ"></a>2. ä»Registryä¸­æ‹‰å–é•œåƒ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo docker pull registry.cn-hangzhou.aliyuncs.com&#x2F;iboy&#x2F;qmx:[é•œåƒç‰ˆæœ¬å·]</span><br></pre></td></tr></table></figure>

<h2 id="3-å°†é•œåƒæ¨é€åˆ°Registry"><a href="#3-å°†é•œåƒæ¨é€åˆ°Registry" class="headerlink" title="3. å°†é•œåƒæ¨é€åˆ°Registry"></a>3. å°†é•œåƒæ¨é€åˆ°Registry</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo docker login --username&#x3D;yang.hao@aliyun.com registry.cn-hangzhou.aliyuncs.com$ sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com&#x2F;iboy&#x2F;qmx:[é•œåƒç‰ˆæœ¬å·]$ sudo docker push registry.cn-hangzhou.aliyuncs.com&#x2F;iboy&#x2F;qmx:[é•œåƒç‰ˆæœ¬å·]</span><br></pre></td></tr></table></figure>

<p>è¯·æ ¹æ®å®é™…é•œåƒä¿¡æ¯æ›¿æ¢ç¤ºä¾‹ä¸­çš„[ImageId]å’Œ[é•œåƒç‰ˆæœ¬å·]å‚æ•°ã€‚</p>
<h2 id="4-é€‰æ‹©åˆé€‚çš„é•œåƒä»“åº“åœ°å€"><a href="#4-é€‰æ‹©åˆé€‚çš„é•œåƒä»“åº“åœ°å€" class="headerlink" title="4. é€‰æ‹©åˆé€‚çš„é•œåƒä»“åº“åœ°å€"></a>4. é€‰æ‹©åˆé€‚çš„é•œåƒä»“åº“åœ°å€</h2><p>ä»ECSæ¨é€é•œåƒæ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨é•œåƒä»“åº“å†…ç½‘åœ°å€ã€‚æ¨é€é€Ÿåº¦å°†å¾—åˆ°æå‡å¹¶ä¸”å°†ä¸ä¼šæŸè€—æ‚¨çš„å…¬ç½‘æµé‡ã€‚</p>
<p>å¦‚æœæ‚¨ä½¿ç”¨çš„æœºå™¨ä½äºVPCç½‘ç»œï¼Œè¯·ä½¿ç”¨ registry-vpc.cn-hangzhou.aliyuncs.com ä½œä¸ºRegistryçš„åŸŸåç™»å½•ï¼Œå¹¶ä½œä¸ºé•œåƒå‘½åç©ºé—´å‰ç¼€ã€‚</p>
<h2 id="5-ç¤ºä¾‹"><a href="#5-ç¤ºä¾‹" class="headerlink" title="5. ç¤ºä¾‹"></a>5. ç¤ºä¾‹</h2><p>ä½¿ç”¨â€docker tagâ€å‘½ä»¤é‡å‘½åé•œåƒï¼Œå¹¶å°†å®ƒé€šè¿‡ä¸“æœ‰ç½‘ç»œåœ°å€æ¨é€è‡³Registryã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo docker imagesREPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZEregistry.aliyuncs.com&#x2F;acs&#x2F;agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB$ sudo docker tag 37bb9c63c8b2 registry-vpc.cn-hangzhou.aliyuncs.com&#x2F;acs&#x2F;agent:0.7-dfb6816</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨â€docker imagesâ€å‘½ä»¤æ‰¾åˆ°é•œåƒï¼Œå°†è¯¥é•œåƒåç§°ä¸­çš„åŸŸåéƒ¨åˆ†å˜æ›´ä¸ºRegistryä¸“æœ‰ç½‘ç»œåœ°å€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo docker push registry-vpc.cn-hangzhou.aliyuncs.com&#x2F;acs&#x2F;agent:0.7-dfb6816</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Hadoopåˆä½“éªŒ</title>
    <url>//post/51380.html</url>
    <content><![CDATA[<h1 id="1ã€é…ç½®JDKçš„"><a href="#1ã€é…ç½®JDKçš„" class="headerlink" title="1ã€é…ç½®JDKçš„"></a>1ã€é…ç½®JDKçš„</h1><p>JAVA_HOME=/app/jdk1.8.0_171</p><p>CLASSPATH=./$JAVA_HOME/lib/tools.jar</p><a id="more"></a>

<p>PATH=$JAVA_HOME/bin:$PATH</p>
<p>export  JAVA_HOME  CLASSPATH  PATH</p>
<h1 id="2ã€æ­å»ºä¼ªåˆ†å¸ƒå¼é›†ç¾¤"><a href="#2ã€æ­å»ºä¼ªåˆ†å¸ƒå¼é›†ç¾¤" class="headerlink" title="2ã€æ­å»ºä¼ªåˆ†å¸ƒå¼é›†ç¾¤"></a>2ã€æ­å»ºä¼ªåˆ†å¸ƒå¼é›†ç¾¤</h1>]]></content>
  </entry>
  <entry>
    <title>Hexoå¦‚ä½•å¤‡ä»½</title>
    <url>//post/40451.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo backup --init #åˆå§‹åŒ–å¤‡ä»½</span><br><span class="line">hexo backup #å¤‡ä»½æ“ä½œ</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaé¡¹ç›®éƒ¨ç½²</title>
    <url>//post/30839.html</url>
    <content><![CDATA[<h1 id="é¡¹ç›®éƒ¨ç½²"><a href="#é¡¹ç›®éƒ¨ç½²" class="headerlink" title="é¡¹ç›®éƒ¨ç½²"></a>é¡¹ç›®éƒ¨ç½²</h1><p>åŸºäºubuntu 16.04ç³»ç»Ÿï¼Œä½¿ç”¨ Nginx è¿›è¡Œå¸ƒç½²ï¼Œäº‘æœåŠ¡å™¨ä¸ºé˜¿é‡Œäº‘</p><h2 id="é˜¿é‡Œäº‘æœåŠ¡å™¨"><a href="#é˜¿é‡Œäº‘æœåŠ¡å™¨" class="headerlink" title="é˜¿é‡Œäº‘æœåŠ¡å™¨"></a>é˜¿é‡Œäº‘æœåŠ¡å™¨</h2><ul>
<li>é€‰æ‹©äº‘æœåŠ¡å™¨:é˜¿é‡Œäº‘æœåŠ¡å™¨ <a href="https://www.aliyun.com" target="_blank" rel="noopener">https://www.aliyun.com</a></li>
<li>ä¸ªäººå…è´¹è·å– [<a href="https://free.aliyun.com/" target="_blank" rel="noopener">https://free.aliyun.com/</a>]</li>
<li>åˆ›å»ºæœåŠ¡å™¨é€‰æ‹©ubuntu16.04 64ä½çš„æ“ä½œç³»ç»Ÿ</li>
<li>è¿›å…¥æ§åˆ¶å°,æŸ¥çœ‹å®ä¾‹åˆ›å»ºæƒ…å†µ</li>
<li>ç»™å®‰å…¨ç»„é…ç½®è§„åˆ™ï¼Œæ·»åŠ 8080ç«¯å£</li>
<li>åˆ©ç”¨å‘½ä»¤è¡Œè¿›è¡Œè¿œç¨‹æœåŠ¡å™¨ç™»å½•</li>
</ul><a id="more"></a>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh ç”¨æˆ·å@ipåœ°å€</span><br></pre></td></tr></table></figure>

<h2 id="ç›¸å…³ç¯å¢ƒå®‰è£…"><a href="#ç›¸å…³ç¯å¢ƒå®‰è£…" class="headerlink" title="ç›¸å…³ç¯å¢ƒå®‰è£…"></a>ç›¸å…³ç¯å¢ƒå®‰è£…</h2><p>ä»¥ä¸‹æ“ä½œéƒ½åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿›è¡Œæ“ä½œ (ubuntu 16.04)</p>
<ul>
<li>å…ˆæ›´æ–° apt ç›¸å…³æº</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<ul>
<li>mysqlå®‰è£…</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apt-get install mysql-server</span><br><span class="line">apt-get install libmysqlclient-dev</span><br></pre></td></tr></table></figure>

<ul>
<li>rz/szå‘½ä»¤å®‰è£…</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apt-get install lrzsz</span><br></pre></td></tr></table></figure>

<ul>
<li>nginxå®‰è£…</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>nginxè¿è¡ŒåŠåœæ­¢</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;nginx start #å¯åŠ¨</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;nginx stop  #åœæ­¢</span><br></pre></td></tr></table></figure>

<ul>
<li>é…ç½®æ–‡ä»¶<ul>
<li>ç¼–è¾‘æ–‡ä»¶:/etc/nginx/sites-available/default</li>
</ul>
</li>
</ul>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ˜¯å¤šå°æœåŠ¡å™¨çš„è¯ï¼Œåˆ™åœ¨æ­¤é…ç½®ï¼Œå¹¶ä¿®æ”¹ location èŠ‚ç‚¹ä¸‹é¢çš„ proxy_pass </span></span><br><span class="line"><span class="attribute">upstream</span> myserver &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8080</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8081</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="comment"># ç›‘å¬80ç«¯å£</span></span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">        <span class="attribute">listen</span> [::]:<span class="number">80</span> default_server;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">root</span> /var/www/html;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">index</span> index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">                <span class="comment"># è½¬å‘è¯·æ±‚åˆ°æœ¬åœ°ç«¯å£ </span></span><br><span class="line">                <span class="attribute">proxy_pass</span> http://127.0.0.1:8080;</span><br><span class="line">                <span class="comment"># è¯·æ±‚è½¬å‘åˆ°å¤šå°æœåŠ¡å™¨</span></span><br><span class="line">                <span class="comment"># proxy_pass http://myserver;</span></span><br><span class="line">                <span class="comment"># è®¾ç½®è¯·æ±‚å¤´ï¼Œå¹¶å°†å¤´ä¿¡æ¯ä¼ é€’ç»™æœåŠ¡å™¨ç«¯ </span></span><br><span class="line">                <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">                <span class="comment"># è®¾ç½®è¯·æ±‚å¤´ï¼Œä¼ é€’åŸå§‹è¯·æ±‚ip </span></span><br><span class="line">                <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨åº”ç”¨"><a href="#å¯åŠ¨åº”ç”¨" class="headerlink" title="å¯åŠ¨åº”ç”¨"></a>å¯åŠ¨åº”ç”¨</h2><p>æ‰§è¡Œnohup java -jar xxx.jar &amp; &gt; log.log</p>
]]></content>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>IDEAå¿«æ·é”®</title>
    <url>//post/43648.html</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>å¿«æ·é”®</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl+Shift+Alt+U</td>
<td>æŸ¥çœ‹ç±»å›¾</td>
</tr>
<tr>
<td>Ctrl+Alt+B</td>
<td>æŸ¥çœ‹æ¥å£çš„å®ç°</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>]]></content>
  </entry>
  <entry>
    <title>Jupyterä½¿ç”¨</title>
    <url>//post/3217.html</url>
    <content><![CDATA[<h1 id="1ã€å®‰è£…"><a href="#1ã€å®‰è£…" class="headerlink" title="1ã€å®‰è£…"></a>1ã€å®‰è£…</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conda install jupyter</span><br></pre></td></tr></table></figure><h1 id="2ã€é…ç½®"><a href="#2ã€é…ç½®" class="headerlink" title="2ã€é…ç½®"></a>2ã€é…ç½®</h1><p>ç”Ÿæˆè‡ªå®šä¹‰é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jupyter notebook --generate-config</span><br></pre></td></tr></table></figure><a id="more"></a>




<p>ç”Ÿæˆçš„é…ç½®æ–‡ä»¶çš„è·¯å¾„</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">C:\Users\Default Account\.jupyter\jupyter_notebook_config.py</span><br></pre></td></tr></table></figure>

<p>1ã€å–æ¶ˆå¯åŠ¨çš„å¯†ç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"># c.NotebookApp.token = '&lt;generated&gt;'</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">c.NotebookApp.token = <span class="string">' '</span></span><br></pre></td></tr></table></figure>

<p>2ã€ä¿®æ”¹é»˜è®¤åœ°å€</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">#c.NotebookApp.notebook_dir = <span class="meta-string">''</span></span></span><br><span class="line">c.NotebookApp.notebook_dir = 'your path'</span><br><span class="line">c.NotebookApp.notebook_dir = 'O:\Jupyter'</span><br></pre></td></tr></table></figure>

<h1 id="3ã€è®¾ç½®ä»£ç è¡¥å…¨"><a href="#3ã€è®¾ç½®ä»£ç è¡¥å…¨" class="headerlink" title="3ã€è®¾ç½®ä»£ç è¡¥å…¨"></a>3ã€è®¾ç½®ä»£ç è¡¥å…¨</h1><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">pip install jupyter_contrib_nbextensions -i https:<span class="comment">//pypi.mirrors.ustc.edu.cn/simpleï¼</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ä»£ç è¡¥å…¨çš„æ•™ç¨‹ï¼š<a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions/blob/master/README.md" target="_blank" rel="noopener">https://github.com/ipython-contrib/jupyter_contrib_nbextensions/blob/master/README.md</a></p>
<h1 id="4ã€Vscodeä¸­ä½¿ç”¨Jupyter"><a href="#4ã€Vscodeä¸­ä½¿ç”¨Jupyter" class="headerlink" title="4ã€Vscodeä¸­ä½¿ç”¨Jupyter"></a>4ã€Vscodeä¸­ä½¿ç”¨Jupyter</h1><p><a href="https://blog.csdn.net/u013709332/article/details/105029123" target="_blank" rel="noopener">https://blog.csdn.net/u013709332/article/details/105029123</a></p>
<blockquote>
<p>ç›¸å…³æ•™ç¨‹ï¼š<a href="https://blog.csdn.net/weixin_37595559/article/details/81540482" target="_blank" rel="noopener">https://blog.csdn.net/weixin_37595559/article/details/81540482</a></p>
<p>numpyå®˜ç½‘ï¼š<a href="https://www.numpy.org.cn/" target="_blank" rel="noopener">https://www.numpy.org.cn/</a></p>
<p>matplotlibå®˜ç½‘ï¼š<a href="https://www.matplotlib.org.cn/" target="_blank" rel="noopener">https://www.matplotlib.org.cn/</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>Hexoåšå®¢ä¼˜åŒ–</title>
    <url>//post/42790.html</url>
    <content><![CDATA[<p>HexoæŠ˜è…¾-æ‰©å±•ç¯‡</p><p>â€‹    ä¸»é¢˜ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/theme-next/hexo-theme-next" target="_blank" rel="noopener">https://github.com/theme-next/hexo-theme-next</a></p><a id="more"></a>

<p>â€‹    1.ç»™Hexoæ·»åŠ æœç´¢åŠŸèƒ½</p>
<p>â€‹            <a href="https://www.jianshu.com/p/d388119a90ec" target="_blank" rel="noopener">https://www.jianshu.com/p/d388119a90ec</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>

<p>â€‹    2.Hexoç”Ÿæˆå”¯ä¸€çš„æ–‡ç« é“¾æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure>

<p>â€‹            <a href="https://segmentfault.com/a/1190000005799711" target="_blank" rel="noopener">https://segmentfault.com/a/1190000005799711</a></p>
<p>â€‹    3.Hexoå‘å¸ƒçš„æ’ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>â€‹            <a href="https://www.cnblogs.com/liuxianan/p/build-blog-website-by-hexo-github.html" target="_blank" rel="noopener">https://www.cnblogs.com/liuxianan/p/build-blog-website-by-hexo-github.html</a></p>
]]></content>
      <categories>
        <category>Hexo</category>
        <category>ç¾åŒ–</category>
      </categories>
  </entry>
  <entry>
    <title>Javaé«˜çº§ä¸Šè¯¾ç¬”è®°</title>
    <url>//post/58020.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Jupyterçš„å¿«æ·é”®</title>
    <url>//post/50306.html</url>
    <content><![CDATA[<p><a href="https://www.cnblogs.com/bky-zhwtt123/p/12655382.html" target="_blank" rel="noopener">https://www.cnblogs.com/bky-zhwtt123/p/12655382.html</a></p><a id="more"></a>
<p>çŸ¥ä¹ï¼šæ¨è<a href="https://zhuanlan.zhihu.com/p/101646637" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/101646637</a></p>
]]></content>
  </entry>
  <entry>
    <title>Linuxä¸‹Pythoné»˜è®¤ç‰ˆæœ¬æ›´æ”¹</title>
    <url>//post/30764.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ›´æ”¹Ubuntu18.04é»˜è®¤Pythonç‰ˆ</span><br><span class="line">https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;368b6b822cd8</span><br><span class="line"></span><br><span class="line">update-alternatives --list python</span><br><span class="line">update-alternatives: error: no alternatives forpython</span><br><span class="line"></span><br><span class="line">å¦‚æœå‡ºç°ä»¥ä¸Šæ‰€ç¤ºçš„é”™è¯¯ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤º Python çš„æ›¿ä»£ç‰ˆæœ¬å°šæœªè¢« update-alternatives å‘½ä»¤è¯†åˆ«ã€‚æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°ä¸€ä¸‹æ›¿ä»£åˆ—è¡¨ï¼Œå°† python2.7 å’Œ python3.4 æ”¾å…¥å…¶ä¸­ã€‚</span><br><span class="line"></span><br><span class="line"># update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;python python &#x2F;usr&#x2F;bin&#x2F;python2.7 1</span><br><span class="line"></span><br><span class="line">update-alternatives: using &#x2F;usr&#x2F;bin&#x2F;python2.7 to provide &#x2F;usr&#x2F;bin&#x2F;python(python) inauto mode</span><br><span class="line"></span><br><span class="line"># update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;python python &#x2F;usr&#x2F;bin&#x2F;python3.5 3</span><br><span class="line"></span><br><span class="line">update-alternatives: using &#x2F;usr&#x2F;bin&#x2F;python3.4 to provide &#x2F;usr&#x2F;bin&#x2F;python(python) inauto mode</span><br><span class="line"></span><br><span class="line">--install é€‰é¡¹ä½¿ç”¨äº†å¤šä¸ªå‚æ•°ç”¨äºåˆ›å»ºç¬¦å·é“¾æ¥ã€‚æœ€åä¸€ä¸ªå‚æ•°æŒ‡å®šäº†æ­¤é€‰é¡¹çš„ä¼˜å…ˆçº§ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ‰‹åŠ¨æ¥è®¾ç½®æ›¿ä»£é€‰é¡¹ï¼Œé‚£ä¹ˆå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„é€‰é¡¹å°±ä¼šè¢«é€‰ä¸­ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸º &#x2F;usr&#x2F;bin&#x2F;python3.4 è®¾ç½®çš„ä¼˜å…ˆçº§ä¸º2ï¼Œæ‰€ä»¥update-alternatives å‘½ä»¤ä¼šè‡ªåŠ¨å°†å®ƒè®¾ç½®ä¸ºé»˜è®¤ Python ç‰ˆæœ¬ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">update-alternatives --list python</span><br><span class="line">sudo ln -s &#x2F;usr&#x2F;bin&#x2F;python2.7  &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python</span><br><span class="line">sudo ln -s &#x2F;usr&#x2F;bin&#x2F;python3.5 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python</span><br><span class="line">å› æ­¤å¯ä»¥åœ¨ &#x2F;usr&#x2F;bin&#x2F;ä¸‹ æ–°å»º pipçš„é“¾æ¥åˆ° python3 å®‰è£…ç›®å½•ä¸‹åˆ° pip3ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</span><br><span class="line">å…ˆå»ºç«‹è½¯ä»¶é“¾æ¥</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3.6&#x2F;bin&#x2F;pip3 &#x2F;usr&#x2F;bin&#x2F;pip3.6</span><br><span class="line"></span><br><span class="line">$ update-alternatives --list python</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;python python &#x2F;usr&#x2F;bin&#x2F;python3.5 6</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;python python &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3.6 4</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;python python &#x2F;usr&#x2F;bin&#x2F;python2.7 4</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;python python &#x2F;usr&#x2F;bin&#x2F;python2 6</span><br><span class="line"></span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;python python &#x2F;usr&#x2F;bin&#x2F;python3.6 4</span><br><span class="line">sudo update-alternatives --config python</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜</span><br><span class="line">é€‰æ‹©è¦æ‰§è¡Œçš„ç‰ˆæœ¬</span><br><span class="line">whereis pip</span><br><span class="line">sudo rm &#x2F;usr&#x2F;bin&#x2F;pip</span><br><span class="line">sudo ln -s &#x2F;usr&#x2F;bin&#x2F;pip2.7 &#x2F;usr&#x2F;bin&#x2F;pip</span><br><span class="line"></span><br><span class="line">é¦–å…ˆåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„pythonæ›¿ä»£ç‰ˆæœ¬ä¿¡æ¯ï¼š</span><br><span class="line">sudo ln -s &#x2F;usr&#x2F;bin&#x2F;python3.6 &#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">$ update-alternatives --list pip</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;pip pip &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip2.7 5</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;pip pip &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip3.5 2</span><br><span class="line">sudo update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;pip pip &#x2F;usr&#x2F;bin&#x2F;pip3 4</span><br><span class="line">sudo update-alternatives --config pip</span><br><span class="line"></span><br><span class="line">ç§»é™¤æ›¿ä»£ç‰ˆæœ¬</span><br><span class="line">update-alternatives --remove python &#x2F;usr&#x2F;bin&#x2F;python3.5</span><br><span class="line"></span><br><span class="line">update-alternatives --remove pip &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip3.5</span><br><span class="line">update-alternatives --remove pip &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip2.7</span><br><span class="line"></span><br><span class="line">åªä¸ºå½“å‰ç”¨æˆ·æ›´æ”¹</span><br><span class="line">alias pip&#x3D;pip3</span><br><span class="line">alias python&#x3D;python3.6</span><br></pre></td></tr></table></figure><a id="more"></a>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®‰è£…Python3.5</span><br><span class="line">æ›´æ”¹Linuxä¸‹pip å®‰è£…åŒ…çš„é»˜è®¤ä½ç½®</span><br><span class="line">http:&#x2F;&#x2F;www.qfrost.com&#x2F;ubuntu%E5%8D%87%E7%BA%A7Python%E5%8F%8Apip&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;C_chuxin&#x2F;article&#x2F;details&#x2F;82962797?utm_source&#x3D;distribute.pc_relevant.none-task</span><br><span class="line"></span><br><span class="line">vim &#x2F;usr&#x2F;local&#x2F;python3.5&#x2F;lib&#x2F;python3.5&#x2F;site.py</span><br><span class="line"></span><br><span class="line">USER_SITE &#x3D; &quot;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.5&#x2F;dist-packages&quot;     #ç”¨æˆ·è‡ªå®šä¹‰çš„ä¾èµ–å®‰è£…åŒ…çš„è·¯å¾„</span><br><span class="line"> </span><br><span class="line">USER_BASE &#x3D; &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3.5&quot;    #ç”¨æˆ·è‡ªå®šä¹‰çš„å¯ç”¨Pythonè„šæœ¬çš„è·¯å¾„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">apt-get install python3.5 ç›´æ¥å®‰è£…å¯èƒ½ä¼šæŠ¥é”™</span><br><span class="line"></span><br><span class="line">wget https:&#x2F;&#x2F;mirrors.huaweicloud.com&#x2F;python&#x2F;3.5.2&#x2F;Python-3.5.2.tgz</span><br><span class="line">cd Python-3.5.2</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3.5&#x2F;bin&#x2F;python3.5 &#x2F;usr&#x2F;bin&#x2F;python3.5</span><br><span class="line"> make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;sqlite3 --disable-static --enable-fts5 --enable-json1 CFLAGS&#x3D;&quot;-g -O2 -DSQLITE_ENABLE_FTS3&#x3D;1 -DSQLITE_ENABLE_FTS4&#x3D;1 -DSQLITE_ENABLE_RTREE&#x3D;1&quot;</span><br></pre></td></tr></table></figure>



<h4 id="ç¼–è¯‘å®‰è£…sqlite3çš„åŒ…"><a href="#ç¼–è¯‘å®‰è£…sqlite3çš„åŒ…" class="headerlink" title="ç¼–è¯‘å®‰è£…sqlite3çš„åŒ…"></a>ç¼–è¯‘å®‰è£…sqlite3çš„åŒ…</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> ï¼ˆ1ï¼‰é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œåªèƒ½é‡‡å–æœ€åŸå§‹çš„åŠæ³•æ¥è¿›è¡Œå®‰è£…ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹;</span><br><span class="line">$ wget https:&#x2F;&#x2F;www.sqlite.org&#x2F;2017&#x2F;sqlite-autoconf-3170000.tar.gz --no-check-certificate</span><br><span class="line">$ tar zxvf sqlite-autoconf-3170000.tar.gz</span><br><span class="line">$ cd sqlite-autoconf-3170000</span><br><span class="line">$ .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;sqlite3 --disable-static --enable-fts5 --enable-json1 CFLAGS&#x3D;&quot;-g -O2 -DSQLITE_ENABLE_FTS3&#x3D;1 -DSQLITE_ENABLE_FTS4&#x3D;1 -DSQLITE_ENABLE_RTREE&#x3D;1&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ï¼ˆ2ï¼‰å¯¹python3è¿›è¡Œé‡æ–°ç¼–è¯‘</span><br><span class="line">$ cd Python-3.6.2</span><br><span class="line">$ LD_RUN_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sqlite3&#x2F;lib .&#x2F;configure LDFLAGS&#x3D;&quot;-L&#x2F;usr&#x2F;local&#x2F;sqlite3&#x2F;lib&quot; CPPFLAGS&#x3D;&quot;-I &#x2F;usr&#x2F;local&#x2F;sqlite3&#x2F;include&quot;</span><br><span class="line">$ LD_RUN_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sqlite3&#x2F;lib make</span><br><span class="line">$ LD_RUN_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sqlite3&#x2F;lib sudo make install</span><br><span class="line">é€šè¿‡ä¸Šè¿°å®‰è£…è¿‡ç¨‹ï¼Œç»ˆäºå¯ä»¥é¡ºåˆ©å®ç°pythonå¯¹sqlite3çš„æ”¯æŒäº†ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è§£å†³æ–¹æ³•ï¼šï¼š </span><br><span class="line">cd &#x2F;var&#x2F;lib&#x2F;dpkg </span><br><span class="line">sudo mv info info.bak </span><br><span class="line">sudo mkdir info </span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure>

<h4 id="pipå®‰è£…"><a href="#pipå®‰è£…" class="headerlink" title="pipå®‰è£…"></a>pipå®‰è£…</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;wangweiwells&#x2F;article&#x2F;details&#x2F;88374070</span><br><span class="line">å®‰è£…pip</span><br><span class="line">4ï¼Œå®‰è£…pipï¼ˆå¯¹åº”Pythonç‰ˆæœ¬ï¼‰</span><br><span class="line"></span><br><span class="line">ä¸‹è½½pip åŒ…</span><br><span class="line">https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;pip&#x2F;9.0.1&#x2F;#files</span><br><span class="line">è§£å‹ï¼Œå®‰è£…ï¼š</span><br><span class="line">tar -zxvf pip-9.0.1.tar.gz</span><br><span class="line">cd pip-9.0.1</span><br><span class="line">python2.7 setup.py install</span><br><span class="line"></span><br><span class="line">wget https:&#x2F;&#x2F;bootstrap.pypa.io&#x2F;get-pip.py  --no-check-certificate</span><br><span class="line">sudo python get-pip.py</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;jianghao_ava&#x2F;article&#x2F;details&#x2F;81097980</span><br></pre></td></tr></table></figure>

<h5 id="é¡¹ç›®ä¾èµ–å¯¼å‡º"><a href="#é¡¹ç›®ä¾èµ–å¯¼å‡º" class="headerlink" title="é¡¹ç›®ä¾èµ–å¯¼å‡º"></a>é¡¹ç›®ä¾èµ–å¯¼å‡º</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install pipreqs</span><br><span class="line">pipreqs .&#x2F;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Linxå¸¸ç”¨å‘½ä»¤-Ubuntu</title>
    <url>//post/37333.html</url>
    <content><![CDATA[<p>1.ä¸ä¿å­˜å‘½ä»¤æ‰§è¡Œè®°å½•</p><p>vi /root/.bash_history</p><p>ç”¨ history -c æ¸…ç©ºå†å²å‘½ä»¤.<br>åœ¨.bashrcçš„æœ€åè¡Œè¿½åŠ <br>unset HISTFILE</p><a id="more"></a>


<p>2.å¼€æœºå¯åŠ¨é¡¹è®¾ç½®</p>
<p>â€‹    sudo vi /etc/rc.local</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2ï¼Œ	å¼€å¯é˜²ç«å¢™ï¼Œ</span><br><span class="line">å¯åŠ¨firewallï¼š</span><br><span class="line"></span><br><span class="line">systemctl start firewalld.service</span><br><span class="line">1</span><br><span class="line">è®¾ç½®å¼€æœºè‡ªå¯ï¼š</span><br><span class="line">systemctl disable firewalld.service</span><br><span class="line">systemctl enable firewalld.service</span><br><span class="line">1</span><br><span class="line">3ï¼Œ	é‡å¯é˜²ç«å¢™ï¼š</span><br><span class="line"></span><br><span class="line">systemctl restart firewalld.service</span><br><span class="line">1</span><br><span class="line">4ï¼Œ	æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€æ˜¯å¦æ‰“å¼€ï¼š</span><br><span class="line"></span><br><span class="line">firewall-cmd --state</span><br><span class="line">1</span><br><span class="line">å¼€ç«¯å£å‘½ä»¤ï¼šfirewall-cmd --zone&#x3D;public --add-port&#x3D;80&#x2F;tcp --permanent</span><br><span class="line">é‡å¯é˜²ç«å¢™ï¼šsystemctl restart firewalld.service</span><br><span class="line"> </span><br><span class="line">å‘½ä»¤å«ä¹‰ï¼š</span><br><span class="line"> </span><br><span class="line">--zone #ä½œç”¨åŸŸ</span><br><span class="line"> </span><br><span class="line">--add-port&#x3D;80&#x2F;tcp  #æ·»åŠ ç«¯å£ï¼Œæ ¼å¼ä¸ºï¼šç«¯å£&#x2F;é€šè®¯åè®®</span><br><span class="line"> </span><br><span class="line">--permanent   #æ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆ</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨CentOS 7ç³»ç»Ÿä¸­å¯ä»¥ç”¨systemdå¯åŠ¨vpnserverï¼Œå…ˆæ–°å»ºå¯åŠ¨è„šæœ¬&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;vpnserver.serviceï¼š</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;SoftEther VPN Server</span><br><span class="line">After&#x3D;network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;forking</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;share&#x2F;vpnserver&#x2F;vpnserver start</span><br><span class="line">ExecStop&#x3D;&#x2F;usr&#x2F;share&#x2F;vpnserver&#x2F;vpnserver stop</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br><span class="line">ç„¶åå°±å¯ä»¥é€šè¿‡systemctl start vpnserverå¯åŠ¨äº†ï¼Œå¹¶é€šè¿‡systemctl enable vpnserverè®¾ç½®å¼€æœºè‡ªå¯ã€‚</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç¯å¢ƒä¸‹Swapé…ç½®æ–¹æ³•</title>
    <url>//post/4849.html</url>
    <content><![CDATA[<p>1.é¦–å…ˆç”¨å‘½ä»¤freeæŸ¥çœ‹ç³»ç»Ÿå†…Swap åˆ†åŒºå¤§å°<br> total used free shared buffers cache</p><a id="more"></a>
<p>â€‹    Mem: 1002 964 38 0 21 410</p>
<p>â€‹    -/+ buffers/cache: 532 470</p>
<p>â€‹    Swap: 1024 24 1000</p>
<p>2.æ·»åŠ swapæ–‡ä»¶<br>mkdir swap<br>cd swap<br>sudo dd if=/dev/zero of=sfile bs=1024 count=1000000</p>
<p>count=1000000å‚æ•°ä»£è¡¨æ•°é‡ï¼Œè¿™ä¸ªæ­£å¥½æ˜¯1gï¼Œç›´æ¥å¢å¤§1g</p>
<p>3.è½¬åŒ–ä¸ºswapæ–‡ä»¶<br>sudo mkswap sfile</p>
<p>4.æ¿€æ´»swapæ–‡ä»¶<br>sudo swapon sfile</p>
<p>5.æŸ¥çœ‹æ•ˆæœ<br>å†æ¬¡è¾“å…¥ï¼šfree -m</p>
<p>Linuxåˆ é™¤æ–‡ä»¶å‡ºç°rm: cannot remove `.user.iniâ€™: Operation not permitted</p>
<p><a href="https://blog.csdn.net/sinat_35861727/article/details/79040755" target="_blank" rel="noopener">https://blog.csdn.net/sinat_35861727/article/details/79040755</a></p>
<p>åˆ é™¤äº¤æ¢æ–‡ä»¶</p>
<p><a href="https://ldjhust.github.io/2018/04/18/rm-swapfile-not-permitted.html" target="_blank" rel="noopener">https://ldjhust.github.io/2018/04/18/rm-swapfile-not-permitted.html</a></p>
]]></content>
  </entry>
  <entry>
    <title>Kaliä½¿ç”¨</title>
    <url>//post/47784.html</url>
    <content><![CDATA[<h2 id="1ã€è™šæ‹Ÿæœºç½‘ç»œæ¡¥æ¥"><a href="#1ã€è™šæ‹Ÿæœºç½‘ç»œæ¡¥æ¥" class="headerlink" title="1ã€è™šæ‹Ÿæœºç½‘ç»œæ¡¥æ¥"></a>1ã€è™šæ‹Ÿæœºç½‘ç»œæ¡¥æ¥</h2><p><a href="https://blog.csdn.net/Bluffing/article/details/114843586" target="_blank" rel="noopener">https://blog.csdn.net/Bluffing/article/details/114843586</a></p><a id="more"></a>
<p><a href="https://cdn.statically.io/gh/iboytech/static/master/images/2020/12/18/649aa73aa185c7995e90a7428eec7d5e.png" target="_blank" rel="noopener">https://cdn.statically.io/gh/iboytech/static/master/images/2020/12/18/649aa73aa185c7995e90a7428eec7d5e.png</a></p>
<p><a href="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/18/649aa73aa185c7995e90a7428eec7d5e.png" target="_blank" rel="noopener">https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/18/649aa73aa185c7995e90a7428eec7d5e.png</a></p>
<p><a href="https://ctguiboy.000webhostapp.com/up.php" target="_blank" rel="noopener">https://ctguiboy.000webhostapp.com/up.php</a></p>
<h2 id="2ã€æ¬ºéª—"><a href="#2ã€æ¬ºéª—" class="headerlink" title="2ã€æ¬ºéª—"></a>2ã€æ¬ºéª—</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¼€å¯IPè½¬å‘ï¼Œä¸ç„¶ç›®æ ‡IPæ²¡ç½‘</span></span><br><span class="line">echo 1 &gt;/proc/sys/net/ipv4/ip_forward    //è¿™å¥æ„æ€æ˜¯å‘è¿™ä¸ªæ–‡ä»¶å†™å…¥1</span><br><span class="line"></span><br><span class="line">ettrcapä¸­target 1æ˜¯ç›®æ ‡æœºå™¨ target2æ˜¯ç½‘å…³</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ•è·å›¾ç‰‡ä¿¡æ¯</span></span><br><span class="line"> driftnet -i eth0 </span><br><span class="line"><span class="meta">#</span><span class="bash">arpspoof -i eth0 -t 192.168.124.7 192.168.124.1   //-iåé¢æ˜¯ç½‘å¡ï¼Œ-t åé¢å¡«ç›®æ ‡ip  æœ€åçš„å¡«ç½‘å…³</span></span><br><span class="line"></span><br><span class="line">apt-get install dsniff</span><br></pre></td></tr></table></figure>

<p>![image-20220612140903232](/Users/hadiyang/Library/Application Support/typora-user-images/image-20220612140903232.png)</p>
]]></content>
      <tags>
        <tag>Kali</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè·¯ç”±é…ç½®</title>
    <url>//post/40399.html</url>
    <content><![CDATA[<p>1.ä¸´æ—¶è·¯ç”±ï¼ˆé‡å¯ç½‘å¡æˆ–è€…æœåŠ¡å™¨ä¹‹åç”Ÿæ•ˆï¼‰</p><p>route add -net 172.25.1.0/24  gw 172.25.5.254</p><a id="more"></a>

<p>route del -net 172.25.1.0/24  gw 172.25.5.254</p>
<p>2.æ°¸ä¹…è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;route-eno4 </span><br><span class="line">   172.168.20.0&#x2F;24 via 172.168.10.254 dev eno4</span><br></pre></td></tr></table></figure>

<p>3.é‡å¯Nginx</p>
<p>/usr/local/nginx/sbin/nginx </p>
]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdownè¯­æ³•</title>
    <url>//post/22648.html</url>
    <content><![CDATA[<h1 id="Markdownè¯­æ³•ç¬”è®°"><a href="#Markdownè¯­æ³•ç¬”è®°" class="headerlink" title="Markdownè¯­æ³•ç¬”è®°"></a>Markdownè¯­æ³•ç¬”è®°</h1><h2 id="1-æ ‡é¢˜"><a href="#1-æ ‡é¢˜" class="headerlink" title="1.æ ‡é¢˜"></a>1.æ ‡é¢˜</h2><p>æ³¨:æ ‡é¢˜è¡Œä¸Šä¸‹éœ€è¦ç•™æœ‰ç©ºè¡Œï¼Œ#å·åé¢éœ€è¦ç•™æœ‰ç©ºæ ¼ï¼Œæœ€å°ä¸º6çº§æ ‡é¢˜</p><h3 id="ä¸‰çº§æ ‡é¢˜"><a href="#ä¸‰çº§æ ‡é¢˜" class="headerlink" title="ä¸‰çº§æ ‡é¢˜"></a>ä¸‰çº§æ ‡é¢˜</h3><a id="more"></a>
<h4 id="å››çº§æ ‡é¢˜"><a href="#å››çº§æ ‡é¢˜" class="headerlink" title="å››çº§æ ‡é¢˜"></a>å››çº§æ ‡é¢˜</h4><h5 id="äº”çº§æ ‡é¢˜"><a href="#äº”çº§æ ‡é¢˜" class="headerlink" title="äº”çº§æ ‡é¢˜"></a>äº”çº§æ ‡é¢˜</h5><h6 id="å…­çº§æ ‡é¢˜"><a href="#å…­çº§æ ‡é¢˜" class="headerlink" title="å…­çº§æ ‡é¢˜"></a>å…­çº§æ ‡é¢˜</h6><h2 id="2-TOCç”Ÿæˆç›®å½•"><a href="#2-TOCç”Ÿæˆç›®å½•" class="headerlink" title="2.TOCç”Ÿæˆç›®å½•"></a>2.TOCç”Ÿæˆç›®å½•</h2><p>æ³¨ï¼šæ ¹æ®æ ‡é¢˜ç”Ÿæˆç›®å½•</p>
<p>[TOC]</p>
<h2 id="3-å¼•ç”¨"><a href="#3-å¼•ç”¨" class="headerlink" title="3.å¼•ç”¨"></a>3.å¼•ç”¨</h2><p>å•è¡Œå¼ï¼š</p>
<blockquote>
<p>hello world</p>
</blockquote>
<p>å¤šè¡Œå¼ï¼š</p>
<blockquote>
<p>hello world!<br>hello world!<br>hello world!</p>
</blockquote>
<p>å¤šå±‚åµŒå¥—:</p>
<blockquote>
<p>aaaaaaaaa</p>
<blockquote>
<p>bbbbbbbbb</p>
<blockquote>
<p>cccccccccc</p>
</blockquote>
</blockquote>
</blockquote>
<h2 id="4-è¡Œå†…æ ‡è®°"><a href="#4-è¡Œå†…æ ‡è®°" class="headerlink" title="4.è¡Œå†…æ ‡è®°"></a>4.è¡Œå†…æ ‡è®°</h2><p>æ³¨ï¼šç”¨ESCé”®ä¸‹é¢çš„æ’‡å·`åšè¡Œå†…æ ‡è®°</p>
<p>eg: æ ‡è®°å¤–<code>æ ‡è®°å†…</code>æ ‡è®°å¤–</p>
<p>eg: æ ‡è®°å¤–<code>hello world</code>æ ‡è®°å¤–</p>
<p>eg: æ ‡è®°å¤–<code>&lt;div&gt;&lt;b&gt;hello world&lt;/b&gt;&lt;/div&gt;</code>æ ‡è®°å¤–</p>
<p>è¡Œå†…æ ‡è®°ä¹‹å†…çš„HTMLæ ‡ç­¾ä¸ä¼šè¢«è§£æï¼Œè¡Œå†…æ ‡è®°ä¹‹å¤–çš„HTMLæ ‡ç­¾ä¼šè¢«è§£æ</p>
<div><b>hello world</b></div>

<h2 id="5-ä»£ç å—"><a href="#5-ä»£ç å—" class="headerlink" title="5.ä»£ç å—"></a>5.ä»£ç å—</h2><p>æ³¨ï¼šä½¿ç”¨ä¸‰ä¸ªæ’‡å·åœ¨ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡ŒåŒ…å›´ä»£ç å—,æ ‡æ³¨ä»£ç å—ä½¿ç”¨çš„ç¨‹åºè¯­è¨€å¯ä»¥ç»™ä»£ç æ˜¾ç¤ºè¯­æ³•é«˜äº®ã€‚å•è¡Œä»£ç ç”¨è¡Œå†…æ ‡è®°å®ç°ã€‚</p>
<p><code>å•è¡Œä»£ç : cout&lt;&lt;&quot;hello world&quot;&lt;&lt;endl;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTMLä»£ç  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>ä»£ç ä¸­ä½¿ç”¨Tabé”®è¿›è¡Œç¼©è¿›<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// javascriptä»£ç </span></span><br><span class="line"><span class="keyword">var</span> num=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; ++i)&#123;</span><br><span class="line">    num += i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(num);</span><br></pre></td></tr></table></figure>

<h2 id="6-æ’å…¥é“¾æ¥"><a href="#6-æ’å…¥é“¾æ¥" class="headerlink" title="6.æ’å…¥é“¾æ¥"></a>6.æ’å…¥é“¾æ¥</h2><!-- [é“¾æ¥æ–‡å­—](é“¾æ¥åœ°å€ "é“¾æ¥æ ‡é¢˜") -->

<p>å†…é“¾å¼ï¼š</p>
<p><a href="http://www.baidu.com/" target="_blank" rel="noopener">ç™¾åº¦1</a></p>
<p>å¼•ç”¨å¼ï¼š</p>
<!-- å‚è€ƒå¼é“¾æ¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œæ–‡ä¸­çš„å†™æ³• [é“¾æ¥æ–‡å­—][é“¾æ¥æ ‡è®°]ï¼Œåœ¨æ–‡æœ¬çš„ä»»æ„ä½ç½®æ·»åŠ [é“¾æ¥æ ‡è®°]:é“¾æ¥åœ°å€ â€œé“¾æ¥æ ‡é¢˜â€ï¼Œé“¾æ¥åœ°å€ä¸é“¾æ¥æ ‡é¢˜å‰æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚
å¦‚æœé“¾æ¥æ–‡å­—æœ¬èº«å¯ä»¥åšä¸ºé“¾æ¥æ ‡è®°ï¼Œä½ ä¹Ÿå¯ä»¥å†™æˆ[é“¾æ¥æ–‡å­—][] 
[é“¾æ¥æ–‡å­—]ï¼šé“¾æ¥åœ°å€çš„å½¢å¼ -->

<p><a href="http://www.baidu.com/" target="_blank" rel="noopener">ç™¾åº¦2</a></p>
<p><a href="http://www.baidu.com" target="_blank" rel="noopener" title="ç™¾åº¦">baidu.com</a></p>
<p>è‡ªåŠ¨é“¾æ¥ï¼š</p>
<!-- Markdown æ”¯æŒä»¥æ¯”è¾ƒç®€çŸ­çš„è‡ªåŠ¨é“¾æ¥å½¢å¼æ¥å¤„ç†ç½‘å€å’Œç”µå­é‚®ä»¶ä¿¡ç®±ï¼Œåªè¦æ˜¯ç”¨<>åŒ…èµ·æ¥ï¼Œ Markdown å°±ä¼šè‡ªåŠ¨æŠŠå®ƒè½¬æˆé“¾æ¥ -->

<p><a href="mailto:&#x77;&#x77;&#x77;&#x2e;&#x77;&#x6a;&#120;&#46;&#103;&#103;&#46;&#54;&#54;&#64;&#113;&#x71;&#46;&#99;&#x6f;&#109;">&#x77;&#x77;&#x77;&#x2e;&#x77;&#x6a;&#120;&#46;&#103;&#103;&#46;&#54;&#54;&#64;&#113;&#x71;&#46;&#99;&#x6f;&#109;</a></p>
<p><a href="https://www.baidu.com" target="_blank" rel="noopener">https://www.baidu.com</a></p>
<h2 id="7-æ’å…¥å›¾ç‰‡"><a href="#7-æ’å…¥å›¾ç‰‡" class="headerlink" title="7.æ’å…¥å›¾ç‰‡"></a>7.æ’å…¥å›¾ç‰‡</h2><!-- æ³¨ï¼šæ–¹æ‹¬å·ä¸­çš„æ–‡å­—æ˜¯å›¾ç‰‡åœ°å€é”™è¯¯æ˜¯çš„æç¤ºæ–‡å­—ï¼Œä¹Ÿå°±æ˜¯altçš„å±æ€§å€¼ -->

<p>å†…é“¾å¼ï¼š</p>
<p><img src="/static/img/markdown/girl1.png" alt="æ¼‚äº®å¥³å­©" title="æè¿°"></p>
<p><img src="/static/img/markdown/main.png" alt="main"></p>
<p>å¼•ç”¨å¼ï¼š</p>
<p><img src="/img/markdown/dog1.png" alt="dog" title="æè¿°"></p>
<h2 id="8-æ’å…¥å›¾ç‰‡å¸¦æœ‰é“¾æ¥"><a href="#8-æ’å…¥å›¾ç‰‡å¸¦æœ‰é“¾æ¥" class="headerlink" title="8.æ’å…¥å›¾ç‰‡å¸¦æœ‰é“¾æ¥"></a>8.æ’å…¥å›¾ç‰‡å¸¦æœ‰é“¾æ¥</h2><p>å†…é“¾å¼(å‚è€ƒå¼)ï¼š</p>
<p><a href="http://www.baidu.com" target="_blank" rel="noopener"><img src="https://blog.iboy.tech/img/markdown/dog1.png" alt="ç™¾åº¦ä¸€ä¸‹" title="ç™¾åº¦"></a></p>
<p>å¼•ç”¨å¼ï¼š</p>
<p><a href="http://www.baidu.com/" target="_blank" rel="noopener"><img src="/static/img/markdown/dog1.png" alt="ç™¾åº¦ä¸€ä¸‹" title="ç™¾åº¦"></a></p>
<!-- [baidu] åœ¨ä¸Šé¢å·²ç»å®šä¹‰è¿‡ -->
<!-- [baidu]: https://iboy.tech -->

<h2 id="9-åˆ—è¡¨"><a href="#9-åˆ—è¡¨" class="headerlink" title="9.åˆ—è¡¨"></a>9.åˆ—è¡¨</h2><p>æœ‰åºåˆ—è¡¨ï¼š åºå·åè¦æœ‰ç©ºæ ¼</p>
<ol>
<li>one</li>
<li>two</li>
<li>three</li>
</ol>
<p>æ— åºåˆ—è¡¨ï¼š å¯ä½¿ç”¨ + - * ä¸‰ç§ç¬¦å·</p>
<ul>
<li>one</li>
<li>two</li>
<li>three</li>
</ul>
<p>åˆ—è¡¨åµŒå¥—ä½¿ç”¨ï¼š</p>
<ol>
<li>one<ul>
<li>one-one</li>
<li>one-two</li>
<li>one-three</li>
</ul>
</li>
<li>two<ol>
<li>two-one</li>
<li>two-two</li>
<li>two-three</li>
</ol>
</li>
<li>three<ul>
<li>three-one</li>
<li>three-two</li>
<li>three-three</li>
</ul>
</li>
</ol>
<p>åˆ—è¡¨åµŒå¥—ä»£ç å—ï¼š</p>
<p>æ³¨ï¼š æ¢è¡Œ + ä¸¤ä¸ªTab</p>
<ul>
<li><p>one</p>
<pre><code>var a = 10;var a = 10;
var a = 10;var a = 10;
var a = 10;var a = 10;
var a = 10;</code></pre></li>
<li><p>two</p>
<pre><code>var b = 20;</code></pre></li>
</ul>
<p>å®šä¹‰å‹åˆ—è¡¨ï¼š</p>
<!-- å®šä¹‰å‹åˆ—è¡¨ç”±åè¯å’Œè§£é‡Šç»„æˆã€‚ä¸€è¡Œå†™ä¸Šå®šä¹‰ï¼Œç´§è·Ÿä¸€è¡Œå†™ä¸Šè§£é‡Šã€‚è§£é‡Šçš„å†™æ³•:ç´§è·Ÿä¸€ä¸ªç¼©è¿›(Tab) -->

<dl><dt>Markdown</dt><dd>è½»é‡çº§æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œå¯ä»¥è½¬æ¢æˆhtml, pdfç­‰æ ¼å¼</dd></dl><dl><dt>ä»£ç å—</dt><dd>ä»¥ä¸‹æ˜¯ä»£ç å—(ç©ºä¸€è¡Œ + ä¸¤ä¸ªTab)</dd></dl><pre><code>var a = 10;
var b = 10;</code></pre><p>åˆ—è¡¨ç¼©è¿›ï¼š</p>
<!-- åˆ—è¡¨é¡¹ç›®æ ‡è®°é€šå¸¸æ˜¯æ”¾åœ¨æœ€å·¦è¾¹ï¼Œä½†æ˜¯å…¶å®ä¹Ÿå¯ä»¥ç¼©è¿›ï¼Œæœ€å¤š 3 ä¸ªç©ºæ ¼ï¼Œé¡¹ç›®æ ‡è®°åé¢åˆ™ä¸€å®šè¦æ¥ç€è‡³å°‘ä¸€ä¸ªç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ -->

<ul>
<li>ç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µç¬¬ä¸€æ®µ<br>ç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µç¬¬äºŒæ®µ</li>
</ul>
<p>ç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µç¬¬ä¸‰æ®µ</p>
<ul>
<li>paragraph1paragraph1paragraph1 paragraph1paragraph1paragraph1 paragraph1paragraph1 paragraph1paragraph1 paragraph1paragraph1 paragraph1paragraph1 paragraph1paragraph1 paragraph1paragraph1 paragraph1paragraph1<br>paragraph2paragraph2paragraph2 paragraph2paragraph2paragraph2 paragraph2paragraph2paragraph2 paragraph2paragraph2paragraph2 paragraph2paragraph2paragraph2 paragraph2paragraph2paragraph2</li>
</ul>
<h2 id="10-ä»»åŠ¡åˆ—è¡¨"><a href="#10-ä»»åŠ¡åˆ—è¡¨" class="headerlink" title="10.ä»»åŠ¡åˆ—è¡¨"></a>10.ä»»åŠ¡åˆ—è¡¨</h2><p>è¯·é€‰æ‹©ä½ å–œæ¬¢çš„æ°´æœï¼š</p>
<ul>
<li><input checked disabled type="checkbox"> æ¡ƒå­</li>
<li><input checked disabled type="checkbox"> è‘¡è„</li>
<li><input disabled type="checkbox"> é¦™è•‰</li>
</ul>
<h2 id="11-è¡¨æƒ…"><a href="#11-è¡¨æƒ…" class="headerlink" title="11.è¡¨æƒ…"></a>11.è¡¨æƒ…</h2><p>æ³¨ï¼šéƒ¨åˆ†ä¸»æµå¹³å°æ”¯æŒï¼Œå…¼å®¹æ€§ä¸€èˆ¬ :smile:<br>:smirk:</p>
<!-- è¯¥æ ‡é¢˜åé¢æ·»åŠ äº†é”šç‚¹æ ‡è®°ï¼ŒèŠ±æ‹¬å·ä¸æ ‡é¢˜ä¹‹é—´è¦æœ‰ç©ºæ ¼ -->

<h2 id="12-ä½¿ç”¨å†…åµŒCSSæ ·å¼"><a href="#12-ä½¿ç”¨å†…åµŒCSSæ ·å¼" class="headerlink" title="12.ä½¿ç”¨å†…åµŒCSSæ ·å¼"></a>12.ä½¿ç”¨å†…åµŒCSSæ ·å¼</h2><p style="color:#ad5d0f;font-size:30px; font-family:'å®‹ä½“'; ">å†…é“¾æ ·å¼</p>
## 13.è¯­ä¹‰æ ‡è®°(markdownè¯­æ³•)

<p>æ–œä½“: <em>æ–œä½“</em></p>
<p>æ–œä½“: <em>æ–œä½“</em></p>
<p>åŠ ç²—: <strong>åŠ ç²—</strong></p>
<p><strong><em>åŠ ç²—+æ–œä½“</em></strong></p>
<p><strong><em>åŠ ç²—+æ–œä½“</em></strong></p>
<p><del>åˆ é™¤çº¿</del></p>
<h2 id="14è¯­ä¹‰æ ‡ç­¾-htmlè¯­æ³•"><a href="#14è¯­ä¹‰æ ‡ç­¾-htmlè¯­æ³•" class="headerlink" title="14è¯­ä¹‰æ ‡ç­¾(htmlè¯­æ³•)"></a>14è¯­ä¹‰æ ‡ç­¾(htmlè¯­æ³•)</h2><p><i>æ–œä½“</i></p>
<p><b>åŠ ç²—</b></p>
<p><em>å¼ºè°ƒ</em></p>
<p>ä¸Šæ ‡ Z<sup>a</sup></p>
<p>ä¸‹æ ‡ Z<sub>a</sub></p>
<p>é”®ç›˜æ–‡æœ¬ <kbd>Ctrl</kbd></p>
<h2 id="15-åˆ†éš”ç¬¦"><a href="#15-åˆ†éš”ç¬¦" class="headerlink" title="15.åˆ†éš”ç¬¦"></a>15.åˆ†éš”ç¬¦</h2><p>æ³¨ï¼šè‡³å°‘ä¸‰ä¸ª â€” æˆ– *** æˆ– * * *</p>
<hr>
<hr>
<hr>
<h2 id="16-è„šæ³¨"><a href="#16-è„šæ³¨" class="headerlink" title="16.è„šæ³¨"></a>16.è„šæ³¨</h2><p>æ³¨: ä¼šè‡ªåŠ¨å°†æ ‡è®°è§£æä¸º1,2,3,â€¦</p>
<p>Markdown<a href="markdwonæ˜¯ä¸€ç§çº¯æ–‡æœ¬æ ‡è®°è¯­è¨€">^1</a></p>
<p>Markdown<a href="markdwonç®€å•å¥½ç”¨">^a</a></p>
<h2 id="17-è¡¨æ ¼"><a href="#17-è¡¨æ ¼" class="headerlink" title="17.è¡¨æ ¼"></a>17.è¡¨æ ¼</h2><p>æ³¨ï¼š :è¡¨ç¤ºå¯¹å…¶æ–¹å¼ï¼Œ ** : ä¸ | ä¹‹é—´ä¸è¦æœ‰ç©ºæ ¼,å¦åˆ™æœ‰äº›ä¼šä¸å…¼å®¹</p>
<table>
<thead>
<tr>
<th align="center">a</th>
<th align="left">b</th>
<th align="right">c</th>
</tr>
</thead>
<tbody><tr>
<td align="center">å±…ä¸­</td>
<td align="left">å·¦å¯¹é½</td>
<td align="right">å³å¯¹é½</td>
</tr>
<tr>
<td align="center">ä¸€</td>
<td align="left">äºŒ</td>
<td align="right">ä¸‰</td>
</tr>
<tr>
<td align="center">ä¸€</td>
<td align="left">äºŒ</td>
<td align="right">ä¸‰</td>
</tr>
<tr>
<td align="center">ä¸€</td>
<td align="left">äºŒ</td>
<td align="right">ä¸‰</td>
</tr>
</tbody></table>
<p>ç®€çº¦å†™æ³•ï¼š</p>
<table>
<thead>
<tr>
<th align="center">a</th>
<th align="left">b</th>
<th align="right">c</th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="left">å±…ä¸­</td>
<td align="right">å·¦å¯¹é½</td>
</tr>
<tr>
<td align="center"></td>
<td align="left">ä¸€</td>
<td align="right">äºŒ</td>
</tr>
<tr>
<td align="center"></td>
<td align="left">ä¸€</td>
<td align="right">äºŒ</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hexo</category>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Minicondaä½¿ç”¨</title>
    <url>//post/14399.html</url>
    <content><![CDATA[<h1 id="1ã€Minicondaä¸‹è½½"><a href="#1ã€Minicondaä¸‹è½½" class="headerlink" title="1ã€Minicondaä¸‹è½½"></a>1ã€Minicondaä¸‹è½½</h1><p><a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/?C=M&amp;O=D" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/?C=M&amp;O=D</a></p><a id="more"></a>
<h1 id="2ã€è®¾ç½®é•œåƒåŠ é€Ÿ"><a href="#2ã€è®¾ç½®é•œåƒåŠ é€Ÿ" class="headerlink" title="2ã€è®¾ç½®é•œåƒåŠ é€Ÿ"></a>2ã€è®¾ç½®é•œåƒåŠ é€Ÿ</h1><p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/</a></p>
<h1 id="3ã€Pycharmä½¿ç”¨å·²æœ‰çš„Anacondaç¯å¢ƒ"><a href="#3ã€Pycharmä½¿ç”¨å·²æœ‰çš„Anacondaç¯å¢ƒ" class="headerlink" title="3ã€Pycharmä½¿ç”¨å·²æœ‰çš„Anacondaç¯å¢ƒ"></a>3ã€Pycharmä½¿ç”¨å·²æœ‰çš„Anacondaç¯å¢ƒ</h1><p><a href="https://www.jianshu.com/p/be02b6181056" target="_blank" rel="noopener">https://www.jianshu.com/p/be02b6181056</a></p>
<h1 id="4ã€Minicondaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"><a href="#4ã€Minicondaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="4ã€Minicondaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"></a>4ã€Minicondaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">æ˜¾ç¤ºå¯ä»¥å®‰è£…çš„Pythonç‰ˆæœ¬</span><br><span class="line">conda search -f python</span><br><span class="line"></span><br><span class="line">conda create -n py2.7 python=2.7</span><br><span class="line">conda activate py2.7</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤</span></span><br><span class="line">conda remove -n py2.7 --all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">winæ¿€æ´»</span></span><br><span class="line">activate py2.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">winé€€å‡º</span></span><br><span class="line">deactivate</span><br></pre></td></tr></table></figure>

<h1 id="5ã€è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„pythonç‰ˆæœ¬"><a href="#5ã€è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„pythonç‰ˆæœ¬" class="headerlink" title="5ã€è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„pythonç‰ˆæœ¬"></a>5ã€è®¾ç½®ç³»ç»Ÿé»˜è®¤çš„pythonç‰ˆæœ¬</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">conda update conda</span><br><span class="line">conda install python=<span class="number">3.6</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Miniconda</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLæ•°æ®æ¢å¤</title>
    <url>//post/57165.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">é¦–å…ˆç¡®è®¤ä½ æ—¥å¿—æ˜¯å¦å¯ç”¨äº†</span><br><span class="line">show variables like &#39;log_bin&#39;;</span><br><span class="line">show master status</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>MongoDBä½¿ç”¨è®°å½•</title>
    <url>//post/51005.html</url>
    <content><![CDATA[<h2 id="é¡¹ç›®ä¸»é¡µ"><a href="#é¡¹ç›®ä¸»é¡µ" class="headerlink" title="é¡¹ç›®ä¸»é¡µ"></a>é¡¹ç›®ä¸»é¡µ</h2><p><a href="http://docs.mongoengine.org/projects/flask-mongoengine/en/latest/#installing-flask-mongoengine" target="_blank" rel="noopener">http://docs.mongoengine.org/projects/flask-mongoengine/en/latest/#installing-flask-mongoengine</a></p><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> Â  db.help();æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br><span class="line"> Â  show dbs å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“</span><br><span class="line"> </span><br><span class="line">Â  Â db å¯ä»¥æŸ¥çœ‹å½“å‰çš„æ•°æ®åº“åç§°</span><br><span class="line"> </span><br><span class="line">Â  Â show collection å¯ä»¥æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸‹çš„é›†åˆ</span><br><span class="line"> </span><br><span class="line">Â  Â useÂ  Â test(æ•°æ®åº“çš„åç§°) åˆ‡æ¢åˆ°æŒ‡å®šçš„æ•°æ®åº“</span><br><span class="line"> </span><br><span class="line">Â   db.é›†åˆå.æ“ä½œÂ  å¯¹é›†åˆè¿›è¡ŒæŸç§æ“ä½œ</span><br><span class="line"> </span><br><span class="line">Â   æ¯”å¦‚ï¼š</span><br><span class="line"> </span><br><span class="line">Â   db.é›†åˆå.find() æŸ¥æ‰¾</span><br><span class="line"> </span><br><span class="line">Â   db.é›†åˆå.getIndexes() æŸ¥çœ‹ç´¢å¼•</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç»™MongoDBè®¾å®šå¯†ç </span><br><span class="line">1.å‘½ä»¤è¡Œçª—å£è¾“å…¥mongoï¼Œè¿›å…¥mongoç¯å¢ƒ </span><br><span class="line">2.åˆ‡æ¢åˆ° &#39;admin&#39; æ•°æ®åº“ use admin</span><br><span class="line">3.ç»™adminè®¾ç½®ç”¨æˆ·å¯†ç :</span><br><span class="line">4.user: ç”¨æˆ·å, pwd: ç”¨æˆ·å¯†ç ,roles: ç”¨æ¥è®¾ç½®ç”¨æˆ·çš„æƒé™ï¼Œæ¯”å¦‚è¯»ï¼Œè¯»å†™ ç­‰ç­‰</span><br><span class="line">db.createUser(&#123;user: &#39;root&#39;, pwd: &#39;123456&#39;, roles: [&#39;root&#39;]&#125;)</span><br><span class="line">5.éªŒè¯æ˜¯å¦æ·»åŠ æˆåŠŸï¼Œ&#39;db.auth(ç”¨æˆ·åï¼Œç”¨æˆ·å¯†ç )&#39; è¿™é‡Œç”¨db.auth(&#39;root&#39;, &#39;123456&#39;) å¦‚æœè¿”å› &#39;1&#39;è¡¨ç¤ºéªŒè¯æˆåŠŸï¼Œ å¦‚æœæ˜¯ &#39;0&#39; è¡¨ç¤ºéªŒè¯å¤±è´¥...</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Flask</category>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>Flask</tag>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaské¡¹ç›®çš„åŸºæœ¬ç»“æ„</title>
    <url>//post/11382.html</url>
    <content><![CDATA[<h2 id="ä»¥ä¸‹å†…å®¹æ‘˜è‡ª"><a href="#ä»¥ä¸‹å†…å®¹æ‘˜è‡ª" class="headerlink" title="ä»¥ä¸‹å†…å®¹æ‘˜è‡ª"></a>ä»¥ä¸‹å†…å®¹æ‘˜è‡ª</h2><blockquote>
<p>Flask Webå¼€å‘ï¼š<br>åŸºäºPythonçš„Webåº”ç”¨å¼€å‘å®æˆ˜</p>
</blockquote><h4 id="7-1-é¡¹ç›®ç»“æ„"><a href="#7-1-é¡¹ç›®ç»“æ„" class="headerlink" title="7.1ã€€é¡¹ç›®ç»“æ„"></a>7.1ã€€é¡¹ç›®ç»“æ„</h4><p>Flask ç¨‹åºçš„åŸºæœ¬ç»“æ„å¦‚ç¤ºä¾‹ 7-1 æ‰€ç¤ºã€‚<br>ç¤ºä¾‹ 7-1ã€€å¤šæ–‡ä»¶ Flask ç¨‹åºçš„åŸºæœ¬ç»“æ„<br>|-flasky<br>|-app/<br>|-templates/<br>|-static/<br>|-main/<br>|-<strong>init</strong>.py<br>|-errors.py<br>|-forms.py<br>|-views.py<br>|-<strong>init</strong>.py<br>|-email.py<br>|-models.py<br>|-migrations/<br>|-tests/<br>|-<strong>init</strong>.py<br>|-test*.py<br>|-venv/<br>|-requirements.txt<br>|-config.py<br>|-manage.py<br>è¿™ç§ç»“æ„æœ‰ 4 ä¸ªé¡¶çº§æ–‡ä»¶å¤¹ï¼š<br>Flask ç¨‹åºä¸€èˆ¬éƒ½ä¿å­˜åœ¨åä¸º app çš„åŒ…ä¸­ï¼› â€¢<br>å’Œä¹‹å‰ä¸€æ ·ï¼Œmigrations æ–‡ä»¶å¤¹åŒ…å«æ•°æ®åº“è¿ç§»è„šæœ¬ï¼› â€¢<br>å•å…ƒæµ‹è¯•ç¼–å†™åœ¨ tests åŒ…ä¸­ï¼› â€¢<br>å’Œä¹‹å‰ä¸€æ ·ï¼Œvenv æ–‡ä»¶å¤¹åŒ…å« Python è™šæ‹Ÿç¯å¢ƒã€‚ â€¢<br>åŒæ—¶è¿˜åˆ›å»ºäº†ä¸€äº›æ–°æ–‡ä»¶ï¼š<br>requirements.txt åˆ—å‡ºäº†æ‰€æœ‰ä¾èµ–åŒ…ï¼Œä¾¿äºåœ¨å…¶ä»–ç”µè„‘ä¸­é‡æ–°ç”Ÿæˆç›¸åŒçš„è™šæ‹Ÿç¯å¢ƒï¼› â€¢<br>config.py å­˜å‚¨é…ç½®ï¼› â€¢<br>manage.py ç”¨äºå¯åŠ¨ç¨‹åºä»¥åŠå…¶ä»–çš„ç¨‹åºä»»åŠ¡ã€‚ â€¢<br>ä¸ºäº†å¸®åŠ©ä½ å®Œå…¨ç†è§£è¿™ä¸ªç»“æ„ï¼Œä¸‹é¢å‡ èŠ‚è®²è§£æŠŠ hello.py ç¨‹åºè½¬æ¢æˆè¿™ç§ç»“æ„çš„è¿‡ç¨‹ã€‚</p><a id="more"></a>

<h4 id="7-2-é…ç½®é€‰é¡¹"><a href="#7-2-é…ç½®é€‰é¡¹" class="headerlink" title="7.2ã€€é…ç½®é€‰é¡¹"></a>7.2ã€€é…ç½®é€‰é¡¹</h4><p>ç¨‹åºç»å¸¸éœ€è¦è®¾å®šå¤šä¸ªé…ç½®ã€‚è¿™æ–¹é¢æœ€å¥½çš„ä¾‹å­å°±æ˜¯å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒè¦ä½¿ç”¨ä¸åŒçš„<br>æ•°æ®åº“ï¼Œè¿™æ ·æ‰ä¸ä¼šå½¼æ­¤å½±å“ã€‚<br>æˆ‘ä»¬ä¸å†ä½¿ç”¨ hello.py ä¸­ç®€å•çš„å­—å…¸çŠ¶ç»“æ„é…ç½®ï¼Œè€Œä½¿ç”¨å±‚æ¬¡ç»“æ„çš„é…ç½®ç±»ã€‚config.py æ–‡<br>ä»¶çš„å†…å®¹å¦‚ç¤ºä¾‹ 7-2 æ‰€ç¤ºã€‚<br>ç¤ºä¾‹ 7-2ã€€config.pyï¼šç¨‹åºçš„é…ç½®<br>import os<br>basedir = os.path.abspath(os.path.dirname(<strong>file</strong>))<br>class Config:<br>SECRET_KEY = os.environ.get(â€˜SECRET_KEYâ€™) or â€˜hard to guess stringâ€™<br>SQLALCHEMY_COMMIT_ON_TEARDOWN = True<br>FLASKY_MAIL_SUBJECT_PREFIX = â€˜[Flasky]â€™<br>FLASKY_MAIL_SENDER = â€˜Flasky Admin <a href="mailto:&#x66;&#x6c;&#x61;&#x73;&#x6b;&#121;&#64;&#x65;&#x78;&#97;&#x6d;&#x70;&#x6c;&#x65;&#x2e;&#99;&#111;&#x6d;">&#x66;&#x6c;&#x61;&#x73;&#x6b;&#121;&#64;&#x65;&#x78;&#97;&#x6d;&#x70;&#x6c;&#x65;&#x2e;&#99;&#111;&#x6d;</a>â€˜<br>FLASKY_ADMIN = os.environ.get(â€˜FLASKY_ADMINâ€™)<br>@staticmethod<br>def init_app(app):<br>pass<br>class DevelopmentConfig(Config):<br>DEBUG = True<br>MAIL_SERVER = â€˜smtp.googlemail.comâ€™<br>å¤§å‹ç¨‹åºçš„ç»“æ„ ï½œ 67<br>MAIL_PORT = 587<br>MAIL_USE_TLS = True<br>MAIL_USERNAME = os.environ.get(â€˜MAIL_USERNAMEâ€™)<br>MAIL_PASSWORD = os.environ.get(â€˜MAIL_PASSWORDâ€™)<br>SQLALCHEMY_DATABASE_URI = os.environ.get(â€˜DEV_DATABASE_URLâ€™) or <br>â€˜sqlite:///â€˜ + os.path.join(basedir, â€˜data-dev.sqliteâ€™)<br>class TestingConfig(Config):<br>TESTING = True<br>SQLALCHEMY_DATABASE_URI = os.environ.get(â€˜TEST_DATABASE_URLâ€™) or <br>â€˜sqlite:///â€˜ + os.path.join(basedir, â€˜data-test.sqliteâ€™)<br>class ProductionConfig(Config):<br>SQLALCHEMY_DATABASE_URI = os.environ.get(â€˜DATABASE_URLâ€™) or <br>â€˜sqlite:///â€˜ + os.path.join(basedir, â€˜data.sqliteâ€™)<br>config = {<br>â€˜developmentâ€™: DevelopmentConfig,<br>â€˜testingâ€™: TestingConfig,<br>â€˜productionâ€™: ProductionConfig,<br>â€˜defaultâ€™: DevelopmentConfig<br>}<br>åŸºç±» Config ä¸­åŒ…å«é€šç”¨é…ç½®ï¼Œå­ç±»åˆ†åˆ«å®šä¹‰ä¸“ç”¨çš„é…ç½®ã€‚å¦‚æœéœ€è¦ï¼Œä½ è¿˜å¯æ·»åŠ å…¶ä»–é…<br>ç½®ç±»ã€‚<br>ä¸ºäº†è®©é…ç½®æ–¹å¼æ›´çµæ´»ä¸”æ›´å®‰å…¨ï¼ŒæŸäº›é…ç½®å¯ä»¥ä»ç¯å¢ƒå˜é‡ä¸­å¯¼å…¥ã€‚ä¾‹å¦‚ï¼Œ SECRET_KEY çš„å€¼ï¼Œ<br>è¿™æ˜¯ä¸ªæ•æ„Ÿä¿¡æ¯ï¼Œå¯ä»¥åœ¨ç¯å¢ƒä¸­è®¾å®šï¼Œä½†ç³»ç»Ÿä¹Ÿæä¾›äº†ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä»¥é˜²ç¯å¢ƒä¸­æ²¡æœ‰å®šä¹‰ã€‚<br>åœ¨ 3 ä¸ªå­ç±»ä¸­ï¼Œ SQLALCHEMY_DATABASE_URI å˜é‡éƒ½è¢«æŒ‡å®šäº†ä¸åŒçš„å€¼ã€‚è¿™æ ·ç¨‹åºå°±å¯åœ¨ä¸åŒ<br>çš„é…ç½®ç¯å¢ƒä¸­è¿è¡Œï¼Œæ¯ä¸ªç¯å¢ƒéƒ½ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ã€‚<br>é…ç½®ç±»å¯ä»¥å®šä¹‰ init_app() ç±»æ–¹æ³•ï¼Œå…¶å‚æ•°æ˜¯ç¨‹åºå®ä¾‹ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¯ä»¥æ‰§è¡Œå¯¹å½“å‰<br>ç¯å¢ƒçš„é…ç½®åˆå§‹åŒ–ã€‚ç°åœ¨ï¼ŒåŸºç±» Config ä¸­çš„ init_app() æ–¹æ³•ä¸ºç©ºã€‚<br>åœ¨è¿™ä¸ªé…ç½®è„šæœ¬æœ«å°¾ï¼Œ config å­—å…¸ä¸­æ³¨å†Œäº†ä¸åŒçš„é…ç½®ç¯å¢ƒï¼Œè€Œä¸”è¿˜æ³¨å†Œäº†ä¸€ä¸ªé»˜è®¤é…ç½®<br>ï¼ˆæœ¬ä¾‹çš„å¼€å‘ç¯å¢ƒï¼‰ã€‚</p>
<h4 id="7-3-ç¨‹åºåŒ…"><a href="#7-3-ç¨‹åºåŒ…" class="headerlink" title="7.3ã€€ç¨‹åºåŒ…"></a>7.3ã€€ç¨‹åºåŒ…</h4><p>ç¨‹åºåŒ…ç”¨æ¥ä¿å­˜ç¨‹åºçš„æ‰€æœ‰ä»£ç ã€æ¨¡æ¿å’Œé™æ€æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªåŒ…ç›´æ¥ç§°ä¸º appï¼ˆåº”<br>ç”¨ï¼‰ï¼Œå¦‚æœæœ‰éœ€æ±‚ï¼Œä¹Ÿå¯ä½¿ç”¨ä¸€ä¸ªç¨‹åºä¸“ç”¨åå­—ã€‚templates å’Œ static æ–‡ä»¶å¤¹æ˜¯ç¨‹åºåŒ…çš„ä¸€éƒ¨<br>åˆ†ï¼Œå› æ­¤è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹è¢«ç§»åˆ°äº† app ä¸­ã€‚æ•°æ®åº“æ¨¡å‹å’Œç”µå­é‚®ä»¶æ”¯æŒå‡½æ•°ä¹Ÿè¢«ç§»åˆ°äº†è¿™ä¸ª<br>åŒ…ä¸­ï¼Œåˆ†åˆ«ä¿å­˜ä¸º app/models.py å’Œ app/email.pyã€‚</p>
<p>7.3.1ã€€ä½¿ç”¨ç¨‹åºå·¥å‚å‡½æ•°<br>åœ¨å•ä¸ªæ–‡ä»¶ä¸­å¼€å‘ç¨‹åºå¾ˆæ–¹ä¾¿ï¼Œä½†å´æœ‰ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹ï¼Œå› ä¸ºç¨‹åºåœ¨å…¨å±€ä½œç”¨åŸŸä¸­åˆ›å»ºï¼Œæ‰€<br>ä»¥æ— æ³•åŠ¨æ€ä¿®æ”¹é…ç½®ã€‚è¿è¡Œè„šæœ¬æ—¶ï¼Œç¨‹åºå®ä¾‹å·²ç»åˆ›å»ºï¼Œå†ä¿®æ”¹é…ç½®ä¸ºæ—¶å·²æ™šã€‚è¿™ä¸€ç‚¹å¯¹<br>å•å…ƒæµ‹è¯•å°¤å…¶é‡è¦ï¼Œå› ä¸ºæœ‰æ—¶ä¸ºäº†æé«˜æµ‹è¯•è¦†ç›–åº¦ï¼Œå¿…é¡»åœ¨ä¸åŒçš„é…ç½®ç¯å¢ƒä¸­è¿è¡Œç¨‹åºã€‚<br>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯å»¶è¿Ÿåˆ›å»ºç¨‹åºå®ä¾‹ï¼ŒæŠŠåˆ›å»ºè¿‡ç¨‹ç§»åˆ°å¯æ˜¾å¼è°ƒç”¨çš„å·¥å‚å‡½æ•°ä¸­ã€‚è¿™<br>ç§æ–¹æ³•ä¸ä»…å¯ä»¥ç»™è„šæœ¬ç•™å‡ºé…ç½®ç¨‹åºçš„æ—¶é—´ï¼Œè¿˜èƒ½å¤Ÿåˆ›å»ºå¤šä¸ªç¨‹åºå®ä¾‹ï¼Œè¿™äº›å®ä¾‹æœ‰æ—¶åœ¨<br>æµ‹è¯•ä¸­éå¸¸æœ‰ç”¨ã€‚ç¨‹åºçš„å·¥å‚å‡½æ•°åœ¨ app åŒ…çš„æ„é€ æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¦‚ç¤ºä¾‹ 7-3 æ‰€ç¤ºã€‚<br>æ„é€ æ–‡ä»¶å¯¼å…¥äº†å¤§å¤šæ•°æ­£åœ¨ä½¿ç”¨çš„ Flask æ‰©å±•ã€‚ç”±äºå°šæœªåˆå§‹åŒ–æ‰€éœ€çš„ç¨‹åºå®ä¾‹ï¼Œæ‰€ä»¥æ²¡<br>æœ‰åˆå§‹åŒ–æ‰©å±•ï¼Œåˆ›å»ºæ‰©å±•ç±»æ—¶æ²¡æœ‰å‘æ„é€ å‡½æ•°ä¼ å…¥å‚æ•°ã€‚ create_app() å‡½æ•°å°±æ˜¯ç¨‹åºçš„å·¥<br>å‚å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ç¨‹åºä½¿ç”¨çš„é…ç½®åã€‚é…ç½®ç±»åœ¨ config.py æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå…¶ä¸­ä¿å­˜<br>çš„é…ç½®å¯ä»¥ä½¿ç”¨ Flask app.config é…ç½®å¯¹è±¡æä¾›çš„ from_object() æ–¹æ³•ç›´æ¥å¯¼å…¥ç¨‹åºã€‚è‡³<br>äºé…ç½®å¯¹è±¡ï¼Œåˆ™å¯ä»¥é€šè¿‡åå­—ä» config å­—å…¸ä¸­é€‰æ‹©ã€‚ç¨‹åºåˆ›å»ºå¹¶é…ç½®å¥½åï¼Œå°±èƒ½åˆå§‹åŒ–<br>æ‰©å±•äº†ã€‚åœ¨ä¹‹å‰åˆ›å»ºçš„æ‰©å±•å¯¹è±¡ä¸Šè°ƒç”¨ init_app() å¯ä»¥å®Œæˆåˆå§‹åŒ–è¿‡ç¨‹ã€‚<br>ç¤ºä¾‹ 7-3ã€€app/<strong>init</strong>.pyï¼šç¨‹åºåŒ…çš„æ„é€ æ–‡ä»¶<br>from flask import Flask, render_template<br>from flask.ext.bootstrap import Bootstrap<br>from flask.ext.mail import Mail<br>from flask.ext.moment import Moment<br>from flask.ext.sqlalchemy import SQLAlchemy<br>from config import config<br>bootstrap = Bootstrap()<br>mail = Mail()<br>moment = Moment()<br>db = SQLAlchemy()<br>def create_app(config_name):<br>app = Flask(<strong>name</strong>)<br>app.config.from_object(config[config_name])<br>config[config_name].init_app(app)<br>bootstrap.init_app(app)<br>mail.init_app(app)<br>moment.init_app(app)<br>db.init_app(app)</p>
<h1 id="é™„åŠ è·¯ç”±å’Œè‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢"><a href="#é™„åŠ è·¯ç”±å’Œè‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢" class="headerlink" title="é™„åŠ è·¯ç”±å’Œè‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢"></a>é™„åŠ è·¯ç”±å’Œè‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢</h1><p>return app<br>å·¥å‚å‡½æ•°è¿”å›åˆ›å»ºçš„ç¨‹åºç¤ºä¾‹ï¼Œä¸è¿‡è¦æ³¨æ„ï¼Œç°åœ¨å·¥å‚å‡½æ•°åˆ›å»ºçš„ç¨‹åºè¿˜ä¸å®Œæ•´ï¼Œå› ä¸ºæ²¡<br>æœ‰è·¯ç”±å’Œè‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢å¤„ç†ç¨‹åºã€‚è¿™æ˜¯ä¸‹ä¸€èŠ‚è¦è®²çš„è¯é¢˜ã€‚<br>å¤§å‹ç¨‹åºçš„ç»“æ„ ï½œ 69<br>7.3.2ã€€åœ¨è“æœ¬ä¸­å®ç°ç¨‹åºåŠŸèƒ½<br>è½¬æ¢æˆç¨‹åºå·¥å‚å‡½æ•°çš„æ“ä½œè®©å®šä¹‰è·¯ç”±å˜å¤æ‚äº†ã€‚åœ¨å•è„šæœ¬ç¨‹åºä¸­ï¼Œç¨‹åºå®ä¾‹å­˜åœ¨äºå…¨<br>å±€ä½œç”¨åŸŸä¸­ï¼Œè·¯ç”±å¯ä»¥ç›´æ¥ä½¿ç”¨ app.route ä¿®é¥°å™¨å®šä¹‰ã€‚ä½†ç°åœ¨ç¨‹åºåœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œåª<br>æœ‰è°ƒç”¨ create_app() ä¹‹åæ‰èƒ½ä½¿ç”¨ app.route ä¿®é¥°å™¨ï¼Œè¿™æ—¶å®šä¹‰è·¯ç”±å°±å¤ªæ™šäº†ã€‚å’Œè·¯ç”±<br>ä¸€æ ·ï¼Œè‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢å¤„ç†ç¨‹åºä¹Ÿé¢ä¸´ç›¸åŒçš„å›°éš¾ï¼Œå› ä¸ºé”™è¯¯é¡µé¢å¤„ç†ç¨‹åºä½¿ç”¨ app.<br>errorhandler ä¿®é¥°å™¨å®šä¹‰ã€‚<br>å¹¸å¥½ Flask ä½¿ç”¨è“æœ¬æä¾›äº†æ›´å¥½çš„è§£å†³æ–¹æ³•ã€‚è“æœ¬å’Œç¨‹åºç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥å®šä¹‰è·¯ç”±ã€‚ä¸åŒçš„<br>æ˜¯ï¼Œåœ¨è“æœ¬ä¸­å®šä¹‰çš„è·¯ç”±å¤„äºä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°è“æœ¬æ³¨å†Œåˆ°ç¨‹åºä¸Šåï¼Œè·¯ç”±æ‰çœŸæ­£æˆä¸ºç¨‹åº<br>çš„ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨ä½äºå…¨å±€ä½œç”¨åŸŸä¸­çš„è“æœ¬æ—¶ï¼Œå®šä¹‰è·¯ç”±çš„æ–¹æ³•å‡ ä¹å’Œå•è„šæœ¬ç¨‹åºä¸€æ ·ã€‚<br>å’Œç¨‹åºä¸€æ ·ï¼Œè“æœ¬å¯ä»¥åœ¨å•ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ï¼Œä¹Ÿå¯ä½¿ç”¨æ›´ç»“æ„åŒ–çš„æ–¹å¼åœ¨åŒ…ä¸­çš„å¤šä¸ªæ¨¡å—ä¸­<br>åˆ›å»ºã€‚ä¸ºäº†è·å¾—æœ€å¤§çš„çµæ´»æ€§ï¼Œç¨‹åºåŒ…ä¸­åˆ›å»ºäº†ä¸€ä¸ªå­åŒ…ï¼Œç”¨äºä¿å­˜è“æœ¬ã€‚ç¤ºä¾‹ 7-4 æ˜¯è¿™<br>ä¸ªå­åŒ…çš„æ„é€ æ–‡ä»¶ï¼Œè“æœ¬å°±åˆ›å»ºäºæ­¤ã€‚<br>ç¤ºä¾‹ 7-4ã€€app/main/<strong>init</strong>.pyï¼šåˆ›å»ºè“æœ¬<br>from flask import Blueprint<br>main = Blueprint(â€˜mainâ€™, <strong>name</strong>)<br>from . import views, errors<br>é€šè¿‡å®ä¾‹åŒ–ä¸€ä¸ª Blueprint ç±»å¯¹è±¡å¯ä»¥åˆ›å»ºè“æœ¬ã€‚è¿™ä¸ªæ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªå¿…é¡»æŒ‡å®šçš„å‚æ•°ï¼š<br>è“æœ¬çš„åå­—å’Œè“æœ¬æ‰€åœ¨çš„åŒ…æˆ–æ¨¡å—ã€‚å’Œç¨‹åºä¸€æ ·ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨ Python çš„<br><strong>name</strong> å˜é‡å³å¯ã€‚<br>ç¨‹åºçš„è·¯ç”±ä¿å­˜åœ¨åŒ…é‡Œçš„ app/main/views.py æ¨¡å—ä¸­ï¼Œè€Œé”™è¯¯å¤„ç†ç¨‹åºä¿å­˜åœ¨ app/main/<br>errors.py æ¨¡å—ä¸­ã€‚å¯¼å…¥è¿™ä¸¤ä¸ªæ¨¡å—å°±èƒ½æŠŠè·¯ç”±å’Œé”™è¯¯å¤„ç†ç¨‹åºä¸è“æœ¬å…³è”èµ·æ¥ã€‚æ³¨æ„ï¼Œè¿™<br>äº›æ¨¡å—åœ¨ app/main/<strong>init</strong>.py è„šæœ¬çš„æœ«å°¾å¯¼å…¥ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å¾ªç¯å¯¼å…¥ä¾èµ–ï¼Œå› ä¸ºåœ¨<br>views.py å’Œ errors.py ä¸­è¿˜è¦å¯¼å…¥è“æœ¬ main ã€‚<br>è“æœ¬åœ¨å·¥å‚å‡½æ•° create_app() ä¸­æ³¨å†Œåˆ°ç¨‹åºä¸Šï¼Œå¦‚ç¤ºä¾‹ 7-5 æ‰€ç¤ºã€‚<br>ç¤ºä¾‹ 7-5ã€€app/<em>init</em>.pyï¼šæ³¨å†Œè“æœ¬<br>def create_app(config_name):</p>
<h1 id="â€¦"><a href="#â€¦" class="headerlink" title="â€¦"></a>â€¦</h1><p>from .main import main as main_blueprint<br>app.register_blueprint(main_blueprint)<br>return app<br>ç¤ºä¾‹ 7-6 æ˜¾ç¤ºäº†é”™è¯¯å¤„ç†ç¨‹åºã€‚<br>70 ï½œ ç¬¬ 7 ç« <br>ç¤ºä¾‹ 7-6ã€€app/main/errors.pyï¼šè“æœ¬ä¸­çš„é”™è¯¯å¤„ç†ç¨‹åº<br>from flask import render_template<br>from . import main<br>@main.app_errorhandler(404)<br>def page_not_found(e):<br>return render_template(â€˜404.htmlâ€™), 404<br>@main.app_errorhandler(500)<br>def internal_server_error(e):<br>return render_template(â€˜500.htmlâ€™), 500<br>åœ¨è“æœ¬ä¸­ç¼–å†™é”™è¯¯å¤„ç†ç¨‹åºç¨æœ‰ä¸åŒï¼Œå¦‚æœä½¿ç”¨ errorhandler ä¿®é¥°å™¨ï¼Œé‚£ä¹ˆåªæœ‰è“æœ¬ä¸­çš„<br>é”™è¯¯æ‰èƒ½è§¦å‘å¤„ç†ç¨‹åºã€‚è¦æƒ³æ³¨å†Œç¨‹åºå…¨å±€çš„é”™è¯¯å¤„ç†ç¨‹åºï¼Œå¿…é¡»ä½¿ç”¨ app_errorhandler ã€‚<br>åœ¨è“æœ¬ä¸­å®šä¹‰çš„ç¨‹åºè·¯ç”±å¦‚ç¤ºä¾‹ 7-7 æ‰€ç¤ºã€‚<br>ç¤ºä¾‹ 7-7ã€€app/main/views.pyï¼šè“æœ¬ä¸­å®šä¹‰çš„ç¨‹åºè·¯ç”±<br>from datetime import datetime<br>from flask import render_template, session, redirect, url_for<br>from . import main<br>from .forms import NameForm<br>from .. import db<br>from ..models import User<br>@main.route(â€˜/â€˜, methods=[â€˜GETâ€™, â€˜POSTâ€™])<br>def index():<br>form = NameForm()<br>if form.validate_on_submit():</p>
<h1 id="â€¦-1"><a href="#â€¦-1" class="headerlink" title="â€¦"></a>â€¦</h1><p>return redirect(url_for(â€˜.indexâ€™))<br>return render_template(â€˜index.htmlâ€™,<br>form=form, name=session.get(â€˜nameâ€™),<br>known=session.get(â€˜knownâ€™, False),<br>current_time=datetime.utcnow())<br>åœ¨è“æœ¬ä¸­ç¼–å†™è§†å›¾å‡½æ•°ä¸»è¦æœ‰ä¸¤ç‚¹ä¸åŒï¼šç¬¬ä¸€ï¼Œå’Œå‰é¢çš„é”™è¯¯å¤„ç†ç¨‹åºä¸€æ ·ï¼Œè·¯ç”±ä¿®é¥°å™¨<br>ç”±è“æœ¬æä¾›ï¼›ç¬¬äºŒï¼Œ url_for() å‡½æ•°çš„ç”¨æ³•ä¸åŒã€‚ä½ å¯èƒ½è¿˜è®°å¾—ï¼Œ url_for() å‡½æ•°çš„ç¬¬ä¸€<br>ä¸ªå‚æ•°æ˜¯è·¯ç”±çš„ç«¯ç‚¹åï¼Œåœ¨ç¨‹åºçš„è·¯ç”±ä¸­ï¼Œé»˜è®¤ä¸ºè§†å›¾å‡½æ•°çš„åå­—ã€‚ä¾‹å¦‚ï¼Œåœ¨å•è„šæœ¬ç¨‹åº<br>ä¸­ï¼Œ index() è§†å›¾å‡½æ•°çš„ URL å¯ä½¿ç”¨ url_for(â€˜indexâ€™) è·å–ã€‚<br>åœ¨è“æœ¬ä¸­å°±ä¸ä¸€æ ·äº†ï¼ŒFlask ä¼šä¸ºè“æœ¬ä¸­çš„å…¨éƒ¨ç«¯ç‚¹åŠ ä¸Šä¸€ä¸ªå‘½åç©ºé—´ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸<br>åŒçš„è“æœ¬ä¸­ä½¿ç”¨ç›¸åŒçš„ç«¯ç‚¹åå®šä¹‰è§†å›¾å‡½æ•°ï¼Œè€Œä¸ä¼šäº§ç”Ÿå†²çªã€‚å‘½åç©ºé—´å°±æ˜¯è“æœ¬çš„åå­—<br>ï¼ˆ Blueprint æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œæ‰€ä»¥è§†å›¾å‡½æ•° index() æ³¨å†Œçš„ç«¯ç‚¹åæ˜¯ main.index ï¼Œ<br>å…¶ URL ä½¿ç”¨ url_for(â€˜main.indexâ€™) è·å–ã€‚<br>å¤§å‹ç¨‹åºçš„ç»“æ„ ï½œ 71<br>url_for() å‡½æ•°è¿˜æ”¯æŒä¸€ç§ç®€å†™çš„ç«¯ç‚¹å½¢å¼ï¼Œåœ¨è“æœ¬ä¸­å¯ä»¥çœç•¥è“æœ¬åï¼Œä¾‹å¦‚ url_for(â€˜.<br>indexâ€™) ã€‚åœ¨è¿™ç§å†™æ³•ä¸­ï¼Œå‘½åç©ºé—´æ˜¯å½“å‰è¯·æ±‚æ‰€åœ¨çš„è“æœ¬ã€‚è¿™æ„å‘³ç€åŒä¸€è“æœ¬ä¸­çš„é‡å®šå‘<br>å¯ä»¥ä½¿ç”¨ç®€å†™å½¢å¼ï¼Œä½†è·¨è“æœ¬çš„é‡å®šå‘å¿…é¡»ä½¿ç”¨å¸¦æœ‰å‘½åç©ºé—´çš„ç«¯ç‚¹åã€‚<br>ä¸ºäº†å®Œå…¨ä¿®æ”¹ç¨‹åºçš„é¡µé¢ï¼Œè¡¨å•å¯¹è±¡ä¹Ÿè¦ç§»åˆ°è“æœ¬ä¸­ï¼Œä¿å­˜äº app/main/forms.py æ¨¡å—ã€‚</p>
<h4 id="7-4-å¯åŠ¨è„šæœ¬"><a href="#7-4-å¯åŠ¨è„šæœ¬" class="headerlink" title="7.4ã€€å¯åŠ¨è„šæœ¬"></a>7.4ã€€å¯åŠ¨è„šæœ¬</h4><p>é¡¶çº§æ–‡ä»¶å¤¹ä¸­çš„ manage.py æ–‡ä»¶ç”¨äºå¯åŠ¨ç¨‹åºã€‚è„šæœ¬å†…å®¹å¦‚ç¤ºä¾‹ 7-8 æ‰€ç¤ºã€‚<br>ç¤ºä¾‹ 7-8ã€€manage.pyï¼šå¯åŠ¨è„šæœ¬<br>#!/usr/bin/env python<br>import os<br>from app import create_app, db<br>from app.models import User, Role<br>from flask.ext.script import Manager, Shell<br>from flask.ext.migrate import Migrate, MigrateCommand<br>app = create_app(os.getenv(â€˜FLASK_CONFIGâ€™) or â€˜defaultâ€™)<br>manager = Manager(app)<br>migrate = Migrate(app, db)<br>def make_shell_context():<br>return dict(app=app, db=db, User=User, Role=Role)<br>manager.add_command(â€œshellâ€, Shell(make_context=make_shell_context))<br>manager.add_command(â€˜dbâ€™, MigrateCommand)<br>if <strong>name</strong> == â€˜<strong>main</strong>â€˜:<br>manager.run()<br>è¿™ä¸ªè„šæœ¬å…ˆåˆ›å»ºç¨‹åºã€‚å¦‚æœå·²ç»å®šä¹‰äº†ç¯å¢ƒå˜é‡ FLASK_CONFIG ï¼Œåˆ™ä»ä¸­è¯»å–é…ç½®åï¼›å¦åˆ™<br>ä½¿ç”¨é»˜è®¤é…ç½®ã€‚ç„¶ååˆå§‹åŒ– Flask-Scriptã€Flask-Migrate å’Œä¸º Python shell å®šä¹‰çš„ä¸Šä¸‹æ–‡ã€‚<br>å‡ºäºä¾¿åˆ©ï¼Œè„šæœ¬ä¸­åŠ å…¥äº† shebang å£°æ˜ï¼Œæ‰€ä»¥åœ¨åŸºäº Unix çš„æ“ä½œç³»ç»Ÿä¸­å¯ä»¥é€šè¿‡ ./manage.<br>py æ‰§è¡Œè„šæœ¬ï¼Œè€Œä¸ç”¨ä½¿ç”¨å¤æ‚çš„ python manage.py ã€‚</p>
<h4 id="7-5-éœ€æ±‚æ–‡ä»¶"><a href="#7-5-éœ€æ±‚æ–‡ä»¶" class="headerlink" title="7.5ã€€éœ€æ±‚æ–‡ä»¶"></a>7.5ã€€éœ€æ±‚æ–‡ä»¶</h4><p>ç¨‹åºä¸­å¿…é¡»åŒ…å«ä¸€ä¸ª requirements.txt æ–‡ä»¶ï¼Œç”¨äºè®°å½•æ‰€æœ‰ä¾èµ–åŒ…åŠå…¶ç²¾ç¡®çš„ç‰ˆæœ¬å·ã€‚å¦‚æœ<br>è¦åœ¨å¦ä¸€å°ç”µè„‘ä¸Šé‡æ–°ç”Ÿæˆè™šæ‹Ÿç¯å¢ƒï¼Œè¿™ä¸ªæ–‡ä»¶çš„é‡è¦æ€§å°±ä½“ç°å‡ºæ¥äº†ï¼Œä¾‹å¦‚éƒ¨ç½²ç¨‹åºæ—¶<br>ä½¿ç”¨çš„ç”µè„‘ã€‚ pip å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è‡ªåŠ¨ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ï¼š<br>(venv) $ pip freeze &gt;requirements.txt<br>å®‰è£…æˆ–å‡çº§åŒ…åï¼Œæœ€å¥½æ›´æ–°è¿™ä¸ªæ–‡ä»¶ã€‚éœ€æ±‚æ–‡ä»¶çš„å†…å®¹ç¤ºä¾‹å¦‚ä¸‹ï¼š<br>72 ï½œ ç¬¬ 7 ç« <br>Flask==0.10.1<br>Flask-Bootstrap==3.0.3.1<br>Flask-Mail==0.9.0<br>Flask-Migrate==1.1.0<br>Flask-Moment==0.2.0<br>Flask-SQLAlchemy==1.0<br>Flask-Script==0.6.6<br>Flask-WTF==0.9.4<br>Jinja2==2.7.1<br>Mako==0.9.1<br>MarkupSafe==0.18<br>SQLAlchemy==0.8.4<br>WTForms==1.0.5<br>Werkzeug==0.9.4<br>alembic==0.6.2<br>blinker==1.3<br>itsdangerous==0.23<br>å¦‚æœä½ è¦åˆ›å»ºè¿™ä¸ªè™šæ‹Ÿç¯å¢ƒçš„å®Œå…¨å‰¯æœ¬ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶åœ¨å…¶ä¸Šè¿è¡Œä»¥ä¸‹<br>å‘½ä»¤ï¼š<br>(venv) $ pip install -r requirements.txt<br>å½“ä½ é˜…è¯»æœ¬ä¹¦æ—¶ï¼Œè¯¥ç¤ºä¾‹ requirements.txt æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·å¯èƒ½å·²ç»è¿‡æœŸäº†ã€‚å¦‚æœæ„¿æ„ï¼Œä½ <br>å¯ä»¥è¯•ç€ä½¿ç”¨è¿™äº›åŒ…çš„æœ€æ–°ç‰ˆã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œä½ å¯ä»¥éšæ—¶æ¢å›è¿™ä¸ªéœ€æ±‚æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬ï¼Œ<br>å› ä¸ºè¿™äº›ç‰ˆæœ¬å’Œç¨‹åºå…¼å®¹ã€‚</p>
<h4 id="7-6-å•å…ƒæµ‹è¯•"><a href="#7-6-å•å…ƒæµ‹è¯•" class="headerlink" title="7.6ã€€å•å…ƒæµ‹è¯•"></a>7.6ã€€å•å…ƒæµ‹è¯•</h4><p>è¿™ä¸ªç¨‹åºå¾ˆå°ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆå¯æµ‹è¯•çš„ã€‚ä¸è¿‡ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸¤ä¸ªç®€å•çš„æµ‹è¯•ï¼Œå¦‚<br>ç¤ºä¾‹ 7-9 æ‰€ç¤ºã€‚<br>ç¤ºä¾‹ 7-9ã€€tests/test_basics.pyï¼šå•å…ƒæµ‹è¯•<br>import unittest<br>from flask import current_app<br>from app import create_app, db<br>class BasicsTestCase(unittest.TestCase):<br>def setUp(self):<br>self.app = create_app(â€˜testingâ€™)<br>self.app_context = self.app.app_context()<br>self.app_context.push()<br>db.create_all()<br>def tearDown(self):<br>db.session.remove()<br>db.drop_all()<br>self.app_context.pop()<br>def test_app_exists(self):<br>å¤§å‹ç¨‹åºçš„ç»“æ„ ï½œ 73<br>self.assertFalse(current_app is None)<br>def test_app_is_testing(self):<br>self.assertTrue(current_app.config[â€˜TESTINGâ€™])<br>è¿™ä¸ªæµ‹è¯•ä½¿ç”¨ Python æ ‡å‡†åº“ä¸­çš„ unittest åŒ…ç¼–å†™ã€‚ setUp() å’Œ tearDown() æ–¹æ³•åˆ†åˆ«åœ¨å„<br>æµ‹è¯•å‰åè¿è¡Œï¼Œå¹¶ä¸”åå­—ä»¥ test_ å¼€å¤´çš„å‡½æ•°éƒ½ä½œä¸ºæµ‹è¯•æ‰§è¡Œã€‚<br>å¦‚æœä½ æƒ³è¿›ä¸€æ­¥äº†è§£å¦‚ä½•ä½¿ç”¨ Python çš„ unittest åŒ…ç¼–å†™æµ‹è¯•ï¼Œè¯·é˜…è¯»å®˜æ–¹æ–‡<br>æ¡£ï¼ˆ<a href="https://docs.python.org/2/library/unittest.htmlï¼‰ã€‚" target="_blank" rel="noopener">https://docs.python.org/2/library/unittest.htmlï¼‰ã€‚</a><br>setUp() æ–¹æ³•å°è¯•åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç¯å¢ƒï¼Œç±»ä¼¼äºè¿è¡Œä¸­çš„ç¨‹åºã€‚é¦–å…ˆï¼Œä½¿ç”¨æµ‹è¯•é…ç½®åˆ›å»ºç¨‹<br>åºï¼Œç„¶åæ¿€æ´»ä¸Šä¸‹æ–‡ã€‚è¿™ä¸€æ­¥çš„ä½œç”¨æ˜¯ç¡®ä¿èƒ½åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ current_app ï¼Œåƒæ™®é€šè¯·æ±‚ä¸€<br>æ ·ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªå…¨æ–°çš„æ•°æ®åº“ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚æ•°æ®åº“å’Œç¨‹åºä¸Šä¸‹æ–‡åœ¨ tearDown() æ–¹æ³•<br>ä¸­åˆ é™¤ã€‚<br>ç¬¬ä¸€ä¸ªæµ‹è¯•ç¡®ä¿ç¨‹åºå®ä¾‹å­˜åœ¨ã€‚ç¬¬äºŒä¸ªæµ‹è¯•ç¡®ä¿ç¨‹åºåœ¨æµ‹è¯•é…ç½®ä¸­è¿è¡Œã€‚è‹¥æƒ³æŠŠ tests æ–‡<br>ä»¶å¤¹ä½œä¸ºåŒ…ä½¿ç”¨ï¼Œéœ€è¦æ·»åŠ  tests/<strong>init</strong>.py æ–‡ä»¶ï¼Œä¸è¿‡è¿™ä¸ªæ–‡ä»¶å¯ä»¥ä¸ºç©ºï¼Œå› ä¸º unittest<br>åŒ…ä¼šæ‰«ææ‰€æœ‰æ¨¡å—å¹¶æŸ¥æ‰¾æµ‹è¯•ã€‚<br>å¦‚æœä½ ä» GitHub ä¸Šå…‹éš†äº†è¿™ä¸ªç¨‹åºçš„ Git ä»“åº“ï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œ git checkout<br>7a ç­¾å‡ºç¨‹åºçš„è¿™ä¸ªç‰ˆæœ¬ã€‚ä¸ºç¡®ä¿å®‰è£…äº†æ‰€æœ‰ä¾èµ–åŒ…ï¼Œè¿˜éœ€æ‰§è¡Œ pip install<br>-r requirements.txt å‘½ä»¤ã€‚<br>ä¸ºäº†è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œä½ å¯ä»¥åœ¨ manage.py è„šæœ¬ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤ã€‚ç¤ºä¾‹ 7-10 å±•ç¤ºäº†å¦‚<br>ä½•æ·»åŠ  test å‘½ä»¤ã€‚<br>ç¤ºä¾‹ 7-10ã€€manage.pyï¼šå¯åŠ¨å•å…ƒæµ‹è¯•çš„å‘½ä»¤<br>@manager.command<br>def test():<br>â€œâ€â€Run the unit tests.â€â€â€<br>import unittest<br>tests = unittest.TestLoader().discover(â€˜testsâ€™)<br>unittest.TextTestRunner(verbosity=2).run(tests)<br>manager.command ä¿®é¥°å™¨è®©è‡ªå®šä¹‰å‘½ä»¤å˜å¾—ç®€å•ã€‚ä¿®é¥°å‡½æ•°åå°±æ˜¯å‘½ä»¤åï¼Œå‡½æ•°çš„æ–‡æ¡£å­—ç¬¦<br>ä¸²ä¼šæ˜¾ç¤ºåœ¨å¸®åŠ©æ¶ˆæ¯ä¸­ã€‚ test() å‡½æ•°çš„å®šä¹‰ä½“ä¸­è°ƒç”¨äº† unittest åŒ…æä¾›çš„æµ‹è¯•è¿è¡Œå‡½æ•°ã€‚<br>å•å…ƒæµ‹è¯•å¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿è¡Œï¼š<br>74 ï½œ ç¬¬ 7 ç« <br>(venv) $ python manage.py test<br>test_app_exists (test_basics.BasicsTestCase) â€¦ ok<br>test_app_is_testing (test_basics.BasicsTestCase) â€¦ ok<br>.â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-<br>Ran 2 tests in 0.001s<br>OK</p>
<h4 id="7-7-åˆ›å»ºæ•°æ®åº“"><a href="#7-7-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="7.7ã€€åˆ›å»ºæ•°æ®åº“"></a>7.7ã€€åˆ›å»ºæ•°æ®åº“</h4><p>é‡ç»„åçš„ç¨‹åºå’Œå•è„šæœ¬ç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ã€‚<br>é¦–é€‰ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–æ•°æ®åº“çš„ URLï¼ŒåŒæ—¶è¿˜æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ SQLite æ•°æ®åº“åšå¤‡ç”¨ã€‚3<br>ç§é…ç½®ç¯å¢ƒä¸­çš„ç¯å¢ƒå˜é‡åå’Œ SQLite æ•°æ®åº“æ–‡ä»¶åéƒ½ä¸ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæ•°æ®<br>åº“ URL ä»ç¯å¢ƒå˜é‡ DEV_DATABASE_URL ä¸­è¯»å–ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œåˆ™ä½¿ç”¨åä¸º<br>data-dev.sqlite çš„ SQLite æ•°æ®åº“ã€‚<br>ä¸ç®¡ä»å“ªé‡Œè·å–æ•°æ®åº“ URLï¼Œéƒ½è¦åœ¨æ–°æ•°æ®åº“ä¸­åˆ›å»ºæ•°æ®è¡¨ã€‚å¦‚æœä½¿ç”¨ Flask-Migrate è·Ÿ<br>è¸ªè¿ç§»ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºæ•°æ®è¡¨æˆ–è€…å‡çº§åˆ°æœ€æ–°ä¿®è®¢ç‰ˆæœ¬ï¼š<br>(venv) $ python manage.py db upgrade<br>ä¸ç®¡ä½ æ˜¯å¦ç›¸ä¿¡ï¼Œç¬¬ä¸€éƒ¨åˆ†åˆ°æ­¤å°±è¦ç»“æŸäº†ã€‚ç°åœ¨ä½ å·²ç»å­¦åˆ°äº†ä½¿ç”¨ Flask å¼€å‘ Web ç¨‹åº<br>çš„å¿…å¤‡åŸºç¡€çŸ¥è¯†ï¼Œä¸è¿‡å¯èƒ½è¿˜ä¸ç¡®å®šå¦‚ä½•æŠŠè¿™äº›çŸ¥è¯†èè´¯èµ·æ¥å¼€å‘ä¸€ä¸ªçœŸæ­£çš„ç¨‹åºã€‚æœ¬ä¹¦<br>ç¬¬äºŒéƒ¨åˆ†çš„ç›®çš„å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸¦ç€ä½ ä¸€æ­¥ä¸€æ­¥åœ°å¼€å‘å‡ºä¸€ä¸ªå®Œæ•´çš„ç¨‹åºã€‚</p>
]]></content>
      <categories>
        <category>Flask</category>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL8è¸©å‘</title>
    <url>//post/44793.html</url>
    <content><![CDATA[<h5 id="1-å¯åŠ¨MySQLæŠ¥é”™-ERROR-2003-HY000-Canâ€™t-connect-to-MySQL-server-on-â€˜localhostâ€™-10061"><a href="#1-å¯åŠ¨MySQLæŠ¥é”™-ERROR-2003-HY000-Canâ€™t-connect-to-MySQL-server-on-â€˜localhostâ€™-10061" class="headerlink" title="1.å¯åŠ¨MySQLæŠ¥é”™:ERROR 2003 (HY000): Canâ€™t connect to MySQL server on â€˜localhostâ€™ (10061)"></a>1.å¯åŠ¨MySQLæŠ¥é”™:ERROR 2003 (HY000): Canâ€™t connect to MySQL server on â€˜localhostâ€™ (10061)</h5><a id="more"></a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;BigData_Mining&#x2F;article&#x2F;details&#x2F;88344513</span><br><span class="line">3ã€å¦‚æœã€æ­¥éª¤2ã€‘ä¸­æ‰¾ä¸åˆ°MysqlæœåŠ¡éœ€è¦æ‰‹åŠ¨å®‰è£…MysqlæœåŠ¡ï¼Œå®‰è£…å‘½ä»¤ä¸ºmysqld -installï¼Œç”±äºæœ¬æœºä¸­å·²ç»å®‰è£…äº†mysqlæœåŠ¡ï¼Œæ‰€ä»¥æœ‰å¦‚ä¸‹æç¤ºThe service already exists!</span><br><span class="line">5ã€æ­¤å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡åœ¨cmdä¸­æ‰§è¡Œå‘½ä»¤net start mysqlå‘½ä»¤æ¥å¯åŠ¨MysqlæœåŠ¡ï¼›</span><br></pre></td></tr></table></figure>

<h5 id="2-ã€é”™è¯¯è§£å†³ã€‘æœ¬åœ°è®¡ç®—æœºä¸Šçš„mysqlæœåŠ¡å¯åŠ¨åœæ­¢å-æŸäº›æœåŠ¡åœ¨æœªç”±å…¶ä»–æœåŠ¡æˆ–ç¨‹åºä½¿ç”¨æ—¶å°†è‡ªåŠ¨åœæ­¢"><a href="#2-ã€é”™è¯¯è§£å†³ã€‘æœ¬åœ°è®¡ç®—æœºä¸Šçš„mysqlæœåŠ¡å¯åŠ¨åœæ­¢å-æŸäº›æœåŠ¡åœ¨æœªç”±å…¶ä»–æœåŠ¡æˆ–ç¨‹åºä½¿ç”¨æ—¶å°†è‡ªåŠ¨åœæ­¢" class="headerlink" title="2.ã€é”™è¯¯è§£å†³ã€‘æœ¬åœ°è®¡ç®—æœºä¸Šçš„mysqlæœåŠ¡å¯åŠ¨åœæ­¢å,æŸäº›æœåŠ¡åœ¨æœªç”±å…¶ä»–æœåŠ¡æˆ–ç¨‹åºä½¿ç”¨æ—¶å°†è‡ªåŠ¨åœæ­¢"></a>2.ã€é”™è¯¯è§£å†³ã€‘æœ¬åœ°è®¡ç®—æœºä¸Šçš„mysqlæœåŠ¡å¯åŠ¨åœæ­¢å,æŸäº›æœåŠ¡åœ¨æœªç”±å…¶ä»–æœåŠ¡æˆ–ç¨‹åºä½¿ç”¨æ—¶å°†è‡ªåŠ¨åœæ­¢</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_26525215&#x2F;article&#x2F;details&#x2F;53424152</span><br><span class="line">é¦–å…ˆï¼Œä½ éœ€è¦æŠŠåŸæ¥çš„æœåŠ¡åˆ é™¤ï¼š</span><br><span class="line"></span><br><span class="line">mysqld --remove mysql</span><br><span class="line">æ³¨æ„:mysqlä¸ºä½ çš„æœåŠ¡åç§°ï¼Œè‡ªå·±å¯ä»¥éšä¾¿å®šä¹‰çš„ã€‚</span><br><span class="line">æ­¤å‘½ä»¤éœ€è¦è¿›å…¥mysqlå®‰è£…ç›®å½•ä¸‹çš„binç›®å½•è¿è¡Œï¼</span><br><span class="line"></span><br><span class="line">mysqlçš„æ ¹ç›®å½•ä¸‹ï¼š</span><br><span class="line">ä½ éœ€è¦æ¸…ç©ºdataç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæ²¡æœ‰dataç›®å½•ï¼Œè¯·è‡ªè¡Œåˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼Œèµ·åä¸ºdataï¼</span><br><span class="line"></span><br><span class="line">ç„¶ååœ¨binç›®å½•ä¸‹è¿è¡Œå‘½ä»¤:</span><br><span class="line"></span><br><span class="line">mysqld --initialize-insecure --user&#x3D;mysql</span><br><span class="line">mysqld --install mysql --defaults-file&#x3D;d:\mysql-5.7.14-winx64\my.ini</span><br><span class="line">net start mysql</span><br></pre></td></tr></table></figure>

<h5 id="3-MySQLæ²¡æœ‰-data-ç›®å½•çš„è§£å†³æ–¹æ³•æˆ–è€…é‡å»º-data-ç›®å½•"><a href="#3-MySQLæ²¡æœ‰-data-ç›®å½•çš„è§£å†³æ–¹æ³•æˆ–è€…é‡å»º-data-ç›®å½•" class="headerlink" title="3.MySQLæ²¡æœ‰ data ç›®å½•çš„è§£å†³æ–¹æ³•æˆ–è€…é‡å»º data ç›®å½•"></a>3.MySQLæ²¡æœ‰ data ç›®å½•çš„è§£å†³æ–¹æ³•æˆ–è€…é‡å»º data ç›®å½•</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;yicixing7&#x2F;article&#x2F;details&#x2F;52399726</span><br><span class="line">ä¸‹è½½ MySQL å…å®‰è£…ç‰ˆï¼Œä» 5.7 ç‰ˆæœ¬ä»¥åï¼Œä¸å†å«æœ‰ data ç›®å½•ï¼Œæ²¡æœ‰ data ç›®å½•ä¹Ÿå°±æ˜¯æ²¡æœ‰é»˜è®¤æ•°æ®åº“ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºã€‚</span><br><span class="line"></span><br><span class="line">è¿è¡Œåˆ›å»º data çš„å‘½ä»¤</span><br><span class="line"></span><br><span class="line">D:\mysql\5.7.12\bin&gt;mysqld --initialize-insecure --user&#x3D;mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å°†è‡ªåŠ¨åˆ›å»ºç›®å½•äº home ä½ç½®</span><br><span class="line"></span><br><span class="line">D:&#x2F;mysql&#x2F;5.7.12&#x2F;data</span><br><span class="line"></span><br><span class="line">åˆ›å»ºå®Œæˆå¹¶å¯åŠ¨æœåŠ¡å™¨ï¼Œæ­¤æ—¶å¯†ç ä¸ºç©º</span><br><span class="line"></span><br><span class="line">&#x2F;bin&#x2F;mysql -u root -p å³å¯è¿›å…¥</span><br></pre></td></tr></table></figure>

<p>æ— æ³•å†ç»ˆç«¯è¿æ¥mysql</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ã€1ã€‘mysql8 çš„å‘ å¯†ç åŠ å¯†è§„åˆ™</span><br><span class="line">ã€€ã€€åœ¨MySQL 8.0.ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œcaching_sha2_passwordæ˜¯é»˜è®¤çš„èº«ä»½éªŒè¯æ’ä»¶ï¼Œè€Œä¸æ˜¯ä»¥å¾€çš„mysql_native_passwordã€‚</span><br><span class="line"></span><br><span class="line">ã€€ã€€æœ‰å…³æ­¤æ›´æ”¹å¯¹æœåŠ¡å™¨æ“ä½œçš„å½±å“ä»¥åŠæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å’Œè¿æ¥å™¨çš„å…¼å®¹æ€§çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…caching_sha2_passwordä½œä¸ºé¦–é€‰çš„èº«ä»½éªŒè¯æ’ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">ã€€ã€€(ç¿»è¯‘è‡ªhttps:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;8.0&#x2F;en&#x2F;caching-sha2-pluggable-authentication.htmlï¼‰</span><br><span class="line"></span><br><span class="line">#å¦‚æœæ‚¨è¿˜æ²¡æœ‰é…ç½®ï¼Œé‚£ä¹ˆåœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä¿®æ”¹ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯MysqlæœåŠ¡åï¼Œæ–°å»ºçš„ç”¨æˆ·å°±å¯ä»¥è¿œç¨‹è¿æ¥äº†ã€‚ä½†ç°æœ‰ç”¨æˆ·ä»ç„¶æ— æ³•è¿œç¨‹è¿æ¥</span><br><span class="line">[mysqld]</span><br><span class="line"># é»˜è®¤ä½¿ç”¨ mysql_native_password æ’ä»¶è®¤è¯</span><br><span class="line">default_authentication_plugin&#x3D;mysql_native_password</span><br><span class="line">ç»ˆç«¯è¿æ¥å¿…é¡»è®¾ç½®ä¸ºcaching_sha2_password</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>PlantUMLä½¿ç”¨ç¬”è®°</title>
    <url>//post/1507.html</url>
    <content><![CDATA[<h2 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h2><p>å¿«æ·é”® <code>ALT+D</code></p><blockquote>
<p><a href="https://blog.csdn.net/zhaoem82/article/details/104369539" target="_blank" rel="noopener">https://blog.csdn.net/zhaoem82/article/details/104369539</a></p>
</blockquote>]]></content>
  </entry>
  <entry>
    <title>Poetryä½¿ç”¨æŒ‡å—</title>
    <url>//post/38590.html</url>
    <content><![CDATA[<h1 id="PythonåŒ…ç®¡ç†ä¹‹poetryçš„ä½¿ç”¨"><a href="#PythonåŒ…ç®¡ç†ä¹‹poetryçš„ä½¿ç”¨" class="headerlink" title="PythonåŒ…ç®¡ç†ä¹‹poetryçš„ä½¿ç”¨"></a><a href="https://www.cnblogs.com/-wenli/p/13337188.html" target="_blank" rel="noopener">PythonåŒ…ç®¡ç†ä¹‹poetryçš„ä½¿ç”¨</a></h1><p>poetryæ˜¯ä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒå’Œä¾èµ–ç®¡ç†çš„å·¥å…·ï¼Œä¹‹å‰ç”¨pipenvï¼Œæœ€è¿‘å­¦ä¹ httprunneræ—¶ï¼Œæ¥è§¦äº†poetryã€‚poetryå’Œpipenvç±»ä¼¼ï¼Œå¦å¤–è¿˜æä¾›äº†æ‰“åŒ…å’Œå‘å¸ƒçš„åŠŸèƒ½ã€‚<br>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.cnblogs.com/-wenli/p/python-poetry.org/docs/" target="_blank" rel="noopener">python-poetry.org/docs/</a></p><a id="more"></a>
<p>pythoné¡¹ç›®éƒ¨ç½²ï¼š<strong>poetryç®¡ç†æœ¬åœ°ç¯å¢ƒ,ä¸Šçº¿ç”¨docker</strong></p>
<p><strong><em>\</em>poetry\</strong>å®‰è£…**</p>
<p>poetryæä¾›å¤šç§å®‰è£…æ–¹å¼ï¼Œä¸ªäººæ¨èä»ä»¥ä¸‹2ç§æ–¹å¼ä¸­é€‰æ‹©ï¼š</p>
<p>æ–¹å¼ä¸€ï¼šï¼ˆæ¨èï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -sSL https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;python-poetry&#x2F;poetry&#x2F;master&#x2F;get-poetry.py | python</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼šï¼ˆpipï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ pip install --user poetry</span><br></pre></td></tr></table></figure>

<h3 id="å·¥ç¨‹åˆå§‹åŒ–"><a href="#å·¥ç¨‹åˆå§‹åŒ–" class="headerlink" title="å·¥ç¨‹åˆå§‹åŒ–"></a>å·¥ç¨‹åˆå§‹åŒ–</h3><p>å¦‚æœå½“å‰è¿˜æ²¡æœ‰åˆ›å»ºå·¥ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨poetryæ–°å»ºå·¥ç¨‹ï¼š</p>
<p>è¾“å…¥poetry newæ¥åˆ›å»ºä¸€ä¸ªé¡¹ç›®è„šæ‰‹æ¶ï¼ŒåŒ…æ‹¬åŸºæœ¬ç»“æ„ã€pyproject.tomlæ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ poetry new poetry-demo</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«å¦‚ä¸‹å†…å®¹çš„å·¥ç¨‹ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">poetry-demo</span><br><span class="line">â”œâ”€â”€ pyproject.toml</span><br><span class="line">â”œâ”€â”€ README.rst</span><br><span class="line">â”œâ”€â”€ poetry_demo</span><br><span class="line">â”‚ â””â”€â”€ __init__.py</span><br><span class="line">â””â”€â”€ tests</span><br><span class="line">â”œâ”€â”€ __init__.py</span><br><span class="line">â””â”€â”€ test_poetry_demo.py</span><br></pre></td></tr></table></figure>



<p>é™¤äº†æ–°å»ºå·¥ç¨‹ï¼Œè¿˜å¯ä»¥åœ¨å·²æœ‰å·¥ç¨‹çš„åŸºç¡€ä¸Šè¿›è¡Œåˆ›å»ºï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ poetry init</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ï¼Œå®ƒä¼šè®©ä½ è¾“å…¥åŒ…åç§°ã€ç‰ˆæœ¬å·ç­‰ä¿¡æ¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¾“å…¥ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æŒ‰ä¸‹ENTERé”®ä½¿ç”¨é»˜è®¤å€¼ï¼Œå®Œæˆä»¥åï¼Œpyproject.tomlå¦‚ä»¥ä¸‹æ ¼å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name &#x3D; &quot;poetry-demo&quot;</span><br><span class="line">version &#x3D; &quot;0.1.0&quot;</span><br><span class="line">description &#x3D; &quot;&quot;</span><br><span class="line">authors &#x3D; [&quot;wenli&quot;]</span><br><span class="line"></span><br><span class="line">[tool.poetry.dependencies]</span><br><span class="line">python &#x3D; &quot;*&quot;</span><br><span class="line"></span><br><span class="line">[tool.poetry.dev-dependencies]</span><br><span class="line">pytest &#x3D; &quot;^3.4&quot;</span><br></pre></td></tr></table></figure>



<h3 id="ä¾èµ–åŒ…ç®¡ç†"><a href="#ä¾èµ–åŒ…ç®¡ç†" class="headerlink" title="ä¾èµ–åŒ…ç®¡ç†"></a>ä¾èµ–åŒ…ç®¡ç†</h3><p><strong>å®‰è£…ä¾èµ–åŒ…</strong></p>
<p>å¯ä»¥ä½¿ç”¨installå‘½ä»¤ç›´æ¥è§£æå¹¶å®‰è£…pyproject.tomlçš„ä¾èµ–åŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ poetry install</span><br><span class="line">pyproject.tomlæ–‡ä»¶çš„é…ç½®å¦‚ä¸‹ï¼š</span><br><span class="line">[tool.poetry.dependencies]</span><br><span class="line">pendulum &#x3D; &quot;^1.4&quot;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥å¯ä»¥ä½¿ç”¨addå‘½ä»¤æ¥å®‰è£…ä¸€æ¬¾Pythonå·¥å…·åŒ…ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ poetry add numpy</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ï¼Œé€šè¿‡æ·»åŠ é…ç½®å‚æ•°â€“devæ¥åŒºåˆ†ä¸åŒç¯å¢ƒä¸‹çš„ä¾èµ–åŒ…ã€‚</p>
<p>è¯¦ç»†ï¼š</p>
<p>poetry add flask ï¼šå®‰è£…æœ€æ–°ç¨³å®šç‰ˆæœ¬çš„flask<br>poetry add pytest â€“dev : æŒ‡å®šä¸ºå¼€å‘ä¾èµ–ï¼Œä¼šå†™åˆ°pyproject.tomlä¸­çš„[tool.poetry.dev-dependencies]åŒºåŸŸ<br>poetry add flask=2.22.0 : æŒ‡å®šå…·ä½“çš„ç‰ˆæœ¬<br>poetry install : å®‰è£…pyproject.tomlæ–‡ä»¶ä¸­çš„å…¨éƒ¨ä¾èµ–<br>poetry install â€“no-dev ï¼š åªå®‰è£…édevelopmentç¯å¢ƒçš„ä¾èµ–ï¼Œä¸€èˆ¬éƒ¨ç½²æ—¶ä½¿ç”¨<br></p>
<p><strong>æ›´æ–°æ‰€æœ‰é”å®šç‰ˆæœ¬çš„ä¾èµ–åŒ…</strong><br>$ poetry update</p>
<p><strong>æ›´æ–°æŒ‡å®šä¾èµ–åŒ…</strong></p>
<p>$ poetry update numpy<br><strong>å¸è½½ä¾èµ–åŒ…</strong><br>$ poetry remove numpy</p>
<p><strong>æŸ¥çœ‹å¯ä»¥æ›´æ–°çš„ä¾èµ–</strong><br>$ poetry show â€“outdated</p>
<p><strong>æŸ¥çœ‹é¡¹ç›®å®‰è£…çš„ä¾èµ–</strong></p>
<p>$ poetry show</p>
<p><strong>æ ‘å½¢ç»“æ„æŸ¥çœ‹é¡¹ç›®å®‰è£…çš„ä¾èµ–</strong></p>
<p>$ poetry show -t</p>
<h3 id="è™šæ‹Ÿç¯å¢ƒç®¡ç†"><a href="#è™šæ‹Ÿç¯å¢ƒç®¡ç†" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒç®¡ç†"></a>è™šæ‹Ÿç¯å¢ƒç®¡ç†</h3><p>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ<br>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæœ‰2ç§æ–¹å¼ï¼š</p>
<p>æ–¹å¼1ï¼š</p>
<p>å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†virtualenvs.create=trueï¼Œæ‰§è¡Œpoetry installæ—¶ä¼šæ£€æŸ¥æ˜¯å¦æœ‰è™šæ‹Ÿç¯å¢ƒï¼Œå¦åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p>
<p>æ–¹å¼2ï¼š</p>
<p><strong>æŒ‡å®šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä½¿ç”¨çš„Pythonè§£é‡Šå™¨ç‰ˆæœ¬</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ poetry env use python3.7</span><br></pre></td></tr></table></figure>

<p><strong>æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</strong><br>$ poetry shell<br><strong>æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</strong><br>$ poetry env info<br><strong>æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒåˆ—è¡¨</strong><br>$ poetry env list<br><strong>æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒç»å¯¹è·¯å¾„</strong><br>$ poetry env list â€“full-path</p>
<p><strong>åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</strong><br>$ poetry env remove python3.7</p>
<p><strong>æŸ¥çœ‹pythonç‰ˆæœ¬</strong><br>$ poetry run python -V</p>
<blockquote>
<p> è½¬è‡ªï¼š<a href="https://www.cnblogs.com/-wenli/p/13337188.html" target="_blank" rel="noopener">https://www.cnblogs.com/-wenli/p/13337188.html</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>Nginxé™æ€æ–‡ä»¶ç¼“å­˜é…ç½®</title>
    <url>//post/64307.html</url>
    <content><![CDATA[<p><a href="https://www.jianshu.com/p/aed6b5204225" target="_blank" rel="noopener">https://www.jianshu.com/p/aed6b5204225</a></p><h1 id="Nginxå­¦ä¹ ä¹‹é™æ€æ–‡ä»¶æœåŠ¡å™¨é…ç½®"><a href="#Nginxå­¦ä¹ ä¹‹é™æ€æ–‡ä»¶æœåŠ¡å™¨é…ç½®" class="headerlink" title="Nginxå­¦ä¹ ä¹‹é™æ€æ–‡ä»¶æœåŠ¡å™¨é…ç½®"></a>Nginxå­¦ä¹ ä¹‹é™æ€æ–‡ä»¶æœåŠ¡å™¨é…ç½®</h1><a id="more"></a>
<p><a href="https://blog.52itstyle.vip/archives/2389/" target="_blank" rel="noopener">https://blog.52itstyle.vip/archives/2389/</a></p>
<p>nginx ç¼“å­˜æœºåˆ¶<br><a href="https://www.cnblogs.com/jun1019/p/6260662.html" target="_blank" rel="noopener">https://www.cnblogs.com/jun1019/p/6260662.html</a><br>Nginxä¹‹é¡µé¢ç¼“å­˜<br><a href="http://blog.csdn.net/w1014074794/article/details/51893766" target="_blank" rel="noopener">http://blog.csdn.net/w1014074794/article/details/51893766</a><br>nginxé™æ€èµ„æºç¼“å­˜ç­–ç•¥é…ç½®<br><a href="http://blog.csdn.net/yu12377/article/details/77875045" target="_blank" rel="noopener">http://blog.csdn.net/yu12377/article/details/77875045</a><br>nginxé™æ€æ–‡ä»¶ç¼“å­˜çš„è§£å†³æ–¹æ¡ˆ<br><a href="http://www.cnblogs.com/wangzhisdu/p/7771069.html" target="_blank" rel="noopener">http://www.cnblogs.com/wangzhisdu/p/7771069.html</a><br>Nginxç¼“å­˜åŸç†åŠé…ç½®<br><a href="http://blog.csdn.net/wangjianno2/article/details/75201020" target="_blank" rel="noopener">http://blog.csdn.net/wangjianno2/article/details/75201020</a></p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€ŒåŒ—äº¬Javaé’å¹´ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/Amen_Wu/article/details/79454455" target="_blank" rel="noopener">https://blog.csdn.net/Amen_Wu/article/details/79454455</a></p>
<p><a href="https://www.cnblogs.com/jun1019/p/6260662.html" target="_blank" rel="noopener">https://www.cnblogs.com/jun1019/p/6260662.html</a></p>
<p><a href="https://juejin.im/post/5af38e0c518825670c45ef6e" target="_blank" rel="noopener">https://juejin.im/post/5af38e0c518825670c45ef6e</a></p>
<p><strong>è¯´ä¸‹root å’Œ aliasçš„åŒºåˆ«ï¼š</strong> </p>
<p><a href="https://www.jianshu.com/p/aed6b5204225" target="_blank" rel="noopener">https://www.jianshu.com/p/aed6b5204225</a></p>
]]></content>
  </entry>
  <entry>
    <title>Redisä½¿ç”¨ç¬”è®°</title>
    <url>//post/32112.html</url>
    <content><![CDATA[<p>å‘½ä»¤è¯¦è§£</p><p><a href="https://cloud.tencent.com/developer/article/1151834" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1151834</a></p>]]></content>
      <categories>
        <category>Redis</category>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>Flask-Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Pyhton+MongoDBå®ç°CRUD</title>
    <url>//post/50599.html</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF-8 -*-#!/usr/bin/python"""@File    : mongodb.py@Time    : 2019/10/20 15:16@Author  : iBoy@Email   : iboy@iboy.tech@Software: PyCharm"""import pymongo# MONGO_URL = 'localhost'# MONGO_DB = 'taobao'# MONGO_TABLE = 'product'## client = pymongo.MongoClient(MONGO_URL)   # åˆ›å»ºä¸€ä¸ªè¿æ¥å¯¹è±¡# db = client[MONGO_DB]# ç¬¬ä¸€æ­¥ï¼Œè¿æ¥MongoDBclient=pymongo.MongoClient('mongodb://127.0.0.1:27017/')# ã€€ã€€ç¬¬äºŒæ­¥ï¼Œé€‰æ‹©æ•°æ®åº“æˆ–é›†åˆ# ç¬¬äºŒæ­¥ï¼Œé€‰æ‹©æ•°æ®åº“æˆ–é›†åˆ# db = client['test']db = client.test# ç¬¬ä¸€æ­¥ï¼Œè¿æ¥MongoDB# é€‰æ‹©å¥½æ•°æ®åº“åæˆ‘ä»¬éœ€è¦æŒ‡å®šè¦æ“ä½œçš„é›†åˆï¼Œä¸æ•°æ®åº“çš„é€‰æ‹©ç±»ä¼¼ã€‚tb=db.persons# p = db.persons    # personsé›†åˆ# p = db['persons']# ã€€ã€€ç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ æ•°æ®person0=&#123;    'name':'æ¨è±ª',    'sex':'ç”·'&#125;person2 = &#123;    'id':'00001',    'name':'Abc',    'age':19&#125;person1 = &#123;    'id':'00002',    'name':'Dfg',    'age':20&#125;print(tb.insert_many([person0,person1,person2]))res = tb.find_one(&#123;'name':'Abc'&#125;)  # æŸ¥è¯¢ name ä¸º Abc çš„äººçš„ä¿¡æ¯ï¼Œè¿”å›å­—å…¸å‹çš„æ•°æ®print(res)res = tb.find(&#123;'age':19&#125;)  # æŸ¥è¯¢é›†åˆä¸­ageæ˜¯20çš„æ•°æ®# res = p.find(&#123;'age':&#123;'$gt':20&#125;&#125;)  # æŸ¥è¯¢é›†åˆä¸­ageå¤§äº20çš„æ•°æ®print(res)for r in res:    print(r)res = tb.find(&#123;'name':&#123;'$regex':'^A.*'&#125;&#125;)  # æŸ¥è¯¢é›†åˆä¸­nameä»¥Aå¼€å¤´çš„æ•°æ®print(res)#where = &#123;'name':'Abc'&#125;res = tb.find_one(where)res['age'] = 25result = tb.update(where,res)  # æ¨èä½¿ç”¨ update_one() æˆ– update_many()print(result)# ã€€ã€€æˆ‘ä»¬é€šè¿‡PyMongoåº“é‡Œçš„MongoClientã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•° host æ˜¯mongodbçš„åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç«¯å£ port ï¼ˆä¸ä¼ å‚æ•°çš„è¯é»˜è®¤æ˜¯27017ï¼‰ã€€result = tb.delete_one(&#123;'name':'Abc'&#125;)   # åˆ é™¤åç§°ä¸ºAbcçš„æ•°æ®ï¼Œæ¨èä½¿ç”¨ delete_one() å’Œ delete_many()ï¼Œæ‰§è¡Œåè°ƒç”¨ result.delete_count,è·å¾—åˆ é™¤çš„æ•°æ®æ¡æ•°print(result)# client = pymongo.MongoClient(host='127.0.0.1',port=27017)# ã€€ã€€å¦ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥ä¼ é€’MongoDBçš„è¿æ¥å­—ç¬¦ä¸²ï¼Œä»¥ mongodb å¼€å¤´ã€‚## client = pymongo.MongoClient('mongodb://127.0.0.1:27017/')# ã€€ã€€ç¬¬äºŒæ­¥ï¼Œé€‰æ‹©æ•°æ®åº“æˆ–é›†åˆ## ã€€ã€€åœ¨MongoDBä¸­å¯ä»¥å»ºç«‹å¤šä¸ªæ•°æ®åº“ï¼Œå…¶ä¸­æ¯ä¸ªæ•°æ®åº“åˆåŒ…å«è®¸å¤šé›†åˆï¼Œç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ã€‚é€‰æ‹©æ•°æ®åº“æœ‰ä¸¤ç§æ–¹æ³•ï¼Œè¿™ä¸¤ç§æ–¹æ³•ä½œç”¨ç›¸åŒã€‚## db = client.test    # testæ•°æ®åº“# db = client['test']# ã€€ã€€é€‰æ‹©å¥½æ•°æ®åº“åæˆ‘ä»¬éœ€è¦æŒ‡å®šè¦æ“ä½œçš„é›†åˆï¼Œä¸æ•°æ®åº“çš„é€‰æ‹©ç±»ä¼¼ã€‚## p = db.persons    # personsé›†åˆ# p = db['persons']# ã€€ã€€ç¬¬ä¸‰æ­¥ï¼Œæ·»åŠ æ•°æ®## å¤åˆ¶ä»£ç # person = &#123;#     'id':'00001',#     'name':'Abc',#     'age':19# &#125;# result = p.insert(person)# # åœ¨PyMongo 3.xç‰ˆæœ¬åï¼Œå®˜æ–¹æ¨èä½¿ç”¨insert_one(),è¯¥æ–¹æ³•è¿”å›çš„ä¸å†æ˜¯å•çº¯çš„_idå€¼ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œresult.inserted_idæŸ¥çœ‹ _id å€¼# print(result)</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>Roseç”»å›¾</title>
    <url>//post/undefined.html</url>
    <content><![CDATA[<p>1ã€BCE    (è¾¹ç•Œç±»ã€æ§åˆ¶ç±»ã€å®ä½“ç±»)</p><p>æ¦‚å¿µï¼š</p><p>â€‹    <a href="https://blog.csdn.net/u012372720/article/details/71171660" target="_blank" rel="noopener">https://blog.csdn.net/u012372720/article/details/71171660</a></p><a id="more"></a>


<p>â€‹    <a href="https://www.cnblogs.com/dandanlovehamhamzo/p/4967980.html" target="_blank" rel="noopener">https://www.cnblogs.com/dandanlovehamhamzo/p/4967980.html</a></p>
<p>ç”»æ³•ï¼š<a href="https://blog.csdn.net/qq_41937388/article/details/103695719" target="_blank" rel="noopener">https://blog.csdn.net/qq_41937388/article/details/103695719</a></p>
<p>2ã€æ—¶åºå›¾</p>
<p><a href="https://blog.csdn.net/yinbucheng/article/details/65631301" target="_blank" rel="noopener">https://blog.csdn.net/yinbucheng/article/details/65631301</a></p>
]]></content>
  </entry>
  <entry>
    <title>ScrapyåŸºæœ¬ä½¿ç”¨</title>
    <url>//post/47501.html</url>
    <content><![CDATA[<h1 id="1ã€cssé€‰æ‹©å™¨"><a href="#1ã€cssé€‰æ‹©å™¨" class="headerlink" title="1ã€cssé€‰æ‹©å™¨"></a>1ã€cssé€‰æ‹©å™¨</h1><p><img src="https://upload-images.jianshu.io/upload_images/15317419-0e56fc83d895cf1c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1080/format/webp" alt="img"></p>]]></content>
      <tags>
        <tag>çˆ¬è™«</tag>
        <tag>Scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„æ—¶é—´å¤„ç†</title>
    <url>//post/22974.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å­—ç¬¦ä¸²è½¬æ¢æˆdatetimeå¯¹è±¡</span><br><span class="line"></span><br><span class="line">from datetime import datetime # å¯¼å…¥datetimeæ¨¡å—</span><br><span class="line">value &#x3D; &#39;2017&#x2F;10&#x2F;7&#39;</span><br><span class="line">datetime.strptime(value, &#39;%Y&#x2F;%m&#x2F;%d&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">datetimeå¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">from datetime import datetime # å¯¼å…¥datetimeæ¨¡å—</span><br><span class="line">stamp &#x3D; datetime(2017, 10, 7) # ç”Ÿæˆä¸€ä¸ªdatetimeå¯¹è±¡</span><br><span class="line">str(stamp) # è½¬æ¢  #ç»“æœæ˜¾ç¤ºï¼š&#39;2017-10-07 00:00:00&#39;</span><br><span class="line"></span><br><span class="line">from datetime import datetime # å¯¼å…¥datetime</span><br><span class="line">datetime.datetimeè½¬åŒ–æˆå­—ç¬¦ä¸²</span><br><span class="line">create_time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>TinyDBä½¿ç”¨</title>
    <url>//post/61034.html</url>
    <content><![CDATA[<p><a href="https://www.cnblogs.com/watalo/p/12343260.html" target="_blank" rel="noopener">https://www.cnblogs.com/watalo/p/12343260.html</a></p>]]></content>
  </entry>
  <entry>
    <title>Macå®‰è£…å’Œç ´è§£æ¿€æ´»Charles</title>
    <url>//post/49742.html</url>
    <content><![CDATA[<h2 id="charlesçš„ä¸‹è½½å®‰è£…"><a href="#charlesçš„ä¸‹è½½å®‰è£…" class="headerlink" title="charlesçš„ä¸‹è½½å®‰è£…"></a>charlesçš„ä¸‹è½½å®‰è£…</h2><ul>
<li>å®˜ç½‘ä¸‹è½½åœ°å€ï¼š<a href="https://www.charlesproxy.com/latest-release/download.do" target="_blank" rel="noopener">https://www.charlesproxy.com/latest-release/download.do</a></li>
<li>å®‰è£…å¾ˆç®€å•ï¼Œä¸€ç›´ä¸‹ä¸€æ­¥å³å¯</li>
</ul><a id="more"></a>
<h2 id="ç ´è§£"><a href="#ç ´è§£" class="headerlink" title="ç ´è§£"></a>ç ´è§£</h2><ul>
<li><a href="http://www.charles.ren/" target="_blank" rel="noopener">http://www.charles.ren</a></li>
<li>è¿›å…¥ä¸Šé¢çš„ç½‘ç«™ï¼Œéšæ„è¾“å…¥ä¸€ä¸ªRegistered Nameï¼Œç‚¹å‡»ã€Œç”Ÿæˆã€</li>
<li>æ‰“å¼€charles-help-registerï¼Œè¾“å…¥åˆšåˆšç”Ÿæˆçš„ï¼Œç„¶åå°±æ¿€æ´»æˆåŠŸå•¦</li>
</ul>
]]></content>
      <tags>
        <tag>æŠ“åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Trojanä½¿ç”¨è®°å½•</title>
    <url>//post/50747.html</url>
    <content><![CDATA[<h3 id="é¡¹ç›®ä¸»é¡µ"><a href="#é¡¹ç›®ä¸»é¡µ" class="headerlink" title="é¡¹ç›®ä¸»é¡µ"></a>é¡¹ç›®ä¸»é¡µ</h3><p><a href="https://github.com/trojan-gfw/trojan/releases" target="_blank" rel="noopener">https://github.com/trojan-gfw/trojan/releases</a></p><p>æ­é…æµè§ˆå™¨æ’ä»¶</p><a id="more"></a>

<p><a href="https://blog.csdn.net/shanghaibao123/article/details/44154489" target="_blank" rel="noopener">https://blog.csdn.net/shanghaibao123/article/details/44154489</a></p>
<p>æ­é…v2rayNå®ç°å»å…¨å±€ä»£ç†</p>
<p>v2rayN</p>
<p>Windowså®¢æˆ·ç«¯<a href="https://www.v2rayssr.com/winv2ray.html" target="_blank" rel="noopener">https://www.v2rayssr.com/winv2ray.html</a> </p>
<p>Androidå®¢æˆ·ç«¯ <a href="https://www.v2rayssr.com/v2rayandroid.html" target="_blank" rel="noopener">https://www.v2rayssr.com/v2rayandroid.html</a></p>
]]></content>
      <categories>
        <category>ç§‘å­¦ä¸Šç½‘</category>
      </categories>
      <tags>
        <tag>Trojan</tag>
        <tag>ç§‘å­¦ä¸Šç½‘</tag>
      </tags>
  </entry>
  <entry>
    <title>Rcloneä½¿ç”¨</title>
    <url>//post/61905.html</url>
    <content><![CDATA[<p>1ã€å®‰è£…</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-12-16-centos backup]# rclone --version</span><br><span class="line">rclone v1.62.2</span><br><span class="line">- os/version: centos 7.6.1810 (64 bit)</span><br><span class="line">- os/kernel: 3.10.0-1160.71.1.el7.x86_64 (x86_64)</span><br><span class="line">- os/type: linux</span><br><span class="line">- os/arch: amd64</span><br><span class="line">- go/version: go1.20.2</span><br><span class="line">- go/linking: static</span><br><span class="line">- go/tags: none</span><br><span class="line"></span><br><span class="line">curl https://rclone.org/install.sh | sudo bash</span><br></pre></td></tr></table></figure><a id="more"></a>


<p>2ã€é…ç½® Webdav</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">vim /root/~/.config/rclone/rclone.conf</span><br><span class="line"></span><br><span class="line"><span class="section">[webdav]</span></span><br><span class="line"><span class="attr">type</span> = webdav</span><br><span class="line"><span class="attr">url</span> =</span><br><span class="line"><span class="attr">vendor</span> = other</span><br><span class="line"><span class="attr">user</span> = admin</span><br><span class="line"><span class="attr">pass</span> =</span><br></pre></td></tr></table></figure>

<p>3ã€æŒ‚è½½æœ¬åœ°å¹¶é…ç½®å¼€æœºè‡ªå¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/systemd/system/rclone.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Rclone</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/usr/bin/rclone mount webdav:/backup /backup --cache-dir /tmp --allow-other --allow-non-empty --vfs-cache-mode writes --no-check-certificate</span><br><span class="line">Restart=on-abort</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl enable rclone</span><br><span class="line"></span><br><span class="line">systemctl status rclone</span><br></pre></td></tr></table></figure>

<p>4ã€åŒæ­¥ç›®å½•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rclone -P --ignore-existing -u -v -P --transfers=10 --ignore-errors --buffer-size=200M --check-first --checkers=10 sync ./backup/ webdav:/backup</span><br></pre></td></tr></table></figure>

<p>5ã€è§£é™¤æŒ‚è½½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fusermount -zu /backup</span><br></pre></td></tr></table></figure>

<p>6ã€ä¸Šä¼ æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rclone --ignore-existing --use-server-modtime    -P --transfers=10  --drive-chunk-size 10M --fast-list  --buffer-size=100M --multi-thread-streams 0  copy --check-first --checkers=10  --retries 2 --log-file rclone.log   --log-level INFO --timeout 6h  --contimeout 6h /backup/$(date +%F)/data.tar.gz webdav:/hkbak/$(date +%F)/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rclone --ignore-existing --use-server-modtime   -P --transfers=10  --drive-chunk-size 10M --fast-list  --buffer-size=100M --multi-thread-streams 0  copy --check-first --checkers=10  --retries 2  --log-level INFO --timeout 6h  --contimeout 6h /backup/$(date +%F) webdav:/hkbak/$(date +%F)</span><br><span class="line"></span><br><span class="line">rclone --ignore-existing --use-server-modtime  -P --transfers=10  --drive-chunk-size 10M --fast-list  --buffer-size=10M --multi-thread-streams 0  copy --check-first --checkers=10  --retries 2 --log-file rclone.log   --log-level DEBUG --timeout 6h  --contimeout 6h /backup/$(date +%F) webdav:/ctguswzl/$(date +%F)</span><br></pre></td></tr></table></figure>

<p>7ã€é”™è¯¯</p>
<p>2023/04/17 15:33:43 Failed to copy: Locked: 423 Locked</p>
<p>rclone delete 00fusheng: â€“include-from /mnt/yingmeiju.txt -v -P </p>
<p>rclone  â€“ignore-checksum  â€“ignore-size â€“ignore-existing â€“use-server-modtime  -P â€“transfers=2  â€“drive-chunk-size 10M  â€“fast-list  â€“buffer-size=32M â€“multi-thread-streams 0  copy â€“check-first â€“checkers=10  â€“retries 10 â€“low-level-retries 1000 â€“log-file /backup/$(date +%F)/rclone.log   â€“log-level DEBUG â€“timeout 24h  â€“contimeout 24h â€“tpslimit 10  /backup/$(date +%F) webdav:/hkbak/$(date +%F)</p>
<p>rclone â€“ignore-existing â€“use-server-modtime -P â€“transfers=10 â€“drive-chunk-size 10M â€“fast-list  â€“buffer-size=100M â€“multi-thread-streams 0  â€“retries 30  â€“log-file /backup/$(date +%F)/rclone.log   â€“log-level DEBUG  â€“timeout 12h  â€“contimeout 12h  /backup/$(date +%F) webdav:/hkbak/$(date +%F)</p>
<p>curl -s -H â€˜Authorization:Basic ZWxhc3RpYzpja3ZAMjAyMA==â€™ -H â€˜Content-Type:application/jsonâ€™ -XGET â€˜<a href="http://9.150.197.156:9200/alarm_store2023-04-17/_search&#39;" target="_blank" rel="noopener">http://9.150.197.156:9200/alarm_store2023-04-17/_search&#39;</a> -d â€˜{â€œsizeâ€:100,â€queryâ€:{â€œboolâ€:{â€œmustâ€:[{â€œtermsâ€:{â€œalarm_typeâ€:[â€œbid_capacity_fullâ€,â€bid_capacity_overloadâ€,â€bid_have_fatal_errcodeâ€,â€bid_availability_very_lowâ€]}},{â€œtermsâ€:{â€œregionâ€:[â€œmusicszâ€,â€musicshâ€]}}]}}}â€™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> find /data/ -type d -exec chmod 755 &#123;&#125; \;</span><br><span class="line">  find /data/ -type f -exec chmod 644 &#123;&#125; \;</span><br><span class="line">find . -name '*.sh' -type f -exec chmod +x &#123;&#125; \;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Rclone</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity3Däººç‰©æ¨¡å‹å’ŒåŠ¨ä½œ</title>
    <url>//post/54234.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unity3Däººç‰©æ¨¡å‹å’ŒåŠ¨ä½œ</span><br><span class="line">ã€é“¾æ¥ï¼šhttps:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1wtjWZvXET1cjLi3z8UohEQ å¯†ç ï¼š6dy5ã€‘-æ¨¡å‹-ã€æ¸¸æˆè›®ç‰›ã€‘-arå¢å¼ºç°å®,è™šæ‹Ÿç°å®,unity3d,unity3dæ•™ç¨‹ä¸‹è½½é¦–é€‰u3d,unity3då®˜ç½‘</span><br><span class="line">|- unity3dè§’è‰² elitetrooper å¸¦åŠ¨ä½œ CSè§’è‰² - 0 B</span><br><span class="line"></span><br><span class="line">|- unity3dè§’è‰² ArcherWithHorse éª‘å£«å¸¦åŠ¨ç”»Archer WithHorse - 0 B</span><br><span class="line"></span><br><span class="line">|- unity3d æ¸¸æˆäººç‰©æ¨¡å‹ é‡è›®äºº Barbarianï¼ˆå¸¦19åŠ¨ä½œåŠ¨ç”»ï¼‰ - 0 B</span><br><span class="line"></span><br><span class="line">|- unity3d æ¸¸æˆäººç‰©æ¨¡å‹ Ubrin Character Costumization RPG è§’è‰²æ¨¡å‹æ¢è£… - 0 B</span><br><span class="line"></span><br><span class="line">|- unity3d æ¸¸æˆäººç‰©æ¨¡å‹ Thief Fantasy Character - 0 B</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Unity</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä¸­æ–°å»ºè¶…çº§ç®¡ç†å‘˜</title>
    <url>//post/58909.html</url>
    <content><![CDATA[<p>åˆ›å»ºè¶…çº§ç®¡ç†å‘˜è´¦æˆ·</p><p>useradd -o -u 0 -g 0 -M -d /root -s /bin/bash admin</p><a id="more"></a>

<p>passwd admin</p>
<p>åˆ é™¤ç”¨æˆ·</p>
<p>userdel -r admin</p>
<p>æŸ¥çœ‹ç³»ç»Ÿçš„ç®¡ç†å‘˜</p>
<p>vim /etc/passwd </p>
<p>cat /etc/passwd </p>
<p>cat /dev/null &gt; ~/.bash_history &amp;&amp; history -c &amp;&amp; exit</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>.gitignoreä½¿ç”¨è®°å½•</title>
    <url>//post/29976.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨.gitignoreæ–‡ä»¶åˆ é™¤æ‰å·²ç»æäº¤çš„æ–‡ä»¶</span><br><span class="line">Â </span><br><span class="line">é¡ºåºä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span><br><span class="line"></span><br><span class="line">First commit any outstanding code changes, and then, run this command:</span><br><span class="line"></span><br><span class="line">git rm -r --cached .</span><br><span class="line">This removes any changed files from theÂ index(staging area), then just run:</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line">Commit it:</span><br><span class="line"></span><br><span class="line">git commit -m &quot;.gitignore is now working&quot;</span><br><span class="line">æœ€åæäº¤åˆ°è¿œç¨‹ä»“åº“ï¼Œä¼šå‘ç°.gitignoreæ–‡ä»¶èµ·ä½œç”¨äº†ã€‚</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Gitä¸GitHubçš„ä½¿ç”¨</title>
    <url>//post/22555.html</url>
    <content><![CDATA[<blockquote>
<p>gitçœŸçš„æ˜¯ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„ä¸€ä¸ªå·¥å…·ï¼Œéå¸¸å€¼å¾—å­¦ä¹ ï¼Œè€Œä¸”æ­é…githubä½¿ç”¨æˆ–è€…æ˜¯å¤šäººé¡¹ç›®çš„å¼€å‘ï¼ŒçœŸçš„æ˜¯å¾ˆç‰›xã€‚</p>
</blockquote><a id="more"></a>
<h1 id="åˆ†å¸ƒå¼ä¸é›†ä¸­å¼"><a href="#åˆ†å¸ƒå¼ä¸é›†ä¸­å¼" class="headerlink" title="åˆ†å¸ƒå¼ä¸é›†ä¸­å¼"></a>åˆ†å¸ƒå¼ä¸é›†ä¸­å¼</h1><p>å­¦ä¹ ä¹‹å‰äº†è§£ä¸€ä¸‹åˆ†å¸ƒå¼ä¸é›†ä¸­å¼<br>å‡å¦‚æˆ‘ä»¬è¦åŠä¸€ä»¶äº‹,ä¸€ä¸ªäººåŒ…æ½å°±æ˜¯é›†ä¸­å¼ï¼Œä¸€ä»¶äº‹åˆ†æˆå‡ ä¸ªéƒ¨åˆ†åˆ†æˆå‡ ä¸ªäººåšå°±æ˜¯åˆ†å¸ƒå¼ï¼ŒäºŒè€…æœ€å–å¾—çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚<br>æ¯”å¦‚ä¸€ä¸ªjavawebçš„é¡¹ç›®,æˆ‘ä»¬æŠŠå®ƒç®€å•çš„åˆ†æˆwebé¡µé¢æœåŠ¡:æ•°æ®åº“æœåŠ¡ï¼ŒserviceæœåŠ¡ã€‚</p>
<blockquote>
<p>é›†ä¸­å¼: æˆ‘ä»¬å°†å®ƒéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœæœåŠ¡å™¨å‡ºäº†é—®é¢˜ï¼Œè¿™ä¸ªç½‘ç«™å°±å´©äº†ã€‚</p>
</blockquote>
<blockquote>
<p>åˆ†å¸ƒå¼: ä¸Šé¢çš„ä¸‰ä¸ªï¼Œæˆ‘ä»¬ç”¨ç‹¬ç«‹æœåŠ¡å™¨æ”¾ï¼ŒåŒä¸€ç±»æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¤šä¸ªæœåŠ¡å™¨ç»„æˆï¼Œå³ä½¿ä¸€ä¸ªå´©äº†ï¼Œè¿˜æœ‰å…¶ä»–çš„æœåŠ¡å™¨é¡¶ç€ã€‚</p>
</blockquote>
<p>é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶: ç‰ˆæœ¬åº“å­˜æ”¾åœ¨ä¸­å¤®æœåŠ¡å™¨ï¼Œæ¯æ¬¡å·¥ä½œéƒ½è¦ä»ä¸­å¤®æœåŠ¡å™¨å–å‡ºæœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¿®æ”¹ä»¥åå†æäº¤ä¸Šå»ï¼Œä¸€æ—¦æœåŠ¡å™¨å´©äº†ï¼Œæˆ–è€…æ²¡ç½‘äº†ï¼Œå·¥ä½œæ— æ³•æ‰§è¡Œã€‚<br>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶: æ²¡æœ‰ä¸­å¤®æœåŠ¡å™¨ï¼Œæ¯ä¸ªäººçš„ç”µè„‘ä¸Šéƒ½æœ‰ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œæ¯æ¬¡å·¥ä½œå®Œä»¥ååªè¦å°†æ¯æ¬¡çš„ä¿®æ”¹æäº¤ç»™å¯¹æ–¹å°±è¡Œäº†ã€‚</p>
<h1 id="gitçš„ä½¿ç”¨"><a href="#gitçš„ä½¿ç”¨" class="headerlink" title="gitçš„ä½¿ç”¨"></a>gitçš„ä½¿ç”¨</h1><h2 id="gitä½¿ç”¨å‰çš„æœ€å°é…ç½®"><a href="#gitä½¿ç”¨å‰çš„æœ€å°é…ç½®" class="headerlink" title="gitä½¿ç”¨å‰çš„æœ€å°é…ç½®"></a>gitä½¿ç”¨å‰çš„æœ€å°é…ç½®</h2><blockquote>
<p>git config â€“global user.name â€˜your_nameâ€™<br>git config â€“global user.email â€˜your_email@domain.comâ€™<br>ç¼ºçœç­‰åŒäºlocal</p>
</blockquote>
<ul>
<li>git config â€“local        localåªå¯¹æŸä¸ªä»“åº“æœ‰æ•ˆ</li>
<li>git config â€“global       globalå¯¹å½“å‰ç”¨æˆ·çš„æ‰€æœ‰ä»“åº“æœ‰æ•ˆ</li>
<li>git config â€“system       systemå¯¹ç³»ç»Ÿæ‰€æœ‰ç™»å½•çš„ç”¨æˆ·æœ‰æ•ˆ</li>
</ul>
<blockquote>
<p>åœ¨å½“å‰ä»“åº“ä¸­ï¼Œå¦‚æœè®¾ç½®äº†localçš„è¯ï¼Œlocalä¼˜å…ˆçº§è¦é«˜ï¼ŒsystemæŒ‡ä»¤ç”¨ä¸ä¸Š</p>
</blockquote>
<p>æŸ¥çœ‹ä¸€äº›é…ç½®ä¿¡æ¯ï¼š</p>
<ul>
<li>git config â€“list â€“local     åªåœ¨æŸä¸€ä¸ªä»“åº“æœ‰æ•ˆ</li>
<li>git config â€“list â€“global    æ‰€æœ‰ä»“åº“æœ‰æ•ˆ</li>
<li>git config â€“list â€“system</li>
</ul>
<h2 id="äº†è§£å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œå†å²ç‰ˆæœ¬åº“"><a href="#äº†è§£å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œå†å²ç‰ˆæœ¬åº“" class="headerlink" title="äº†è§£å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œå†å²ç‰ˆæœ¬åº“"></a>äº†è§£å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œå†å²ç‰ˆæœ¬åº“</h2><p><img src="/static/img/git-github/%E4%B8%89%E4%B8%AA%E5%88%86%E5%8C%BA.png" alt="åˆ†åŒº"></p>
<h3 id="gitæ˜¯å¦‚ä½•ä¿å­˜æ•°æ®çš„"><a href="#gitæ˜¯å¦‚ä½•ä¿å­˜æ•°æ®çš„" class="headerlink" title="gitæ˜¯å¦‚ä½•ä¿å­˜æ•°æ®çš„"></a>gitæ˜¯å¦‚ä½•ä¿å­˜æ•°æ®çš„</h3><p>gitå­˜å‚¨æ–‡ä»¶çš„æ–¹å¼ä¸æ˜¯å­˜å‚¨æ–‡ä»¶çš„å˜åŒ–æˆ–è€…å·®å¼‚ï¼Œä»–å­˜å‚¨çš„æ˜¯ä¸€ç³»åˆ—ä¸åŒæ—¶åˆ»æ–‡ä»¶çš„ <strong>å¿«ç…§</strong> .ä¾‹å¦‚ï¼Œæ¯æ¬¡ä½ æ‰§è¡Œ <kbd>git add</kbd> æˆ–è€… <kbd>git commmit</kbd> æ“ä½œï¼Œå°±ä¼šå°†æ–‡ä»¶å‹ç¼©æˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªGitå¯¹è±¡ï¼Œå­˜åœ¨äº ==.git/objects== ç›®å½•ä¸‹ã€‚æ–‡ä»¶çš„åå­—æ˜¯ç”¨SHA1ç®—æ³•è®¡ç®—çš„ä¸€ä¸ªhashå€¼(é•¿åº¦40çš„å­—ç¬¦ä¸²)ï¼Œ ==.git/objects== ä¸‹æˆä¸€ä¸ªå­ç›®å½•ï¼Œå‰ä¸¤ä¸ªå­—ç¬¦æ˜¯å­ç›®å½•åï¼Œå38ä½æ˜¯æ–‡ä»¶åã€‚</p>
<h2 id="gitæ–‡ä»¶"><a href="#gitæ–‡ä»¶" class="headerlink" title=".gitæ–‡ä»¶"></a>.gitæ–‡ä»¶</h2><p>ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶:</p>
<blockquote>
<p>refs/ </p>
<blockquote>
<p>heads    -åˆ†æ”¯       (ä¾‹å¦‚ï¼šå‰ç«¯åˆ†æ”¯ï¼Œåç«¯åˆ†æ”¯ï¼Œä¸¤è€…äº’ä¸å½±å“)<br>tags       -é‡Œç¨‹ç¢‘     (æ ‡ç­¾)</p>
</blockquote>
<p>HEAD      - æŸ¥çœ‹å½“å‰ä»“åº“åœ¨å“ªä¸ªåˆ†æ”¯ä¸Š<br>conig     - ä»“åº“ä¿¡æ¯<br>objects   - å­˜å‚¨æ¯æ¬¡æ“ä½œçš„äºŒè¿›åˆ¶æ–‡ä»¶</p>
</blockquote>
<h2 id="gitä¸­æ–‡ä»¶çš„å‡ ç§çŠ¶æ€"><a href="#gitä¸­æ–‡ä»¶çš„å‡ ç§çŠ¶æ€" class="headerlink" title="gitä¸­æ–‡ä»¶çš„å‡ ç§çŠ¶æ€"></a>gitä¸­æ–‡ä»¶çš„å‡ ç§çŠ¶æ€</h2><blockquote>
<p>Untracked:   æœªè·Ÿè¸ª, æ­¤æ–‡ä»¶åœ¨æ–‡ä»¶å¤¹ä¸­, ä½†å¹¶æ²¡æœ‰åŠ å…¥åˆ°gitåº“, ä¸å‚ä¸ç‰ˆæœ¬æ§åˆ¶. é€šè¿‡<kbd>git add</kbd> çŠ¶æ€å˜ä¸ºStaged.</p>
</blockquote>
<blockquote>
<p>Unmodify: æ–‡ä»¶å·²ç»å…¥åº“, æœªä¿®æ”¹, å³ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶å¿«ç…§å†…å®¹ä¸æ–‡ä»¶å¤¹ä¸­å®Œå…¨ä¸€è‡´. è¿™ç§ç±»å‹çš„æ–‡ä»¶æœ‰ä¸¤ç§å»å¤„, å¦‚æœå®ƒè¢«ä¿®æ”¹, è€Œå˜ä¸ºModified.</p>
</blockquote>
<blockquote>
<p>Modified: æ–‡ä»¶å·²ä¿®æ”¹, ä»…ä»…æ˜¯ä¿®æ”¹, å¹¶æ²¡æœ‰è¿›è¡Œå…¶ä»–çš„æ“ä½œ. è¿™ä¸ªæ–‡ä»¶ä¹Ÿæœ‰ä¸¤ä¸ªå»å¤„, é€šè¿‡git addå¯è¿›å…¥æš‚å­˜stagedçŠ¶æ€, ä½¿ç”¨<kbd>git checkout</kbd> åˆ™ä¸¢å¼ƒä¿®æ”¹è¿‡,è¿”å›åˆ°unmodifyçŠ¶æ€, è¿™ä¸ª<kbd>git checkout</kbd>å³ä»åº“ä¸­å–å‡ºæ–‡ä»¶, è¦†ç›–å½“å‰ä¿®æ”¹</p>
</blockquote>
<blockquote>
<p>Staged: æš‚å­˜çŠ¶æ€. æ‰§è¡Œ<kbd>git commit</kbd>åˆ™å°†ä¿®æ”¹åŒæ­¥åˆ°åº“ä¸­, è¿™æ—¶åº“ä¸­çš„æ–‡ä»¶å’Œæœ¬åœ°æ–‡ä»¶åˆå˜ä¸ºä¸€è‡´, æ–‡ä»¶ä¸ºUnmodifyçŠ¶æ€. æ‰§è¡Œ<kbd>git reset HEAD filename </kbd> å–æ¶ˆæš‚å­˜,æ–‡ä»¶çŠ¶æ€ä¸ºModified</p>
</blockquote>
<h2 id="gitçš„å¸¸ç”¨æ“ä½œ"><a href="#gitçš„å¸¸ç”¨æ“ä½œ" class="headerlink" title="gitçš„å¸¸ç”¨æ“ä½œ"></a>gitçš„å¸¸ç”¨æ“ä½œ</h2><h3 id="1-æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€"><a href="#1-æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€" class="headerlink" title="1. æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€"></a>1. æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>

<h3 id="2-å·¥ä½œåŒºæäº¤åˆ°æš‚å­˜åŒº"><a href="#2-å·¥ä½œåŒºæäº¤åˆ°æš‚å­˜åŒº" class="headerlink" title="2. å·¥ä½œåŒºæäº¤åˆ°æš‚å­˜åŒº"></a>2. å·¥ä½œåŒºæäº¤åˆ°æš‚å­˜åŒº</h3><p>å¯¹æš‚å­˜åŒºæ–‡ä»¶çš„ä¿®æ”¹ï¼šæ·»åŠ ï¼Œåˆ é™¤ï¼Œæ›´æ–°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git add &lt;file-name&gt;</span><br><span class="line">git add .                   //æäº¤æ‰€æœ‰æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">git add --ignore-removal    //ä¸æäº¤åˆ é™¤æ–‡ä»¶</span><br><span class="line">git add -u                  //ä¸æäº¤æ–°æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h3 id="3-æš‚å­˜åŒºæäº¤åˆ°ç‰ˆæœ¬åº“"><a href="#3-æš‚å­˜åŒºæäº¤åˆ°ç‰ˆæœ¬åº“" class="headerlink" title="3. æš‚å­˜åŒºæäº¤åˆ°ç‰ˆæœ¬åº“"></a>3. æš‚å­˜åŒºæäº¤åˆ°ç‰ˆæœ¬åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git commit -m <span class="string">'message'</span></span><br></pre></td></tr></table></figure>

<h3 id="4-æŸ¥çœ‹å†å²ç‰ˆæœ¬"><a href="#4-æŸ¥çœ‹å†å²ç‰ˆæœ¬" class="headerlink" title="4. æŸ¥çœ‹å†å²ç‰ˆæœ¬"></a>4. æŸ¥çœ‹å†å²ç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span>                             //æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬å†å²</span><br><span class="line">git <span class="built_in">log</span> &lt;branch-name&gt;               //æŸ¥çœ‹å½“å‰åˆ†æ”¯</span><br><span class="line">git <span class="built_in">log</span> --graph                     //ä»¥å›¾çš„å½¢å¼æŸ¥çœ‹ç‰ˆæœ¬å†å²</span><br><span class="line">git <span class="built_in">log</span> --oneline                   //çœç•¥ä¸€äº›ä¿¡æ¯ï¼Œä¸€æ¬¡commitåªå±•ç¤ºä¸€è¡Œ</span><br></pre></td></tr></table></figure>

<h3 id="5-æ¯”è¾ƒæ–‡ä»¶å·®å¼‚"><a href="#5-æ¯”è¾ƒæ–‡ä»¶å·®å¼‚" class="headerlink" title="5. æ¯”è¾ƒæ–‡ä»¶å·®å¼‚"></a>5. æ¯”è¾ƒæ–‡ä»¶å·®å¼‚</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git diff [--&lt;file-nameA&gt; [&lt;file-nameB&gt;]]                //æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒºå·®å¼‚ï¼ŒåŠ æ–‡ä»¶åå°±åªæ¯”è¾ƒæ–‡ä»¶(å¯ä»¥æ¯”å¤šä¸ª)çš„å·®å¼‚</span><br><span class="line"></span><br><span class="line">git diff -cached [--&lt;file-nameA&gt; [&lt;file-nameB&gt;]]        //æ¯”è¾ƒæš‚å­˜åŒºä¸headæŒ‡é’ˆæ‰€å«æ–‡ä»¶çš„å·®å¼‚</span><br></pre></td></tr></table></figure>

<h3 id="6-åˆ é™¤å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶"><a href="#6-åˆ é™¤å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶" class="headerlink" title="6. åˆ é™¤å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶"></a>6. åˆ é™¤å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git rm &lt;file-name&gt;</span><br></pre></td></tr></table></figure>


<h3 id="7-å·¥ä½œåŒºåŒæ­¥ä¸æš‚å­˜åŒºä¸€æ ·"><a href="#7-å·¥ä½œåŒºåŒæ­¥ä¸æš‚å­˜åŒºä¸€æ ·" class="headerlink" title="7. å·¥ä½œåŒºåŒæ­¥ä¸æš‚å­˜åŒºä¸€æ ·"></a>7. å·¥ä½œåŒºåŒæ­¥ä¸æš‚å­˜åŒºä¸€æ ·</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout -- &lt;file-nameA&gt; [file-nameB]</span><br><span class="line">git checkout -- *</span><br></pre></td></tr></table></figure>

<h3 id="8-æš‚å­˜åŒºåŒæ­¥ä¸å†å²ç‰ˆæœ¬åº“ä¸€æ ·"><a href="#8-æš‚å­˜åŒºåŒæ­¥ä¸å†å²ç‰ˆæœ¬åº“ä¸€æ ·" class="headerlink" title="8. æš‚å­˜åŒºåŒæ­¥ä¸å†å²ç‰ˆæœ¬åº“ä¸€æ ·"></a>8. æš‚å­˜åŒºåŒæ­¥ä¸å†å²ç‰ˆæœ¬åº“ä¸€æ ·</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset &lt;branch-name&gt;                     //åŒæ­¥åˆ°æŸä¸€ä¸ªåˆ†æ”¯</span><br><span class="line">git reset HEAD -- &lt;filenameA&gt; [filenameB]   //åŒæ­¥åˆ°æŸä¸€ä¸ªåˆ†æ”¯çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h3 id="9-ç‰ˆæœ¬å›æº¯"><a href="#9-ç‰ˆæœ¬å›æº¯" class="headerlink" title="9. ç‰ˆæœ¬å›æº¯"></a>9. ç‰ˆæœ¬å›æº¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset --soft &lt;commit-id&gt;</span><br><span class="line">git reset --hard &lt;commit-id&gt;</span><br></pre></td></tr></table></figure>
<table style="text-align:center">
   <tr>
      <td colspan="4"> git reset å½±å“èŒƒå›´</td>
   </tr>
   <tr>
      <td>æŒ‡ä»¤</td>
      <td>HEAD</td>
      <td>æš‚å­˜åŒº</td>
      <td>å·¥ä½œåŒº</td>
   </tr>
   <tr>
      <td>--soft</td>
      <td>æ˜¯</td>
      <td>å¦</td>
      <td>å¦</td>
   </tr>
   <tr>
      <td>--mixed</td>
      <td>æ˜¯</td>
      <td>æ˜¯</td>
      <td>å¦</td>
   </tr>
   <tr>
      <td>--hard</td>
      <td>æ˜¯</td>
      <td>æ˜¯</td>
      <td>æ˜¯</td>
   </tr>
</table>


<h3 id="10-åˆå¹¶åˆ†æ”¯"><a href="#10-åˆå¹¶åˆ†æ”¯" class="headerlink" title="10.  åˆå¹¶åˆ†æ”¯"></a>10.  åˆå¹¶åˆ†æ”¯</h3><p>â€“ åŸºäº <strong>merge</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git merge &lt;merge-nameA&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git merge --abort   //å¦‚æœä¸æƒ³åˆå¹¶ï¼Œæ­¤å‘½ä»¤ä¼šè¿”å›åˆå¹¶ä¹‹å‰çš„çŠ¶æ€</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>fast-forward(å¿«è¿›)ä¸non-fast-forward</strong><br>åˆ†æ”¯åˆå¹¶ï¼Œå…¶ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæ˜¯å¦å¤–ä¸€ä¸ªåˆ†æ”¯çš„çˆ¶åˆ†æ”¯ï¼Œå«åšfast-forwardï¼Œå¦åˆ™å°±æ˜¯non-fast-forward</p>
</blockquote>
<blockquote>
<p><a href="https://blog.csdn.net/u012937029/article/details/77161584" target="_blank" rel="noopener">mergeæ“ä½œ</a>ï¼šåˆ©ç”¨ä¸‰è·¯åˆå¹¶ç®—æ³•ï¼Œmergeç»“æœä¸æ—¶é—´å…ˆåæ— å…³ï¼Œå°±æ˜¯ä¸¤ä¸ªäººåˆ†æ”¯ä¼šæ‰¾åˆ°ä¸€ä¸ªåŸºå‡†Base(å†å²ç‰ˆæœ¬ä¸­çš„æŸä¸€æ¬¡commit,ç®€å•æƒ…å†µä¸‹å°±æ˜¯åˆ†æ”¯åˆ†å‰çš„ä½ç½®)ï¼Œå¦‚æœä¸¤ä¸ªæ–‡ä»¶ç›¸å¯¹äºBaseéƒ½ä¸ä¸€æ ·ï¼Œå°±ä¼šäº§ç”Ÿå†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³ã€‚æŸ¥çœ‹ä¸¤ä¸ªåˆ†æ”¯çš„Baseå‘½ä»¤ï¼š <strong>git merge-base &lt;merge-nameA&gt; &lt;merge-name-B&gt;</strong>ã€‚<a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E9%AB%98%E7%BA%A7%E5%90%88%E5%B9%B6#r_merge_log" target="_blank" rel="noopener">mergeä¹‹å‰çš„æ–‡ä»¶åœ¨mergeè¿‡ç¨‹ä¸­å¯ä»¥å¯¼å‡ºæŸ¥çœ‹</a>ã€‚</p>
</blockquote>
<p>â€“ åŸºäº <strong>rebase</strong>çš„å˜åŸºæ“ä½œ</p>
<blockquote>
<p>å°†ä¸€ä¸ªåˆ†æ”¯çš„ä¿®æ”¹ç§»åˆ°å¦å¤–ä¸€ä¸ªåˆ†æ”¯ä¸Šï¼Œå¥½åƒâ€é‡æ–°æ’­æ”¾â€ä¸€æ ·.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git rebase &lt;branchA&gt;        //ç›¸å½“äºåœ¨Båˆ†æ”¯ä¸Šï¼ŒæŠŠBæ•´åˆåˆ°Aä¸Šï¼ŒAï¼ŒBæœ€è¿‘çš„å…±åŒçˆ¶åˆ†æ”¯(å°±æ˜¯åˆ†å‰çš„ä½ç½®)å¾€åçš„Båˆ†æ”¯éƒ½ä¸è§äº†ï¼Œä¼šåœ¨Aåˆ†æ”¯åç”Ÿæˆä¸€æ®µæ–°çš„æäº¤ã€‚è¿™æ ·ï¼Œæäº¤å†å²å°±æ˜¯ä¸€æ¡å¹²å‡€çš„ç›´çº¿äº†ã€‚</span><br><span class="line"></span><br><span class="line">//å¦‚æœå‘ç”Ÿå†²çª</span><br><span class="line">git add .</span><br><span class="line">git rebase --<span class="built_in">continue</span></span><br></pre></td></tr></table></figure>
<p>æœ€å¥½æ˜¯åœ¨æäº¤åˆ°è¿œç¨‹ä»“åº“ä¹‹å‰ä¹‹å‰ï¼Œå°†è‡ªå·±çš„ç‰ˆæœ¬åº“è¿›è¡Œä¸€æ¬¡å˜åŸºæ“ä½œï¼Œå†å‘ä¸»é¡¹ç›®æäº¤ã€‚<br><strong>å˜åŸºæ“ä½œçš„å‡†åˆ™ï¼šä¸è¦å¯¹åœ¨ä½ çš„ä»“åº“å¤–æœ‰å‰¯æœ¬çš„åˆ†æ”¯æ‰§è¡Œå˜åŸºã€‚</strong></p>
<h3 id="11-ä¿®æ”¹å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶å"><a href="#11-ä¿®æ”¹å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶å" class="headerlink" title="11. ä¿®æ”¹å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶å"></a>11. ä¿®æ”¹å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶å</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git mv &lt;old-name&gt; &lt;new-name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="12-å…³äºåˆ†æ”¯çš„æ“ä½œ"><a href="#12-å…³äºåˆ†æ”¯çš„æ“ä½œ" class="headerlink" title="12. å…³äºåˆ†æ”¯çš„æ“ä½œ"></a>12. å…³äºåˆ†æ”¯çš„æ“ä½œ</h3><p>â€“ åˆ›å»ºåˆ†æ”¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git branch &lt;new-branch-name&gt;</span><br></pre></td></tr></table></figure>

<p>â€“ æŸ¥çœ‹åˆ†æ”¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git branch [-v]</span><br></pre></td></tr></table></figure>

<p>â€“ åˆ‡æ¢åˆ†æ”¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout &lt;branch-name&gt;</span><br></pre></td></tr></table></figure>

<p>â€“ åˆ é™¤åˆ†æ”¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git branch -d &lt;branch-name&gt;</span><br></pre></td></tr></table></figure>


<h3 id="13-å°†å¤šä¸ªcommitæ•´ç†æˆä¸€ä¸ªcommit"><a href="#13-å°†å¤šä¸ªcommitæ•´ç†æˆä¸€ä¸ªcommit" class="headerlink" title="13. å°†å¤šä¸ªcommitæ•´ç†æˆä¸€ä¸ªcommit"></a>13. å°†å¤šä¸ªcommitæ•´ç†æˆä¸€ä¸ªcommit</h3><p>â€“ ä¸è¿ç»­çš„commit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git rebase -i &lt;è¦æ•´åˆçš„æœ€æ—©çš„ä¸€ä¸ªcommit&gt;</span><br></pre></td></tr></table></figure>
<p>æ¼”ç¤ºï¼š<br>å…ˆçœ‹ä¸€æ®µç‰ˆæœ¬å†å²:<br><img src="/static/img/git-github/rebase%E7%89%88%E6%9C%AC%E5%8E%86%E5%8F%B2.png" alt="ç‰ˆæœ¬å†å²"><br>å®¹æ˜“çœ‹å‡ºç‰ˆæœ¬å·ä¸ºï¼š d09341c ï¼Œe3a6b32 ï¼Œ603e2b3 éƒ½æ˜¯å¯¹readme.mdçš„æ“ä½œï¼Œæˆ‘ä»¬æƒ³æ•´ç†æˆä¸€æ¬¡commitã€‚<br>å…ˆæ‰¾åˆ°è¦æ•´åˆçš„æœ€æ—©çš„commitçš„ç‰ˆæœ¬å· ä¸º 603e2b3<br>æ‰§è¡Œï¼š<kbd>git rebase -i 603e2b3<kbd><br>è¿›å…¥ç•Œé¢:<br><img src="/static/img/git-github/rebase%E7%89%88%E6%9C%AC%E7%BC%96%E8%BE%91.png" alt="ç‰ˆæœ¬å†å²"><br>ä¿®æ”¹åï¼š<br>æ³¨æ„çœ‹p,så‡ä¸ºç®€å†™ï¼Œä¸‹æ–¹æœ‰æ³¨é‡Š<br><img src="/static/img/git-github/%E4%BF%AE%E6%94%B9%E5%90%8E%E7%9A%84rebase%E7%BC%96%E8%BE%91.png" alt="ç‰ˆæœ¬å†å²"></kbd></kbd></p>
<p>é€€å‡ºåï¼Œæ‰§è¡Œ <kbd>git rebase --continue<kbd></kbd></kbd></p>
<p>è¿›å…¥ç•Œé¢ï¼š<br><img src="/static/img/git-github/rebase%E7%BC%96%E8%BE%91%E6%B3%A8%E9%87%8A%E5%89%8D.png" alt="ç‰ˆæœ¬å†å²"><br>æ·»åŠ æ³¨é‡Šï¼š<br><img src="/static/img/git-github/rebase%E7%BC%96%E8%BE%91%E6%B7%BB%E5%8A%A0%E6%B3%A8%E9%87%8A%E5%90%8E.png" alt="ç‰ˆæœ¬å†å²"></p>
<p>-- è¿ç»­çš„commit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git rebase -i &lt;æ•´åˆçš„æœ€æ—©çš„ä¸€ä¸ªcommit&gt;</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼ä¸Šæ–¹ï¼Œæ›´ç®€å•ã€‚</p>
<h3 id="14-æ¶ˆé™¤æœ€è¿‘çš„å‡ ä¸ªcommit"><a href="#14-æ¶ˆé™¤æœ€è¿‘çš„å‡ ä¸ªcommit" class="headerlink" title="14. æ¶ˆé™¤æœ€è¿‘çš„å‡ ä¸ªcommit"></a>14. æ¶ˆé™¤æœ€è¿‘çš„å‡ ä¸ªcommit</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset --hard &lt;commit-number&gt;        //å·¥ä½œåŒºå’Œæš‚å­˜åŒºéƒ½ä¼šæ¢å¤æˆæŒ‡å®šçš„commitç‰ˆæœ¬å·çš„å†…å®¹(æ…ç”¨)</span><br></pre></td></tr></table></figure>


<h3 id="15-å¼€å‘ä¸­å¦‚æœç´§æ€¥åŠ å¡æ€ä¹ˆå¤„ç†"><a href="#15-å¼€å‘ä¸­å¦‚æœç´§æ€¥åŠ å¡æ€ä¹ˆå¤„ç†" class="headerlink" title="15. å¼€å‘ä¸­å¦‚æœç´§æ€¥åŠ å¡æ€ä¹ˆå¤„ç†"></a>15. å¼€å‘ä¸­å¦‚æœç´§æ€¥åŠ å¡æ€ä¹ˆå¤„ç†</h3><p>git stashä¼šå°†æ­¤æ—¶å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„å†…å®¹å‹å…¥Gitçš„æ ˆä¸­ï¼Œå·¥ä½œåŒºå°±æ˜¯å¹²å‡€çš„äº†ï¼Œæ­¤æ—¶å·¥ä½œåŒºçš„å†…å®¹ä¼šå’Œä¸Šæ¬¡çš„commitå†…å®¹ä¸€æ ·ã€‚æ¥é¿å…ä¸€æ¬¡è„æäº¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git stash:                      //å¤‡ä»½å½“å‰çš„å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„å·²ç»è¢«trackçš„æ–‡ä»¶ï¼Œä¿å­˜åˆ°Gitæ ˆä¸­ã€‚ä»æœ€è¿‘çš„ä¸€æ¬¡æäº¤ä¸­è¯»å–ç›¸å…³å†…å®¹ï¼Œè®©å·¥ä½œåŒºä¿è¯å’Œä¸Šæ¬¡æäº¤</span><br><span class="line">git stash save <span class="string">"message"</span>        //åŒä¸Šå¹¶æ·»åŠ å¤‡æ³¨ä¿¡æ¯</span><br><span class="line">git stash list:                 //æ˜¾ç¤ºgitæ ˆå†…çš„æ‰€æœ‰å¤‡ä»½ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªåˆ—è¡¨æ¥å†³å®šä»é‚£ä¸ªåœ°æ–¹æ¢å¤ã€‚</span><br><span class="line">git stash pop stash@&#123;0&#125;         //ä»gitæ ˆä¸­è¯»å–å¹¶æ¢å¤å·¥ä½œåŒºï¼Œç„¶ååˆ é™¤å¯¹åº”çš„è®°å½•ï¼Œé»˜è®¤æ¢å¤æœ€æ–°çš„ï¼ˆstash@&#123;0&#125;ä¸ºæœ€æ–°ï¼‰</span><br><span class="line">git stash apply stash@&#123;0&#125;       //åŒgit stash popï¼Œä½†ä¸ä¼šåˆ é™¤å¯¹åº”çš„è®°å½•</span><br><span class="line">git stash clear                 //æ¸…ç©ºgitæ ˆã€‚æ­¤æ—¶ä½¿ç”¨gitgç­‰å›¾å½¢åŒ–å·¥å…·ä¼šå‘ç°ï¼ŒåŸæ¥stashçš„å“ªäº›èŠ‚ç‚¹éƒ½æ¶ˆå¤±äº†ã€‚</span><br></pre></td></tr></table></figure>


<h1 id="å¤šäººåä½œä»¥åŠGitHubçš„ä½¿ç”¨"><a href="#å¤šäººåä½œä»¥åŠGitHubçš„ä½¿ç”¨" class="headerlink" title="å¤šäººåä½œä»¥åŠGitHubçš„ä½¿ç”¨"></a>å¤šäººåä½œä»¥åŠGitHubçš„ä½¿ç”¨</h1><h2 id="gitå¤‡ä»½"><a href="#gitå¤‡ä»½" class="headerlink" title="gitå¤‡ä»½"></a>gitå¤‡ä»½</h2><p>å“‘åè®®ä¸æ™ºèƒ½åè®®<br>ç›´è§‚åŒºåˆ«ï¼šå“‘åè®®ä¼ è¾“è¿›åº¦ä¸å¯è§ï¼›æ™ºèƒ½åè®®ä¼ è¾“å¯è§<br>ä¼ è¾“é€Ÿåº¦ï¼šæ™ºèƒ½åè®®æ¯”å“‘åè®®ä¼ è¾“é€Ÿåº¦å¿«</p>
<table>
<thead>
<tr>
<th>å¸¸ç”¨åè®®</th>
<th>è¯­æ³•æ ¼å¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>æœ¬åœ°åè®®ï¼ˆ1ï¼‰</td>
<td>/d/Desktop/gitcommit/commit2/.git</td>
<td>å“‘åè®®</td>
</tr>
<tr>
<td>æœ¬åœ°åè®®ï¼ˆ2ï¼‰</td>
<td>file:///d/Desktop/gitcommit/commit2/.git</td>
<td>æ™ºèƒ½åè®®</td>
</tr>
<tr>
<td>http/httpsåè®®</td>
<td><a href="https://github.com/name/learngit.git" target="_blank" rel="noopener">https://github.com/name/learngit.git</a></td>
<td>å¹³æ—¶æ¥è§¦åˆ°çš„éƒ½æ˜¯æ™ºèƒ½åè®®</td>
</tr>
<tr>
<td>sshåè®®</td>
<td><a href="mailto:git@github.com">git@github.com</a>:name/learngit.git</td>
<td>å·¥ä½œä¸­æœ€å¸¸ç”¨çš„æ™ºèƒ½åè®®</td>
</tr>
</tbody></table>
<h2 id="å¤šäººåä½œ"><a href="#å¤šäººåä½œ" class="headerlink" title="å¤šäººåä½œ"></a>å¤šäººåä½œ</h2><h3 id="git-cloneçš„ä½¿ç”¨"><a href="#git-cloneçš„ä½¿ç”¨" class="headerlink" title="git cloneçš„ä½¿ç”¨"></a>git cloneçš„ä½¿ç”¨</h3><ul>
<li>git clone <ç‰ˆæœ¬åº“çš„ç½‘å€> [file-name]<br>å¦‚æœé™„å¸¦[file-name]ï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ªç›®å½•åå­—ä¸º[file-name]ï¼Œé»˜è®¤åˆ™ä¸ºç‰ˆæœ¬åº“çš„åå­—ã€‚(æ³¨æ„ç½‘å€åé¢æ˜¯é™„å¸¦.gitçš„)</ç‰ˆæœ¬åº“çš„ç½‘å€></li>
</ul>
<h3 id="git-remoteçš„ä½¿ç”¨"><a href="#git-remoteçš„ä½¿ç”¨" class="headerlink" title="git remoteçš„ä½¿ç”¨"></a>git remoteçš„ä½¿ç”¨</h3><ul>
<li>git remote [-v]<br>æŸ¥çœ‹è¿œç¨‹ä¸»æœº [ä¸ç½‘å€]</li>
<li>git remote add <ä¸»æœºå> <ç½‘å€><br>æ·»åŠ ä¸»æœº</ç½‘å€></ä¸»æœºå></li>
<li>git remote rename <åŸä¸»æœºå> <æ–°ä¸»æœºå><br>ä¿®æ”¹ä¸»æœºåå­—</æ–°ä¸»æœºå></åŸä¸»æœºå></li>
<li>git remote rm <ä¸»æœºå><br>åˆ é™¤ä¸»æœº</ä¸»æœºå></li>
<li>git remote show <ä¸»æœºå><br>æŸ¥çœ‹ä¸»æœºä¿¡æ¯</ä¸»æœºå></li>
</ul>
<h3 id="git-fetchçš„ä½¿ç”¨"><a href="#git-fetchçš„ä½¿ç”¨" class="headerlink" title="git fetchçš„ä½¿ç”¨"></a>git fetchçš„ä½¿ç”¨</h3><ul>
<li>git fetch <è¿œç¨‹ä¸»æœºå> [åˆ†æ”¯å]<br>å–å›è¿œç¨‹ä¸»æœºæ‰€æœ‰åˆ†æ”¯çš„æ›´æ–°(è‹¥é™„å¸¦æ‹¬å·åˆ™å–æŒ‡å®šåˆ†æ”¯åçš„æ›´æ–°)</è¿œç¨‹ä¸»æœºå></li>
</ul>
<h3 id="git-pushçš„ä½¿ç”¨"><a href="#git-pushçš„ä½¿ç”¨" class="headerlink" title="git pushçš„ä½¿ç”¨"></a>git pushçš„ä½¿ç”¨</h3><p>git push <è¿œç¨‹ä¸»æœºå> [è¿œç¨‹åˆ†æ”¯å]:[æœ¬åœ°åˆ†æ”¯å]</è¿œç¨‹ä¸»æœºå></p>
<h3 id="git-pullçš„ä½¿ç”¨"><a href="#git-pullçš„ä½¿ç”¨" class="headerlink" title="git pullçš„ä½¿ç”¨"></a>git pullçš„ä½¿ç”¨</h3><ul>
<li>git pull <è¿œç¨‹ä¸»æœºå> <è¿œç¨‹åˆ†æ”¯å>:<æœ¬åœ°åˆ†æ”¯å><br>å–å›è¿œç¨‹ä¸»æœºçš„æŒ‡å®šåˆ†æ”¯ï¼Œå¹¶ä¸æŒ‡å®šæœ¬åœ°åˆ†æ”¯åˆå¹¶(ä¸€ä¸ªgit pullæ“ä½œç­‰äºå…ˆgit fetchå†git merge)</æœ¬åœ°åˆ†æ”¯å></è¿œç¨‹åˆ†æ”¯å></è¿œç¨‹ä¸»æœºå></li>
</ul>
<blockquote>
<p>åœ¨git cloneçš„è¿‡ç¨‹ä¸­ï¼ŒGitä¼šåœ¨æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯ä¹‹é—´å»ºç«‹ä¸€ç§è¿½è¸ªå…³ç³»(tracking)ã€‚ä¾‹å¦‚ï¼Œgit cloneè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æœ¬åœ°åˆ†æ”¯é»˜è®¤ä¸è¿œç¨‹ä¸»æœºçš„åŒååˆ†æ”¯ï¼Œå»ºç«‹è¿½è¸ªå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬åœ°çš„masteråˆ†æ”¯è‡ªåŠ¨"è¿½è¸ª"origin/masteråˆ†æ”¯ã€‚</p>
</blockquote>
<p>Gitä¹Ÿå…è®¸æ‰‹åŠ¨å»ºç«‹è¿½è¸ªå…³ç³»</p>
<blockquote>
<p>git branch --set-upstream <æœ¬åœ°åˆ†æ”¯å> <è¿œç¨‹ä»“åº“å>/<è¿œç¨‹åˆ†æ”¯å></è¿œç¨‹åˆ†æ”¯å></è¿œç¨‹ä»“åº“å></æœ¬åœ°åˆ†æ”¯å></p>
</blockquote>
<p>å¦‚æœå½“å‰åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯å­˜åœ¨è¿½è¸ªå…³ç³»ï¼Œgit pullå°±å¯ä»¥çœç•¥è¿œç¨‹åˆ†æ”¯åã€‚</p>
<blockquote>
<p>git pull <è¿œç¨‹ä»“åº“å></è¿œç¨‹ä»“åº“å></p>
</blockquote>
<h3 id="ç¬¬ä¸€æ¬¡æäº¤åˆ°éç©ºGitHubä»“åº“"><a href="#ç¬¬ä¸€æ¬¡æäº¤åˆ°éç©ºGitHubä»“åº“" class="headerlink" title="ç¬¬ä¸€æ¬¡æäº¤åˆ°éç©ºGitHubä»“åº“"></a>ç¬¬ä¸€æ¬¡æäº¤åˆ°éç©ºGitHubä»“åº“</h3><p>ä¾‹å¦‚ï¼šgithubåˆå§‹åŒ–æ—¶ï¼Œå¸¦æœ‰readmeå’Œ<a href="http://www.ruanyifeng.com/blog/2011/05/how_to_choose_free_software_licenses.html" target="_blank" rel="noopener">å¼€æºåè®®</a><br>è®°å¾—git pullä¸€ä¸‹</p>
<h3 id="ä¸åŒäººçš„äººä¿®æ”¹äº†ä¸åŒçš„æ–‡ä»¶"><a href="#ä¸åŒäººçš„äººä¿®æ”¹äº†ä¸åŒçš„æ–‡ä»¶" class="headerlink" title="ä¸åŒäººçš„äººä¿®æ”¹äº†ä¸åŒçš„æ–‡ä»¶"></a>ä¸åŒäººçš„äººä¿®æ”¹äº†ä¸åŒçš„æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git push github chase</span><br><span class="line">To github.com:shanqianyouyu/Learning.git</span><br><span class="line"> ! [rejected]        chase -&gt; chase (non-fast-forward)</span><br><span class="line">error: failed to push some refs to <span class="string">'git@github.com:shanqianyouyu/Learning.git'</span></span><br><span class="line">hint: Updates were rejected because the tip of your current branch is behind</span><br><span class="line">hint: its remote counterpart. Integrate the remote changes (e.g.</span><br><span class="line">hint: <span class="string">'git pull ...'</span>) before pushing again.</span><br><span class="line">hint: See the <span class="string">'Note about fast-forwards'</span> <span class="keyword">in</span> <span class="string">'git push --help'</span> <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure>
<p>å…ˆ mergeä¸€ä¸‹å†push</p>
<h3 id="ä¸åŒçš„äººä¿®æ”¹äº†ç›¸åŒæ–‡ä»¶çš„ä¸åŒä½ç½®"><a href="#ä¸åŒçš„äººä¿®æ”¹äº†ç›¸åŒæ–‡ä»¶çš„ä¸åŒä½ç½®" class="headerlink" title="ä¸åŒçš„äººä¿®æ”¹äº†ç›¸åŒæ–‡ä»¶çš„ä¸åŒä½ç½®"></a>ä¸åŒçš„äººä¿®æ”¹äº†ç›¸åŒæ–‡ä»¶çš„ä¸åŒä½ç½®</h3><p>åŒä¸Šï¼Œgitä¼šè‡ªå·±æ•´åˆ</p>
<h3 id="ä¸åŒçš„äººä¿®æ”¹äº†ç›¸åŒæ–‡ä»¶çš„ç›¸åŒä½ç½®"><a href="#ä¸åŒçš„äººä¿®æ”¹äº†ç›¸åŒæ–‡ä»¶çš„ç›¸åŒä½ç½®" class="headerlink" title="ä¸åŒçš„äººä¿®æ”¹äº†ç›¸åŒæ–‡ä»¶çš„ç›¸åŒä½ç½®"></a>ä¸åŒçš„äººä¿®æ”¹äº†ç›¸åŒæ–‡ä»¶çš„ç›¸åŒä½ç½®</h3><p>åŒä¸Šæ“ä½œï¼Œä¸è¿‡æ­¤æ—¶ï¼Œä¼šæç¤ºå†²çªï¼Œgitä¼šè‡ªå·±æ•´åˆï¼Œä½†æ˜¯éœ€è¦è‡ªå·±è§£å†³å†²çª</p>
<h3 id="ä¸åŒçš„äººåŒæ—¶å˜æ›´äº†æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹"><a href="#ä¸åŒçš„äººåŒæ—¶å˜æ›´äº†æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹" class="headerlink" title="ä¸åŒçš„äººåŒæ—¶å˜æ›´äº†æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹"></a>ä¸åŒçš„äººåŒæ—¶å˜æ›´äº†æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹</h3><p>ä¾‹å¦‚ï¼š</p>
<ol>
<li>(å…ˆ)Aä¿®æ”¹ <strong>index.html</strong> ä¸º <strong>index.htm</strong> å¹¶ä¸” pushåˆ°è¿œç¨‹ä»“åº“</li>
<li>(å)Bä¿®æ”¹ <strong>index.html</strong> (Bä¸çŸ¥é“æ–‡ä»¶åå·²ç»è¢«ä¿®æ”¹äº†),å¹¶ä¸”ä¿®æ”¹äº†æ–‡ä»¶çš„å†…å®¹ï¼Œpushåˆ°è¿œç«¯ï¼Œå‘ç°é”™è¯¯ï¼Œgit pull(ç­‰åŒäºä¸Šé¢çš„ git fetch å† git merge) ä¸€ä¸‹ï¼Œå‘ç°gitè‡ªåŠ¨è¯†åˆ«å‡ºæ¥ï¼Œå°±æ˜¯gitä¼šå°†Bä»“åº“ä¸‹çš„   <strong>index.html</strong> ä¿®æ”¹æˆ <strong>index.htm</strong> ï¼Œå¹¶ä¸”å†…å®¹è¢«ä¿®æ”¹ï¼Œå†pushåˆ°è¿œç¨‹ä»“åº“å³å¯</li>
</ol>
<h3 id="ä¸åŒçš„äººåŒæ—¶ä¿®æ”¹äº†æ–‡ä»¶å"><a href="#ä¸åŒçš„äººåŒæ—¶ä¿®æ”¹äº†æ–‡ä»¶å" class="headerlink" title="ä¸åŒçš„äººåŒæ—¶ä¿®æ”¹äº†æ–‡ä»¶å"></a>ä¸åŒçš„äººåŒæ—¶ä¿®æ”¹äº†æ–‡ä»¶å</h3><ol>
<li>(å…ˆ)Aä¿®æ”¹äº† <strong>index.html</strong> ä¸º <strong>index1.html</strong> ,å¹¶ä¸”pushåˆ°è¿œç«¯</li>
<li>(å)Bä¿®æ”¹ <strong>index.html</strong> ä¸º <strong>index2.html</strong> ï¼Œpushåˆ°è¿œç«¯æŠ¥é”™ï¼Œ <strong>git pull</strong> åˆ°æœ¬åœ°ï¼Œå‘ç°å‘ç”Ÿå†²çªï¼Œè¿™æ—¶å€™éœ€è¦æ‰‹åŠ¨è§£å†³å†²çªï¼Œ <strong>git status</strong> ä¼šå‘ç°ï¼Œå·¥ä½œåŒºæœ‰ä¸¤ä¸ªæ–‡ä»¶ <strong>index1.html</strong> <strong>index2.html</strong> ï¼Œ <strong>git status</strong> å‘ç°æš‚å­˜åŒºæç¤º <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">both deleted:    index.html</span><br><span class="line">added by them:   index1.html</span><br><span class="line">added by us:     index2.html</span><br></pre></td></tr></table></figure>
è¿™æ—¶å€™ä½ éœ€è¦å’Œä½ çš„åŒä¼´è®¨è®ºæœ€åçš„åå­—æ˜¯å“ªä¸€ä¸ªï¼Œç„¶åæ‰‹åŠ¨åˆ é™¤ä¸éœ€è¦çš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œæäº¤å¦å¤–ä¸€ä¸ªå³å¯ï¼Œå† <strong>git push</strong> åˆ°è¿œç¨‹ä»“åº“ã€‚</li>
</ol>
<h3 id="FETCH-HEAD"><a href="#FETCH-HEAD" class="headerlink" title="FETCH_HEAD"></a>FETCH_HEAD</h3><p>FETCH_HEADæ˜¯ä¸€ä¸ªçŸ­æœŸå¼•ç”¨ï¼Œä»¥è·Ÿè¸ªåˆšåˆšä»è¿œç¨‹å­˜å‚¨åº“è·å–çš„å†…å®¹ã€‚ git pullé¦–å…ˆè°ƒç”¨git fetchï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ä»è¿œç¨‹è·å–ä¸€ä¸ªåˆ†æ”¯; FETCH_HEADæŒ‡å‘è¿™ä¸ªåˆ†æ”¯çš„æç¤º(å®ƒå­˜å‚¨æäº¤çš„SHA1ï¼Œå°±åƒåˆ†æ”¯ä¸€æ ·)ã€‚ git pullç„¶åè°ƒç”¨git mergeï¼Œå°†FETCH_HEADåˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚</p>
<h2 id="å›¢é˜Ÿåä½œä¸­ç¦æ­¢çš„æ“ä½œ"><a href="#å›¢é˜Ÿåä½œä¸­ç¦æ­¢çš„æ“ä½œ" class="headerlink" title="å›¢é˜Ÿåä½œä¸­ç¦æ­¢çš„æ“ä½œ"></a><em>å›¢é˜Ÿåä½œä¸­ç¦æ­¢çš„æ“ä½œ</em></h2><ul>
<li>git push -f <commitç‰ˆæœ¬å·></commitç‰ˆæœ¬å·></li>
<li>ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œå˜æ›´å†å²æ“ä½œ(å˜åŸºæ“ä½œ)</li>
</ul>
<h2 id="å¦‚ä½•åœ¨Githubä¸Šæ‰¾åˆ°æƒ³è¦çš„å¼€æºé¡¹ç›®å‘¢"><a href="#å¦‚ä½•åœ¨Githubä¸Šæ‰¾åˆ°æƒ³è¦çš„å¼€æºé¡¹ç›®å‘¢" class="headerlink" title="å¦‚ä½•åœ¨Githubä¸Šæ‰¾åˆ°æƒ³è¦çš„å¼€æºé¡¹ç›®å‘¢"></a>å¦‚ä½•åœ¨Githubä¸Šæ‰¾åˆ°æƒ³è¦çš„å¼€æºé¡¹ç›®å‘¢</h2><p>è¿›å…¥<a href="https://github.com/search/advanced" target="_blank" rel="noopener">é“¾æ¥</a>ï¼š <a href="https://github.com/search/advanced" target="_blank" rel="noopener">https://github.com/search/advanced</a><br>æˆ–è€…åœ¨æœç´¢æ ç©ºæœï¼Œ<img src="/static/img/git-github/git%E7%9A%84%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD.png" alt="gitçš„æœç´¢åŠŸèƒ½.png"><br>githubçš„helpä¸­æœ‰æ•™æ€ä¹ˆç”¨ï¼Œæˆ–è€…çœ‹çœ‹è¿™ä¸ª<a href="https://zhuanlan.zhihu.com/p/55294261" target="_blank" rel="noopener">é“¾æ¥</a>å§.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¡¥å……ï¼šhttps:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;450cd21b36a4</span><br><span class="line">#å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶</span><br><span class="line">git config --global core.safecrlf false </span><br><span class="line">windowså¹³å°ä¸‹ä½¿ç”¨git addï¼Œgit deploy æ–‡ä»¶æ—¶ç»å¸¸å‡ºç°â€œwarning: LF will be replaced by CRLFâ€ çš„æç¤ºã€‚</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Git</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>frp + v2ray åˆ©ç”¨è·¯ç”±å™¨åšä»£ç†æœåŠ¡å™¨</title>
    <url>//post/17334.html</url>
    <content><![CDATA[<h2 id="1ã€Dokcerå®‰è£…-frps"><a href="#1ã€Dokcerå®‰è£…-frps" class="headerlink" title="1ã€Dokcerå®‰è£… frps"></a>1ã€Dokcerå®‰è£… frps</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --restart=always --network host -d -v $PWD:/etc/frp --name frps snowdreamtech/frps</span><br></pre></td></tr></table></figure><a id="more"></a>

<p>æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ <strong>frps.ini</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">bind_udp_port</span> = <span class="number">7001</span></span><br><span class="line"><span class="attr">kcp_bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">81</span></span><br><span class="line"><span class="attr">vhost_https_port</span> = <span class="number">84</span></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">7500</span></span><br><span class="line"><span class="attr">dashboard_user</span> = user</span><br><span class="line"><span class="attr">dashboard_pwd</span> = pwd</span><br><span class="line"><span class="attr">subdomain_host</span> = host</span><br><span class="line"><span class="attr">log_max_days</span> = <span class="number">7</span></span><br><span class="line"><span class="attr">authentication_timeout</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">token</span> = token</span><br><span class="line"><span class="attr">allow_ports</span> = <span class="number">1</span>-<span class="number">65535</span></span><br><span class="line"><span class="attr">max_pool_count</span> = <span class="number">20</span></span><br><span class="line"><span class="attr">max_ports_per_client</span> = <span class="number">20</span></span><br><span class="line"><span class="attr">log_file</span> = /etc/frp/frps.log</span><br><span class="line"><span class="attr">log_level</span> = info</span><br></pre></td></tr></table></figure>

<h2 id="2ã€v2ray-è‡ªå®šä¹‰é…ç½®"><a href="#2ã€v2ray-è‡ªå®šä¹‰é…ç½®" class="headerlink" title="2ã€v2ray è‡ªå®šä¹‰é…ç½®"></a>2ã€v2ray è‡ªå®šä¹‰é…ç½®</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;inbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;port&quot;: 12340,</span><br><span class="line">            &quot;protocol&quot;: &quot;socks&quot;,</span><br><span class="line">            &quot;sniffing&quot;: &#123;</span><br><span class="line">                &quot;enabled&quot;: true,</span><br><span class="line">                &quot;destOverride&quot;: [</span><br><span class="line">                    &quot;http&quot;,</span><br><span class="line">                    &quot;tls&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;auth&quot;: &quot;noauth&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;port&quot;: 12341,</span><br><span class="line">            &quot;protocol&quot;: &quot;http&quot;,</span><br><span class="line">            &quot;sniffing&quot;: &#123;</span><br><span class="line">                &quot;enabled&quot;: true,</span><br><span class="line">                &quot;destOverride&quot;: [</span><br><span class="line">                    &quot;http&quot;,</span><br><span class="line">                    &quot;tls&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;auth&quot;: &quot;noauth&quot;,</span><br><span class="line">                &quot;udp&quot;: false</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;outbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;freedom&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2ã€frpc-é…ç½®"><a href="#2ã€frpc-é…ç½®" class="headerlink" title="2ã€frpc é…ç½®"></a>2ã€frpc é…ç½®</h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#frp.jsxz.cfæ˜¯å…è´¹æä¾›çš„frpæœåŠ¡å™¨ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ï¼Œè¯·ä¿®æ”¹ä¸‹é¢ä¸¤å¤„çš„â€œtestâ€ä¸ºä½ çš„åç§°ï¼Œæ¯”å¦‚"hello"</span></span><br><span class="line"><span class="comment">#ç„¶åå¯ä»¥é€šè¿‡http://hello.jsxz.cfè®¿é—®ä½ çš„è®¾å¤‡</span></span><br><span class="line"><span class="comment">#å¦‚æœæ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œè¯·æ›´æ”¹åç§°ï¼Œæ³¨æ„åç§°ä¸èƒ½å’Œåˆ«äººé‡å¤</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = host</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">token</span> = token</span><br><span class="line"><span class="attr">user</span> = user</span><br><span class="line"></span><br><span class="line"><span class="section">[web]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">subdomain</span> = w1</span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[socks5_proxy]</span></span><br><span class="line"><span class="comment">#type = tcp</span></span><br><span class="line"><span class="comment">#remote_port = 12340</span></span><br><span class="line"><span class="comment">#plugin = socks5</span></span><br><span class="line"><span class="comment">#use_encryption = true</span></span><br><span class="line"><span class="comment">#plugin_http_user = user</span></span><br><span class="line"><span class="comment">#plugin_http_passwd =pwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[http_proxy]</span></span><br><span class="line"><span class="comment">#type = tcp</span></span><br><span class="line"><span class="comment">#remote_port = 12341</span></span><br><span class="line"><span class="comment">#plugin = http_proxy</span></span><br><span class="line"><span class="comment">#use_encryption = true</span></span><br><span class="line"><span class="comment">#plugin_http_user = user</span></span><br><span class="line"><span class="comment">#plugin_http_passwd = pwd</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ftp]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">1234</span></span><br><span class="line"><span class="attr">plugin</span> = static_file</span><br><span class="line"><span class="comment"># è¦å¯¹å¤–æš´éœ²çš„æ–‡ä»¶ç›®å½•</span></span><br><span class="line"><span class="attr">plugin_local_path</span> = /tmp/log</span><br><span class="line"><span class="comment"># ç”¨æˆ·è®¿é—® URL ä¸­ä¼šè¢«å»é™¤çš„å‰ç¼€ï¼Œä¿ç•™çš„å†…å®¹å³ä¸ºè¦è®¿é—®çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="attr">plugin_strip_prefix</span> = static</span><br><span class="line"><span class="attr">plugin_http_user</span> = user</span><br><span class="line"><span class="attr">plugin_http_passwd</span> = pwd</span><br><span class="line"></span><br><span class="line"><span class="section">[v2ray_socks5_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> =  <span class="number">12340</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">12340</span></span><br><span class="line"></span><br><span class="line"><span class="section">[v2ray_http_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">12341</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">12341</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>frp</tag>
      </tags>
  </entry>
  <entry>
    <title>VsCodeå¼€å‘ç¯å¢ƒé…ç½®</title>
    <url>//post/50613.html</url>
    <content><![CDATA[<h3 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h3><p>å›¾æ ‡ä¸»é¢˜ vscode-icons</p><p><a href="https://www.zhihu.com/question/38435139" target="_blank" rel="noopener">https://www.zhihu.com/question/38435139</a></p><a id="more"></a>

<p>é…è‰²ä¸»é¢˜ </p>
<p><strong>One Dark Pro</strong></p>
<p><img src="https://pic4.zhimg.com/80/v2-8a3893a1b55d6e036fb24fa311b5b73a_hd.jpg" alt></p>
<h5 id="Brackets-Light-Pro"><a href="#Brackets-Light-Pro" class="headerlink" title="Brackets Light Pro"></a>Brackets Light Pro</h5><p><img src="https://pic2.zhimg.com/80/v2-eb243facac1a66036c32f78d2c089faf_hd.jpg" alt></p>
<h4 id="Tiny-Light"><a href="#Tiny-Light" class="headerlink" title="Tiny Light"></a>Tiny Light</h4><p><img src="https://pic3.zhimg.com/80/v2-486f1b54ef49edcb4c0550d3185e4973_hd.jpg" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ’ä»¶å®‰è£…</span><br><span class="line">æœ‰ä¸¤ç§æ–¹å¼ï¼Œéšä¾¿ä¸€ç§å°±å¥½ã€‚</span><br><span class="line">F1 è¾“å…¥ extensionsï¼š || ext installã€‚extensionsï¼šè¿˜å¯ä»¥æ˜¾ç¤ºå·²ç»å®‰è£…è¿‡çš„æ’ä»¶ã€‚</span><br><span class="line">ctrl + P ç„¶åè¾“å…¥ &gt;ext install</span><br><span class="line"></span><br><span class="line">koroFileHeader æ’ä»¶</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;OBKoro1&#x2F;koro1FileHeader&#x2F;blob&#x2F;master&#x2F;README.md</span><br><span class="line">é¡¶éƒ¨æ³¨é‡Šæ¨¡æ¿ï¼Œå¯å®šä¹‰ä½œè€…ã€æ—¶é—´ç­‰ä¿¡æ¯ï¼Œå¹¶ä¼šè‡ªåŠ¨æ›´æ–°æœ€åä¿®æ”¹æ—¶é—´</span><br><span class="line">filesize  åœ¨åº•éƒ¨çŠ¶æ€æ æ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤§å°ï¼Œç‚¹å‡»åè¿˜å¯ä»¥çœ‹åˆ°è¯¦ç»†åˆ›å»ºã€ä¿®æ”¹æ—¶é—´</span><br><span class="line">vetur  vueæ¡†æ¶æ‰€éœ€çš„æ’ä»¶ï¼Œè¯­æ³•é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ã€Emmetç­‰</span><br><span class="line">Bootstrap 3 Sinnpet  å¸¸ç”¨ bootstrap çš„å¯ä»¥å®‰è£…ã€‚</span><br><span class="line">jQuery Code Snippets  jquery é‡åº¦æ‚£è€…å¿…é¡»å“</span><br><span class="line">HTML CSS Support è®© html æ ‡ç­¾ä¸Šå†™class æ™ºèƒ½æç¤ºå½“å‰é¡¹ç›®æ‰€æ”¯æŒçš„æ ·å¼</span><br><span class="line">Atuo Rename Tag ä¿®æ”¹ html æ ‡ç­¾ï¼Œè‡ªåŠ¨å¸®ä½ å®Œæˆå°¾éƒ¨é—­åˆæ ‡ç­¾çš„åŒæ­¥ä¿®æ”¹</span><br><span class="line">HTML Snippets   è¶…çº§å®ç”¨ä¸”åˆçº§çš„ H5ä»£ç ç‰‡æ®µä»¥åŠæç¤º</span><br><span class="line"></span><br><span class="line">Git history è¿™æ ·å¯ä»¥çœ‹æ•´ä¸ªä»“åº“æ–‡ä»¶æäº¤å†å²ï¼ŒåŠä¿®æ”¹åœ°æ–¹</span><br><span class="line">https:&#x2F;&#x2F;juejin.im&#x2F;post&#x2F;5b00474951882542ba08087a</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;MirroZhou&#x2F;Blog&#x2F;issues&#x2F;6</span><br><span class="line"></span><br><span class="line">gitignore</span><br><span class="line">https:&#x2F;&#x2F;marketplace.visualstudio.com&#x2F;items?itemName&#x3D;michelemelluso.gitignore</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Document This</span><br><span class="line">Document This èƒ½å¤Ÿä¸€é”®ç»™ä»£ç ä¸­çš„ç±»ã€å‡½æ•°åŠ ä¸Šæ³¨é‡Šï¼Œæ”¯æŒå‡½æ•°å£°æ˜ã€å‡½æ•°è¡¨è¾¾å¼ã€ç®­å¤´å‡½æ•°ç­‰ï¼›</span><br><span class="line"></span><br><span class="line">vscode-</span><br><span class="line">https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;f27f452ceb27faker ç”Ÿæˆè™šæ‹Ÿæ•° https:&#x2F;&#x2F;marketplace.visualstudio.com&#x2F;itemsitemName&#x3D;deerawan.vscode-faker</span><br><span class="line"></span><br><span class="line">Icon Fonts</span><br><span class="line">https:&#x2F;&#x2F;marketplace.visualstudio.com&#x2F;items?itemName&#x3D;idleberg.icon-fonts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Settings SyncåŒæ­¥åŠŸèƒ½è®¾ç½®æ’ä»¶</span><br><span class="line">https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;4ffa3b0ad860</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç±»åè‡ªåŠ¨è¡¥å…¨</span><br><span class="line">IntelliSense for CSS class names in HTML</span><br><span class="line">https:&#x2F;&#x2F;marketplace.visualstudio.com&#x2F;items?itemName&#x3D;Zignd.html-css-class-completion</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Prettier</span><br><span class="line">https:&#x2F;&#x2F;medium.com&#x2F;@thoamsy&#x2F;%E4%BD%BF%E7%94%A8-vs-code-%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%BE%88%E7%88%BD%E7%9A%84%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83-2d393ba5cc45</span><br><span class="line">è¿™ä¸ªæ˜¯æœ€è¿‘ä¸€å¹´æœ€ç«çš„æ ¼å¼åŒ–å·¥å…·ï¼Œèƒ½å¤Ÿå°†ä½ å†™æˆğŸ’©ä¸€æ ·çš„ JS ä¹Ÿèƒ½æ ¼å¼æˆååˆ†æ¼‚äº®çš„ä»£ç ï¼ˆå‰ææ˜¯æ²¡æœ‰è¯­æ³•æ²¡é”™ï¼‰ã€‚åŒæ—¶ä¹Ÿæ”¯æŒ HTMLï¼ŒCSSï¼ŒJSONï¼ŒMarkdown ç­‰ç­‰æ–‡ä»¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ‹¬å·é«˜äº®</span><br><span class="line"></span><br><span class="line">Bracket Pair Colorizer å¦‚æœä»…ä»…çœ‹å®ƒçš„ä»‹ç»çš„è¯ï¼Œè¿™ä¸ªæ’ä»¶æ˜¯ä¸€ä¸ªä¼šå°†ä½ çš„ ([&#123;&#125;]) è¿™äº›ä½¿ç”¨ä¸åŒçš„é¢œè‰²åŒºåˆ†å‡ºæ¥ï¼Œæå‡é‰´åˆ«åº¦ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Path Intellisense</span><br><span class="line">æä¾› URL çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿™ä¸ªå¿…é¡»è£…å§ã€‚æ”¯æŒä»»ä½•è¯­è¨€ï¼Œè§¦å‘æ¡ä»¶ä¸€èˆ¬æ˜¯åœ¨ä¸€å¯¹å¼•å·ä¸­ï¼Œè¾“å…¥ .&#x2F; ï¼Œ..&#x2F;, &#x2F; è¿™äº›è¡¨ç¤ºè·¯å¾„çš„å‰ç¼€ï¼Œå°±ä¼šè·³å‡ºæ¥äº†ã€‚åƒæˆ‘ä»¬çš„ JSï¼ŒHTML ä¸­å¼•ç”¨æ–‡ä»¶ï¼ŒCSS ä¸­ url å°±å†ä¹Ÿä¸ç”¨æ‹…å¿ƒäº†ã€‚</span><br><span class="line"></span><br><span class="line">Live Server</span><br><span class="line">è¿™ä¸ªè‚¯å®šæ˜¯ä¸€ä¸ªç¥å™¨ï¼Œå¦‚æœä½ è¿˜ä¸ä¼šä½¿ç”¨ webpack æˆ–è€… parcel çš„è¯ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">é¢œè‰²é€‰å–æ’ä»¶ Color Info	</span><br><span class="line">è¿™ä¸ªä¾¿æ·çš„æ’ä»¶ï¼Œå°†ä¸ºä½ æä¾›ä½ åœ¨ CSS ä¸­ä½¿ç”¨é¢œè‰²çš„ç›¸å…³ä¿¡æ¯ã€‚ä½ åªéœ€åœ¨é¢œè‰²ä¸Šæ‚¬åœå…‰æ ‡ï¼Œå°±å¯ä»¥é¢„è§ˆè‰²å—ä¸­è‰²å½©æ¨¡å‹çš„ï¼ˆHEXã€ RGBã€HSL å’Œ CMYKï¼‰ç›¸å…³ä¿¡æ¯äº†</span><br><span class="line"></span><br><span class="line">GitLens æ˜¾ç¤ºæ–‡ä»¶æœ€è¿‘çš„ commit å’Œä½œè€…ï¼Œæ˜¾ç¤ºå½“å‰è¡Œ commit ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">é…ç½®æ»šè½®ç¼©æ”¾</span><br><span class="line">é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</span><br><span class="line">åœ¨æ–‡ä»¶--&gt;é¦–é€‰é¡¹--&gt;è®¾ç½®--&gt;ç”¨æˆ·è®¾ç½®ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</span><br><span class="line">&quot;editor.mouseWheelZoom&quot;: true,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å±€éƒ¨åŒæ—¶ç¼–è¾‘</span><br><span class="line">5ã€æŒ‰shift+altï¼Œå†ä½¿ç”¨é¼ æ ‡æ‹–åŠ¨ï¼Œä¹Ÿå¯ä»¥å‡ºç°ç«–ç›´çš„åˆ—å…‰æ ‡ï¼ŒåŒæ—¶å¯ä»¥é€‰ä¸­å¤šåˆ—ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">VsCodeç¼–è¾‘å™¨çš„å­—ä½“</span><br><span class="line">æ®æ‚‰ï¼ŒCascadia Code æ˜¯ä¸æ–°ç‰ˆ Windowsç»ˆç«¯åº”ç”¨ç¨‹åºå…±åŒå¼€å‘çš„ï¼Œå› æ­¤å®˜æ–¹æ¨èæœ€å¥½å°†è¯¥å­—ä½“ä¸ Windows Terminal å’Œ Visual Studio &#x2F; VS Code ç­‰æ–‡æœ¬ç¼–è¾‘å™¨æ­é…ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¯å¢ƒå˜é‡é«˜äº®æ’ä»¶</span><br><span class="line">https:&#x2F;&#x2F;marketplace.visualstudio.com&#x2F;items?itemName&#x3D;mikestead.dotenv</span><br><span class="line">VSCode .env syntax highlighting</span><br></pre></td></tr></table></figure>

<h2 id="ä¾§è¾¹æ å­—ä½“"><a href="#ä¾§è¾¹æ å­—ä½“" class="headerlink" title="ä¾§è¾¹æ å­—ä½“"></a>ä¾§è¾¹æ å­—ä½“</h2><p>æ‰“å¼€è®¾ç½®ï¼Œæ‰¾åˆ°settings.json<img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2021/01/14/a90d3629fed7ed326f342958720d3e83.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¶ä¸­<br>â€œeditor.fontSizeâ€: 15, //ç¬¬ä¸€ä¸ªæ˜¯ç¼–è¾‘é¢æ¿çš„<br>â€œwindow.zoomLevelâ€: 1.5 //ç¬¬äºŒä¸ªæ˜¯ç³»ç»Ÿç•Œé¢çš„</p>
]]></content>
      <tags>
        <tag>IDE</tag>
        <tag>VsCode</tag>
      </tags>
  </entry>
  <entry>
    <title>pipenvè™šæ‹Ÿç¯å¢ƒåŒ…ç®¡ç†å·¥å…·</title>
    <url>//post/58768.html</url>
    <content><![CDATA[<h1 id="ä¸€ï¼šå‰è¨€"><a href="#ä¸€ï¼šå‰è¨€" class="headerlink" title="ä¸€ï¼šå‰è¨€"></a>ä¸€ï¼šå‰è¨€</h1><p>ä»‹ç»ä¸€ä¸ªåŒ…ç®¡ç†ç¥å™¨-pipenvï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥è®©æˆ‘ä»¬åœ¨å†™ä»£ç ã€åˆ›å»ºPythonè¿è¡Œç¯å¢ƒã€packageä¾èµ–å…³ç³»ä»¥åŠé¡¹ç›®åˆä½œçš„æ—¶å€™æ›´æœ‰æ•ˆç‡ã€‚</p><a id="more"></a>
<p>åœ¨pycon2018ä¸Šï¼ŒKenneth Reitzä»‹ç»çš„Pipenvåœ¨ä¸ä¹…å°±æˆä¸ºäº†Pythonå®˜æ–¹æ¨èçš„åŒ…ç®¡ç†å·¥å…·ã€‚ä¸‹é¢æ˜¯pycon2018çš„é“¾æ¥ï¼Œæ¨èå¤§å®¶çœ‹çœ‹ï¼š<a href="https://www.bilibili.com/video/av26610021/?p=1ã€‚" target="_blank" rel="noopener">https://www.bilibili.com/video/av26610021/?p=1ã€‚</a></p>
<h1 id="äºŒï¼šPythonåŒ…ç®¡ç†å†å²"><a href="#äºŒï¼šPythonåŒ…ç®¡ç†å†å²" class="headerlink" title="äºŒï¼šPythonåŒ…ç®¡ç†å†å²"></a>äºŒï¼šPythonåŒ…ç®¡ç†å†å²</h1><p>æœ€åˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰äº†Pythonï¼Œä½†æ˜¯æ²¡æœ‰å¹²å‡€çš„æ–¹æ³•æ¥å®‰è£…è½¯ä»¶åŒ…ï¼Œæ—©æœŸçš„æ—¶å€™ï¼Œå½“ç”¨æˆ·æƒ³å®‰è£…åŒ…æ—¶ï¼Œéœ€è¦å…ˆä»ç½‘ä¸ŠæŠŠæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œè§£å‹ï¼Œç„¶åæ‰§è¡ŒPython setup.py install,å°±èƒ½å°†åŒ…å®‰è£…å¥½ã€‚</p>
<p>åæ¥æœ‰äº†PyPIï¼Œå¼€å‘è€…å¯ä»¥æŠŠä»–ä»¬çš„åŒ…ä¸Šä¼ åˆ°ä¸Šé¢ï¼Œç„¶åå…¶ä»–å¼€å‘è€…å¯ä»¥ä»è¿™é‡Œä¸‹è½½ä»–ä»¬éœ€è¦çš„åŒ…ï¼Œç„¶åå†æ‰§è¡Œpython setup.py install è¿›è¡Œå®‰è£…ï¼Œä½†æ˜¯è¿™æ ·è¿˜æ˜¯å­˜åœ¨è®¸å¤šçš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼šæ•´ä¸ªè¿‡ç¨‹éœ€è¦äººå·¥ï¼Œä¸æ–¹ä¾¿è‡ªåŠ¨åŒ–ï¼Œæ— æ³•å®‰è£…å¤šä¸ªä¸åŒç‰ˆæœ¬ç­‰ç­‰ã€‚</p>
<p>å†åæ¥æœ‰äº†easy_installï¼Œå½“ç”¨æˆ·æƒ³è¦å®‰è£…æŸä¸ªåŒ…çš„æ˜¯å¦ï¼Œåªè¦æ‰§è¡Œeasy_install åŒ…åï¼Œå·¥å…·å°±ä¼šè‡ªåŠ¨æŠŠåŒ…ä»¥åŠä¾èµ–ä¸‹è½½ä¸‹æ¥è¿›è¡Œå®‰è£…ï¼Œè¿™è§£å†³äº†æ— æ³•è‡ªåŠ¨åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•åˆå¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œåªèƒ½å®‰è£…ï¼Œå´æ²¡æœ‰æ–¹æ³•å¸è½½ã€‚</p>
<p>åˆ°äº†2008å¹´ï¼Œpipå‡ºç°äº†ï¼Œè¿˜å¼•å…¥äº†requirements filesçš„æ¦‚å¿µï¼Œå¯ä»¥ä½¿ç”¨æˆ·éå¸¸æ–¹ä¾¿çš„å¤åˆ¶Pythonç¯å¢ƒã€‚æ¯”å¦‚è¯´å®‰è£…æŸä¸ªåŒ…ï¼Œæ‰§è¡Œpip install åŒ…åï¼Œéœ€è¦å¸è½½ï¼Œæ‰§è¡Œpip uninstall åŒ…åï¼Œéœ€è¦æ‰¹é‡å®‰è£…ï¼Œæ‰§è¡Œpip install -r requirements.txtã€‚ç›´åˆ°ç°åœ¨ï¼Œpipå·²ç»æˆä¸ºéå¸¸å¥½ç”¨çš„åŒ…ç®¡ç†å·¥å…·äº†ã€‚pipè§£å†³äº†å•ä¸ªç¯å¢ƒä¸‹çš„åŒ…ç®¡ç†é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ä¸€å°æœºå™¨ä¸Šå¼€å‘å¤šä¸ªé¡¹ç›®ï¼Œè¿™å¤šä¸ªé¡¹ç›®ç”¨åˆ°äº†ç›¸åŒåŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œè¿™å°±æˆäº†éå¸¸æ£˜æ‰‹çš„é—®é¢˜äº†ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œvirtualenvå‡ºç°äº†ã€‚virtualenvå¯ä»¥ä¸ºæ¯ä¸ªé¡¹ç›®åˆ›å»ºä¸€å¥—éš”ç¦»çš„Pythonç¯å¢ƒï¼Œå†ä½¿ç”¨pipè¿›è¡ŒåŒ…ç®¡ç†ã€‚ç›®å‰pip+virtualenvæ˜¯ç›®å‰æ¯”è¾ƒä¸»æµçš„Pythonå¼€å‘æµç¨‹ã€‚æ…¢æ…¢çš„è¿™ç§æ–¹å¼ä¹Ÿé€æ¸æš´éœ²å‡ºäº†ç¼ºç‚¹ï¼Œæ¯”å¦‚pipçš„requirements.txtè¿‡äºç®€å•ï¼Œæ²¡åŠæ³•è¡¨ç¤ºå…·ä½“çš„ä¾èµ–å…³ç³»ï¼Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªå·¥å…·ï¼ˆpip+virtualenvï¼‰æ‰èƒ½å®Œæˆå·¥ä½œã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜pipenvç™»åœºäº†ï¼Œå®ƒä¸»è¦ä½¿ç”¨pipfileæ¥å–ä»£ä¹‹å‰çš„requirements.txtï¼Œpipfileæ¯”requirements.txtè¡¨è¾¾èƒ½åŠ›æ›´å¼ºï¼Œé»˜è®¤æ”¯æŒä¸¤ç§ä¾èµ–ï¼Œå¯ä»¥å°†å¤šä¸ªrequirements.txtçš„å†…å®¹åˆå¹¶åˆ°ä¸€èµ·ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œå¹¶ä¸”é€šè¿‡pipfile.lockå¯¹ç¯å¢ƒè¿›è¡Œæ˜ç¡®ï¼Œè¯¦ç»†çš„æè¿°ã€‚pipenvå¯ä»¥è®©ä½ æ— ç¼çš„ä½¿ç”¨pipfileï¼Œpipfile.lockï¼Œä¿è¯æ¯ä¸ªä¾èµ–çš„ä¿¡æ¯éƒ½æ˜¯æ˜ç¡®çš„ï¼Œå®ƒæä¾›ç®€æ´çš„å‘½ä»¤æ“ä½œvirtualenvï¼Œå¹¶ä¸”æä¾›å¾ˆå¤šè¾…åŠ©å·¥å…·ï¼Œæ¯”å¦‚pipenv graphï¼Œå¯ä»¥æ˜¾ç¤ºé¡¹ç›®çš„å®Œæ•´ä¾èµ–å…³ç³»ã€‚</p>
<p>ç›®å‰Pipenvå·²ç»æ˜¯Pythonå®˜æ–¹æ¨èçš„å·¥ä½œæµå·¥å…·äº†ã€‚</p>
<h1 id="ä¸‰ï¼šPipenvå®æ“"><a href="#ä¸‰ï¼šPipenvå®æ“" class="headerlink" title="ä¸‰ï¼šPipenvå®æ“"></a>ä¸‰ï¼šPipenvå®æ“</h1><p>ç›®å‰pycharm2018.2.4ç‰ˆæœ¬ä»¥ä¸Šå·²ç»æ”¯æŒpipenväº†ã€‚</p>
<p>é¦–å…ˆæ‰“å¼€å‘½ä»¤è¡Œï¼šè¾“å…¥pip install pipenv å®‰è£…pipenvåº“ã€‚</p>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085050252-1351013491.png" alt="img"></p>
<p>ç„¶åè¾“å…¥ï¼špipenvï¼Œå¦‚æœæœ‰å¦‚ä¸‹æç¤ºè¯´æ˜å®‰è£…æˆåŠŸã€‚</p>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085129892-981808638.png" alt="img"></p>
<ul>
<li>æ¥ç€æ‰“å¼€pycharmåˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚</li>
</ul>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085151756-939121853.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085237419-1349695997.png" alt="img"></p>
<ul>
<li>é¡¹ç›®åˆ›å»ºå®Œæˆå¦ç”Ÿæˆä¸€ä¸ªpipfileæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é»˜è®¤çš„æºæ˜¯å›½å¤–çš„ï¼Œä¸ºäº†å¢åŠ å®‰è£…åº“çš„é€Ÿåº¦ï¼Œæˆ‘ä»¬æŠŠæºæ”¹æˆæ¸…åæºï¼š<a href="https://pypi.tuna.tsinghua.edu.cn/simple" target="_blank" rel="noopener">https://pypi.tuna.tsinghua.edu.cn/simple</a></li>
</ul>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085319672-2101539750.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085330856-2099737980.png" alt="img"></p>
<p>ä¸‹é¢æˆ‘ä»¬æ‰“å¼€pycharmè‡ªå¸¦çš„terminalæ¥å®‰è£…ä¸€ä¸ªç®€å•çš„æ¨¡å—ï¼Œæ£€æµ‹æ˜¯å¦æˆåŠŸã€‚</p>
<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼špipenv install requests</p>
<p> <img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085726379-2072554360.png" alt="img"></p>
<p>å¦‚æœå‡ºç°ä¸‹é¢æç¤ºï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚</p>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085510944-1925436841.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085552557-1259083927.png" alt="img"></p>
<p>å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œè¯´æ˜é¡¹ç›®åç§°åŒ…å«ä¸­æ–‡åã€‚</p>
<p><img src="https://img2018.cnblogs.com/blog/1277642/201810/1277642-20181011085424601-716320841.png" alt="img"></p>
<p>è‡³æ­¤ï¼ŒåŸºæœ¬çš„pipenvç¯å¢ƒå°±æ­å»ºå¥½äº†ã€‚</p>
<h1 id="å››ï¼špipenvå‘½ä»¤è¯¦è§£"><a href="#å››ï¼špipenvå‘½ä»¤è¯¦è§£" class="headerlink" title="å››ï¼špipenvå‘½ä»¤è¯¦è§£"></a>å››ï¼špipenvå‘½ä»¤è¯¦è§£</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install --user --upgrade pipenv # ç”¨æˆ·å®‰è£…pipenv </span><br><span class="line">pipenv --three # ä¼šä½¿ç”¨å½“å‰ç³»ç»Ÿçš„Python3åˆ›å»ºç¯å¢ƒ </span><br><span class="line">pipenv --two # ä½¿ç”¨python2åˆ›å»º </span><br><span class="line">pipenv --python 3.6 æŒ‡å®šæŸä¸€Pythonç‰ˆæœ¬åˆ›å»ºç¯å¢ƒ </span><br><span class="line">pipenv run python æ–‡ä»¶å pipenv run pip ...# è¿è¡Œpip </span><br><span class="line">pipenv shell æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ </span><br><span class="line">pipenv --where æ˜¾ç¤ºç›®å½•ä¿¡æ¯ </span><br><span class="line">pipenv --venv æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒä¿¡æ¯ </span><br><span class="line">pipenv --py æ˜¾ç¤ºPythonè§£é‡Šå™¨ä¿¡æ¯ </span><br><span class="line">pipenv install requests å®‰è£…ç›¸å…³æ¨¡å—å¹¶åŠ å…¥åˆ°Pipfile </span><br><span class="line">pipenv install django==1.11 å®‰è£…å›ºå®šç‰ˆæœ¬æ¨¡å—å¹¶åŠ å…¥åˆ°Pipfile </span><br><span class="line">pipenv graph # æ˜¾ç¤ºä¾èµ–å›¾ </span><br><span class="line">pipenv check #æ£€æŸ¥å®‰å…¨æ¼æ´ </span><br><span class="line">pipenv lock # ç”Ÿæˆlockfile</span><br><span class="line">pipenv update # æ›´æ–°æ‰€æœ‰çš„åŒ…</span><br><span class="line">pipenv --rm # åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">pipenv uninstall requests # å¸è½½åŒ…å¹¶ä»Pipfileä¸­ç§»é™¤ </span><br><span class="line">pipenv uninstall --all # å¸è½½å…¨éƒ¨åŒ…</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>pipenv</tag>
      </tags>
  </entry>
  <entry>
    <title>Vimå¸¸ç”¨å‘½ä»¤</title>
    <url>//post/20075.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åˆ é™¤å…¨éƒ¨</span><br><span class="line">å…‰æ ‡ç§»åˆ°ç¬¬ä¸€è¡Œï¼Œç„¶åè¾“å…¥ :.,$d ä¸€å›è½¦å°±å…¨æ²¡äº†ï¼Œåœ¨å‘½ä»¤æ¨¡å¼ä¸‹æ‰§è¡Œçš„ã€‚</span><br><span class="line">ï¼š0è·³è½¬é¦–è¡Œ</span><br><span class="line">Gè·³è½¬æœ«å°¾</span><br><span class="line">set number æ˜¾ç¤ºè¡Œå·</span><br><span class="line">yyå¤åˆ¶</span><br><span class="line">pç²˜è´´</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>Vim</tag>
      </tags>
  </entry>
  <entry>
    <title>Supervisorä½¿ç”¨</title>
    <url>//post/40974.html</url>
    <content><![CDATA[<h2 id="1ã€å¸¸ç”¨å‘½ä»¤"><a href="#1ã€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="1ã€å¸¸ç”¨å‘½ä»¤"></a>1ã€å¸¸ç”¨å‘½ä»¤</h2><p>å¼€æœºè‡ªå¯</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl enable supervisord</span><br><span class="line"></span><br><span class="line">#éªŒè¯æ˜¯å¦å¼€æœºè‡ªå¯</span><br><span class="line">systemctl is-enabled supervisord</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Supervisor</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜é›…çš„å¤‡ä»½Hexoåšå®¢</title>
    <url>//post/39661.html</url>
    <content><![CDATA[<p>èŠ±äº†ä¸€ä¸­åˆçš„æ—¶é—´æŠŠåšå®¢ä»githubè¿ç§»åˆ°äº†codingï¼Œè‡³äºä¸ºä»€ä¹ˆè¦è¿ç§»ï¼Œå¯¹æ¯”ä¸€ä¸‹å°±çŸ¥é“äº†ï¼Œä¹Ÿå¯ä»¥è¿ç§»åˆ°å…¶ä»–åœ°æ–¹æ¯”å¦‚  <a href="https://zeit.co/homeï¼Œæä¾›ç®€çŸ­çš„åŸŸåä»¥åŠå…¨çƒCDNè¿˜æœ‰è¯ä¹¦ï¼Œå¯ä»¥å…³è”github" target="_blank" rel="noopener">https://zeit.co/homeï¼Œæä¾›ç®€çŸ­çš„åŸŸåä»¥åŠå…¨çƒCDNè¿˜æœ‰è¯ä¹¦ï¼Œå¯ä»¥å…³è”github</a> ä»“åº“å®ç°è‡ªåŠ¨æ„å»ºï¼Œ</p><a id="more"></a>
<p>å½“ç„¶è¿˜æ˜¯codingå¥½ç”¨ï¼Œæ¯•ç«Ÿæ˜¯å›½å†…çš„2020å¹´1æœˆcodingå…¨é¢æ›´æ–°ï¼Œä¹‹å‰çš„åšå®¢éƒ½ç”¨ä¸äº†äº†ï¼Œæ‹–äº†å¾ˆä¹…ï¼Œç»ˆäºæŠŠåšå®¢æŠ˜è…¾å¥½äº†ï¼Œé¡ºä¾¿æ€»ç»“ä¸€ä¸‹å¯’å‡å­¦åˆ°çš„ä¸œè¥¿ï¼Œå…ˆè¯´ä¸€ä¸‹å¤‡ä»½å§ï¼Œå·å¾—å¸–å­ï¼Œè®²çš„å¾ˆè¯¦ç»†äº†ï¼Œä¸»è¦æ€•è¢«åˆ å¸–</p>
<p>ç”¨çš„æ˜¯ä¸€ä¸ªæ’ä»¶ï¼š<a href="https://github.com/coneycode/hexo-git-backup" target="_blank" rel="noopener">hexo-git-backup</a>ï¼ŒHexoå®˜ç½‘çš„æ’ä»¶é‡Œæœä¸åˆ°ï¼Œè¿™ä¸ªæ’ä»¶å‘å¸ƒåœ¨äº†GitHubä¸Šï¼Œå…³äºå®‰è£…ä½¿ç”¨å®˜æ–¹ä¹Ÿç»™äº†å¾ˆç®€æ´æ˜“æ‡‚çš„è¯´æ˜æ–‡æ¡£ã€‚</p>
<h1 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h1><h3 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h3><p>å¦‚æœä½ çš„Hexoç‰ˆæœ¬æ˜¯2.x.xï¼ˆæŸ¥çœ‹Hexoç‰ˆæœ¬å¯ä½¿ç”¨å‘½ä»¤ï¼š<code>hexo version</code>ï¼‰åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ npm install hexo-git-backup@0.0.91 --save</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ çš„Hexoç‰ˆæœ¬æ˜¯3.x.xåˆ™ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ npm install hexo-git-backup --save</span><br></pre></td></tr></table></figure>

<h2 id="æ’ä»¶å‡çº§"><a href="#æ’ä»¶å‡çº§" class="headerlink" title="æ’ä»¶å‡çº§"></a>æ’ä»¶å‡çº§</h2><p>å¦‚æœä½ æ˜¯é€šè¿‡<code>--save</code>å®‰è£…çš„ï¼Œé‚£ä¹ˆå‡çº§ä¹‹å‰ä½ å¿…é¡»å…ˆåˆ é™¤æ—§çš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ npm remove hexo-git-backup$ npm install hexo-git-backup --save</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å»ºGitHubä»“åº“"><a href="#æ–°å»ºGitHubä»“åº“" class="headerlink" title="æ–°å»ºGitHubä»“åº“"></a>æ–°å»ºGitHubä»“åº“</h3><p>æ–°å»ºä¸€ä¸ª GitHub ä»“åº“ç”¨æ¥å¤‡ä»½åšå®¢ï¼ˆå…·ä½“æ“ä½œä¸å†èµ˜è¿°ï¼‰</p>
<p>å¤åˆ¶ä»“åº“ï¼³ï¼³ï¼¨é“¾æ¥å¤‡ç”¨ï¼Œæ­¤å¤„éœ€ç¡®ä¿ä½ çš„ç”µè„‘å·²é€šè¿‡SSHè¿æ¥åˆ° GitHub ï¼Œå…·ä½“æ“ä½œå¯å‚è€ƒ<a href="https://help.github.com/en/articles/connecting-to-github-with-ssh" target="_blank" rel="noopener"> GitHub å®˜æ–¹å¸®åŠ©æ–‡æ¡£</a>ã€‚</p>
<h2 id="æ’ä»¶é…ç½®"><a href="#æ’ä»¶é…ç½®" class="headerlink" title="æ’ä»¶é…ç½®"></a>æ’ä»¶é…ç½®</h2><p>åœ¨åšå®¢æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­é…ç½®æ’ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">backup:    </span><br><span class="line">	type: git    </span><br><span class="line">	repository: github: git@github.com:xxx/xxx.git,branchName       </span><br><span class="line">	gitcafe: git@github.com:xxx/xxx.git,branchName</span><br></pre></td></tr></table></figure>

<h4 id="é…ç½®è¯´æ˜ï¼š"><a href="#é…ç½®è¯´æ˜ï¼š" class="headerlink" title="é…ç½®è¯´æ˜ï¼š"></a>é…ç½®è¯´æ˜ï¼š</h4><p>å¦‚æœä½ æƒ³è¿åŒä¸»é¢˜ä¸€èµ·å¤‡ä»½ï¼Œåœ¨ <code>_config.yml</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸»é¢˜åå³å¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">backup:    </span><br><span class="line">    type: git    </span><br><span class="line">    theme: coney,landscape,xxx    </span><br><span class="line">	repository:       </span><br><span class="line">    github: git@github.com:xxx/xxx.git,branchName       </span><br><span class="line">    gitcafe: git@github.com:xxx/xxx.git,branchName</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼šå¦‚æœä½ é€‰æ‹©äº†å¤‡ä»½ä¸»é¢˜ä¾‹å¦‚landscapeï¼Œé‚£ä¹ˆlandscapeä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„ themes/landscape/.git æ–‡ä»¶å°±ä¼šè¢«åˆ é™¤</strong></p>
<p>å¦‚æœä½ æƒ³è‡ªå®šä¹‰ commit ä¿¡æ¯ï¼Œæ·»åŠ ä¸€è¡Œ <code>message: update xxx</code> å³å¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">backup:    </span><br><span class="line">	type: git    </span><br><span class="line">	message: update xxx    </span><br><span class="line">	repository:       </span><br><span class="line">        github: git@github.com:xxx/xxx.git,branchName       </span><br><span class="line">        gitcafe: git@github.com:xxx/xxx.git,branchName</span><br></pre></td></tr></table></figure>

<h2 id="æ’ä»¶ä½¿ç”¨"><a href="#æ’ä»¶ä½¿ç”¨" class="headerlink" title="æ’ä»¶ä½¿ç”¨"></a>æ’ä»¶ä½¿ç”¨</h2><p>ç°åœ¨å°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¤‡ä»½ä½ çš„åšå®¢åˆ°GitHubäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ hexo backup</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ hexo b</span><br></pre></td></tr></table></figure>

<p>åšå®¢å¤‡ä»½è‡³æ­¤å°±å·²ç»ç»“æŸï¼å®‰å…¨èµ·è§å¯ä»¥æ¯æ¬¡ <code>hexo d</code> çš„æ—¶å€™åŒæ­¥ <code>hexo b</code> å¤‡ä»½ä¸€ä¸‹åšæ–‡ã€‚</p>
<h1 id="æ¢å¤"><a href="#æ¢å¤" class="headerlink" title="æ¢å¤"></a>æ¢å¤</h1><p>æœ‰æ—¶å€™æ¢äº†å¦ä¸€å°ç”µè„‘æˆ–è€…å¦ä¸€ä¸ªç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œæƒ³è¦å†™åšå®¢å°±ä¸å¾—ä¸æŠŠåšå®¢æ–‡ä»¶è¿ç§»è¿‡å»ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯å…³äºåšå®¢çš„è¿ç§»ï¼Œæ¥ä¸Šæ–‡ä½¿ç”¨ hexo-git-backup æ’ä»¶çš„æƒ…å†µä¸‹ï¼ˆå…¶ä»–æ–¹æ³•å¤‡ä»½çš„åšå®¢åŸç†ç±»ä¼¼ï¼‰ã€‚</p>
<h3 id="å®‰è£…Hexo"><a href="#å®‰è£…Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h3><p>æ ¹æ® Hexo å®˜ç½‘è¯´æ˜å®‰è£… Hexo å³å¯</p>
<p>é™„ä¸Šå®˜ç½‘åœ°å€ï¼š<a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">https://hexo.io/zh-cn/</a></p>
<p>è¦éƒ¨ç½²åšå®¢åˆ° GitHub è¿˜éœ€è¦å®‰è£…æ’ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ npm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure>

<h3 id="æ¢å¤åšå®¢"><a href="#æ¢å¤åšå®¢" class="headerlink" title="æ¢å¤åšå®¢"></a>æ¢å¤åšå®¢</h3><p>ä¸‹è½½æˆ–è€… clone å‰æ–‡æ‰€è¿°å¤‡ä»½çš„åšå®¢åˆ°æœ¬åœ°ä»»æ„ä½ç½®ï¼Œå¤åˆ¶å¤‡ä»½æ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶åˆ°æ–°å®‰è£…çš„åšå®¢ç›®å½•ä¸‹ï¼Œé‡å¤æ–‡ä»¶ä¿ç•™å¤‡ä»½çš„å³å¯ã€‚</p>
<p>è‡³æ­¤åšå®¢è¿ç§»å·²å®Œæˆï¼Œå¯ä»¥â€ä¸‰éƒ¨æ›²â€œæµ‹è¯•ä¸€ä¸‹æ˜¯å¦è¿ç§»æˆåŠŸï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ hexo clean$ hexo g$ hexo s</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">åˆ†æ”¯æ“ä½œï¼š</span><br><span class="line">git branch -a #æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ </span><br><span class="line">git branch -r #æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ </span><br><span class="line">git branch -vv #æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯æ‰€å…³è”çš„è¿œç¨‹åˆ†æ”¯</span><br><span class="line">git branch -m old_branch new_branch # é‡å‘½ä»¤æœ¬åœ°åˆ†æ”¯</span><br><span class="line">ç‰ˆæœ¬å›é€€</span><br><span class="line">git log æ˜¾ç¤ºæäº¤æ—¥å¿—</span><br><span class="line">git reset --hard a7e1d279</span><br><span class="line">git checkout -b add_orderdesc åœ¨æœ¬åœ°åˆ›å»º+åˆ‡æ¢åˆ†æ”¯ </span><br><span class="line">git push origin add_orderdesc æ–°å»ºè¿œç¨‹åˆ†æ”¯</span><br><span class="line">git branch --set-upstream-to=origin/add_orderdesc æŠŠæœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹originçš„åˆ†æ”¯è¿›è¡Œå…³è”å¤„ç†</span><br><span class="line">git branch -u origin/addFile  å»ºç«‹å½“å‰åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»:</span><br><span class="line">git branch --unset-upstream  æ’¤é”€æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„æ˜ å°„å…³ç³»</span><br><span class="line"></span><br><span class="line">touch README.md</span><br><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m "first commit"</span><br><span class="line">git remote add origin https://xxxxxxx/wangdong/helloworld.git</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line">å¦‚æœæœ¬åœ°çš„ä»£ç ï¼Œæ²¡æœ‰å…³è”ä»»ä½•è¿œç¨‹åˆ†æ”¯</span><br><span class="line">git remote add origin https://xxxxxxx/wangdong/helloworld.git</span><br><span class="line">git push -u origin master</span><br><span class="line">git remote remove origin è§£é™¤å½“å‰åˆ†æ”¯ä¸è¿œç¨‹ä»“åº“å…³è”</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Coding</category>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>GitHub</tag>
        <tag>Coding</tag>
      </tags>
  </entry>
  <entry>
    <title>äººæœˆç¥è¯è¯»åæ„Ÿ</title>
    <url>//post/30551.html</url>
    <content><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/27521161" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/27521161</a></p><h2 id="ç¬¬ä¸€ç« -ç„¦æ²¹å‘"><a href="#ç¬¬ä¸€ç« -ç„¦æ²¹å‘" class="headerlink" title="ç¬¬ä¸€ç«  ç„¦æ²¹å‘"></a>ç¬¬ä¸€ç«  ç„¦æ²¹å‘</h2><p>ç¨‹åºå˜æˆç¼–ç¨‹ç³»ç»Ÿäº§å“ï¼Œå®ƒçš„æˆæœ¬é«˜è¾¾ä¹å€ã€‚ç„¶è€Œï¼Œåªæœ‰å®ƒæ‰æ˜¯çœŸæ­£æœ‰ç”¨çš„äº§å“ï¼Œæ˜¯å¤§å¤šæ•°ç³»ç»Ÿå¼€å‘çš„ç›®æ ‡ã€‚ ç¼–ç¨‹çš„ä¹è¶£ï¼š1.åˆ›é€ äº‹ç‰©çš„å¿«ä¹ã€‚2.æ¥è‡ªå¼€å‘å¯¹åˆ«äººæœ‰å¸®åŠ©çš„ä¸œè¥¿ã€‚3. å°†å„ä¸ªé›¶ä»¶ç»„è£…èµ·æ¥å¹¶ç²¾ç¡®è¿è¡Œå¾—åˆ°é¢„å…ˆæƒ³è¦å¾—åˆ°çš„æ•ˆæœã€‚4.å­¦ä¹ çš„ä¹è¶£ã€‚5.ä»£ç è¿™ç§ä»‹è´¨å¯ä»¥ä½¿ç¨‹åºå‘˜è½»æ¾çš„åˆ›é€ è‡ªå·±çš„â€œåŸå ¡â€ã€‚æ€»ä¹‹ç¼–ç¨‹éå¸¸æœ‰è¶£ï¼Œåœ¨äºå®ƒä¸ä»…æ»¡è¶³äº†æˆ‘ä»¬å†…å¿ƒæ·±å¤„è¿›è¡Œåˆ›é€ çš„æ¸´æœ›ï¼Œè€Œä¸”è¿˜æ„‰æ‚¦äº†æ¯ä¸ªäººå†…åœ¨çš„æƒ…æ„Ÿã€‚ ç¼–ç¨‹çš„è‹¦æ¼ï¼š1.è¿½æ±‚å®Œç¾ã€‚2.å¯»æ‰¾bugã€‚3.äº§å“å®Œæˆæ—¶å·²ç»è¿‡æ—¶çš„å¨èƒã€‚4ç¼–ç¨‹äººå‘˜å¾ˆå°‘èƒ½æ§åˆ¶å·¥ä½œç¯å¢ƒå’Œå·¥ä½œç›®æ ‡ã€‚å®é™…çš„æƒå¨æ¥è‡ªäºæ¯æ¬¡ä»»åŠ¡çš„å®Œæˆã€‚5.å¸¸å¸¸éœ€è¦ä¾èµ–åˆ«äººç³Ÿç³•çš„ç¨‹åºå’Œæ–‡æ¡£ã€‚</p><a id="more"></a>

<h2 id="ç¬¬äºŒç« -äººæœˆç¥è¯"><a href="#ç¬¬äºŒç« -äººæœˆç¥è¯" class="headerlink" title="ç¬¬äºŒç«  äººæœˆç¥è¯"></a>ç¬¬äºŒç«  äººæœˆç¥è¯</h2><p>åœ¨ä¼—å¤šè½¯ä»¶é¡¹ç›®ä¸­ï¼Œç¼ºä¹åˆç†çš„æ—¶é—´è¿›åº¦æ˜¯é€ æˆé¡¹ç›®æ»åçš„æœ€ä¸»è¦åŸå› ï¼Œå®ƒæ¯”å…¶ä»–æ‰€æœ‰å› ç´ åŠ èµ·æ¥çš„å½±å“è¿˜å¤§ã€‚ å¯¼è‡´è¿™ç§ç¾éš¾çš„åŸå› ï¼š</p>
<ol>
<li>ä¹è§‚ä¸»ä¹‰ï¼šç¼–ç¨‹äººå‘˜æ½œåœ¨è®¤ä¸ºç¨‹åºä¼šä¸€åˆ‡è¿è¡Œè‰¯å¥½ï¼Œä½†æˆ‘ä»¬çš„æ„æ€æ€»ä¼šå­˜åœ¨ç¼ºé™·ï¼Œå› æ­¤æ€»ä¼šå­˜åœ¨bugï¼Œåœ¨å¤§å‹çš„ç¼–ç¨‹ä»»åŠ¡ä¸­ä¸€åˆ‡æ­£å¸¸çš„æ¦‚ç‡éå¸¸å°ç”šè‡³æ¥è¿‘äºæ— ã€‚</li>
<li>äººæœˆï¼šä½œè€…è®¤ä¸ºç”¨äººæœˆä½œä¸ºè¡¡é‡ä¸€é¡¹å·¥ä½œçš„è§„æ¨¡æ˜¯ä¸€ä¸ªå±é™©å’Œå¸¦æœ‰æ¬ºéª—æ€§çš„ç¥è¯ã€‚ å®ƒæš—ç¤ºç€äººå‘˜æ•°é‡å’Œæ—¶é—´æ˜¯å¯ä»¥ç›¸äº’æ›¿æ¢çš„ã€‚äººæ•°å’Œæ—¶é—´çš„äº’æ¢ä»…ä»…é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼šæŸä¸ªä»»åŠ¡å¯ä»¥åˆ†è§£ç»™å‚ä¸äººå‘˜ï¼Œå¹¶ä¸”ä»–ä»¬ä¹‹é—´ä¸éœ€è¦ç›¸äº’çš„äº¤æµã€‚è¿™åœ¨å‰²å°éº¦æˆ–æ”¶è·æ£‰èŠ±çš„å·¥ä½œä¸­æ˜¯å¯è¡Œçš„ï¼›è€Œåœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­è¿‘ä¹ä¸å¯èƒ½ã€‚ç³»ç»Ÿç¼–ç¨‹åœ¨å¢åŠ äººåŠ›çš„æ—¶å€™éœ€è¦é¢å¤–å¢åŠ çš„äº¤æµæˆæœ¬ï¼Œè¿™ç§äº¤æµå’Œæ²Ÿé€šçš„å·¥ä½œé‡å·¨å¤§ï¼Œåœ¨ç›¸åŒäººæœˆä¸‹ï¼Œå¢åŠ æ›´å¤šçš„äººæ‰‹å®é™…ä¸Šä¼šå¢åŠ æ—¶é—´è¿›åº¦è€Œä¸æ˜¯å‡å°‘ã€‚</li>
<li>ç³»ç»Ÿæµ‹è¯•ï¼šä¼ ç»Ÿé¡¹ç›®å¾€å¾€ä¸é‡è§†æµ‹è¯•ï¼Œä¸å®‰æ’è¶³å¤Ÿçš„æ—¶é—´ä½†å®é™…ä¸­æµ‹è¯•å ç”¨äº†å¤§é‡æ—¶é—´ï¼Œå› æ­¤ä½œè€…æå‡º1/3 è®¡åˆ’ 1/6 ç¼–ç 1/4 æ„ä»¶æµ‹è¯•å’Œæ—©æœŸç³»ç»Ÿæµ‹è¯• 1/4 ç³»ç»Ÿæµ‹è¯•</li>
<li>ç©ºæ³›çš„ä¼°ç®—ï¼šäº§å“ç»ç†è¦å¯¹è‡ªå·±çš„ä¼°ç®—è‡ªä¿¡ï¼Œé¿å…ä¸ºäº†é¡¾å®¢çš„æœŸæœ›çš„æ—¥æœŸè€Œé€ æˆä¸åˆç†çš„è¿›åº¦å®‰æ’</li>
<li>é‡å¤äº§ç”Ÿçš„è¿›åº¦ç¾éš¾ï¼šä½œè€…è®¤ä¸ºå‘è¿›åº¦è½åçš„é¡¹ç›®ä¸­å¢åŠ äººæ‰‹ï¼Œåªä¼šä½¿è¿›åº¦æ›´åŠ è½å</li>
</ol>
<h2 id="ç¬¬ä¸‰ç« -å¤–ç§‘æ‰‹æœ¯é˜Ÿä¼"><a href="#ç¬¬ä¸‰ç« -å¤–ç§‘æ‰‹æœ¯é˜Ÿä¼" class="headerlink" title="ç¬¬ä¸‰ç«  å¤–ç§‘æ‰‹æœ¯é˜Ÿä¼"></a>ç¬¬ä¸‰ç«  å¤–ç§‘æ‰‹æœ¯é˜Ÿä¼</h2><p>ä¼˜ç§€çš„ç¨‹åºå‘˜å’Œè¾ƒå·®çš„ç¨‹åºå‘˜ä¹‹é—´ç”Ÿäº§ç‡çš„å·®å¼‚æƒŠäºº å¯¹äºæ•ˆç‡å’Œæ¦‚å¿µçš„å®Œæ•´æ€§æ¥è¯´æœ€å¥½ç”±å°‘æ•°å¹²ç»ƒçš„äººå‘˜è®¾è®¡å’Œå¼€å‘ã€‚ å¯¹äºå¤§å‹ç³»ç»Ÿï¼Œéœ€è¦å¤§é‡äººæ‰‹æ¥æ»¡è¶³äº§å“åœ¨æ—¶é—´ä¸Šçš„è¦æ±‚ ä¸ºäº†è°ƒå’Œä¸Šè¿°çŸ›ç›¾Millsæå‡ºäº†ä¸€ç§æå‡ºäº†ä¸€ç§ç±»ä¼¼å¤–ç§‘æ‰‹æœ¯é˜Ÿä¼ç»„å»ºæ–¹å¼å³åäººç»„æˆçš„å›¢é˜Ÿç”±ä¸€ä¸ªäººæ¥å®Œæˆé—®é¢˜çš„åˆ†è§£ï¼Œå…¶ä»–äººç»™äºˆä»–æ‰€éœ€è¦çš„æ”¯æŒä»¥æé«˜æ•ˆç‡å’Œç”Ÿäº§åŠ›ã€‚ å¯¹åäººçš„å›¢é˜Ÿè¿›è¡Œæ‰©å»ºä»…ä»…å¯¹ â€œå¤–ç§‘åŒ»ç”Ÿâ€è¿›è¡Œåè°ƒå³å¯</p>
<h2 id="ç¬¬å››ç« -è´µæ—ä¸“åˆ¶-æ°‘ä¸»æ”¿æ²»å’Œç³»ç»Ÿè®¾è®¡"><a href="#ç¬¬å››ç« -è´µæ—ä¸“åˆ¶-æ°‘ä¸»æ”¿æ²»å’Œç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç¬¬å››ç«  è´µæ—ä¸“åˆ¶,æ°‘ä¸»æ”¿æ²»å’Œç³»ç»Ÿè®¾è®¡"></a>ç¬¬å››ç«  è´µæ—ä¸“åˆ¶,æ°‘ä¸»æ”¿æ²»å’Œç³»ç»Ÿè®¾è®¡</h2><p>ä½œè€…ä¸»å¼ åœ¨ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œæ¦‚å¿µå®Œæ•´æ€§åº”è¯¥æ˜¯æœ€é‡è¦çš„è€ƒè™‘å› ç´ ï¼Œæ¦‚å¿µçš„å®Œæ•´æ€§è¦æ±‚è®¾è®¡å¿…é¡»ç”±ä¸€ä¸ªäººæˆ–è€…éå¸¸å°‘æ•°ç”±é»˜å¥‘çš„äººå‘˜æ¥å®ç°ã€‚å¯¹äºå¤§å‹çš„é¡¹ç›®å°†è®¾è®¡æ–¹æ³•ï¼Œä½“ç³»ç»“æ„æ–¹é¢çš„å·¥ä½œä¸å…·ä½“å®ç°ç›¸åˆ†ç¦»æ˜¯è·å¾—æ¦‚å¿µå®Œæ•´æ€§çš„å¼ºæœ‰åŠ›æ–¹æ³•ã€‚ å¤–éƒ¨ä½“ç³»ç»“æ„è§„å®šå®é™…ä¸Šæ˜¯å¢å¼ºå°ç»„çš„åˆ›é€ æ€§ï¼Œåœ¨æ¯«æ— é™åˆ¶çš„å®ç°å°ç»„ä¸­ä¼šäº§ç”Ÿå¤§é‡çš„æƒ³æ³•å’Œäº‰è®®è€Œå¿½è§†äº†å…·ä½“å®ç°ã€‚</p>
<h2 id="ç¬¬äº”ç« -ç”»è›‡æ·»è¶³"><a href="#ç¬¬äº”ç« -ç”»è›‡æ·»è¶³" class="headerlink" title="ç¬¬äº”ç«  ç”»è›‡æ·»è¶³"></a>ç¬¬äº”ç«  ç”»è›‡æ·»è¶³</h2><p>å®é™…æƒ…å†µä¸­ï¼Œå°½æ—©çš„äº¤æµå’ŒæŒç»­æ²Ÿé€šèƒ½ä½¿ç»“æ„å¸ˆæœ‰è¾ƒå¥½çš„æˆæœ¬æ„è¯†ï¼Œä»¥åŠä½¿å¼€å‘äººå‘˜è·å¾—å¯¹è®¾è®¡çš„ä¿¡æ¯ã€‚ å½“å®ç°äº§å“æ—¶ï¼ŒæŸäº›æ¬¡è¦ç‰¹æ€§çš„ä¿®æ”¹ä¼šé€ æˆæ„æ–™ä¸åˆ°çš„æˆæœ¬å¼€é”€ã€‚ ç¬¬äºŒä¸ªç³»ç»Ÿæ˜¯è®¾è®¡å¸ˆä»¬æ‰€è®¾è®¡çš„æœ€å±é™©çš„ç³»ç»Ÿã€‚è¿‡åˆ†çš„è®¾è®¡ï¼Œæ·»åŠ å¾ˆå¤šä¸éœ€è¦çš„åŠŸèƒ½</p>
<h2 id="ç¬¬å…­ç« -è´¯å½»æ‰§è¡Œ"><a href="#ç¬¬å…­ç« -è´¯å½»æ‰§è¡Œ" class="headerlink" title="ç¬¬å…­ç«  è´¯å½»æ‰§è¡Œ"></a>ç¬¬å…­ç«  è´¯å½»æ‰§è¡Œ</h2><p>ä¸ºäº†å¼€å‘äººå‘˜å‡†ç¡®ç†è§£å¹¶å®ç°æ¶æ„å¸ˆçš„å†³ç­–ä»¥åŠæ¶æ„å¸ˆå°ç»„å†…çš„æ¦‚å¿µä¸€è‡´æ€§ï¼Œä½œè€…æå‡ºäº†ä»¥ä¸‹åŠæ³• 1.æ‰‹å†Œæˆ–è€…ä¹¦é¢è§„æ ¼è¯´æ˜æ˜¯éå¸¸å¿…è¦çš„ã€‚ 2.å½¢å¼åŒ–å®šä¹‰ç²¾ç¡®ä½†éš¾ä»¥ç†è§£ï¼Œè§„æ ¼è¯´æ˜è¦å½¢å¼åŒ–å®šä¹‰è¦ä¸è®°è¿°æ€§æ–‡å­—ç›¸ç»“åˆã€‚ 3.å‘¨ä¼šå’Œå¹´ä¼šæ˜¯å¿…è¦çš„ã€‚ 4.å½“å­˜åœ¨å¤šé‡å®ç°æ—¶å¦‚å®åœ°éµä»æ‰‹å†Œæ›´æ–°æœºå™¨æ‰€é€ æˆçš„å»¶è¿Ÿå’Œæˆæœ¬çš„æ¶ˆè€—ï¼Œæ¯”æ ¹æ®æœºå™¨è°ƒæ•´æ‰‹å†Œè¦ä½ã€‚ 5.ä¸€ç§æœ‰ç”¨çš„æœºåˆ¶æ˜¯ç”±ç»“æ„å¸ˆä¿å­˜ç”µè¯æ—¥å¿—ã€‚æ—¥å¿—ä¸­ï¼Œä»–è®°å½•äº†æ¯ä¸€ä¸ªé—®é¢˜å’Œç›¸åº”çš„å›ç­”ã€‚æ¯å‘¨ï¼Œå¯¹è‹¥å¹²ç»“æ„å¸ˆçš„æ—¥å¿—è¿›è¡Œåˆå¹¶ï¼Œé‡æ–°æ•´ç†ï¼Œå¹¶å‘å¸ƒç»™ç”¨æˆ·å’Œå®ç°äººå‘˜ã€‚ 6.è®¾ç«‹æµ‹è¯•å°ç»„æ˜¯ä½¿è®¾è®¡å†³ç­–å¾—ä»¥è´¯å½»æ‰§è¡Œçš„å¿…è¦æ‰‹æ®µï¼ŒåŒæ ·ä¹Ÿæ˜¯éœ€è¦å°½æ—©ç€æ‰‹ï¼Œä¸è®¾è®¡åŒæ—¶å®æ–½çš„é‡è¦ç¯èŠ‚ã€‚</p>
<h2 id="ç¬¬ä¸ƒç« -ä¸ºä»€ä¹ˆå·´æ¯”ä¼¦å¡”ä¼šå¤±è´¥"><a href="#ç¬¬ä¸ƒç« -ä¸ºä»€ä¹ˆå·´æ¯”ä¼¦å¡”ä¼šå¤±è´¥" class="headerlink" title="ç¬¬ä¸ƒç«  ä¸ºä»€ä¹ˆå·´æ¯”ä¼¦å¡”ä¼šå¤±è´¥"></a>ç¬¬ä¸ƒç«  ä¸ºä»€ä¹ˆå·´æ¯”ä¼¦å¡”ä¼šå¤±è´¥</h2><p>å·´æ¯”ä¼¦å¡”å¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªå·¥ç¨‹ä¸Šçš„å½»åº•å¤±è´¥ï¼Œä½†å®ƒä¸æ˜¯æœ€åä¸€ä¸ªã€‚äº¤æµå’Œäº¤æµçš„ç»“æœâ€”ç»„ç»‡ï¼Œæ˜¯æˆåŠŸçš„å…³é”®ã€‚äº¤æµå’Œç»„ç»‡çš„æŠ€èƒ½éœ€è¦ç®¡ç†è€…ä»”ç»†è€ƒè™‘ï¼Œç›¸å…³ç»éªŒçš„ç§¯ç´¯å’Œèƒ½åŠ›çš„æé«˜åŒè½¯ä»¶æŠ€æœ¯æœ¬èº«ä¸€æ ·é‡è¦ã€‚ ä½œè€…æ€»ç»“å·´æ¯”ä¼¦å¡”é¡¹ç›®å¤±è´¥çš„åŸå› æ˜¯ç¼ºä¹äº¤æµå’Œç¼ºä¹ç»„ç»‡ï¼Œå› æ­¤ä½œè€…è®¤ä¸ºåœ¨è½¯ä»¶é¡¹ç›®ä¸­æœ‰æ•ˆçš„äº¤æµå’Œç»„ç»‡æ˜¯ååˆ†é‡è¦çš„ï¼Œé¡¹ç›®å·¥ä½œæ‰‹å†Œä½œä¸ºæˆå‘˜äº¤æµçš„æˆæœå¹¶ä¸”ä¿è¯äº†é¡¹ç›®çš„æ¦‚å¿µä¸€è‡´æ€§ã€‚åœ¨å¤§å‹ç¼–ç¨‹é¡¹ç›®çš„ç»„ç»‡æ¶æ„ä¸­ï¼Œä¸ºäº†å‡å°‘äº¤æµçš„æ•°é‡æå‡ºäº†æ ‘çŠ¶ç®¡ç†ç»“æ„ã€‚ä½œè€…å»ºè®®åœ¨å°å‹å›¢é˜Ÿä»¥æŠ€æœ¯ä¸»ç®¡ä¸ºä¸»äº§å“è´Ÿè´£äººä¸ºè¾…ï¼Œå¤§å‹å›¢é˜Ÿä¸­äº§å“è´Ÿè´£äººä¸ºä¸»æŠ€æœ¯ä¸»ç®¡ä¸ºè¾…ã€‚</p>
<h2 id="ç¬¬å…«ç« -èƒ¸æœ‰æˆè¶³"><a href="#ç¬¬å…«ç« -èƒ¸æœ‰æˆè¶³" class="headerlink" title="ç¬¬å…«ç«  èƒ¸æœ‰æˆè¶³"></a>ç¬¬å…«ç«  èƒ¸æœ‰æˆè¶³</h2><p>å¯¹ç¼–ç æ—¶é—´çš„ä¼°è®¡ä½¿ç”¨æ—¶é—´çš„æ¯”å€¼åæ¨å„ä¸ªä»»åŠ¡çš„æ—¶é—´æ˜¯ä¸åˆç†çš„å¹¶ä¸”å¾ˆå¯èƒ½ä¼šå¸¦æ¥ç³Ÿç³•çš„åæœ ä¸èƒ½ä»¥å°å‹ç¨‹åºçš„å·¥ä½œé‡æ¥ä¼°è®¡å¤§å‹ç¼–ç¨‹ç³»ç»Ÿäº§å“ï¼Œä¸¤è€…ä¹‹é—´çš„å…³ç³»ä¸æ˜¯çº¿æ€§çš„ã€‚ ä½¿ç”¨é€‚å½“çš„é«˜çº§è¯­è¨€ï¼Œç¼–ç¨‹çš„ç”Ÿäº§ç‡å¯ä»¥æé«˜ 5 å€ã€‚</p>
<h2 id="ç¬¬ä¹ç« -å‰Šè¶³é€‚å±¥"><a href="#ç¬¬ä¹ç« -å‰Šè¶³é€‚å±¥" class="headerlink" title="ç¬¬ä¹ç«  å‰Šè¶³é€‚å±¥"></a>ç¬¬ä¹ç«  å‰Šè¶³é€‚å±¥</h2><p>å¼€å‘äººå‘˜å¿…é¡»è®¾ç½®è§„æ¨¡çš„ç›®æ ‡ï¼Œæ§åˆ¶è§„æ¨¡ï¼Œè€ƒè™‘å‡å°‘è§„æ¨¡çš„æ–¹æ³•ã€‚åŒä»»ä½•å¼€é”€ä¸€æ ·ï¼Œè§„æ¨¡æœ¬èº«ä¸æ˜¯åäº‹ï¼Œä½†ä¸å¿…è¦çš„è§„æ¨¡æ˜¯ä¸å¯å–çš„ã€‚ ä»…ä»…å¯¹æ ¸å¿ƒç¨‹åºè®¾å®šè§„æ¨¡ç›®æ ‡æ˜¯ä¸å¤Ÿçš„ï¼Œå¿…é¡»æŠŠæ‰€æœ‰æ–¹é¢çš„è§„æ¨¡éƒ½ç¼–å…¥é¢„ç®—ã€‚åœ¨æŒ‡æ˜æ¨¡å—æœ‰å¤šå¤§çš„åŒæ—¶ï¼Œç¡®åˆ‡å®šä¹‰æ¨¡å—çš„åŠŸèƒ½ã€‚å¼€å‘äººå‘˜ä»ç³»ç»Ÿæ•´ä½“å‡ºå‘ï¼Œé¢å‘ç”¨æˆ·ã€‚</p>
<h2 id="ç¬¬åç« -æçº²æŒˆé¢†"><a href="#ç¬¬åç« -æçº²æŒˆé¢†" class="headerlink" title="ç¬¬åç«  æçº²æŒˆé¢†"></a>ç¬¬åç«  æçº²æŒˆé¢†</h2><p>é¡¹ç›®ç»ç†çš„ä»»åŠ¡æ˜¯åˆ¶è®¢è®¡åˆ’ï¼Œå¹¶æ ¹æ®è®¡åˆ’å®ç°ã€‚ä½†æ˜¯åªæœ‰ä¹¦é¢è®¡åˆ’æ˜¯ç²¾ç¡®å’Œå¯ä»¥æ²Ÿé€šçš„ã€‚è®¡åˆ’ä¸­åŒ…æ‹¬äº†æ—¶é—´ã€åœ°ç‚¹ã€äººç‰©ã€åšä»€ä¹ˆã€èµ„é‡‘ã€‚è¿™äº›å°‘é‡çš„å…³é”®æ–‡æ¡£å°è£…äº†ä¸€äº›é¡¹ç›®ç»ç†çš„å·¥ä½œã€‚å¦‚æœä¸€å¼€å§‹å°±è®¤è¯†åˆ°å®ƒä»¬çš„æ™®éæ€§å’Œé‡è¦æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†æ–‡æ¡£ä½œä¸ºå·¥å…·å‹å¥½åœ°åˆ©ç”¨èµ·æ¥ï¼Œè€Œä¸ä¼šè®©å®ƒæˆä¸ºä»¤äººåŒçƒ¦çš„ç¹é‡ä»»åŠ¡ã€‚é€šè¿‡éµå¾ªæ–‡æ¡£å¼€å±•å·¥ä½œï¼Œé¡¹ç›®ç»ç†èƒ½æ›´æ¸…æ™°å’Œå¿«é€Ÿåœ°è®¾å®šè‡ªå·±çš„æ–¹å‘ã€‚</p>
<h2 id="ç¬¬åä¸€ç« -æœªé›¨ç»¸ç¼ª"><a href="#ç¬¬åä¸€ç« -æœªé›¨ç»¸ç¼ª" class="headerlink" title="ç¬¬åä¸€ç«  æœªé›¨ç»¸ç¼ª"></a>ç¬¬åä¸€ç«  æœªé›¨ç»¸ç¼ª</h2><p>è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ä¸€å®šä¼šå‡ºç°æŠ›å¼ƒæœ€åˆå¼€å‘çš„å®éªŒæ€§ç³»ç»Ÿå› æ­¤ä¸€å®šè¦ä¸ºèˆå¼ƒè€Œè®¡åˆ’ å˜åŒ–æ˜¯ä¸ç”Ÿä¿±æ¥çš„ï¼Œä¸æ˜¯ä¸åˆæ—¶å®œå’Œä»¤äººç”ŸåŒçš„å¼‚å¸¸æƒ…å†µï¼Œå¼€å‘äººå‘˜æ˜¯äº¤ä»˜çš„ç”¨æˆ·æ»¡æ„åº¦è€Œä¸ä»…ä»…æ˜¯æœ‰å½¢çš„äº§å“ã€‚ ç¨‹åºåæœŸç»´æŠ¤çš„æˆæœ¬æƒŠäººï¼Œåœ¨è§£å†³bugçš„åŒæ—¶ä¼šäº§ç”Ÿæ–°çš„bugï¼Œæ‰€æœ‰çš„ä¿®æ”¹éƒ½å€¾å‘äºç ´åç³»ç»Ÿçš„æ¶æ„ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„æ··ä¹±ç¨‹åº¦</p>
<h2 id="ç¬¬åäºŒç« -å¹²å°†è«é‚ª"><a href="#ç¬¬åäºŒç« -å¹²å°†è«é‚ª" class="headerlink" title="ç¬¬åäºŒç«  å¹²å°†è«é‚ª"></a>ç¬¬åäºŒç«  å¹²å°†è«é‚ª</h2><p>åœ¨è½¯ä»¶é¡¹ç›®ä¸­å¼€å‘å’Œç»´æŠ¤å…¬å…±çš„é€šç”¨ç¼–ç¨‹å·¥å…·çš„æ•ˆç‡æ›´é«˜ã€‚ä½œè€…å»ºè®®åœ¨å›¢é˜Ÿä¸­åŠ å…¥å·¥å…·ç®¡ç†äººå‘˜æ¥ç»Ÿä¸€ç®¡ç†é€šç”¨å·¥å…·å¹¶ä¸”å¯¹æ­¤ä¸èƒ½åå•¬äººåŠ›å’Œç‰©åŠ›ã€‚ ç›®æ ‡æœºå™¨çš„ä½¿ç”¨æ—¶é—´åˆ†é…æˆè¿ç»­çš„å—ï¼Œæœºå™¨çš„åˆ©ç”¨ç¨‹åº¦ä¼šé™ä½ä½†ç”Ÿäº§ç‡å´èƒ½æé«˜ã€‚ä¸åœ¨ä½¿ç”¨æœºå™¨çš„æ—¶é—´å—ä¸­çš„å°ç»„å¯ä»¥ä»äº‹æ–‡æ¡£ä¹¦å†™å·¥ä½œã€‚ ä½œè€…åœ¨å¼€å‘OS/360ä¸­ä½¿ç”¨äº†ç¨‹åºåº“å’Œç¨‹åºåº“çš„ç®¡ç†ï¼Œæ˜¯ç°åœ¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·çš„é›å½¢ï¼Œè¯¥å·¥å…·ä½¿å¾—ç¨‹åºæ˜¯å¯æ§çš„å¹¶ä¸”ç¨‹åºçš„å¼€å‘è¿›å±•å˜å¾—æ­£å¼ã€‚ é«˜çº§è¯­è¨€å’Œäº¤äº’å¼ç¼–ç¨‹å·¥å…·æå¤§çš„æé«˜å¼€å‘çš„æ•ˆç‡ã€‚</p>
<h2 id="ç¬¬åä¸‰ç« -æ•´ä½“éƒ¨åˆ†"><a href="#ç¬¬åä¸‰ç« -æ•´ä½“éƒ¨åˆ†" class="headerlink" title="ç¬¬åä¸‰ç«  æ•´ä½“éƒ¨åˆ†"></a>ç¬¬åä¸‰ç«  æ•´ä½“éƒ¨åˆ†</h2><p>å¼€å‘ä¸€ä¸ªèƒ½ç”¨çš„ç³»ç»Ÿå®¹æ˜“ï¼Œä½†å¼€å‘ä¸€ä¸ªå¯é å¥½ç”¨çš„ç³»ç»Ÿå¹¶ä¸å®¹æ˜“ã€‚æœ¬ç« ä½œè€…è®¨è®ºäº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯é çš„ç³»ç»Ÿï¼Œé¦–å…ˆæ˜¯å‰é¢å·²ç»è¯´è¿‡çš„ç¨‹åºå¼€å‘è¦ä¿æŒæ¦‚å¿µå®Œæ•´æ€§ï¼Œå…¶æ¬¡æ˜¯ç¼–å†™ä»»ä½•ä»£ç ä¹‹å‰ï¼Œè§„æ ¼è¯´æ˜å¿…é¡»äº¤ç»™å¤–éƒ¨æµ‹è¯•å°ç»„è¿›è¡Œæµ‹è¯•ã€‚ä½œè€…åˆæåˆ°äº†è‡ªä¸Šè€Œä¸‹çš„è®¾è®¡å³å°†ç³»ç»Ÿå¼€å‘åˆ’åˆ†ä¸ºä½“ç³»ç»“æ„è®¾è®¡ï¼Œè®¾è®¡å®ç°å’Œç‰©ç†ç¼–ç å®ç°ä»¥åŠç»“æ„åŒ–ç¼–ç¨‹çš„æ¦‚å¿µã€‚æ— ç–‘è¿™äº›æ€æƒ³åœ¨å½“æ—¶éƒ½æ˜¯æ¯”è¾ƒå…ˆè¿›çš„ã€‚å¹¶ä¸”è¿™äº›æ¦‚å¿µç°åœ¨ä¹Ÿæœ‰åº”ç”¨ã€‚ä½œè€…å†ä¸€æ¬¡å¼ºè°ƒäº†æµ‹è¯•çš„å¤æ‚æ€§å’Œå›°éš¾åº¦ï¼Œä½œè€…è®¤ä¸ºåœ¨ç³»ç»Ÿé›†æˆæµ‹è¯•ä¸­ä½¿ç”¨ç»è¿‡è°ƒè¯•çš„æ„å»ºå•å…ƒæ¯”â€œåˆåœ¨ä¸€èµ·å°è¯•â€æ›´èŠ‚çœæ—¶é—´ã€‚å¯ä»¥åœ¨é›†æˆæµ‹è¯•ä¸­æ­å»ºè¾…åŠ©æµ‹è¯•å¹³å°ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç°åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„æ¡©æ¨¡å—å’Œé©±åŠ¨æ¨¡å—ã€‚è¿˜æœ‰æ§åˆ¶å˜æ›´ï¼Œä¸€æ¬¡æ·»åŠ ä¸€ä¸ªæ„ä»¶ä»¥åŠé˜¶æ®µåŒ–ã€å®šæœŸå˜æ›´ç­‰æ–¹æ³•æ¥è¿›è¡Œé›†æˆã€‚</p>
<h2 id="ç¬¬åå››ç« -ç¥¸èµ·è§å¢™"><a href="#ç¬¬åå››ç« -ç¥¸èµ·è§å¢™" class="headerlink" title="ç¬¬åå››ç«  ç¥¸èµ·è§å¢™"></a>ç¬¬åå››ç«  ç¥¸èµ·è§å¢™</h2><p>é¡¹ç›®è¿›åº¦å¤§å¹…åº¦è½åçš„åŸå› å¾€å¾€ä¸æ˜¯é‡å¤§ç¾å®³é€ æˆçš„è€Œæ˜¯ä¸€å¤©ä¸€å¤©è¿›åº¦è½åé€ æˆçš„ã€‚é¡¹ç›®è¿›åº¦è¡¨çš„æ¯ä¸€ä»¶äº‹è¢«ç§°ä¸ºâ€œé‡Œç¨‹ç¢‘â€ã€‚é‡Œç¨‹ç¢‘çš„é€‰æ‹©åªæœ‰ä¸€ä¸ªåŸåˆ™ï¼Œé‚£å°±æ˜¯ï¼Œé‡Œç¨‹ç¢‘å¿…é¡»æ˜¯å…·ä½“çš„ã€ç‰¹å®šçš„ã€å¯åº¦é‡çš„äº‹ä»¶ï¼Œèƒ½å¤Ÿè¿›è¡Œæ¸…æ™°å®šä¹‰ã€‚å¿…é¡»å…³å¿ƒæ¯ä¸€å¤©çš„æ»åï¼Œä»–ä»¬æ˜¯å¤§ç¾ç¥¸çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚è®¡åˆ’åç¦»æ—¶ä¸€çº¿ç»ç†çš„åˆ©ç›Šå’Œè€æ¿çš„åˆ©ç›Šæ˜¯å†…åœ¨å†²çªçš„ï¼Œä½†ä¸ºäº†è§£å†³è®¡åˆ’åç¦»å°±å¿…é¡»æŠŠé—®é¢˜æš´éœ²ç»™è€æ¿ï¼Œä½œè€…æå‡ºäº†ä¸¤ç§åŠæ³•ä¸€æ˜¯è€æ¿å’Œä¸€çº¿ç»ç†åº”è¯¥å‡å°‘è§’è‰²çš„å†²çªï¼Œåœ¨ç»ç†å¯ä»¥å¤„ç†çš„æƒ…å†µä¸‹è€æ¿ä¸è¦æ’æ‰‹ï¼ŒäºŒæ˜¯ä»¥å‘¨å’Œæœˆä¸ºå•ä½è¿›è¡Œé¡¹ç›®è¯„å®¡ï¼Œè¯„å®¡ä¸­ä½¿å¾—æ¯ä¸ªäººéƒ½çŸ¥é“é—®é¢˜çš„æ‰€åœ¨ï¼Œè€Œäº§å“æ„ä»¶ç»ç†åº”å‡†å¤‡è§£é‡Šå»¶è¿Ÿçš„åŸå› ï¼Œä»€ä¹ˆæ—¶å€™ç»“æŸï¼Œé‡‡å–çš„æ­¥éª¤å’Œéœ€è¦çš„ä»»ä½•å¸®åŠ©â€”â€”è€æ¿æä¾›çš„ï¼Œæˆ–è€…æ˜¯å…¶ä»–å°ç»„é—´æ¥æä¾›çš„ã€‚</p>
<h2 id="ç¬¬åäº”ç« -å¦å¤–ä¸€é¢"><a href="#ç¬¬åäº”ç« -å¦å¤–ä¸€é¢" class="headerlink" title="ç¬¬åäº”ç«  å¦å¤–ä¸€é¢"></a>ç¬¬åäº”ç«  å¦å¤–ä¸€é¢</h2><p>ä¹¦å†™æ–‡æ¡£æ˜¯å¿…è¦çš„å³ä½¿æ˜¯å®Œå…¨å¼€å‘ç»™è‡ªå·±ä½¿ç”¨çš„ç¨‹åºã€‚å› ä¸ºè®°å¿†è¡°é€€çš„è§„å¾‹ä¼šä½¿ç”¨æˆ·ï¼ä½œè€…å¤±å»å¯¹ç¨‹åºçš„äº†è§£ï¼Œäºæ˜¯ä»–ä¸å¾—ä¸é‡æ‹¾è‡ªå·±åŠ³åŠ¨çš„å„ä¸ªç»†èŠ‚ã€‚ä¸åŒç”¨æˆ·éœ€è¦ä¸åŒçš„æ–‡æ¡£ä½œã€‚å¯¹ä½¿ç”¨ç¨‹åºçš„ç”¨æˆ·æ¥è¯´éœ€è¦ä»æ–‡æ¡£ä¸­äº†è§£ç›®çš„ã€ç¯å¢ƒã€èŒƒå›´ã€è¾“å…¥è¾“å‡ºç­‰ä¿¡æ¯è¿™ä»½æ–‡æ¡£çš„ç»å¤§éƒ¨åˆ†éœ€è¦åœ¨ç¨‹åºç¼–åˆ¶ä¹‹å‰ä¹¦å†™ã€‚ å¯¹éªŒè¯ç¨‹åºçš„ç”¨æˆ·æ¥è¯´éœ€è¦ä»æ–‡æ¡£ä¸­äº†è§£ç¨‹åºè¾¹ç•Œå€¼è¿›è¡Œæµ‹è¯•ã€‚ å¯¹äºä¿®æ”¹ç¨‹åºçš„ç”¨æˆ·æ¥è¯´éœ€è¦ä»æ–‡æ¡£ä¸­äº†è§£ç¨‹åºè¯¦ç»†çš„å®ç°ç»†èŠ‚åŒ…æ‹¬ç»“æ„å›¾ã€ç®—æ³•æè¿°ã€æ¥å£æè¿°ç­‰ã€‚ æµç¨‹å›¾æ˜¯è¢«å¹æ§å¾—æœ€è¿‡åˆ†çš„ä¸€ç§ç¨‹åºæ–‡æ¡£ã€‚äº‹å®ä¸Šï¼Œå¾ˆå¤šç¨‹åºç”šè‡³ä¸éœ€è¦æµç¨‹å›¾ï¼Œå¾ˆå°‘æœ‰ç¨‹åºéœ€è¦ä¸€é¡µçº¸ä»¥ä¸Šçš„æµç¨‹å›¾ã€‚ ä½œè€…æå€¡è‡ªæ–‡æ¡£åŒ–çš„ç¨‹åºå³æŠŠæ–‡æ¡£æ•´åˆåˆ°æºä»£ç ã€‚è¿™å¯¹æ­£ç¡®ç»´æŠ¤æ˜¯ç›´æ¥æœ‰åŠ›çš„æ¨åŠ¨ï¼Œä¿è¯ç¼–ç¨‹ç”¨æˆ·èƒ½æ–¹ä¾¿ã€å³æ—¶åœ°å¾—åˆ°æ–‡æ¡£èµ„æ–™ã€‚</p>
<h2 id="ç¬¬åå…­ç« -æ²¡æœ‰é“¶å¼¹"><a href="#ç¬¬åå…­ç« -æ²¡æœ‰é“¶å¼¹" class="headerlink" title="ç¬¬åå…­ç«  æ²¡æœ‰é“¶å¼¹"></a>ç¬¬åå…­ç«  æ²¡æœ‰é“¶å¼¹</h2><p>åœ¨æœªæ¥çš„åå¹´å†…ï¼Œæ— è®ºæ˜¯åœ¨æŠ€æœ¯è¿˜æ˜¯ç®¡ç†æ–¹æ³•ä¸Šï¼Œéƒ½çœ‹ä¸å‡ºæœ‰ä»»ä½•çªç ´æ€§çš„è¿›æ­¥ï¼Œèƒ½å¤Ÿä¿è¯åœ¨åå¹´å†…å¤§å¹…åº¦åœ°æé«˜è½¯ä»¶çš„ç”Ÿäº§ç‡ã€å¯é æ€§å’Œç®€æ´æ€§ã€‚è½¯ä»¶æ´»åŠ¨åŒ…æ‹¬æ ¹æœ¬ä»»åŠ¡å’Œæ¬¡è¦ä»»åŠ¡ï¼Œè½¯ä»¶è¿‘å¹´æ¥å‡ºç°çš„è¿›æ­¥éƒ½åœ¨æ¬¡è¦ä»»åŠ¡ä¸Šä½†é™¤éæ¬¡è¦ä»»åŠ¡å äº†æ‰€æœ‰å·¥ä½œçš„9/10ï¼Œå¦åˆ™å³ä½¿å…¨éƒ¨æ¬¡è¦ä»»åŠ¡çš„æ—¶é—´ç¼©å‡åˆ°é›¶ä¹Ÿä¸ä¼šå¸¦æ¥ç”Ÿäº§ç‡æ•°é‡çº§ä¸Šçš„æé«˜ã€‚ ä½œè€…è®¤ä¸ºä¸æ˜¯è½¯ä»¶å‘å±•å¤ªæ…¢è€Œæ˜¯ç¡¬ä»¶å‘å±•åœ°å¤ªå¿«ã€‚è½¯ä»¶å¼€å‘ä¸­å›°éš¾çš„éƒ¨åˆ†æ˜¯è§„æ ¼åŒ–ã€è®¾è®¡å’Œæµ‹è¯•è¿™äº›æ¦‚å¿µä¸Šçš„ç»“æ„ï¼Œè€Œä¸æ˜¯å¯¹æ¦‚å¿µè¿›è¡Œè¡¨è¾¾å’Œå¯¹å®ç°é€¼çœŸç¨‹åº¦è¿›è¡ŒéªŒè¯ã€‚å¦‚æœè¿™æ˜¯äº‹å®ï¼Œé‚£ä¹ˆè½¯ä»¶å¼€å‘æ€»æ˜¯éå¸¸å›°éš¾çš„ã€‚å¤©ç”Ÿå°±æ²¡æœ‰é“¶å¼¹ã€‚è½¯ä»¶å¼€å‘å…·æœ‰å¤æ‚åº¦ã€ä¸€è‡´æ€§ã€å¯å˜æ€§å’Œä¸å¯è§æ€§ç­‰ç‰¹ç‚¹ã€‚ é’ˆå¯¹è½¯ä»¶å¼€å‘ä¸­çš„æ ¹æœ¬é—®é¢˜çš„è§£å†³æ–¹æ³•ä½œè€…è®¤ä¸ºç›®å‰æœ‰è´­ä¹°è€Œä¸æ˜¯å¼€å‘è½¯ä»¶ã€éœ€æ±‚ç²¾ç‚¼å’Œå¿«é€ŸåŸå‹ã€å¢é‡å¼€å‘ã€åŸ¹å…»å“è¶Šçš„è®¾è®¡äººå‘˜è¿™å‡ ç§ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>äº‘å°šå‘å¡DockeråŒ–</title>
    <url>//post/3462.html</url>
    <content><![CDATA[<h1 id="1ã€åŸºç¡€é•œåƒ"><a href="#1ã€åŸºç¡€é•œåƒ" class="headerlink" title="1ã€åŸºç¡€é•œåƒ"></a>1ã€åŸºç¡€é•œåƒ</h1><p>ç¯å¢ƒè¦æ±‚</p><ul>
<li><strong>ç¯å¢ƒè¦æ±‚ï¼š</strong><code>Mysql</code>è‡³å°‘<code>5.2</code>ã€<code>Nginx</code>/<code>Apache</code>ã€<code>PHP</code>è‡³å°‘<code>5.4</code>ã€‚</li>
</ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php:<span class="number">5.6</span><span class="number">.40</span>-fpm-alpine3<span class="number">.8</span></span><br></pre></td></tr></table></figure><a id="more"></a>



<h1 id="2ã€éœ€è¦å®‰è£…çš„æ’ä»¶"><a href="#2ã€éœ€è¦å®‰è£…çš„æ’ä»¶" class="headerlink" title="2ã€éœ€è¦å®‰è£…çš„æ’ä»¶"></a>2ã€éœ€è¦å®‰è£…çš„æ’ä»¶</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g'</span> /etc/apk/repositories</span><br><span class="line">docker-php-ext-install pdo_mysql</span><br><span class="line">docker-php-ext-install mysql</span><br></pre></td></tr></table></figure>

<h1 id="3ã€PHPæ‰©å±•å®‰è£…"><a href="#3ã€PHPæ‰©å±•å®‰è£…" class="headerlink" title="3ã€PHPæ‰©å±•å®‰è£…"></a>3ã€PHPæ‰©å±•å®‰è£…</h1><table>
<thead>
<tr>
<th align="left">åç§°</th>
<th align="left">ç±»å‹</th>
<th align="left">è¯´æ˜</th>
<th align="left">çŠ¶æ€</th>
<th align="left">æ“ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ZendGuardLoader</td>
<td align="left">è„šæœ¬è§£å¯†</td>
<td align="left">ç”¨äºè§£å¯†ZendGuardåŠ å¯†è„šæœ¬!</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å¸è½½</a></td>
</tr>
<tr>
<td align="left">ionCube</td>
<td align="left">è„šæœ¬è§£å¯†</td>
<td align="left">ç”¨äºè§£å¯†ionCube EncoderåŠ å¯†è„šæœ¬!</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">fileinfo</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">è‹¥å¯ç”¨å†…å­˜å°äº1Gï¼Œå¯èƒ½ä¼šå®‰è£…ä¸ä¸Š</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">opcache</td>
<td align="left">ç¼“å­˜å™¨</td>
<td align="left">ç”¨äºåŠ é€ŸPHPè„šæœ¬!</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å¸è½½</a></td>
</tr>
<tr>
<td align="left">xcache</td>
<td align="left">ç¼“å­˜å™¨</td>
<td align="left">æ”¯æŒè„šæœ¬ç¼“å­˜å’Œå˜é‡ç¼“å­˜!</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">memcache</td>
<td align="left">ç¼“å­˜å™¨</td>
<td align="left">å¼ºå¤§çš„å†…å®¹ç¼“å­˜å™¨</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">memcached</td>
<td align="left">ç¼“å­˜å™¨</td>
<td align="left">æ¯”memcacheæ”¯æŒæ›´å¤šé«˜çº§åŠŸèƒ½</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å¸è½½</a></td>
</tr>
<tr>
<td align="left">redis</td>
<td align="left">ç¼“å­˜å™¨</td>
<td align="left">åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„Key-Valueæ•°æ®åº“</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å¸è½½</a></td>
</tr>
<tr>
<td align="left">apcu</td>
<td align="left">ç¼“å­˜å™¨</td>
<td align="left">è„šæœ¬ç¼“å­˜å™¨</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">imagemagick</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">Imagické«˜æ€§èƒ½å›¾å½¢åº“</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">xdebug</td>
<td align="left">è°ƒè¯•å™¨</td>
<td align="left">å¼€æºçš„PHPç¨‹åºè°ƒè¯•å™¨</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">imap</td>
<td align="left">é‚®ä»¶æœåŠ¡</td>
<td align="left">é‚®ä»¶æœåŠ¡å™¨å¿…å¤‡</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">exif</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">ç”¨äºè¯»å–å›¾ç‰‡EXIFä¿¡æ¯</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">intl</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">æä¾›å›½é™…åŒ–æ”¯æŒ</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">xsl</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">xslè§£ææ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">Swoole</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">å¼‚æ­¥ã€å¹¶è¡Œã€é«˜æ€§èƒ½ç½‘ç»œé€šä¿¡å¼•æ“</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">yaf</td>
<td align="left">æ¡†æ¶</td>
<td align="left">Yafæ˜¯ä¸€ä¸ªCè¯­è¨€ç¼–å†™çš„PHPæ¡†æ¶</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">phalcon</td>
<td align="left">æ¡†æ¶</td>
<td align="left">phalconæ˜¯ä¸€ä¸ªCè¯­è¨€ç¼–å†™çš„PHPæ¡†æ¶</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">mongo</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">Mongodbæ•°æ®åº“è¿æ¥é©±åŠ¨</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">sg11</td>
<td align="left">è„šæœ¬åŠ å¯†</td>
<td align="left">phpä»£ç æ··æ·†åŠ å¯†</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">pgsql</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•(éœ€æå‰å®‰è£…postgresql)</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">pdo_pgsql</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•(éœ€æå‰å®‰è£…postgresql)</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">readline</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">snmp</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">ldap</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">recode</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">enchant</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">pspell</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">bz2</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">sysvshm</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">calendar</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">gmp</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">wddx</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
<tr>
<td align="left">sysvmsg</td>
<td align="left">é€šç”¨æ‰©å±•</td>
<td align="left">phpå®˜æ–¹æ‰©å±•</td>
<td align="left"></td>
<td align="left"><a href="javascript:;">å®‰è£…</a></td>
</tr>
</tbody></table>
<h1 id="4ã€è®¿é—®"><a href="#4ã€è®¿é—®" class="headerlink" title="4ã€è®¿é—®"></a>4ã€è®¿é—®</h1><p>ç„¶åæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå†æ‰“å¼€åŸŸåè¿›è¡Œå®‰è£…ã€‚<br>        å¦‚æœé‡åˆ°æƒé™ä¸è¶³ï¼Œè¯·ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„appå’Œinstallæ–‡ä»¶å¤¹æƒé™ä¸º777.</p>
<p>ç¨‹åºåå°å…¥å£ï¼š<code>http://xx.com/ysmd</code>ã€‚</p>
]]></content>
      <tags>
        <tag>Docker</tag>
        <tag>äº‘å°š</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ å¯†è§£å¯†</title>
    <url>//post/49371.html</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install pycrypto-2.6.1-cp36-cp36m-win_amd64.whl</span><br><span class="line">å¯èƒ½çš„æŠ¥é”™</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;jinpingzhao&#x2F;p&#x2F;12492878.html</span><br><span class="line">pip install pycryptodome</span><br><span class="line">pyinstaller -F -i key.ico --key 123456789 qq.py</span><br></pre></td></tr></table></figure><a id="more"></a>

<p><a href="https://blog.csdn.net/HW140701/article/details/93494869" target="_blank" rel="noopener">https://blog.csdn.net/HW140701/article/details/93494869</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‡ºç°å¦‚ä¸‹è­¦å‘Šï¼Œè¯´æ˜åŒæ—¶å®‰è£…äº†</span><br><span class="line">pycrypto ä¸ pycryptodome</span><br><span class="line"></span><br><span class="line">[22048] WARNING: file already exists but </span><br><span class="line">should not: C:\Users\DEFAUL~3\AppData\Local\Temp\_MEI220482\Crypto\Cipher\_AES.cp37-win_amd64.pyd</span><br><span class="line"></span><br><span class="line">è§£å†³åŠæ³•</span><br><span class="line">è¿›å…¥</span><br><span class="line">D:\Program Files\Python37\Lib\site-packages\Crypto\Cipher</span><br><span class="line">å¤åˆ¶_raw_cfb.cp37-win_amd64.pydåšå¤‡ä»½</span><br><span class="line">ç„¶åpip uninstall pycryptodome</span><br></pre></td></tr></table></figure>

<h1 id="æ‰“åŒ…pydæ–‡ä»¶"><a href="#æ‰“åŒ…pydæ–‡ä»¶" class="headerlink" title="æ‰“åŒ…pydæ–‡ä»¶"></a>æ‰“åŒ…pydæ–‡ä»¶</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install  cython</span><br><span class="line"></span><br><span class="line">pip install pyinstaller</span><br><span class="line"></span><br><span class="line">å»ºç«‹build_pyd.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup</span><br><span class="line"><span class="keyword">from</span> Cython.Build <span class="keyword">import</span> cythonize</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">'Anything you want'</span>,</span><br><span class="line">    ext_modules=cythonize([<span class="string">"course.py"</span></span><br><span class="line">                            ], language_level=<span class="number">3</span></span><br><span class="line">        ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python build_pyd.py build_ext --inplace</span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…Visual-C-Build-Tools-2015"><a href="#å®‰è£…Visual-C-Build-Tools-2015" class="headerlink" title="å®‰è£…Visual C++ Build Tools 2015"></a>å®‰è£…<a href="http://go.microsoft.com/fwlink/?LinkId=691126" target="_blank" rel="noopener">Visual C++ Build Tools 2015</a></h1><h1 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> set PATH=%path%;C:\Program Files (x86)\Windows Kits\8.1\Windows Performance Toolkit\;C:\Program Files (x86)\Windows Kits\8.1\bin\x64\;C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin\amd64\</span><br><span class="line">set include=C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\include\;C:\Program Files (x86)\Windows Kits\10\Include\10.0.10240.0\ucrt;C:\Program Files (x86)\Windows Kits\8.1\Include\shared\</span><br><span class="line">set lib=C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\lib\amd64\;C:\Program Files (x86)\Windows Kits\8.1\Lib\winv6.3\um\x64;C:\Program Files (x86)\Windows Kits\10\Lib\10.0.10240.0\ucrt\x64\</span><br></pre></td></tr></table></figure>

<h1 id="åç¼–è¯‘pyc"><a href="#åç¼–è¯‘pyc" class="headerlink" title="åç¼–è¯‘pyc"></a>åç¼–è¯‘pyc</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install uncompyle</span><br><span class="line">uncompyle6 æœç´¢å¼•æ“.pyc &gt; æœç´¢å¼•æ“.py</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åç¼–è¯‘ï¼š<a href="https://blog.csdn.net/qq_44198436/article/details/97314626" target="_blank" rel="noopener">https://blog.csdn.net/qq_44198436/article/details/97314626</a></p>
<p>pydï¼š<a href="https://blog.csdn.net/fangkailove/article/details/104965270" target="_blank" rel="noopener">https://blog.csdn.net/fangkailove/article/details/104965270</a></p>
<p>pydå¼•å¯¼ï¼š<a href="https://www.lizenghai.com/archives/898.html#pyd" target="_blank" rel="noopener">https://www.lizenghai.com/archives/898.html#pyd</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>åšå®¢è¿ç§»</title>
    <url>//post/53348.html</url>
    <content><![CDATA[<h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo-cli: 4.2.0</span><br><span class="line">os: Windows_NT 10.0.19042 win32 x64</span><br><span class="line">node: 13.14.0</span><br><span class="line">v8: 7.9.317.25-node.32</span><br><span class="line">uv: 1.37.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">brotli: 1.0.7</span><br><span class="line">ares: 1.16.0</span><br><span class="line">modules: 79</span><br><span class="line">nghttp2: 1.40.0</span><br><span class="line">napi: 6</span><br><span class="line">llhttp: 2.0.4</span><br><span class="line">openssl: 1.1.1g</span><br><span class="line">cldr: 36.1</span><br><span class="line">icu: 66.1</span><br><span class="line">tz: 2019c</span><br><span class="line">unicode: 13.0</span><br></pre></td></tr></table></figure><a id="more"></a>

<p>node ä¸‹è½½ï¼š<a href="https://nodejs.org/download/release/v13.14.0/node-v13.14.0-x64.msi" target="_blank" rel="noopener">https://nodejs.org/download/release/v13.14.0/node-v13.14.0-x64.msi</a></p>
]]></content>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜é›…çš„è§£å†³Typoraçš„å›¾ç‰‡ä¸Šä¼ é—®é¢˜</title>
    <url>//post/38968.html</url>
    <content><![CDATA[<p>1ã€æœ¬åœ°ç›¸å¯¹è·¯å¾„</p><p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/08/26/49722b78124638e97c62f309629c8416.png" alt="image-20200826144350474"></p><p>2ã€PicGoä¸Šä¼ </p><p><a href="https://blog.csdn.net/qq_42573684/article/details/105414197" target="_blank" rel="noopener">https://blog.csdn.net/qq_42573684/article/details/105414197</a></p><a id="more"></a>



<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/7010773e1e3f541507f46d81cf5a6c07.png" alt></p>
<p>PicGoä½¿ç”¨</p>
<p><a href="https://blog.csdn.net/weixin_45701789/article/details/107427487" target="_blank" rel="noopener">https://blog.csdn.net/weixin_45701789/article/details/107427487</a></p>
<p>è§£å†³ä¸Šä¼ çš„ç¨³å®šæ€§</p>
<p><a href="https://wblog.tech/hexo-picgoup.html" target="_blank" rel="noopener">https://wblog.tech/hexo-picgoup.html</a></p>
<p>è‡ªå·±åœ¨åŸåŸºç¡€ä¸Šåšäº†ä¸€äº›æ”¹è¿›</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: yumusb</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020-03-27 14:45:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@LastEditors</span>: yumusb</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@LastEditTime</span>: 2020-03-27 14:45:34</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">URL https://github.com/yumusb/autoPicCdn</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">header(<span class="string">'Content-Type: text/html; charset=UTF-8'</span>);</span><br><span class="line">date_default_timezone_set(<span class="string">"PRC"</span>);</span><br><span class="line">define(<span class="string">"REPO"</span>,<span class="string">"repo"</span>);<span class="comment">//å¿…é¡»æ˜¯ä¸‹é¢ç”¨æˆ·åä¸‹çš„å…¬å¼€ä»“åº“</span></span><br><span class="line">define(<span class="string">"USER"</span>,<span class="string">"user"</span>);<span class="comment">//å¿…é¡»æ˜¯å½“å‰GitHubç”¨æˆ·å</span></span><br><span class="line">define(<span class="string">"MAIL"</span>,<span class="string">"mail"</span>);<span class="comment">//</span></span><br><span class="line">define(<span class="string">"TOKEN"</span>,<span class="string">"token"</span>);<span class="comment">//https://github.com/settings/tokens å»è¿™ä¸ªé¡µé¢ç”Ÿæˆä¸€ä¸ªæœ‰å†™æƒé™çš„tokenï¼ˆwrite:packageså‰æ‰“å‹¾ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">($url, $content)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    $defaultOptions=[</span><br><span class="line">        CURLOPT_URL =&gt; $url,</span><br><span class="line">        CURLOPT_FOLLOWLOCATION =&gt; <span class="keyword">true</span>,</span><br><span class="line">        CURLOPT_RETURNTRANSFER =&gt; <span class="keyword">true</span>,</span><br><span class="line">        CURLOPT_CUSTOMREQUEST=&gt;<span class="string">"PUT"</span>,</span><br><span class="line">        CURLOPT_POSTFIELDS=&gt;json_encode([</span><br><span class="line">            <span class="string">"message"</span>=&gt; date(<span class="string">"Y-m-d H:i:s "</span>),</span><br><span class="line">            <span class="string">"committer"</span>=&gt; [</span><br><span class="line">                <span class="string">"name"</span>=&gt; USER,</span><br><span class="line">                <span class="string">"email"</span>=&gt;MAIL,</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"content"</span>=&gt; $content,</span><br><span class="line">        ]),</span><br><span class="line">        CURLOPT_HTTPHEADER =&gt; [</span><br><span class="line">            <span class="string">"Accept:text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>,</span><br><span class="line">            <span class="string">"Accept-Language:zh-CN,en-US;q=0.7,en;q=0.3"</span>,</span><br><span class="line">            <span class="string">"User-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36"</span>,</span><br><span class="line">            <span class="string">'Authorization:token '</span>.TOKEN,</span><br><span class="line">        ],</span><br><span class="line">    ];</span><br><span class="line">    curl_setopt_array($ch, $defaultOptions);</span><br><span class="line">    $chContents = curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">    <span class="keyword">return</span> $chContents;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'REQUEST_METHOD'</span>] == <span class="string">'POST'</span> &amp;&amp; $_FILES[<span class="string">"pic"</span>][<span class="string">"error"</span>] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    $filename = <span class="string">'images'</span> . <span class="string">'/'</span> . date(<span class="string">'Y'</span>) . <span class="string">'/'</span> . date(<span class="string">'m'</span>) . <span class="string">'/'</span> . date(<span class="string">'d'</span>) . <span class="string">'/'</span> . md5(time()) . <span class="string">".png"</span>;</span><br><span class="line">    $url = <span class="string">"https://api.github.com/repos/"</span> . USER . <span class="string">"/"</span> . REPO . <span class="string">"/contents/"</span> . $filename;</span><br><span class="line">    $tmpName = <span class="string">'./tmp'</span> . md5($filename);</span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">'pic'</span>][<span class="string">'tmp_name'</span>], $tmpName);</span><br><span class="line">    $content = base64_encode(file_get_contents($tmpName));</span><br><span class="line">    $res = json_decode(upload($url, $content), <span class="keyword">true</span>);</span><br><span class="line">    unlink($tmpName);</span><br><span class="line">    <span class="keyword">if</span> ($res[<span class="string">'content'</span>][<span class="string">'path'</span>] != <span class="string">""</span>) &#123;</span><br><span class="line">        $return[<span class="string">'code'</span>] = <span class="string">'success'</span>;</span><br><span class="line">        $return[<span class="string">'data'</span>][<span class="string">'filename'</span>] = $filename;</span><br><span class="line">        $return[<span class="string">'data'</span>][<span class="string">'url'</span>] = <span class="string">'https://cdn.jsdelivr.net/gh/'</span> . USER . <span class="string">'/'</span> . REPO . <span class="string">'/'</span> . $res[<span class="string">'content'</span>][<span class="string">'path'</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $return[<span class="string">'code'</span>] = <span class="number">500</span>;</span><br><span class="line">        $return[<span class="string">'url'</span>] = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $return[<span class="string">'code'</span>] = <span class="number">404</span>;</span><br><span class="line">    $return[<span class="string">'url'</span>] = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">exit</span>(json_encode($return));</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>pyppeteer æ‰‹å†Œ</title>
    <url>//post/63440.html</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰æ®µæ—¶é—´å› ä¸ºæœ‰ä»»åŠ¡ï¼Œéœ€è¦å››ä¸ªç”µå•†(äº¬ä¸œã€æ·˜å®ã€å¤©çŒ«ã€æ‹¼å¤šå¤š)çš„æ•°æ®ã€‚è€Œå…¶ä¸­äº¬ä¸œçš„æ²¡ä»€ä¹ˆåçˆ¬ï¼ŒåŸºæœ¬æ˜¯éšä¾¿æŠ“ã€‚æ‹¼å¤šå¤šçš„åŠ å¯†å‚æ•°æœ‰ç‚¹å¤æ‚ï¼Œè€Œä¸”å˜åŒ–ä¹ŸæŒºé¢‘ç¹çš„ï¼Œç”¨çš„æ˜¯ seleniumï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¯æçš„ã€‚æŠ“æ·˜å®å’Œå¤©çŒ«å› ä¸ºç”¨ selenium æ»‘å—è¿‡ä¸äº†ï¼Œäºæ˜¯å°±æ”¹æˆäº† pyppeteerã€‚ç°åœ¨æˆ‘è¯´ä¸€ä¸‹ä½¿ç”¨çš„å¿ƒå¾—ã€‚æœ‰äº›ç»†èŠ‚å› ä¸ºå½“æ—¶æ²¡æœ‰è®°å½•ï¼Œç°åœ¨ä¹Ÿè®°ä¸èµ·æ¥äº†ã€‚</p><a id="more"></a>
<p>é¦–å…ˆ <code>pip install pyppeteer</code> , è¿™æ—¶å€™æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ websockets è¿™ä¸ªåº“çš„ç‰ˆæœ¬ï¼Œå› ä¸ºå¿…é¡»ä¿è¯è¿™ä¸ªåº“æ˜¯ 7.0 çš„ç‰ˆæœ¬ã€‚8.0 å’Œ 6.0 è™½ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨è®¿é—®å¤šä¸ªç½‘é¡µä¼šå‡ºç°ä¸€äº›æ— æ³•è§£å†³çš„å¼‚å¸¸ã€‚ç°åœ¨å®‰è£… pyppeteerï¼Œwebsockets çš„ç‰ˆæœ¬é»˜è®¤æ˜¯ 8.0ï¼Œæˆ‘ä»¬éœ€è¦å…ˆ <code>pip uninstall websockets</code> å¸è½½ 8.0ï¼Œç„¶å <code>pip install websockets==7.0</code>ã€‚ç„¶åæˆ‘ä»¬æŒ‰ç…§ <a href="https://link.ld246.com/forward?goto=https%3A%2F%2Fgithub.com%2Fmiyakogi%2Fpyppeteer%2Fpull%2F160%2Ffiles" target="_blank" rel="noopener">https://github.com/miyakogi/pyppeteer/pull/160/files</a> è¿™ä¸ªç½‘é¡µä¿®æ”¹ pyppeteer çš„æºç (å¦‚æœæ˜¯ anacondaï¼Œåˆ™è·¯å¾„æ˜¯ anaconda å®‰è£…è·¯å¾„\Lib\site-packages\pyppeteer\connection.py è¿™ä¸ªæ–‡ä»¶)ã€‚è¿™æ ·å‡†å¤‡å·¥ä½œå°±å®Œæˆäº†ï¼Œè¿™æ ·æ“ä½œä¹‹åå°±å¯ä»¥é¿å…å¾ˆå¤šå¼‚å¸¸ã€‚</p>
<p>éœ€è¦è¿™ä¹ˆè´¹åŠ²çš„æŠ˜è…¾ï¼Œæ˜¯å› ä¸º pyppeteer è¿™ä¸ªåº“å·²ç»å¾ˆä¹…æ²¡æœ‰åšå¤§çš„æ›´æ–°äº†ï¼Œè™½ç„¶æœ‰ç‚¹å°çš„æ”¹åŠ¨ï¼Œä½†æ˜¯åŸºæœ¬çš„ bug è¿˜æ˜¯æ²¡æœ‰è§£å†³ã€‚æ‰€ä»¥å¦‚æœæœ‰ js åŸºç¡€ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨ JavaScript çš„ puppeteer è¿™ä¸ªå·¥å…·ï¼Œè¿™ä¸ªæ˜¯è°·æ­Œå‡ºå“çš„ï¼Œä¸€ç›´åœ¨æ›´æ–°ç»´æŠ¤ï¼ŒåŸºæœ¬æ²¡æœ‰ bugã€‚</p>
<p><strong>è¡¥å……ï¼šæœ‰æ—¶å€™ä¼šå‡ºç°æ˜æ˜ç½‘é¡µåŠ è½½å®Œæˆäº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šå‡ºç°è¶…æ—¶çš„æƒ…å†µã€‚ä¸çŸ¥é“æ˜¯ä»€ä¹ˆ bugï¼Œè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œç„¶åè¯¥åšå•¥åšå•¥ã€‚</strong></p>
<p><strong>ä»¥ä¸‹æœ‰çš„æ–¹æ³•å‰é¢å¸¦ coroutine è¿™ä¸ªå…³é”®å­—ï¼Œæœ‰ç‚¹æ²¡æœ‰ï¼Œè¿™æ˜¯å› ä¸ºå¸¦è¿™ä¸ªå‚æ•°çš„æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¿…é¡»è¢« async å…³é”®å­—ä¿®é¥°ï¼Œè°ƒç”¨çš„æ—¶å€™ä¹Ÿå¿…é¡» await å…³é”®å­—ä¿®é¥°ã€‚ä¸è¿‡æˆ‘ä»¬æ—¢ç„¶ä½¿ç”¨æµè§ˆå™¨çˆ¬è™«äº†ï¼Œè‚¯å®šå·²ç»ä¸åœ¨ä¹æ•ˆç‡äº†ï¼Œå¼‚æ­¥ç­‰äºåœ¨ç­‰ç½‘ç«™å°ï¼Œæ‰€ä»¥åªéœ€è¦éµå®ˆæŸäº›è§„åˆ™å³å¯(ä¸æ‡‚çš„è¯·ç™¾åº¦ asyncio çš„ä½¿ç”¨)ï¼Œå®é™…ä¸Šè¿˜æ˜¯åŒæ­¥è¿è¡Œã€‚å¦å¤–ï¼Œè™½ç„¶ page.onï¼ˆï¼‰è¿™ä¸ªæ–¹æ³•æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­å¹¶æœªç»™å‡ºè¯¦ç»†çš„è¯´æ˜ï¼Œç”šè‡³æˆ‘æŸ¥çœ‹ pyppeteer çš„æºç ä¹Ÿæœªæ‰¾åˆ°è¿™ä¸ªå‡½æ•°ï¼Œä¸çŸ¥é“æ˜¯æ€ä¹ˆå›äº‹ã€‚ä½†æ˜¯å‚è€ƒ puppeteer çš„æ–‡æ¡£ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼Œä¸è¿‡æŠ¥é”™å±…å¤šï¼Œæˆ‘ä¹Ÿå°±æ²¡æœ‰æ·±ç©¶äº†ã€‚</strong></p>
<h2 id="API-å‚è€ƒ"><a href="#API-å‚è€ƒ" class="headerlink" title="API å‚è€ƒ"></a>API å‚è€ƒ</h2><h2 id="å¯åŠ¨å™¨"><a href="#å¯åŠ¨å™¨" class="headerlink" title="å¯åŠ¨å™¨"></a>å¯åŠ¨å™¨</h2><ol>
<li>pyppeteer.launcher.launch()<br> å¯åŠ¨ Chrome è¿›ç¨‹å¹¶è¿”å›æµè§ˆå™¨å®ä¾‹</li>
</ol>
<p>å‚æ•°ï¼š</p>
<ul>
<li><code>ignoreHTTPSErrors</code>ï¼ˆboolï¼‰ï¼šæ˜¯å¦å¿½ç•¥ HTTPS é”™è¯¯ã€‚é»˜è®¤ä¸º <code>False</code></li>
<li><code>headless</code>ï¼ˆboolï¼‰ï¼šæ˜¯å¦åœ¨æ— å¤´æ¨¡å¼ä¸‹è¿è¡Œæµè§ˆå™¨ã€‚é»˜è®¤ä¸º <code>True</code> é™¤é <code>appMode</code> æˆ– <code>devtools</code> é€‰é¡¹ <code>True</code></li>
<li><code>executablePath</code> ï¼ˆstrï¼‰ï¼šè¿è¡Œ Chromium æˆ– Chrome å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œè€Œä¸æ˜¯é»˜è®¤æ†ç»‘çš„ Chromium</li>
<li><code>slowMo</code> ï¼ˆint | floatï¼‰ï¼šæŒ‰æŒ‡å®šçš„æ¯«ç§’æ•°å‡æ…¢ pyppeteer æ“ä½œã€‚</li>
<li><code>args</code> ï¼ˆList [str]ï¼‰ï¼šä¼ é€’ç»™æµè§ˆå™¨è¿›ç¨‹çš„é™„åŠ å‚æ•°ï¼ˆæ ‡å¿—ï¼‰ã€‚</li>
<li><code>dumpio</code>ï¼ˆboolï¼‰ï¼šæ˜¯å¦ç®¡é“æµè§ˆå™¨è¿›ç¨‹ stdout å’Œ stderr è¿›å…¥ <code>process.stdout</code> å’Œ <code>process.stderr</code>ã€‚é»˜è®¤ä¸º <code>False</code>ã€‚</li>
<li><code>userDataDir</code> ï¼ˆstrï¼‰ï¼šç”¨æˆ·æ•°æ®ç›®å½•çš„è·¯å¾„ã€‚</li>
<li><code>env</code>ï¼ˆdictï¼‰ï¼šæŒ‡å®šæµè§ˆå™¨å¯è§çš„ç¯å¢ƒå˜é‡ã€‚é»˜è®¤ä¸ python è¿›ç¨‹ç›¸åŒã€‚</li>
<li><code>devtools</code>ï¼ˆboolï¼‰ï¼šæ˜¯å¦ä¸ºæ¯ä¸ªé€‰é¡¹å¡è‡ªåŠ¨æ‰“å¼€ DevTools é¢æ¿ã€‚å¦‚æœæ˜¯æ­¤é€‰é¡¹ <code>True</code>ï¼Œ<code>headless</code> åˆ™å°†è®¾ç½®è¯¥é€‰é¡¹ <code>False</code>ã€‚</li>
<li><code>logLevel</code>ï¼ˆint | strï¼‰ï¼šç”¨äºæ‰“å°æ—¥å¿—çš„æ—¥å¿—çº§åˆ«ã€‚é»˜è®¤å€¼ä¸æ ¹è®°å½•å™¨ç›¸åŒã€‚</li>
<li><code>autoClose</code>ï¼ˆboolï¼‰ï¼šè„šæœ¬å®Œæˆæ—¶è‡ªåŠ¨å…³é—­æµè§ˆå™¨è¿›ç¨‹ã€‚é»˜è®¤ä¸º <code>True</code>ã€‚</li>
<li><code>loop</code>ï¼ˆasyncio.AbstractEventLoopï¼‰ï¼šäº‹ä»¶å¾ªç¯ï¼ˆ<strong>å®éªŒ</strong>ï¼‰ã€‚</li>
</ul>
<hr>
<ul>
<li>ignoreHTTPSErrorsï¼šæ„æ€å¾ˆæ˜æ˜¾ï¼Œä¸è§£é‡Š</li>
<li>headlessï¼šä¸è§£é‡Š</li>
<li>executablePathï¼šè¿™ä¸ªä¸€èˆ¬æ˜¯é»˜è®¤çš„è·¯å¾„å°±è¡Œ</li>
<li>slowMoï¼šæˆ‘ä¸€èˆ¬ä¼šåŠ è¿™ä¸ªå‚æ•°ï¼Œè‡³äºæ•ˆæœå—ï¼Œå¥½åƒæœ‰ç‚¹ã€‚</li>
<li>argsï¼šå¸¸ç”¨çš„æœ‰[â€˜â€“no-sandboxâ€™,â€™â€“disable-gpuâ€™, â€˜â€“disable-setuid-sandboxâ€™,â€™â€“window-size=1440x900â€™]</li>
<li>dumpio: ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå¦‚æœä¸åŠ  dumpio=True æœ‰æ—¶ä¼šå‡ºç°æµè§ˆå™¨å¡é¡¿</li>
<li>userDataDirï¼šselenium çš„ userdata å¯ä»¥ä¿ç•™ cookieï¼Œä¸‹æ¬¡å¯åŠ¨å¯ä»¥è¾¾åˆ°å…ç™»å½•ï¼Œè€Œè¿™ä¸ªå‚æ•°æ²¡ä»€ä¹ˆç”¨</li>
<li>envï¼šçœ‹éœ€æ±‚</li>
<li>devtoolsï¼šç”¨çš„ä¸æ·±ï¼Œæ²¡ç”¨è¿‡</li>
<li>logLevelï¼šæ²¡ä»€ä¹ˆç”¨ï¼Œåœ¨ Linux ä¸‹è¿˜æ˜¯æ‰“å°å¤§é‡çš„æ—¥å¿—</li>
<li>autoCloseï¼šé»˜è®¤å°±å¥½ï¼Œä¸è¿‡å¦‚æœä½ éœ€è¦ä¿æŒæµè§ˆå™¨çŠ¶æ€ï¼Œå¯ä»¥ä¸å…³é—­ï¼Œä¸‹æ¬¡ç›´æ¥è¿æ¥è¿™ä¸ªå·²å­˜åœ¨çš„æµè§ˆå™¨</li>
<li>loopï¼šæš‚æ—¶ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨</li>
</ul>
<ol>
<li>pyppeteer.launcher.connect()<br> è¿æ¥åˆ°ç°æœ‰çš„ Chrome</li>
</ol>
<p>å‚æ•°ï¼š</p>
<ul>
<li><code>browserWSEndpoint</code>ï¼ˆstrï¼‰ï¼šè¦è¿æ¥çš„æµè§ˆå™¨ WebSocket ç«¯ç‚¹ã€‚ï¼ˆ<strong>å¿…å¡«</strong>ï¼‰</li>
<li><code>ignoreHTTPSErrors</code>ï¼ˆboolï¼‰ï¼šæ˜¯å¦å¿½ç•¥ HTTPS é”™è¯¯ã€‚é»˜è®¤ä¸º <code>False</code>ã€‚</li>
<li><code>slowMo</code> ï¼ˆint | floatï¼‰ï¼šæŒ‰æŒ‡å®šçš„æ¯«ç§’æ•°å‡æ…¢ pyppeteer çš„é€Ÿåº¦ã€‚</li>
<li><code>logLevel</code>ï¼ˆint | strï¼‰ï¼šç”¨äºæ‰“å°æ—¥å¿—çš„æ—¥å¿—çº§åˆ«ã€‚é»˜è®¤å€¼ä¸æ ¹è®°å½•å™¨ç›¸åŒã€‚</li>
<li><code>loop</code>ï¼ˆasyncio.AbstractEventLoopï¼‰ï¼šäº‹ä»¶å¾ªç¯ï¼ˆ<strong>å®éªŒ</strong>ï¼‰ã€‚</li>
</ul>
<p>browserWSEndpointï¼šæ ¼å¼æ˜¯ <code>ws://${host}:${port}/devtools/browser/&lt;id&gt;</code>ã€‚ä»¥å‰æµè§ˆå™¨çš„ wsEndpoint è¿™ä¸ªå€¼ï¼Œå¯ä»¥é€šè¿‡ <code>brower = pyppeteer.launcher.launch()</code> <code>dev = brower. wsEndpoint</code> ä¿å­˜è¿™ä¸ªå€¼å°±å¯ä»¥ä¸‹æ¬¡å¯åŠ¨äº†</p>
<ol>
<li>pyppeteer.launcher.executablePath()<br> è·å–é»˜è®¤ Chrome çš„å¯æ‰§è¡Œè·¯å¾„</li>
</ol>
<h2 id="æµè§ˆå™¨ç±»"><a href="#æµè§ˆå™¨ç±»" class="headerlink" title="æµè§ˆå™¨ç±»"></a>æµè§ˆå™¨ç±»</h2><p>pyppeteer.browser.Browser()<br> è¿™ä¸ªç±»æ˜¯ç”± launch()è¿”å›çš„å®ä¾‹</p>
<ul>
<li>browserContextsï¼š è¿”å›æ‰€æœ‰æ‰“å¼€çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡çš„åˆ—è¡¨ï¼Œåœ¨æ–°åˆ›å»ºçš„æµè§ˆå™¨ä¸­ï¼Œè¿™å°†è¿”å›å•ä¸ªå®ä¾‹</li>
<li>coroutine close()ï¼š å…³é—­è¿æ¥å¹¶ç»ˆæ­¢æµè§ˆå™¨è¿›ç¨‹</li>
<li>coroutine createIncognitoBrowserContext(): åˆ›å»ºä¸€ä¸ªæ–°çš„éšèº«æµè§ˆå™¨ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ä¼šä¸å…¶ä»–æµè§ˆå™¨ä¸Šä¸‹æ–‡å…±äº« cookie /ç¼“å­˜</li>
<li>coroutine disconnect(): æ–­å¼€æµè§ˆå™¨</li>
<li>coroutine newPage(): åœ¨æ­¤æµè§ˆå™¨ä¸Šåˆ›å»ºæ–°é¡µé¢å¹¶è¿”å›å…¶å¯¹è±¡</li>
<li>coroutine pages(): è·å–æ­¤æµè§ˆå™¨çš„æ‰€æœ‰é¡µé¢ã€‚è¿”å›æ ¼å¼ä¸ºåˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰é¡µé¢</li>
<li>processï¼šè¿”å›æ­¤æµè§ˆå™¨çš„è¿›ç¨‹</li>
<li>target(): è·å–æµè§ˆå™¨ä¸­æ‰€æœ‰æ´»åŠ¨ç›®æ ‡çš„åˆ—è¡¨</li>
<li>coroutine userAgent()ï¼šè¿”å›æµè§ˆå™¨çš„åŸå§‹ UA</li>
<li>coroutine version(): è·å–æµè§ˆå™¨çš„ç‰ˆæœ¬</li>
<li>wsEndpoint: è¿”å› WebSocket ç«¯ç‚¹ url</li>
</ul>
<h2 id="é¡µé¢ç±»"><a href="#é¡µé¢ç±»" class="headerlink" title="é¡µé¢ç±»"></a>é¡µé¢ç±»</h2><p>pyppeteer.page.Page()<br> ç”± brower.newPage()æˆ–è€… brower.pages()å¾—åˆ°</p>
<ul>
<li>coroutine J()ï¼šåˆ«å querySelector(),çœ‹åå­—å°±çŸ¥é“é€šè¿‡ CSS é€‰æ‹©å™¨æ¥é€‰å‡ºå…ƒç´ </li>
<li>coroutine JJ(): åˆ«å querySelectorAll()</li>
<li>coroutine Jeval(): åŠŸèƒ½æ¯” page.J()åŠŸèƒ½å¤šä¸€ç‚¹ï¼Œå¯ä»¥é€‰å‡ºç½‘é¡µæ–‡æœ¬æˆ–è€…å±æ€§æŒ‡</li>
<li>coroutine JJeval(): querySelectorAllEval()</li>
<li>coroutine Jx(): åˆ«å xpath()</li>
<li>coroutine addScriptTag(): å°†è„šæœ¬æ ‡è®°æ·»åŠ åˆ°æ­¤é¡µé¢, è¿”å› ElementHandle<br> å…¶ä¸­ä¸€ä¸ª urlï¼Œpath æˆ– content é€‰æ‹©æ˜¯å¿…è¦çš„ã€‚<ul>
<li><code>url</code> ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè¦æ·»åŠ çš„è„šæœ¬çš„ URLã€‚</li>
<li><code>path</code> ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè¦æ·»åŠ çš„æœ¬åœ° JavaScript æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
<li><code>content</code> ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè¦æ·»åŠ çš„ JavaScript å­—ç¬¦ä¸²ã€‚</li>
<li><code>type</code>ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè„šæœ¬ç±»å‹ã€‚ä½¿ç”¨ <code>module</code> ä»¥åŠ è½½ä¸€ä¸ª JavaScript ES6 æ¨¡å—ã€‚</li>
</ul>
</li>
<li>coroutine addStyleTag(): å°†æ ·å¼æˆ–é“¾æ¥æ ‡è®°æ·»åŠ åˆ°æ­¤é¡µé¢, è¿”å› ElementHandle<br> å…¶ä¸­ä¸€ä¸ª <code>url</code>ï¼Œ<code>path</code> æˆ– <code>content</code> é€‰æ‹©æ˜¯å¿…è¦çš„ã€‚<ul>
<li><code>url</code> ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè¦æ·»åŠ çš„é“¾æ¥æ ‡è®°çš„ URLã€‚</li>
<li><code>path</code> ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè¦æ·»åŠ çš„æœ¬åœ° CSS æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
<li><code>content</code> ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè¦æ·»åŠ çš„ CSS å­—ç¬¦ä¸²ã€‚</li>
</ul>
</li>
<li>coroutine authenticate(): æä¾› http èº«ä»½éªŒè¯çš„å‡­æ®</li>
<li>coroutine bringToFront(): å°†é¡µé¢ç½®äºå‰é¢</li>
<li>browser: è·å–è¯¥é¡µé¢æ‰€å±çš„æµè§ˆå™¨</li>
<li>coroutine click(): ç›¸å½“äºé¼ æ ‡å·¦é”®å•å‡»åŒ¹é…çš„å…ƒç´ ,å‚æ•°æ˜¯ CSS é€‰æ‹©å™¨çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å…ƒç´ ï¼Œåˆ™ä¼šå¼•å‘ PageError<br> å¯é€‰å‚æ•°ï¼š<ul>
<li><code>button</code>ï¼ˆstrï¼‰ï¼š ï¼Œleftï¼Œright æˆ– middleï¼Œé»˜è®¤ä¸º leftã€‚</li>
<li><code>clickCount</code> ï¼ˆintï¼‰ï¼šé»˜è®¤ä¸º 1ã€‚</li>
<li><code>delay</code>ï¼ˆint | floatï¼‰ï¼šç­‰å¾…æ—¶é—´ mousedown å’Œ mouseup ä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´ã€‚é»˜è®¤ä¸º 0ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„</strong><br> å¦‚æœæ­¤æ–¹æ³•è§¦å‘å¯¼èˆªäº‹ä»¶å¹¶ä¸”å­˜åœ¨å•ç‹¬çš„äº‹ä»¶ï¼Œåˆ™ waitForNavigation()æœ€ç»ˆå¯èƒ½ä¼šå‡ºç°äº§ç”Ÿæ„å¤–ç»“æœçš„ç«äº‰æ¡ä»¶ã€‚å•å‡»å¹¶ç­‰å¾…å¯¼èˆªçš„æ­£ç¡®æ¨¡å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â€‹</span><br></pre></td></tr></table></figure>
<p>await asyncio.gather(</p>
<pre><code>page.waitForNavigation(waitOptions),

page.click(selector, clickOptions),</code></pre><p>)<br>â€‹```</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">å¤§æ¦‚æ„æ€æ˜¯ click()è§¦å‘å¦‚æœä¼šè·³è½¬ç½‘é¡µï¼Œåˆ™éœ€è¦ page.waitForNavigation()è¿™ä¸ªå‡½æ•°æ¥ç­‰å¾…ã€‚ä½†ç‚¹å‡»äº‹ä»¶å’Œè§¦å‘äº‹ä»¶æ˜¯åŒæ—¶çš„ï¼Œæ‰€ä»¥éœ€è¦å°†è¿™ä¸¤ä¸ªäº‹ä»¶ç»‘å®šï¼Œä»£ç å¦‚ä¸Šã€‚</span><br><span class="line"></span><br><span class="line">- coroutine close(): å…³é—­æ­¤é¡µé¢</span><br><span class="line"></span><br><span class="line">- coroutine content(): è·å–é¡µé¢çš„å®Œæ•´ HTML å†…å®¹</span><br><span class="line"></span><br><span class="line">- coroutine cookies(): è·å– cookieã€‚å‚æ•°ä¸º URLï¼Œå¦‚æœæœªæŒ‡å®š URLï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›å½“å‰é¡µé¢ URL çš„ cookieã€‚å¦‚æœæŒ‡å®šäº† URLï¼Œåˆ™ä»…è¿”å›è¿™äº› URL çš„ cookie</span><br><span class="line"></span><br><span class="line">- coverageï¼š è¿”å› coverage</span><br><span class="line"></span><br><span class="line">- coroutine deleteCookie(): åˆ é™¤ cookieï¼Œå‚æ•°ä¸º cookie å­—æ®µå‚æ•°ï¼Œæ¯”å¦‚ nameã€urlã€domainã€path ç­‰</span><br><span class="line"></span><br><span class="line">- coroutine emulate(): æ¨¡æ‹Ÿç»™å®šçš„è®¾å¤‡æŒ‡æ ‡å’Œç”¨æˆ·ä»£ç†ã€‚ç›¸å½“äºåŒæ—¶è®¾ç½®äº† setUserAgent()ã€setViewport()</span><br><span class="line"></span><br><span class="line">- coroutine emulateMedia(): æ¨¡æ‹Ÿé¡µé¢çš„ CSS åª’ä½“ç±»å‹ã€‚å‚æ•°ä¸ºï¼šscreenã€printã€Noneã€‚</span><br><span class="line"></span><br><span class="line">- coroutine evaluate(): åœ¨æµè§ˆå™¨ä¸Šæ‰§è¡Œ js å¹¶è·å–ç»“æœ</span><br><span class="line"></span><br><span class="line">- coroutine evaluateHandle(): åŒä¸Šï¼Œåªæ˜¯ä¼šè¿”å›ä¸€ä¸ªå€¼ã€‚è‡³äºæ˜¯ä»€ä¹ˆï¼Œæ²¡ç”¨è¿‡</span><br><span class="line"></span><br><span class="line">- coroutine evaluateOnNewDocument(): ä¹Ÿæ˜¯æ‰§è¡Œ jsï¼Œè‡³äºåŒºåˆ«ã€‚å¥½åƒæ˜¯åœ¨é¡µé¢è·³è½¬æ—¶æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">- coroutine exposeFunction(): å°† python å‡½æ•°æ·»åŠ åˆ°æµè§ˆå™¨çš„ window å¯¹è±¡ä¸­ nameã€‚ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨</span><br><span class="line"></span><br><span class="line">- coroutine focus(): èšç„¦åŒ¹é…çš„å…ƒç´ ã€‚å¦‚æœä¸å­˜åœ¨ï¼ŒæŠ›å‡º PageError</span><br><span class="line"></span><br><span class="line">- framesï¼šè·å–æ­¤é¡µé¢çš„æ‰€æœ‰ frame</span><br><span class="line"></span><br><span class="line">- coroutine goBack()ï¼šè¿”å›ä¸Šä¸€ä¸ªç½‘é¡µã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› None</span><br><span class="line"></span><br><span class="line">- coroutine goForward(): è·³è½¬åˆ°ä¸‹ä¸€é¡µã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› None</span><br><span class="line"></span><br><span class="line">- coroutine goto(): è®¿é—®æŸä¸ª URLã€‚</span><br><span class="line">   å‚æ•°ï¼š</span><br><span class="line"></span><br><span class="line">  - urlï¼šã€‚ã€‚ã€‚</span><br><span class="line">  - timeoutï¼šã€‚ã€‚ã€‚</span><br><span class="line">  - waitUntilï¼šä»€ä¹ˆæƒ…å†µä¸‹ç®—æˆåŠŸè®¿é—®ã€‚æ²¡çœ‹æ‡‚å‚æ•°çš„å‡ ä¸ªå€¼æœ‰ä»€ä¹ˆç”¨</span><br><span class="line"></span><br><span class="line">- coroutine hover(): é¼ æ ‡æ‚¬åœåŒ¹é…çš„å…ƒç´ </span><br><span class="line"></span><br><span class="line">- isClosed(): åˆ¤æ–­é¡µé¢æ˜¯å¦å…³é—­</span><br><span class="line"></span><br><span class="line">- keyboardï¼š è·å– keyboard å¯¹è±¡</span><br><span class="line"></span><br><span class="line">- mainFrameï¼š è·å– frame é¡µé¢çš„ä¸»è¦å†…å®¹</span><br><span class="line"></span><br><span class="line">- coroutine metrics(): å¥½åƒæ˜¯è·å–é¡µé¢ä¸­çš„ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">- mouseï¼š è·å– mouse å¯¹è±¡</span><br><span class="line"></span><br><span class="line">- coroutine reload(): åˆ·æ–°ç½‘é¡µ</span><br><span class="line"></span><br><span class="line">- coroutine screenshot(): æˆªå›¾</span><br><span class="line">   å‚æ•°ï¼š</span><br><span class="line"></span><br><span class="line">  - &#96;path&#96;ï¼ˆstrï¼‰ï¼šä¿å­˜å›¾åƒçš„æ–‡ä»¶è·¯å¾„ã€‚å±å¹•æˆªå›¾ç±»å‹å°†ä»æ–‡ä»¶æ‰©å±•åä¸­æ¨æ–­å‡ºæ¥ã€‚</span><br><span class="line"></span><br><span class="line">  - &#96;type&#96;ï¼ˆstrï¼‰ï¼šæŒ‡å®šå±å¹•æˆªå›¾ç±»å‹ï¼Œå¯ä»¥æ˜¯ &#96;jpeg&#96; æˆ– &#96;png&#96;ã€‚é»˜è®¤ä¸º &#96;png&#96;ã€‚</span><br><span class="line"></span><br><span class="line">  - &#96;quality&#96;ï¼ˆintï¼‰ï¼šå›¾åƒçš„è´¨é‡ï¼Œåœ¨ 0-100 ä¹‹é—´ã€‚ä¸é€‚ç”¨äº &#96;png&#96; å›¾åƒã€‚</span><br><span class="line"></span><br><span class="line">  - &#96;fullPage&#96;ï¼ˆboolï¼‰ï¼šå¦‚æœä¸º trueï¼Œè¯·æˆªå–å®Œæ•´çš„å¯æ»šåŠ¨é¡µé¢ã€‚é»˜è®¤ä¸º &#96;False&#96;ã€‚</span><br><span class="line"></span><br><span class="line">  -</span><br></pre></td></tr></table></figure>
<pre><code>clip
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    ï¼ˆå­—å…¸ï¼‰ï¼šæŒ‡å®šé¡µé¢å‰ªåˆ‡åŒºåŸŸçš„å¯¹è±¡ã€‚æ­¤é€‰é¡¹åº”åŒ…å«ä»¥ä¸‹å­—æ®µï¼š     </span><br><span class="line"></span><br><span class="line">    - &#96;x&#96; ï¼ˆintï¼‰ï¼šå‰ªè¾‘åŒºåŸŸå·¦ä¸Šè§’çš„ x åæ ‡ã€‚</span><br><span class="line">    - &#96;y&#96; ï¼ˆintï¼‰ï¼šå‰ªè¾‘åŒºåŸŸå·¦ä¸Šè§’çš„ y åæ ‡ã€‚</span><br><span class="line">    - &#96;width&#96; ï¼ˆintï¼‰ï¼šå‰ªåˆ‡åŒºåŸŸçš„å®½åº¦ã€‚</span><br><span class="line">    - &#96;height&#96; ï¼ˆintï¼‰ï¼šå‰ªåˆ‡åŒºåŸŸçš„é«˜åº¦ã€‚</span><br><span class="line"></span><br><span class="line">  - &#96;omitBackground&#96; ï¼ˆboolï¼‰ï¼šéšè—é»˜è®¤çš„ç™½è‰²èƒŒæ™¯å¹¶å…è®¸æ•è·å…·æœ‰é€æ˜åº¦çš„å±å¹•æˆªå›¾ã€‚</span><br><span class="line"></span><br><span class="line">  - &#96;encoding&#96;ï¼ˆstrï¼‰ï¼šå›¾åƒçš„ç¼–ç å¯ä»¥æ˜¯ &#96;&#39;base64&#39;&#96; æˆ– &#96;&#39;binary&#39;&#96;ã€‚é»˜è®¤ä¸º &#96;&#39;binary&#39;&#96;ã€‚</span><br><span class="line"></span><br><span class="line">- coroutine select(): é€‰æ‹©é€‰é¡¹å¹¶è¿”å›æ‰€é€‰å€¼ã€‚å¦‚æœæœªæ‰¾åˆ°å…ƒç´ ï¼ŒæŠ›å‡º ElementHandleErrorã€‚</span><br><span class="line"></span><br><span class="line">- coroutine setCacheEnabled(): ä¸ºæ¯ä¸ªè¯·æ±‚å¯ç”¨&#x2F;ç¦ç”¨ç¼“å­˜ã€‚é»˜è®¤å¯ç”¨</span><br><span class="line"></span><br><span class="line">- coroutine setContent(): å°† HTML åŠ åˆ°ç½‘é¡µ</span><br><span class="line"></span><br><span class="line">- coroutine setCookie(): è®¾ç½® cookie</span><br><span class="line"></span><br><span class="line">- setDefaultNavigationTimeout(): æ›´æ”¹é»˜è®¤çš„æœ€å¤§å¯¼èˆªè¶…æ—¶ã€‚é»˜è®¤ 30 ç§’</span><br><span class="line"></span><br><span class="line">- coroutine setJavaScriptEnabled(): è®¾ç½® JavaScript å¯ç”¨&#x2F;ç¦ç”¨</span><br><span class="line"></span><br><span class="line">- coroutine setExtraHTTPHeaders(): è®¾ç½®é»˜è®¤ headers å¤´ï¼Œå€¼ä¸ºä¸€ä¸ªå­—å…¸</span><br><span class="line"></span><br><span class="line">- coroutine setRequestInterception(): å¯ç”¨&#x2F;ç¦ç”¨è¯·æ±‚æ‹¦æˆªã€‚é…åˆ page.on()</span><br><span class="line"></span><br><span class="line">- coroutine setUserAgent(): è®¾ç½®è¦åœ¨æ­¤é¡µé¢ä¸­ä½¿ç”¨çš„ UA</span><br><span class="line"></span><br><span class="line">- coroutine setViewport(): è®¾ç½®çª—å£å¤§å°ã€‚</span><br><span class="line">   å‚æ•°ï¼š</span><br><span class="line"></span><br><span class="line">  - &#96;width&#96; ï¼ˆintï¼‰ï¼šä»¥åƒç´ ä¸ºå•ä½çš„é¡µé¢å®½åº¦ã€‚</span><br><span class="line">  - &#96;height&#96; ï¼ˆintï¼‰ï¼šä»¥åƒç´ ä¸ºå•ä½çš„é¡µé¢é«˜åº¦ã€‚</span><br><span class="line">  - &#96;deviceScaleFactor&#96; ï¼ˆfloatï¼‰ï¼šé»˜è®¤ä¸º 1.0ã€‚</span><br><span class="line">  - &#96;isMobile&#96;ï¼ˆboolï¼‰ï¼šé»˜è®¤ä¸º &#96;False&#96;ã€‚</span><br><span class="line">  - &#96;hasTouch&#96;ï¼ˆboolï¼‰ï¼šé»˜è®¤ä¸º &#96;False&#96;ã€‚</span><br><span class="line">  - &#96;isLandscape&#96;ï¼ˆboolï¼‰ï¼šé»˜è®¤ä¸º &#96;False&#96;ã€‚</span><br><span class="line"></span><br><span class="line">- coroutine tap(): ç‚¹å‡»ä¸ä¹‹åŒ¹é…çš„å…ƒç´ </span><br><span class="line"></span><br><span class="line">- coroutine title(): è·å–é¡µé¢æ ‡ç­¾</span><br><span class="line"></span><br><span class="line">- tracingï¼šè·å– tracing å¯¹è±¡</span><br><span class="line"></span><br><span class="line">- coroutine type(): å¾€è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º CSS é€‰æ‹©å™¨ï¼Œç¬¬äºŒä¸ªä¸ºæ–‡æœ¬å†…å®¹</span><br><span class="line"></span><br><span class="line">- urlï¼šè·å–æ­¤é¡µé¢çš„ url</span><br><span class="line"></span><br><span class="line">- waitFor(): ç­‰å¾…é¡µé¢ä¸ŠåŒ¹é…çš„å‡½æ•°ï¼Œè¶…æ—¶æˆ–å…ƒç´ ã€‚å‚æ•°å¯ä»¥æ˜¯ int æˆ–è€… floatï¼Œå•ä½æ¯«ç§’ã€‚ä¹Ÿå¯ä»¥æ˜¯ CSS é€‰æ‹©å™¨</span><br><span class="line"></span><br><span class="line">- waitForFunction():</span><br><span class="line"></span><br><span class="line">- coroutine waitForNavigation(): ç­‰åˆ°ç½‘é¡µè·³è½¬</span><br><span class="line"></span><br><span class="line">- coroutine waitForRequest(): ç­‰å¾…è¯·æ±‚</span><br><span class="line"></span><br><span class="line">- coroutine waitForResponse(): ç­‰å¾…å›åº”</span><br><span class="line"></span><br><span class="line">- waitForSelector(): ç­‰åˆ°é¡µé¢ä¸Šå‡ºç°åŒ¹é…çš„å…ƒç´ ã€‚å…¶å® waitFor()ä¹Ÿæœ‰åŒæ ·åŠŸèƒ½ã€‚</span><br><span class="line"></span><br><span class="line">- waitForFunction(): ç­‰åˆ°å‡½æ•°å®Œæˆå¹¶è¿”å›ä¸€ä¸ªå€¼</span><br><span class="line"></span><br><span class="line">- coroutine waitForXPath(): ç­‰åˆ° xpath é¡µé¢ä¸Šå‡ºç°åŒ¹é…çš„å…ƒç´ </span><br><span class="line"></span><br><span class="line">- workers: è·å–é¡µé¢çš„æ‰€æœ‰ workerã€‚è‡³äºæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä¸çŸ¥é“</span><br><span class="line"></span><br><span class="line">- coroutine xpath(): ..</span><br><span class="line"></span><br><span class="line">## worker ç±»</span><br><span class="line"></span><br><span class="line">page.on(&#39;workercreated&#39;, å‡½æ•°) è¿™ä¸ªå‡½æ•°ä¼ å…¥çš„å‚æ•°å°±æ˜¯ worker ç±»</span><br><span class="line"></span><br><span class="line">- coroutine evaluate(): åŒä¸Š</span><br><span class="line">- coroutine evaluateHandle():åŒä¸Š</span><br><span class="line">- coroutine executionContext():åŒä¸Š</span><br><span class="line">- url: åŒä¸Š</span><br><span class="line"></span><br><span class="line">## é”®ç›˜ç±»</span><br><span class="line"></span><br><span class="line">- coroutine down(): å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåˆ™æ˜¯æŒ‰ä¸‹é¼ æ ‡å·¦é”®ã€‚å¦‚æœæ˜¯é”®ç›˜çš„æŸä¸ªå€¼æ¯”å¦‚ shiftã€A ç­‰é”®ï¼Œåˆ™æ˜¯ç›¸å½“äºæŒ‰ä¸‹è¿™äº›é”®ã€‚</span><br><span class="line">- coroutine press(): åŒ down()ï¼Œä½†æ˜¯ä¸Šé¢æ˜¯ä¸ä¼šé‡Šæ”¾é¼ æ ‡æˆ–è€…é”®ç›˜ï¼Œéœ€è¦è°ƒç”¨ up æ–¹æ³•é‡Šæ”¾é¼ æ ‡ã€‚</span><br><span class="line">- coroutine sendCharacterï¼šå°†å­—ç¬¦å‘é€åˆ°é¡µé¢ã€‚æ²¡ç”¨è¿‡</span><br><span class="line">- coroutine type(): åŒä¸Š</span><br><span class="line">- coroutine up(): é‡Šæ”¾ç”± down æŒ‰ä¸‹çš„é”®æˆ–è€…é¼ æ ‡</span><br><span class="line"></span><br><span class="line">## é¼ æ ‡ç±»</span><br><span class="line"></span><br><span class="line">- coroutine click(): æŒ‰ä¸‹(x, y)å¤„çš„æŒ‰é’®</span><br><span class="line">   å‚æ•°ï¼š</span><br><span class="line">  - &#96;button&#96;ï¼ˆSTRï¼‰ï¼š ï¼Œleftï¼ˆå·¦é”®ï¼‰ã€rightï¼ˆå³é”®ï¼‰æˆ– middleï¼ˆä¸­é”®ï¼‰ï¼Œé»˜è®¤ä¸º &#96;left&#96;ã€‚</span><br><span class="line">  - &#96;clickCount&#96; ï¼ˆintï¼‰ï¼šé»˜è®¤ä¸º 1ã€‚</span><br><span class="line">  - &#96;delay&#96;ï¼ˆint | floatï¼‰ï¼šç­‰å¾…æ—¶é—´ &#96;mousedown&#96; å’Œ &#96;mouseup&#96; ä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´ã€‚é»˜è®¤ä¸º 0ã€‚</span><br><span class="line">- coroutine down(): åŒä¸Š</span><br><span class="line">- coroutine move(): ç§»åŠ¨é¼ æ ‡å…‰æ ‡ã€‚</span><br><span class="line">- coroutine up()ï¼š åŒä¸Š</span><br><span class="line"></span><br><span class="line">## tracing ç±»</span><br><span class="line"></span><br><span class="line">åˆ›å»ºå¯åœ¨ Chrome DevTools æˆ–æ—¶é—´çº¿æŸ¥çœ‹å™¨æ‰“å¼€çš„è·Ÿè¸ªæ–‡ä»¶ ï¼Œä½¿ç”¨å¦‚ä¸‹</span><br></pre></td></tr></table></figure></code></pre><p>await page.tracing.start({â€˜pathâ€™: â€˜trace.jsonâ€™})</p>
<p>await page.goto(â€˜<a href="https://www.google.com&#39;" target="_blank" rel="noopener">https://www.google.com&#39;</a>)</p>
<p>await page.tracing.stop()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- coroutine start(): å¼€å§‹è·Ÿè¸ª</span><br><span class="line">- coroutine stop(): åœæ­¢è·Ÿè¸ª</span><br><span class="line"></span><br><span class="line">ä¸å¥½ç”¨ï¼Œå¯èƒ½æ˜¯æˆ‘ä¸çŸ¥é“ç”¨</span><br><span class="line"></span><br><span class="line">## Dialog ç±»</span><br><span class="line"></span><br><span class="line">&#96;page.on( &#39;dialog&#39;, å‡½æ•°)&#96;ï¼Œå‡½æ•°çš„å‚æ•°å°±æ˜¯è¿™ä¸ªç±»</span><br><span class="line"></span><br><span class="line">- coroutine accept(): æ¥å—å¯¹è¯æ¡†</span><br><span class="line">- defaultValueï¼š å¦‚æœå¯¹è¯æ¡†æç¤ºï¼Œåˆ™è·å–é»˜è®¤æç¤ºå€¼</span><br><span class="line">- coroutine dismiss(): å…³é—­å¯¹è¯æ¡†</span><br><span class="line">- message: è·å–å¯¹è¯æ¡†æ¶ˆæ¯</span><br><span class="line">- typeï¼š è·å–å¯¹è¯æ¡†ç±»å‹ã€‚ç±»å‹æœ‰ï¼š&#96;alert&#96;ï¼Œ&#96;beforeunload&#96;ï¼Œ&#96;confirm&#96;ï¼Œæˆ– &#96;prompt&#96;</span><br><span class="line"></span><br><span class="line">## frame ç±»</span><br><span class="line"></span><br><span class="line">- coroutine J():åŒä¸Š</span><br><span class="line">- coroutine JJ():åŒä¸Š</span><br><span class="line">- coroutine JJeval(): åŒä¸Š</span><br><span class="line">- coroutine Jeval(): åŒä¸Š</span><br><span class="line">- coroutine Jx(): åŒä¸Š</span><br><span class="line">- coroutine addScriptTag(): åŒä¸Š</span><br><span class="line">- coroutine addStyleTag(): åŒä¸Š</span><br><span class="line">- childFrames: è·å–å­æ¡†æ¶</span><br><span class="line">- coroutine click(): åŒä¸Š</span><br><span class="line">- coroutine content(): åŒä¸Š</span><br><span class="line">- coroutine evaluate(): åŒä¸Š</span><br><span class="line">- coroutine evaluateHandle(): åŒä¸Š</span><br><span class="line">- coroutine executionContext(): åŒä¸Š</span><br><span class="line">- coroutine focus(): åŒä¸Š</span><br><span class="line">- coroutine hover(): åŒä¸Š</span><br><span class="line">- isDetached()ï¼š å¦‚æœæ­¤æ¡†æ¶å·²åˆ†ç¦»ï¼Œåˆ™è¿”å› True</span><br><span class="line">- nameï¼šè·å– frame çš„åç§°ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å› ID</span><br><span class="line">- parentFrameï¼šè·å–çˆ¶æ¡†æ¶</span><br><span class="line">   åé¢è¿™äº›å±æ€§å’Œ page ç±»ä¸€æ¨¡ä¸€æ ·</span><br><span class="line"></span><br><span class="line">## ElementHandle ç±»</span><br><span class="line"></span><br><span class="line">- coroutine J()</span><br><span class="line">- coroutine JJ()</span><br><span class="line">- coroutine JJeval()</span><br><span class="line">- coroutine Jeval()</span><br><span class="line">- asElement</span><br><span class="line">- coroutine boundingBox(): è¿”å›æ­¤å…ƒç´ çš„è¾¹ç•Œæ¡†,å¦‚æœå…ƒç´ ä¸å¯è§ï¼Œåˆ™è¿”å› None</span><br><span class="line">- coroutine boxModel():è¿”å›å…ƒç´ æ¡†</span><br><span class="line">- coroutine click()</span><br><span class="line">- coroutine contentFrame(): è¿”å›å…ƒç´ å¥æŸ„çš„ frame</span><br><span class="line">- coroutine focus()</span><br><span class="line">- coroutine hover()</span><br><span class="line">- coroutine isIntersectingViewport(): å¦‚æœå…ƒç´ åœ¨è§†å£ä¸­å¯è§ï¼Œåˆ™è¿”å› True</span><br><span class="line">- coroutine press()</span><br><span class="line">- coroutine screenshot()</span><br><span class="line">- coroutine tap()</span><br><span class="line">- coroutine type()</span><br><span class="line">- coroutine uploadFile(): ä¸Šä¼ æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">## request ç±»</span><br><span class="line"></span><br><span class="line">page.on(&#39;request&#39;, å‡½æ•°) è¿™ä¸ªå‡½æ•°ä¼ å…¥çš„å‚æ•°å°±æ˜¯ request ç±»</span><br><span class="line"></span><br><span class="line">- coroutine abort(): ä¸­æ–­è¯·æ±‚</span><br><span class="line"></span><br><span class="line">- coroutine continue_(): ä½¿ç”¨å¯é€‰çš„è¯·æ±‚è¦†ç›–ç»§ç»­è¯·æ±‚</span><br><span class="line"></span><br><span class="line">   å‚æ•°ï¼š   </span><br><span class="line"></span><br><span class="line">  - &#96;url&#96; ï¼ˆstrï¼‰ï¼šå¦‚æœè®¾ç½®ï¼Œè¯·æ±‚ URL å°†è¢«æ›´æ”¹ã€‚</span><br><span class="line">  - &#96;method&#96;ï¼ˆstrï¼‰ï¼šå¦‚æœè®¾ç½®ï¼Œåˆ™æ›´æ”¹è¯·æ±‚æ–¹æ³•ï¼ˆä¾‹å¦‚ &#96;GET&#96;ï¼‰ã€‚</span><br><span class="line">  - &#96;postData&#96; ï¼ˆstrï¼‰ï¼šå¦‚æœè®¾ç½®ï¼Œåˆ™æ›´æ”¹å‘å¸ƒæ•°æ®æˆ–è¯·æ±‚ã€‚</span><br><span class="line">  - &#96;headers&#96; ï¼ˆdictï¼‰ï¼šå¦‚æœè®¾ç½®ï¼Œåˆ™æ›´æ”¹è¯·æ±‚ HTTP æ ‡å¤´</span><br><span class="line"></span><br><span class="line">- failure(): è¿”å›é”™è¯¯æ–‡æœ¬</span><br><span class="line"></span><br><span class="line">- frame : è¿”å›åŒ¹é…çš„ frame å¯¹è±¡</span><br><span class="line"></span><br><span class="line">- headers: è¿”å›æ­¤è¯·æ±‚çš„ HTTP æ ‡å¤´å­—å…¸</span><br><span class="line"></span><br><span class="line">- isNavigationRequest(): ï¼Ÿï¼Ÿ</span><br><span class="line"></span><br><span class="line">- methodï¼šè¿”å›æ­¤è¯·æ±‚çš„æ–¹æ³•</span><br><span class="line"></span><br><span class="line">- postDataï¼š è¿”å›æ­¤è¯·æ±‚çš„å¸–å­æ­£æ–‡</span><br><span class="line"></span><br><span class="line">- redirectChainï¼š request ç±»é‡å®šå‘çš„æ‰€æœ‰è¯·æ±‚</span><br><span class="line"></span><br><span class="line">- resourceTypeï¼šæ¸²æŸ“å¼•æ“æ„ŸçŸ¥çš„æ­¤è¯·æ±‚çš„èµ„æºç±»å‹</span><br><span class="line"></span><br><span class="line">- coroutine respond(): é€šè¿‡ç»™å®šçš„å‚æ•°ä¿®æ”¹è¯·æ±‚</span><br><span class="line"></span><br><span class="line">   å‚æ•°ï¼š   </span><br><span class="line"></span><br><span class="line">  - &#96;status&#96; ï¼ˆintï¼‰ï¼šå“åº”çŠ¶æ€ä»£ç ï¼Œé»˜è®¤ä¸º 200ã€‚</span><br><span class="line">  - &#96;headers&#96; ï¼ˆdictï¼‰ï¼šå¯é€‰çš„å“åº”å¤´ã€‚</span><br><span class="line">  - &#96;contentType&#96;ï¼ˆstrï¼‰ï¼šå¦‚æœè®¾ç½®ï¼Œåˆ™ç­‰äºè®¾ç½® &#96;Content-Type&#96; å“åº”å¤´ã€‚</span><br><span class="line">  - &#96;body&#96; ï¼ˆstr | bytesï¼‰ï¼šå¯é€‰çš„å“åº”ä¸»ä½“ã€‚</span><br><span class="line"></span><br><span class="line">- response(): è¿”å›åŒ¹é…çš„ response å¯¹è±¡</span><br><span class="line"></span><br><span class="line">- urlï¼š æ­¤è¯·æ±‚çš„ URL</span><br><span class="line"></span><br><span class="line">## response ç±»</span><br><span class="line"></span><br><span class="line">- buffer(): è¿”å›ç›¸åº”çš„å­—èŠ‚å†…å®¹</span><br><span class="line">- fromCacheï¼š å¦‚æœå“åº”æ˜¯ä»ç¼“å­˜æä¾›çš„ï¼Œåˆ™è¿”å› Trueã€‚ç¼“å­˜å¯èƒ½æ˜¯æµè§ˆå™¨çš„ç£ç›˜ç¼“å­˜æˆ–è€…å†…å­˜ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨å“åº”çš„</span><br><span class="line">- fromServiceWorkerï¼š å¦‚æœå“åº”ç”±æœåŠ¡å™¨æä¾›ï¼Œåˆ™è¿”å› True</span><br><span class="line">- headersï¼š è¿”å›æ­¤å“åº”çš„ HTTP æ ‡å¤´å­—å…¸</span><br><span class="line">- coroutine json(): è·å–å“åº”æ­£æ–‡çš„ JSON</span><br><span class="line">- okï¼š è¿”å› bool æ­¤è¯·æ±‚æ˜¯å¦æˆåŠŸ</span><br><span class="line">- requestï¼š è·å–åŒ¹é…çš„ request å¯¹è±¡</span><br><span class="line">- securityDetailsï¼š è¿”å›ä¸æ­¤å“åº”å…³è”çš„å®‰å…¨è¯¦ç»†ä¿¡æ¯</span><br><span class="line">- statusï¼š å“åº”çš„çŠ¶æ€ä»£ç </span><br><span class="line">- coroutine text(): è·å–å“åº”æ­£æ–‡çš„æ–‡æœ¬</span><br><span class="line">- url : å“åº”çš„ URL</span><br><span class="line"></span><br><span class="line">## target ç±»</span><br><span class="line"></span><br><span class="line">æˆ‘åˆ°ç°åœ¨è¿˜æ²¡æ˜ç™½è¿™æ˜¯å¹²ä»€ä¹ˆçš„</span><br><span class="line"></span><br><span class="line">- browserï¼š è·å–ç›®æ ‡æ‰€å±çš„æµè§ˆå™¨</span><br><span class="line">- browserContextï¼š è¿”å›ç›®æ ‡æ‰€å±çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡</span><br><span class="line">- coroutine createCDPSession(): åˆ›å»ºé™„åŠ åˆ°ç›®æ ‡çš„ Chrome Devtools åè®®ä¼šè¯</span><br><span class="line">- opener: è·å–æ‰“å¼€æ­¤ç›®æ ‡çš„ç›®æ ‡</span><br><span class="line">- coroutine page(): è·å–æ­¤ç›®æ ‡çš„é¡µé¢</span><br><span class="line">- type: è·å–æ­¤ç›®æ ‡çš„ç±»å‹</span><br><span class="line">- url: è·å–æ­¤ç›®æ ‡çš„ç½‘å€</span><br><span class="line"></span><br><span class="line">## CDPSession ç±»</span><br><span class="line"></span><br><span class="line">- coroutine detach(): ä»ç›®æ ‡åˆ†ç¦»ä¼šè¯</span><br><span class="line">- send() :</span><br><span class="line"></span><br><span class="line">## Debugging</span><br><span class="line"></span><br><span class="line">å¯¹äºè°ƒè¯•ï¼Œæ‚¨å¯ä»¥è®¾ç½® for å’Œ åŠŸèƒ½ &#96;logLevel&#96; é€‰é¡¹ã€‚ä½†æ˜¯ï¼Œæ­¤é€‰é¡¹ä¼šæ‰“å°å¤ªå¤šæ—¥å¿—ï¼ŒåŒ…æ‹¬ pyppeteer çš„ SEND &#x2F; RECV æ¶ˆæ¯ã€‚ä¸ºäº†åªæ˜¾ç¤ºè¢«æŠ‘åˆ¶çš„é”™è¯¯æ¶ˆæ¯ï¼Œæ‚¨åº”è¯¥è®¾ç½® logging.DEBUG ä¸º True</span><br></pre></td></tr></table></figure>
<p>import asyncio<br>import pyppeteer<br>from pyppeteer import launch</p>
<p>pyppeteer.DEBUG = True  # print suppressed errors as error log</p>
<p>async def main():</p>
<pre><code>browser = await launch()

...  # do something</code></pre><p>asyncio.get_event_loop().run_until_complete(main())</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## å®è·µ</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line">import asyncio</span><br><span class="line">from asyncio.tasks import wait</span><br><span class="line">from logging import lastResort</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from pyquery import PyQuery as pq</span><br><span class="line"></span><br><span class="line"># ç¬¬ä¸€æ­¥ å»é™¤æµè§ˆå™¨è‡ªåŠ¨åŒ–å‚æ•°</span><br><span class="line"># å¿…é¡»åœ¨ from pyppeteer import launch å‰å»é™¤å‚æ•°</span><br><span class="line"># å»é™¤è‡ªåŠ¨åŒ– å¯åŠ¨å‚æ•°</span><br><span class="line"># from pyppeteer import launcher</span><br><span class="line"># launcher.AUTOMATION_ARGS.remove(&quot;--enable-automation&quot;)</span><br><span class="line">from pyppeteer import launch</span><br><span class="line"></span><br><span class="line">browser &#x3D; None</span><br><span class="line">launch_kwargs &#x3D; &#123;</span><br><span class="line">    # æ§åˆ¶æ˜¯å¦ä¸ºæ— å¤´æ¨¡å¼</span><br><span class="line">    &quot;headless&quot;: False,</span><br><span class="line">    # chromeå¯åŠ¨å‘½ä»¤è¡Œå‚æ•°</span><br><span class="line">    &quot;args&quot;: [</span><br><span class="line">        # æµè§ˆå™¨ä»£ç† é…åˆæŸäº›ä¸­é—´äººä»£ç†ä½¿ç”¨</span><br><span class="line">        # &quot;--proxy-server&#x3D;http:&#x2F;&#x2F;127.0.0.1:8008&quot;,</span><br><span class="line">        # æœ€å¤§åŒ–çª—å£</span><br><span class="line">        &quot;--start-maximized&quot;,</span><br><span class="line">        # å–æ¶ˆæ²™ç›’æ¨¡å¼ æ²™ç›’æ¨¡å¼ä¸‹æƒé™å¤ªå°</span><br><span class="line">        &quot;--no-sandbox&quot;,</span><br><span class="line">        # ä¸æ˜¾ç¤ºä¿¡æ¯æ   æ¯”å¦‚ chromeæ­£åœ¨å—åˆ°è‡ªåŠ¨æµ‹è¯•è½¯ä»¶çš„æ§åˆ¶ ...</span><br><span class="line">        &quot;--disable-infobars&quot;,</span><br><span class="line">        # logç­‰çº§è®¾ç½® åœ¨æŸäº›ä¸æ˜¯é‚£ä¹ˆå®Œæ•´çš„ç³»ç»Ÿé‡Œ å¦‚æœä½¿ç”¨é»˜è®¤çš„æ—¥å¿—ç­‰çº§ å¯èƒ½ä¼šå‡ºç°ä¸€å¤§å †çš„warningä¿¡æ¯</span><br><span class="line">        &quot;--log-level&#x3D;3&quot;,</span><br><span class="line">        # è®¾ç½®UA</span><br><span class="line">        &quot;--user-agent&#x3D;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;71.0.3578.98 Safari&#x2F;537.36&quot;,</span><br><span class="line">    ],</span><br><span class="line">    &quot;dumpio&quot;: True,</span><br><span class="line">    # å½“ç•Œé¢å¼€å¤šäº†æ—¶ä¼šå¡ä½ï¼Œè®¾ç½®è¿™ä¸ªå‚æ•°å°±ä¸ä¼šäº†</span><br><span class="line">    # ç”¨æˆ·æ•°æ®ä¿å­˜ç›®å½• è¿™ä¸ªæœ€å¥½ä¹Ÿè‡ªå·±æŒ‡å®šä¸€ä¸ªç›®å½•</span><br><span class="line">    # å¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œchromeä¼šè‡ªåŠ¨æ–°å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•ä½¿ç”¨ï¼Œåœ¨æµè§ˆå™¨é€€å‡ºçš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶ç›®å½•</span><br><span class="line">    # åœ¨åˆ é™¤çš„æ—¶å€™å¯èƒ½ä¼šåˆ é™¤å¤±è´¥ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šå‡ºç°æƒé™é—®é¢˜ï¼Œæˆ‘ç”¨çš„windowsï¼‰ å¯¼è‡´æµè§ˆå™¨é€€å‡ºå¤±è´¥</span><br><span class="line">    # ç„¶åchromeè¿›ç¨‹å°±ä¼šä¸€ç›´æ²¡æœ‰é€€å‡º CPUå°±ä¼šç‹‚é£™åˆ°99%</span><br><span class="line">    &quot;userDataDir&quot;: &quot;.&#x2F;userdata&quot;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def screen_size():</span><br><span class="line">    &quot;&quot;&quot;ä½¿ç”¨tkinterè·å–å±å¹•å¤§å°&quot;&quot;&quot;</span><br><span class="line">    import tkinter</span><br><span class="line"></span><br><span class="line">    tk &#x3D; tkinter.Tk()</span><br><span class="line">    width &#x3D; tk.winfo_screenwidth()</span><br><span class="line">    height &#x3D; tk.winfo_screenheight()</span><br><span class="line">    tk.quit()</span><br><span class="line">    return width, height</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    global browser</span><br><span class="line">    if browser is None:</span><br><span class="line">        browser &#x3D; await launch(launch_kwargs)</span><br><span class="line"></span><br><span class="line">    page &#x3D; await browser.newPage()</span><br><span class="line">    width, height &#x3D; screen_size()</span><br><span class="line">    # è®¾ç½®ç½‘é¡µå¯è§†åŒºåŸŸå¤§å°</span><br><span class="line">    # await page.setViewport(&#123;</span><br><span class="line">    #     &quot;width&quot;: width,</span><br><span class="line">    #     &quot;height&quot;: height</span><br><span class="line">    # &#125;)</span><br><span class="line">    # ç¬¬äºŒæ­¥ï¼Œä¿®æ”¹ navigator.webdriveræ£€æµ‹</span><br><span class="line">    # å…¶å®å„ç§ç½‘ç«™çš„æ£€æµ‹jsæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™æ˜¯æ¯”è¾ƒé€šç”¨çš„ã€‚æœ‰çš„ç½‘ç«™ä¼šæ£€æµ‹è¿è¡Œçš„ç”µè„‘è¿è¡Œç³»ç»Ÿï¼Œcpuæ ¸å¿ƒæ•°é‡ï¼Œé¼ æ ‡è¿è¡Œè½¨è¿¹ç­‰ç­‰ã€‚</span><br><span class="line">    # åçˆ¬js</span><br><span class="line">    # éšè—æµè§ˆå™¨é©±åŠ¨ä¿¡æ¯ï¼Œé˜²æ£€æµ‹</span><br><span class="line">    await page.evaluateOnNewDocument(</span><br><span class="line">        &quot;Object.defineProperty(&quot; &#39;navigator, &quot;webdriver&quot;, &#123;get: () &#x3D;&gt; undefined&#125;)&#39;</span><br><span class="line">    )</span><br><span class="line">    js_text &#x3D; &quot;&quot;&quot;</span><br><span class="line">() &#x3D;&gt;&#123; </span><br><span class="line">    Object.defineProperties(navigator,&#123; webdriver:&#123; get: () &#x3D;&gt; false &#125; &#125;);</span><br><span class="line">    window.navigator.chrome &#x3D; &#123; runtime: &#123;&#125;,  &#125;;</span><br><span class="line">    Object.defineProperty(navigator, &#39;languages&#39;, &#123; get: () &#x3D;&gt; [&#39;en-US&#39;, &#39;en&#39;] &#125;);</span><br><span class="line">    Object.defineProperty(navigator, &#39;plugins&#39;, &#123; get: () &#x3D;&gt; [1, 2, 3, 4, 5,6], &#125;);</span><br><span class="line"> &#125;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    await page.evaluateOnNewDocument(js_text)  # æœ¬é¡µåˆ·æ–°åå€¼ä¸å˜ï¼Œè‡ªåŠ¨æ‰§è¡Œjs</span><br><span class="line"></span><br><span class="line">    await page.setUserAgent(</span><br><span class="line">        &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;70.0.3538.67 Safari&#x2F;537.36&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    await page.goto(&quot;http:&#x2F;&#x2F;sxdxjwc.ctgu.edu.cn&#x2F;index.jsp&quot;)</span><br><span class="line"></span><br><span class="line">    await page.screenshot(path&#x3D;&quot;example.png&quot;, quality&#x3D;100, fullPage&#x3D;True)</span><br><span class="line">    latest_notice &#x3D; await page.querySelector(&quot;div.jwtz_nr &gt; ul &gt; ul &gt; li:nth-child(1)&quot;)</span><br><span class="line">    url &#x3D; await (await latest_notice.getProperty(&quot;href&quot;)).jsonValue()</span><br><span class="line">    print(str(url))</span><br><span class="line">    print(page.url)</span><br><span class="line">    title &#x3D; await page.evaluate(&quot;(element) &#x3D;&gt; element.textContent&quot;, latest_notice)</span><br><span class="line">    print(title)</span><br><span class="line">    url &#x3D; await page.evaluate(&quot;(element) &#x3D;&gt; element.URL&quot;, latest_notice)</span><br><span class="line">    print(&quot;è·å–çš„é“¾æ¥&quot;, url)</span><br><span class="line">    await page.click(</span><br><span class="line">        &quot;body &gt; div.width &gt; div.maina &gt; div.jwtz &gt; div.jwtz_nr &gt; ul &gt; ul &gt; li:nth-child(1)&quot;</span><br><span class="line">    )</span><br><span class="line">    await asyncio.sleep(1)</span><br><span class="line">    # await page.waitForNavigation(timeout&#x3D;0)</span><br><span class="line">    # await asyncio.wait(</span><br><span class="line">    #     [</span><br><span class="line">    #         page.click(</span><br><span class="line">    #             &quot;body &gt; div.width &gt; div.maina &gt; div.jwtz &gt; div.jwtz_nr &gt; ul &gt; ul &gt; li:nth-child(1)&quot;</span><br><span class="line">    #         ),</span><br><span class="line">    #         page.waitForNavigation(&#123;&quot;timeout&quot;: 0&#125;),</span><br><span class="line">    #     ]</span><br><span class="line">    # )</span><br><span class="line"></span><br><span class="line">    pages &#x3D; await browser.pages()</span><br><span class="line">    print(&quot;æ‰€æœ‰çš„é¡µé¢&quot;, pages)</span><br><span class="line">    for p in pages:</span><br><span class="line">        print(p.title,p.url)</span><br><span class="line">    # pages[0].close()</span><br><span class="line">    # await page.click(</span><br><span class="line">    #     &quot;body &gt; div.width &gt; div.maina &gt; div.jwtz &gt; div.jwtz_nr &gt; ul &gt; ul &gt; li:nth-child(1)&quot;</span><br><span class="line">    # )</span><br><span class="line">    # await page.waitFor(1)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    # page.mouse  # æ¨¡æ‹ŸçœŸå®ç‚¹å‡»</span><br><span class="line">    # time.sleep(10)</span><br><span class="line">    # page.bringToFront()</span><br><span class="line">    cookies &#x3D; await page.cookies()</span><br><span class="line">    print(cookies)</span><br><span class="line">    # ç„¶åå¯¼å…¥cookie</span><br><span class="line">    # await page.setCookie(*cookies)</span><br><span class="line">    # browser.retainLastPage()</span><br><span class="line">    # å‰è¿›</span><br><span class="line">    # await page.goForward()</span><br><span class="line">    # page&#x3D;pages[1]</span><br><span class="line">    await pages[-1].screenshot(path&#x3D;&quot;news.png&quot;, quality&#x3D;100, fullPage&#x3D;True)</span><br><span class="line">    # await page.waitFor(2)  # åœé¡¿</span><br><span class="line">    await browser.close()</span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>



<blockquote>
<p>è½¬è‡ªï¼š<a href="https://ld246.com/article/1566221786951" target="_blank" rel="noopener">https://ld246.com/article/1566221786951</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>å¤±ç‰©æ‹›é¢†DokceråŒ–éƒ¨ç½²</title>
    <url>//post/493714.html</url>
    <content><![CDATA[<h2 id="ä¸€ã€SSHé…ç½®"><a href="#ä¸€ã€SSHé…ç½®" class="headerlink" title="ä¸€ã€SSHé…ç½®"></a>ä¸€ã€SSHé…ç½®</h2><h3 id="1ã€æ›´æ”¹Rootç”¨æˆ·å¯†ç "><a href="#1ã€æ›´æ”¹Rootç”¨æˆ·å¯†ç " class="headerlink" title="1ã€æ›´æ”¹Rootç”¨æˆ·å¯†ç "></a>1ã€æ›´æ”¹Rootç”¨æˆ·å¯†ç </h3><p>åˆæ¬¡ä½¿ç”¨å…ˆä»ç®¡ç†å‘˜åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œå¹¶æ›´æ”¹rootç”¨æˆ·å¯†ç </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">åˆ‡æ¢Rootç”¨æˆ·</span><br><span class="line">sudo su root</span><br><span class="line">ä¸ºrootç”¨æˆ·è®¾ç½®å¯†ç </span><br><span class="line">passwd root</span><br></pre></td></tr></table></figure><a id="more"></a>


<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2021/01/23/f1044b5363673ba97e7dfd61c5dc0937.png" alt="image-20200810185454159"></p>
<h3 id="æ›´æ”¹SSHé»˜è®¤é…ç½®-å¹¶é‡å¯SSHæœåŠ¡"><a href="#æ›´æ”¹SSHé»˜è®¤é…ç½®-å¹¶é‡å¯SSHæœåŠ¡" class="headerlink" title="æ›´æ”¹SSHé»˜è®¤é…ç½® å¹¶é‡å¯SSHæœåŠ¡"></a>æ›´æ”¹SSHé»˜è®¤é…ç½® å¹¶é‡å¯SSHæœåŠ¡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "s/#PermitRootLogin.*/PermitRootLogin yes/g" /etc/ssh/sshd_config \</span><br><span class="line">&amp;&amp; sed -i "s/#PasswordAuthentication.*/PasswordAuthentication yes/g" /etc/ssh/sshd_config \</span><br><span class="line">&amp;&amp; sed -i "s/#PubkeyAuthentication.*/PubkeyAuthentication yes/g" /etc/ssh/sshd_config \</span><br><span class="line">&amp;&amp; /etc/init.d/ssh restart</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€Dockerå®‰è£…ã€å¯åŠ¨ã€é•œåƒåŠ é€Ÿã€Docker-Composeå®‰è£…"><a href="#äºŒã€Dockerå®‰è£…ã€å¯åŠ¨ã€é•œåƒåŠ é€Ÿã€Docker-Composeå®‰è£…" class="headerlink" title="äºŒã€Dockerå®‰è£…ã€å¯åŠ¨ã€é•œåƒåŠ é€Ÿã€Docker Composeå®‰è£…"></a>äºŒã€Dockerå®‰è£…ã€å¯åŠ¨ã€é•œåƒåŠ é€Ÿã€Docker Composeå®‰è£…</h2><p>ä½¿ç”¨è„šæœ¬è‡ªåŠ¨å®‰è£…åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­ Docker å®˜æ–¹ä¸ºäº†ç®€åŒ–å®‰è£…æµç¨‹ï¼Œæä¾›äº†ä¸€å¥—ä¾¿æ·çš„å®‰è£…è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡ â€“mirror é€‰é¡¹ä½¿ç”¨å›½å†…æºè¿›è¡Œå®‰è£…ï¼Œæ‰§è¡Œè¿™ç»„å‘½ä»¤åï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨çš„å°†ä¸€åˆ‡å‡†å¤‡å·¥ä½œåšå¥½ï¼Œå¹¶ä¸”æŠŠ Docker CE çš„ç¨³å®š(stable)ç‰ˆæœ¬å®‰è£…åœ¨ç³»ç»Ÿä¸­å¹¶ä¸”è®¾ç½®å¼€æœºè‡ªå¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -fsSL get.docker.com -o get-docker.sh \</span><br><span class="line">&amp;&amp; sudo sh get-docker.sh --mirror Aliyun \</span><br><span class="line">&amp;&amp; sudo systemctl enable docker \</span><br><span class="line">&amp;&amp; sudo systemctl start docker \</span><br><span class="line">&amp;&amp; echo " &#123; \</span><br><span class="line">\"registry-mirrors\": [ </span><br><span class="line">\"https://mirror.ccs.tencentyun.com\", </span><br><span class="line">\"https://eqcxmbvw.mirror.aliyuncs.com\" </span><br><span class="line">] </span><br><span class="line">&#125;" &gt;  /etc/docker/daemon.json \</span><br><span class="line">&amp;&amp; service docker restart \</span><br><span class="line">&amp;&amp; docker info \</span><br><span class="line">&amp;&amp; curl -k -L https://github.wuyanzheshui.workers.dev/docker/compose/releases/download/1.26.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose \</span><br><span class="line">&amp;&amp; chmod +x /usr/local/bin/docker-compose \</span><br><span class="line">&amp;&amp; docker-compose</span><br></pre></td></tr></table></figure>

<h3 id="Dockerå¯è§†åŒ–é¢æ¿å®‰è£…ï¼ˆæ±‰åŒ–ç‰ˆï¼‰"><a href="#Dockerå¯è§†åŒ–é¢æ¿å®‰è£…ï¼ˆæ±‰åŒ–ç‰ˆï¼‰" class="headerlink" title="Dockerå¯è§†åŒ–é¢æ¿å®‰è£…ï¼ˆæ±‰åŒ–ç‰ˆï¼‰"></a>Dockerå¯è§†åŒ–é¢æ¿å®‰è£…ï¼ˆæ±‰åŒ–ç‰ˆï¼‰</h3><p>æ±‰åŒ–ç‰ˆçš„æ²¡æœ‰æ›´æ–°æç¤º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 9000:9000 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v portainer_data:/data \</span><br><span class="line">--name portainer \</span><br><span class="line">--restart=always \</span><br><span class="line">registry.cn-zhangjiakou.aliyuncs.com/ctgu/portainer</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€å¼€æ”¾å®‰å…¨ç»„ç«¯å£"><a href="#ä¸‰ã€å¼€æ”¾å®‰å…¨ç»„ç«¯å£" class="headerlink" title="ä¸‰ã€å¼€æ”¾å®‰å…¨ç»„ç«¯å£"></a>ä¸‰ã€å¼€æ”¾å®‰å…¨ç»„ç«¯å£</h2><blockquote>
<p>å®‰è£…å®Œæˆä¹‹åè®°å¾—å»é˜¿é‡Œäº‘æˆ–è€…è…¾è®¯äº‘æ§åˆ¶å°å¼€æ”¾å¯¹åº”ç«¯å£ï¼Œè¿™é‡Œæ˜¯<strong>9000</strong>ç«¯å£</p>
<p>å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼š<a href="https://cloud.tencent.com/document/product/213/39740" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/213/39740</a></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2021/01/23/75f1d8904352a246428355bb4757d68c.png" alt="image-20200810190047023"></p>
<h2 id="å››ã€æœåŠ¡å™¨è¿ç§»"><a href="#å››ã€æœåŠ¡å™¨è¿ç§»" class="headerlink" title="å››ã€æœåŠ¡å™¨è¿ç§»"></a>å››ã€æœåŠ¡å™¨è¿ç§»</h2><h3 id="1ã€å¯¼å‡ºæ•°æ®åº“æ–‡ä»¶ï¼Œå¹¶åˆ é™¤mysqlçš„å®‰è£…æ–‡ä»¶"><a href="#1ã€å¯¼å‡ºæ•°æ®åº“æ–‡ä»¶ï¼Œå¹¶åˆ é™¤mysqlçš„å®‰è£…æ–‡ä»¶" class="headerlink" title="1ã€å¯¼å‡ºæ•°æ®åº“æ–‡ä»¶ï¼Œå¹¶åˆ é™¤mysqlçš„å®‰è£…æ–‡ä»¶"></a>1ã€å¯¼å‡ºæ•°æ®åº“æ–‡ä»¶ï¼Œå¹¶åˆ é™¤mysqlçš„å®‰è£…æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it mysql sh -c "mysqldump -h127.0.0.1 -uroot -pæ•°æ®åº“å¯†ç  swzl &gt; /docker-entrypoint-initdb.d/init.sql" \</span><br><span class="line">&amp;&amp; chmod +x /www/server/mysql/init/* \</span><br><span class="line">&amp;&amp; rm -rf /www/server/mysql/data/*</span><br></pre></td></tr></table></figure>

<h3 id="2ã€ç½‘ç«™æ•´ç«™æ‰“åŒ…"><a href="#2ã€ç½‘ç«™æ•´ç«™æ‰“åŒ…" class="headerlink" title="2ã€ç½‘ç«™æ•´ç«™æ‰“åŒ…"></a>2ã€ç½‘ç«™æ•´ç«™æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~/.. \</span><br><span class="line">&amp;&amp; tar -zcvf www.tar.gz www</span><br><span class="line">scp www.tar.gz root@æ–°æœåŠ¡çš„ip:..</span><br><span class="line"></span><br><span class="line">scp www.tar.gz root@49.235.194.44:..</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€ç½‘ç«™è¯ä¹¦"><a href="#äº”ã€ç½‘ç«™è¯ä¹¦" class="headerlink" title="äº”ã€ç½‘ç«™è¯ä¹¦"></a>äº”ã€ç½‘ç«™è¯ä¹¦</h2><h4 id="CDNè¯ä¹¦éœ€è¦æ¯å¹´åˆ°æœŸåæ‰‹åŠ¨å»äº‘æœåŠ¡å™¨æ§åˆ¶å°ç”³è¯·"><a href="#CDNè¯ä¹¦éœ€è¦æ¯å¹´åˆ°æœŸåæ‰‹åŠ¨å»äº‘æœåŠ¡å™¨æ§åˆ¶å°ç”³è¯·" class="headerlink" title="CDNè¯ä¹¦éœ€è¦æ¯å¹´åˆ°æœŸåæ‰‹åŠ¨å»äº‘æœåŠ¡å™¨æ§åˆ¶å°ç”³è¯·"></a>CDNè¯ä¹¦éœ€è¦æ¯å¹´åˆ°æœŸåæ‰‹åŠ¨å»äº‘æœåŠ¡å™¨æ§åˆ¶å°ç”³è¯·</h4><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/javaxw666/article/details/96602668" target="_blank" rel="noopener">https://blog.csdn.net/javaxw666/article/details/96602668</a></p>
<h2 id="äº”ã€ç½‘ç«™è¯ä¹¦è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè¿‡æœŸåè‡ªåŠ¨æ›¿æ¢"><a href="#äº”ã€ç½‘ç«™è¯ä¹¦è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè¿‡æœŸåè‡ªåŠ¨æ›¿æ¢" class="headerlink" title="äº”ã€ç½‘ç«™è¯ä¹¦è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè¿‡æœŸåè‡ªåŠ¨æ›¿æ¢"></a>äº”ã€ç½‘ç«™è¯ä¹¦è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè¿‡æœŸåè‡ªåŠ¨æ›¿æ¢</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">é¦–æ¬¡ç”³è¯·è¯ä¹¦</span><br><span class="line">tar xvf www.tar.gz \</span><br><span class="line">&amp;&amp; /www/server/nginx/cert \</span><br><span class="line">&amp;&amp; docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="å…­ã€å®šæ—¶ä»»åŠ¡è®¾ç½®"><a href="#å…­ã€å®šæ—¶ä»»åŠ¡è®¾ç½®" class="headerlink" title="å…­ã€å®šæ—¶ä»»åŠ¡è®¾ç½®"></a>å…­ã€å®šæ—¶ä»»åŠ¡è®¾ç½®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ–°å»ºå®šæ—¶ä»»åŠ¡</span></span><br><span class="line">crontab -e</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0 1 * * * cd /www/server/qiniu/ &amp;&amp; python main.py &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">0 0 */30 * * docker exec acme.sh --cron	--force &gt; /dev/null &amp;&amp; docker restart nginx</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹è®¾ç½®çš„å®šæ—¶ä»»åŠ¡"><a href="#æŸ¥çœ‹è®¾ç½®çš„å®šæ—¶ä»»åŠ¡" class="headerlink" title="æŸ¥çœ‹è®¾ç½®çš„å®šæ—¶ä»»åŠ¡"></a>æŸ¥çœ‹è®¾ç½®çš„å®šæ—¶ä»»åŠ¡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab -l</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2021/01/23/42e1ecbabac39741cfe4be888ff07aee.png" alt="image-20210123102953430"></p>
<h2 id="ä¸ƒã€æ•°æ®åº“æ³¨æ„äº‹é¡¹"><a href="#ä¸ƒã€æ•°æ®åº“æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸ƒã€æ•°æ®åº“æ³¨æ„äº‹é¡¹"></a>ä¸ƒã€æ•°æ®åº“æ³¨æ„äº‹é¡¹</h2><h3 id="1ã€æ•°æ®åº“æ¯å¤©å®šæ—¶å¤‡ä»½"><a href="#1ã€æ•°æ®åº“æ¯å¤©å®šæ—¶å¤‡ä»½" class="headerlink" title="1ã€æ•°æ®åº“æ¯å¤©å®šæ—¶å¤‡ä»½"></a>1ã€æ•°æ®åº“æ¯å¤©å®šæ—¶å¤‡ä»½</h3><p>å¤‡ä»½ç”¨çš„ä¸ƒç‰›äº‘OSSï¼Œæ¯å¤©å®šæ—¶å¤‡ä»½ï¼Œéœ€è¦å…ˆå®‰è£…ä¾èµ–ï¼Œç„¶åæ·»åŠ å®šæ—¶ä»»åŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®‰è£…ä¾èµ–</span><br><span class="line">apt install python-pip \</span><br><span class="line">&amp;&amp; pip install qiniu&#x3D;&#x3D;7.2.9</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">æ¯æ™šå‡Œæ™¨1ç‚¹å¤‡ä»½æ•°æ®åº“ï¼Œä¿ç•™æœ€è¿‘30å¤©çš„æ•°æ®åº“ï¼Œ</span><br><span class="line">æ¯éš”30å¤©æ£€æŸ¥ä¸€æ¬¡è¯ä¹¦</span><br><span class="line"><span class="meta">#</span><span class="bash">æ·»åŠ å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">crontab -e</span><br><span class="line">0 1 * * * cd /www/server/qiniu/ &amp;&amp; python main.py &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">0 0 */30 * * docker exec acme.sh --cron	--force &gt; /dev/null &amp;&amp; docker restart nginx</span><br></pre></td></tr></table></figure>

<h3 id="2ã€æ•°æ®åº“ç›®å½•æƒé™é—®é¢˜"><a href="#2ã€æ•°æ®åº“ç›®å½•æƒé™é—®é¢˜" class="headerlink" title="2ã€æ•°æ®åº“ç›®å½•æƒé™é—®é¢˜"></a>2ã€æ•°æ®åº“ç›®å½•æƒé™é—®é¢˜</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#æ•°æ®åº“çš„æƒé™</span><br><span class="line">chmod 777 &#x2F;www&#x2F;server&#x2F;mysql&#x2F;data</span><br></pre></td></tr></table></figure>

<h1 id="ç›¸å…³èµ„æº"><a href="#ç›¸å…³èµ„æº" class="headerlink" title="ç›¸å…³èµ„æº"></a>ç›¸å…³èµ„æº</h1><blockquote>
<p>ğŸ‘‰ Dockerç»ƒä¹ å¹³å°ï¼š<a href="http://play-with-docker.com" target="_blank" rel="noopener">http://play-with-docker.com</a></p>
<p>ğŸ‘‰ Dockerå®˜æ–¹æ–‡æ¡£ï¼š <a href="https://docs.docker.com" target="_blank" rel="noopener">https://docs.docker.com</a></p>
<p>ğŸ‘‰ Dockerå®˜ç½‘ï¼š<a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a></p>
<p>ğŸ‘‰ Docker Hubï¼š<a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a></p>
<p>ğŸ‘‰ èœé¸Ÿæ•™ç¨‹Dockerï¼š <a href="https://www.runoob.com/docker/docker-tutorial.html" target="_blank" rel="noopener">https://www.runoob.com/docker/docker-tutorial.html</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§æ•°æ®</title>
    <url>//post/5394.html</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡æè¿°</span><br><span class="line">ç›¸å…³çŸ¥è¯†</span><br><span class="line">å¦‚ä½•ä½¿ç”¨happpybaseè¿æ¥HBaseæ•°æ®åº“</span><br><span class="line">ç¼–ç¨‹è¦æ±‚</span><br><span class="line">å¥½äº†ï¼Œåˆ°ä½ å•¦ï¼Œä½¿ç”¨æœ¬å…³çŸ¥è¯†ï¼Œåœ¨å³ä¾§å‘½ä»¤è¡Œå®Œæˆä¸‹é¢çš„ä»»åŠ¡è¦æ±‚ï¼š</span><br><span class="line">ä»»åŠ¡æè¿°</span><br><span class="line">æœ¬å…³ä»»åŠ¡ï¼šä½¿ç”¨pythonä»£ç åœ¨HBaseä¸­åˆ›å»ºè¡¨ã€‚</span><br><span class="line"></span><br><span class="line">ç›¸å…³çŸ¥è¯†</span><br><span class="line">ä¸ºäº†å®Œæˆæœ¬å…³ä»»åŠ¡ï¼Œä½ éœ€è¦æŒæ¡ï¼š<span class="number">1.</span>å¦‚ä½•ä½¿ç”¨happybase è¿æ¥HBaseæ•°æ®åº“ï¼Œ<span class="number">2.</span>å¦‚ä½•ä½¿ç”¨pythonä»£ç åœ¨HBaseä¸­åˆ›å»ºè¡¨ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚ä½•ä½¿ç”¨happpybaseè¿æ¥HBaseæ•°æ®åº“</span><br><span class="line">ä¸€ã€è¿æ¥(happybase.Connection)</span><br><span class="line"><span class="keyword">import</span> happybase</span><br><span class="line">happybase.Connection(host=â€™localhostâ€™, port=<span class="number">9090</span>, timeout=<span class="literal">None</span>, autoconnect=<span class="literal">True</span>, table_prefix=<span class="literal">None</span>, table_prefix_separator=bâ€™_â€™, compat=â€™<span class="number">0.98</span>â€™, transport=â€™bufferedâ€™, protocol=â€™binaryâ€™)</span><br><span class="line">è·å–è¿æ¥å®ä¾‹</span><br><span class="line">hostï¼šä¸»æœºå</span><br><span class="line">portï¼šç«¯å£</span><br><span class="line">timeoutï¼šè¶…æ—¶æ—¶é—´</span><br><span class="line">autoconnectï¼šè¿æ¥æ˜¯å¦ç›´æ¥æ‰“å¼€</span><br><span class="line">table_prefixï¼šç”¨äºæ„é€ è¡¨åçš„å‰ç¼€</span><br><span class="line">table_prefix_separatorï¼šç”¨äºtable_prefixçš„åˆ†éš”ç¬¦</span><br><span class="line">compatï¼šå…¼å®¹æ¨¡å¼</span><br><span class="line">transportï¼šè¿è¾“æ¨¡å¼</span><br><span class="line">protocolï¼šåè®®</span><br><span class="line">ä¾‹ï¼š</span><br><span class="line">connection = happybase.Connection(host=â€<span class="number">192.168</span><span class="number">.0</span><span class="number">.156</span>â€,port=<span class="number">9090</span>,timeout=<span class="literal">None</span>,autoconnect=<span class="literal">True</span>,table_prefix=<span class="literal">None</span>,table_prefix_separator=bâ€™_â€™,compat=â€™<span class="number">0.98</span>â€™, transport=â€™bufferedâ€™,protocol=â€™binaryâ€™)</span><br><span class="line"></span><br><span class="line">å½“connectionè¢«åˆ›å»ºçš„æ—¶å€™ï¼Œé»˜è®¤è‡ªåŠ¨ä¸Hbaseå»ºç«‹socketè¿æ¥çš„ã€‚</span><br><span class="line">è‹¥ä¸æƒ³è‡ªåŠ¨ä¸Hbaseå»ºç«‹socketè¿æ¥ï¼Œå¯ä»¥å°†autoconnectå‚æ•°è®¾ç½®ä¸º<span class="literal">False</span></span><br><span class="line">connection = happybase.Connection(â€˜<span class="number">10.1</span><span class="number">.13</span><span class="number">.111</span>â€™, autoconnect=<span class="literal">False</span>)</span><br><span class="line">ç„¶åæ‰‹åŠ¨ä¸Hbaseå»ºç«‹socketè¿æ¥</span><br><span class="line">connection.open()</span><br><span class="line">open()ï¼šæ‰“å¼€ä¼ è¾“ï¼Œæ— è¿”å›å€¼</span><br><span class="line">close()ï¼šå…³é—­ä¼ è¾“ï¼Œæ— è¿”å›å€¼</span><br><span class="line">connection.close()</span><br><span class="line">è¿æ¥å»ºç«‹å¥½ä¹‹åæŸ¥çœ‹å¯ä»¥ä½¿ç”¨çš„table</span><br><span class="line"><span class="keyword">print</span> connection.tables()</span><br><span class="line">å› ä¸ºè¿˜æ²¡æœ‰åˆ›å»ºtableï¼Œæ‰€ä»¥è¿”å›ç»“æœæ˜¯ []</span><br><span class="line"></span><br><span class="line"> äºŒã€åˆ›å»ºä¸€ä¸ªtable</span><br><span class="line">ï‚·create_table(name,families)ï¼šåˆ›å»ºè¡¨ï¼Œæ— è¿”å›å€¼ </span><br><span class="line">ï‚·nameï¼šè¡¨å</span><br><span class="line">ï‚·familiesï¼šåˆ—æ—</span><br><span class="line">families = &#123; â€œcfâ€:dict(), â€œdfâ€:dict()&#125;</span><br><span class="line">connection.create_table(name,families)</span><br><span class="line"> å¦‚æœè¿æ¥æ—¶ï¼Œæœ‰ä¼ é€’è¡¨å‰ç¼€å‚æ•°æ—¶ï¼ŒçœŸå®è¡¨åå°†ä¼šæ˜¯ï¼šâ€&#123;&#125;_&#123;&#125;â€.format(table_prefix,name)</span><br><span class="line"></span><br><span class="line">connection.create_table(</span><br><span class="line">    â€˜my_tableâ€™,</span><br><span class="line">    &#123;</span><br><span class="line">        â€˜cf1â€™: dict(max_versions=<span class="number">10</span>),</span><br><span class="line">        â€˜cf2â€™:dict(max_versions=<span class="number">1</span>,block_cache_enabled=<span class="literal">False</span>),</span><br><span class="line">        â€˜cf3â€™: dict(),  <span class="comment"># use defaults</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">æ­¤æ—¶ï¼Œæˆ‘ä»¬å†é€šè¿‡connection.tables()æŸ¥çœ‹å¯ä»¥ä½¿ç”¨çš„tableï¼Œç»“æœä¸º[â€˜my_tableâ€™]</span><br><span class="line">åˆ›å»ºçš„tableå³my_tableåŒ…å«<span class="number">3</span>ä¸ªåˆ—æ—ï¼šcf1ã€cf2ã€cf3</span><br><span class="line"></span><br><span class="line">ç¼–ç¨‹è¦æ±‚</span><br><span class="line">å¥½äº†ï¼Œåˆ°ä½ å•¦ï¼Œä½¿ç”¨æœ¬å…³çŸ¥è¯†ï¼Œåœ¨å³ä¾§å‘½ä»¤è¡Œå®Œæˆä¸‹é¢çš„ä»»åŠ¡è¦æ±‚ï¼š</span><br><span class="line"><span class="number">1</span>æ‰§è¡Œç¯èŠ‚æ­å»ºè„šæœ¬ï¼Œä¸ºä½¿ç”¨Pythonè¯­è¨€æ“ä½œhbaseåšå¥½å‡†å¤‡ã€‚</span><br><span class="line">cd /data/workspace/myshixun/opt/</span><br><span class="line">chmod +x setup-env.sh</span><br><span class="line">./setup-env.sh</span><br><span class="line">è¿™é‡Œå¯èƒ½éœ€è¦ç­‰å¾…å‡ åˆ†é’Ÿï¼Œè®©è„šæœ¬æ‰§è¡Œå®Œï¼Œthriftå’Œhappybaseå°±å®‰è£…å¥½äº†ã€‚</span><br><span class="line">æ¥ä¸‹æ¥å¯ä»¥æŸ¥çœ‹å„ä¸ªæœåŠ¡è¿›ç¨‹æ˜¯å¦å¯åŠ¨</span><br><span class="line">jps</span><br><span class="line">â€˜â€™</span><br><span class="line">root@evassh<span class="number">-2932225</span>:~<span class="comment"># jps</span></span><br><span class="line"><span class="number">1808</span> ResourceManager</span><br><span class="line"><span class="number">4785</span> Jps</span><br><span class="line"><span class="number">2820</span> ThriftServer</span><br><span class="line"><span class="number">1317</span> NameNode</span><br><span class="line"><span class="number">2694</span> HRegionServer</span><br><span class="line"><span class="number">1447</span> DataNode</span><br><span class="line"><span class="number">2506</span> HQuorumPeer</span><br><span class="line"><span class="number">1626</span> SecondaryNameNode</span><br><span class="line"><span class="number">2570</span> HMaster</span><br><span class="line">â€˜â€™</span><br><span class="line">å¦‚æœå¯åŠ¨è¿‡ç¨‹ä¸­å‡ºç°ï¼š</span><br><span class="line">localhost: zookeeper running <span class="keyword">as</span> process <span class="number">2474.</span> Stop it first. master running <span class="keyword">as</span> process <span class="number">2538.</span> Stop it first. : regionserver running <span class="keyword">as</span> process <span class="number">2665.</span> Stop it first. thrift running <span class="keyword">as</span> process <span class="number">2789.</span> Stop it first.</span><br><span class="line"></span><br><span class="line">éœ€è¦æˆ‘ä»¬é‡æ–°</span><br><span class="line">/app/hbase<span class="number">-2.1</span><span class="number">.1</span>/binhbase-daemon.sh stop thrift stop-dfs.sh å’Œstop-hbase.shï¼Œç„¶åå†é‡å¯ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> è¿›å…¥Pythonç¼–è¯‘å™¨å®Œæˆè¿æ¥å’Œåˆ›å»ºè¡¨</span><br><span class="line">python3</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> å»ºç«‹ä¸€ä¸ªæœ¬åœ°è¿æ¥å¯¹è±¡connï¼Œä½¿ç”¨æœ¬æœºå’Œé»˜è®¤ç«¯å£å»ºç«‹è¿æ¥</span><br><span class="line"><span class="number">4</span> åˆ›å»ºä¸€ä¸ªåä¸ºstudent1çš„è¡¨ï¼Œæœ‰ä¸¤ä¸ªåˆ—æ—ï¼šinfoå’Œscores</span><br><span class="line">æ³¨æ„ï¼šåˆ—æ—å®šä¹‰ä¹‹é—´çš„é€—å·åè¦ç©ºä¸€æ ¼ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚</span><br><span class="line"><span class="number">5</span> å¯ä»¥ä½¿ç”¨conn.tables()æŸ¥çœ‹è¡¨æ˜¯å¦åˆ›å»ºå¥½ã€‚</span><br><span class="line">å¦‚æœå‡ºç°â€˜BrokenPipeError: [Errno <span class="number">32</span>] Broken pipeâ€™æç¤ºï¼Œè¯´æ˜è¿æ¥å·²ç»è‡ªåŠ¨å…³é—­ï¼Œæ¯æ¬¡è¿æ¥å¦‚æœè¶…è¿‡<span class="number">60</span>ç§’æ²¡æœ‰æ“ä½œï¼Œå°±ä¼šè‡ªåŠ¨å…³é—­ï¼Œéœ€è¦é‡æ–°å»ºç«‹è¿æ¥ã€‚</span><br><span class="line"><span class="number">6</span> é€€å‡ºPythonç¼–è¯‘å™¨</span><br><span class="line"></span><br><span class="line">å¼€å§‹ä½ çš„ä»»åŠ¡å§ï¼Œç¥ä½ æˆåŠŸï¼</span><br></pre></td></tr></table></figure><a id="more"></a>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ä»»åŠ¡æè¿°</span><br><span class="line">ç›¸å…³çŸ¥è¯†</span><br><span class="line">ä»»åŠ¡æè¿°</span><br><span class="line">æœ¬å…³ä»»åŠ¡ï¼šä½¿ç”¨pythonä»£ç å‘HBaseè¡¨ä¸­å¹¶æ·»åŠ ã€åˆ é™¤æ•°æ®ï¼Œå¹¶æŸ¥çœ‹æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">ç›¸å…³çŸ¥è¯†</span><br><span class="line">ä¸€ã€æ·»åŠ æ•°æ®</span><br><span class="line"></span><br><span class="line">è¦å¯¹ä¸€ä¸ªè¡¨æ·»åŠ æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªtableå¯¹è±¡ï¼Œä½¿ç”¨table.put()æ–¹æ³•æ·»åŠ æ•°æ®ï¼š</span><br><span class="line"></span><br><span class="line">åœ¨ä¸Šä¸€å…³çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†my_tableè¡¨åŒ…å«<span class="number">3</span>ä¸ªåˆ—æ—ï¼šcf1ã€cf2ã€cf3ï¼Œç°åœ¨æˆ‘ä»¬å¾€é‡Œé¢å†™å…¥æ•°æ®ã€‚ä½ å¯ä»¥è¯•è¯•å…ˆè‡ªå·±åˆ›å»ºè¿™ä¸ªmy_tableè¡¨ã€‚</span><br><span class="line"></span><br><span class="line">table = connection.table(â€˜my_tableâ€™)       <span class="comment">#é¦–å…ˆè·å¾—è¡¨å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">Hbaseé‡Œ å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯åŸå§‹çš„å­—èŠ‚å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">cloth_data = &#123;<span class="string">'cf1:content'</span>: <span class="string">'jeans'</span>, <span class="string">'cf1:price'</span>: <span class="string">'299'</span>, <span class="string">'cf1:rating'</span>: <span class="string">'98%'</span>&#125;</span><br><span class="line">hat_data = &#123;<span class="string">'cf1:content'</span>: <span class="string">'cap'</span>, <span class="string">'cf1:price'</span>: <span class="string">'88'</span>, <span class="string">'cf1:rating'</span>: <span class="string">'99%'</span>&#125;</span><br><span class="line">shoe_data = &#123;<span class="string">'cf1:content'</span>: <span class="string">'jacket'</span>, <span class="string">'cf1:price'</span>: <span class="string">'988'</span>, <span class="string">'cf1:rating'</span>: <span class="string">'100%'</span>&#125;</span><br><span class="line">author_data = &#123;<span class="string">'cf2:name'</span>: <span class="string">'LiuLin'</span>, <span class="string">'cf2:date'</span>: <span class="string">'2017-03-09'</span>&#125;</span><br><span class="line">table.put(row=<span class="string">'www.test1.com'</span>, data=cloth_data)</span><br><span class="line">table.put(row=<span class="string">'www.test2.com'</span>, data=hat_data)</span><br><span class="line">table.put(row=<span class="string">'www.test3.com'</span>, data=shoe_data)</span><br><span class="line">table.put(row=<span class="string">'www.test4.com'</span>, data=author_data)</span><br><span class="line">ä½¿ç”¨putä¸€æ¬¡åªèƒ½å­˜å‚¨ä¸€è¡Œæ•°æ®</span><br><span class="line">å¦‚æœrow keyå·²ç»å­˜åœ¨ï¼Œåˆ™å˜æˆäº†ä¿®æ”¹æ•°æ®</span><br><span class="line"> </span><br><span class="line">æ›´å¥½çš„å­˜å‚¨æ•°æ®</span><br><span class="line">table.put()æ–¹æ³•ä¼šç«‹å³ç»™Hbase Thrift serverå‘é€ä¸€æ¡å‘½ä»¤ã€‚å…¶å®è¿™ç§æ–¹æ³•çš„æ•ˆç‡å¹¶ä¸é«˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´é«˜æ•ˆçš„table.batch()æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨batchä¸€æ¬¡æ’å…¥å¤šè¡Œæ•°æ®</span><br><span class="line"></span><br><span class="line">bat = table.batch()</span><br><span class="line">bat.put(<span class="string">'www.test5.com'</span>, &#123;<span class="string">'cf1:price'</span>: <span class="number">999</span>, <span class="string">'cf2:title'</span>: <span class="string">'Hello Python'</span>, <span class="string">'cf2:length'</span>: <span class="number">34</span>, <span class="string">'cf3:code'</span>: <span class="string">'A43'</span>&#125;)</span><br><span class="line">bat.put(<span class="string">'www.test6.com'</span>, &#123;<span class="string">'cf1:content'</span>: <span class="string">'razor'</span>, <span class="string">'cf1:price'</span>: <span class="number">168</span>, <span class="string">'cf1:rating'</span>: <span class="string">'97%'</span>&#125;)</span><br><span class="line">bat.put(<span class="string">'www.test7.com'</span>, &#123;<span class="string">'cf3:function'</span>: <span class="string">'print'</span>&#125;)</span><br><span class="line">bat.send()</span><br><span class="line">æ›´æœ‰ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥ç®¡ç†batchï¼Œè¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨å‘é€æ•°æ®äº†ï¼Œå³ä¸å†éœ€è¦bat.send()</span><br><span class="line"></span><br><span class="line">*ä½¿ç”¨<span class="keyword">with</span>æ¥ç®¡ç†batch *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> table.batch() <span class="keyword">as</span> bat:</span><br><span class="line">    bat.put(<span class="string">'www.test5.com'</span>, &#123;<span class="string">'cf1:price'</span>: <span class="string">'999'</span>, <span class="string">'cf2:title'</span>: <span class="string">'Hello Python'</span>, <span class="string">'cf2:length'</span>: <span class="string">'34'</span>, <span class="string">'cf3:code'</span>: <span class="string">'A43'</span>&#125;)</span><br><span class="line">    bat.put(<span class="string">'www.test6.com'</span>, &#123;<span class="string">'cf1:content'</span>: <span class="string">u'å‰ƒé¡»åˆ€'</span>, <span class="string">'cf1:price'</span>: <span class="string">'168'</span>, <span class="string">'cf1:rating'</span>: <span class="string">'97%'</span>&#125;)</span><br><span class="line">    bat.put(<span class="string">'www.test7.com'</span>, &#123;<span class="string">'cf3:function'</span>: <span class="string">'print'</span>&#125;)</span><br><span class="line">äºŒã€åˆ é™¤æ•°æ®</span><br><span class="line">åœ¨batchä¸­åˆ é™¤æ•°æ®<span class="keyword">with</span> table.batch() <span class="keyword">as</span> bat:</span><br><span class="line">     bat.delete(â€˜www.test1.com<span class="string">')</span></span><br><span class="line"><span class="string"> batchå°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ŒçŸ¥é“æ•°æ®è¢«sendï¼Œç¬¬ä¸€ç§sendæ•°æ®çš„æ–¹æ³•æ˜¯æ˜¾ç¤ºåœ°å‘é€ï¼Œå³bat.send()ï¼Œç¬¬äºŒç§sendæ•°æ®çš„æ–¹æ³•æ˜¯åˆ°è¾¾withä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ç»“å°¾è‡ªåŠ¨å‘é€ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">** ä¸‰ã€æ£€ç´¢æ•°æ®**</span></span><br><span class="line"><span class="string"> å…¨å±€æ‰«æä¸€ä¸ªtable</span></span><br><span class="line"><span class="string"> for key, value in table.scan():</span></span><br><span class="line"><span class="string">    print key, value</span></span><br><span class="line"><span class="string">ç»“æœå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="string">,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ£€ç´¢ä¸€è¡Œæ•°æ®</span></span><br><span class="line"><span class="string">row = table.row(â€˜www.test4.com'</span>) <span class="keyword">print</span> row</span><br><span class="line">ç›´æ¥è¿”å›è¯¥row keyçš„å€¼ï¼ˆä»¥å­—å…¸çš„å½¢å¼ï¼‰ï¼Œç»“æœä¸ºï¼š</span><br><span class="line">&#123;â€˜cf2:nameâ€™: â€˜LiuLinâ€™, â€˜cf2:dateâ€™: â€˜<span class="number">2017</span><span class="number">-03</span><span class="number">-09</span>â€™&#125;</span><br><span class="line"></span><br><span class="line">æ£€ç´¢å¤šè¡Œæ•°æ®</span><br><span class="line">rows = table.rows([â€˜www.test1.com<span class="string">', â€˜www.test4.com'</span>])<span class="keyword">print</span> rows</span><br><span class="line">è¿”å›çš„æ˜¯ä¸€ä¸ªlistï¼Œlistçš„ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªtupleï¼Œtupleçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯rowkeyï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯rowkeyçš„å€¼</span><br><span class="line">å¦‚æœæƒ³ä½¿æ£€ç´¢å¤šè¡Œæ•°æ®å³table.rows()è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå¯ä»¥è¿™æ ·å¤„ç†æ£€ç´¢å¤šè¡Œæ•°æ®ï¼Œè¿”å›å­—å…¸</span><br><span class="line">rows_dict = dict(table.rows([â€˜www.test1.com<span class="string">', â€˜www.test4.com'</span>]))<span class="keyword">print</span> rows_dict</span><br><span class="line">å¦‚æœæƒ³ä½¿table.rows()è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæœ‰åºå­—å…¸ï¼Œå³OrderedDictï¼Œå¯ä»¥è¿™æ ·å¤„ç†æ£€ç´¢å¤šè¡Œæ•°æ®ï¼Œè¿”å›æœ‰åºå­—å…¸</span><br><span class="line"><span class="keyword">from</span> collection <span class="keyword">import</span> OrderedDict</span><br><span class="line">rows_ordered_dict = OrderedDict(table.rows([â€˜www.test1.com<span class="string">', â€˜www.test4.com'</span>]))</span><br><span class="line"><span class="keyword">print</span> rows_ordered_dict</span><br><span class="line"></span><br><span class="line">å¥½äº†ï¼Œä¸‹é¢å¼€å§‹ä½ çš„ä»»åŠ¡å•¦ï¼š</span><br><span class="line">æŒ‰ç…§å³è¾¹çš„æ–‡ä»¶è¦æ±‚è¡¥å®Œä»£ç ã€‚</span><br><span class="line">é¢„æœŸè¾“å‡ºï¼š</span><br><span class="line">OrderedDict([(bâ€™info:nameâ€™, bâ€™Johnâ€™), (bâ€™scores:Bigdataâ€™, bâ€™<span class="number">89</span>â€™), (bâ€™scores:databaseâ€™, bâ€™<span class="number">88</span>â€™)])</span><br><span class="line">bâ€™<span class="number">95001</span>â€™ OrderedDict([(bâ€™info:nameâ€™, bâ€™Johnâ€™), (bâ€™scores:Bigdataâ€™, bâ€™<span class="number">89</span>â€™), (bâ€™scores:databaseâ€™, bâ€™<span class="number">88</span>â€™)])</span><br><span class="line">bâ€™<span class="number">95002</span>â€™ OrderedDict([(bâ€™info:nameâ€™, bâ€™Roseâ€™), (bâ€™scores:databaseâ€™, bâ€™<span class="number">68</span>â€™)])</span><br><span class="line">bâ€™<span class="number">95003</span>â€™ OrderedDict([(bâ€™info:nameâ€™, bâ€™Greensâ€™), (bâ€™scores:Bigdataâ€™, bâ€™<span class="number">76</span>â€™)])</span><br><span class="line">å¦‚æœè¿è¡Œç»“æœæŠ¥é”™æç¤ºæ˜¾ç¤ºè¡¨å·²ç»å­˜åœ¨ï¼Œ</span><br><span class="line">,</span><br><span class="line">æŸ¥çœ‹å„ä¸ªæœåŠ¡è¿›ç¨‹æ˜¯å¦å¯åŠ¨</span><br><span class="line">â€˜â€™</span><br><span class="line">root@evassh<span class="number">-2932225</span>:~<span class="comment"># jps</span></span><br><span class="line"><span class="number">1808</span> ResourceManager</span><br><span class="line"><span class="number">4785</span> Jps</span><br><span class="line"><span class="number">2820</span> ThriftServer</span><br><span class="line"><span class="number">1317</span> NameNode</span><br><span class="line"><span class="number">2694</span> HRegionServer</span><br><span class="line"><span class="number">1447</span> DataNode</span><br><span class="line"><span class="number">2506</span> HQuorumPeer</span><br><span class="line"><span class="number">1626</span> SecondaryNameNode</span><br><span class="line"><span class="number">2570</span> HMaster</span><br><span class="line">â€˜â€™</span><br><span class="line">å¦‚æœå¤„äºå¯åŠ¨çŠ¶æ€å°±åˆ°åˆ°hbase shellä¸­æ‰‹åŠ¨åˆ é™¤è¯¥è¡¨ã€‚</span><br><span class="line"></span><br><span class="line">å¼€å§‹ä½ çš„ä»»åŠ¡å§ï¼Œç¥ä½ æˆåŠŸï¼</span><br></pre></td></tr></table></figure>



<p>HBaseåˆ›å»ºæ“ä½œè¡¨ <a href="https://www.educoder.net/tasks/hc5rigv6y2t4" target="_blank" rel="noopener">https://www.educoder.net/tasks/hc5rigv6y2t4</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç¬¬ä¸€ä¸ªå¤§é¢˜ </span></span><br><span class="line"><span class="keyword">import</span> happybase</span><br><span class="line">happybase.Connection(host=â€™localhostâ€™, port=<span class="number">9090</span>, timeout=<span class="literal">None</span>, autoconnect=<span class="literal">True</span>, table_prefix=<span class="literal">None</span>, table_prefix_separator=bâ€™_â€™, compat=â€™<span class="number">0.98</span>â€™, transport=â€™bufferedâ€™, protocol=â€™binaryâ€™)</span><br><span class="line"></span><br><span class="line">åˆ›å»ºè¡¨ï¼š</span><br><span class="line">connection.create_table(</span><br><span class="line">    â€˜shopâ€™,</span><br><span class="line">    &#123;</span><br><span class="line">        â€˜cf1â€™: dict(max_versions=<span class="number">10</span>),</span><br><span class="line">        â€˜cf2â€™:dict(max_versions=<span class="number">1</span>,block_cache_enabled=<span class="literal">False</span>),</span><br><span class="line">        â€˜cf3â€™: dict(),  <span class="comment"># use defaults</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ’å…¥</span></span><br><span class="line">table = conn.table(<span class="string">"shop"</span>)</span><br><span class="line">bat = table.batch()</span><br><span class="line">bat.put(<span class="string">'0001'</span>,&#123;<span class="string">'interfaceInfo:inter_show'</span>:<span class="string">'HDM1'</span>, <span class="string">'interfaseInfo:inter_network'</span>:<span class="string">'10Mbps'</span>, <span class="string">'interfaceInfo:inter_three'</span>:<span class="string">'1ä¸ª'</span>,<span class="string">'interfaceInfo:inter_Type-c'</span>:<span class="string">'1ä¸ª'</span>&#125;)</span><br><span class="line">bat.put(<span class="string">'0002'</span>,&#123;<span class="string">'inputInfo:input_one'</span>:<span class="string">'æœ‰æŒ‡ç‚¹æ†'</span>,<span class="string">'inputInfo:input_tow'</span>:<span class="string">'å…¨å°ºå¯¸é”®ç›˜'</span>,<span class="string">'inputInfo:input_three'</span>:<span class="string">'å¤šç‚¹è§¦æ§'</span>,<span class="string">'inputInfo:input_four'</span>:<span class="string">'å¤šç‚¹è§¦æ§'</span>&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/22/eb29e8c5f3d070871e889a7df0c0648f.png" alt="image-20201222151712603"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/22/d62b69bbd06221ffbd8b6774aa4e984a.png" alt="image-20201222153426834"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/22/c62409102e9d05d8e27391cb9bd3f862.png" alt="image-20201222153450963"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/22/f575719efe0cbc47a6c0170f333c5019.png" alt="image-20201222142737837"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/22/c2d6d280fcca0e5c8ab064dfa4c7b587.png" alt="QQå›¾ç‰‡20201222151459"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/22/eadce52255b38a7599c09f1141e02933.png" alt="QQå›¾ç‰‡20201222151503"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/22/ceac3a666c81d839a67c97e51c4eafa6.png" alt="QQå›¾ç‰‡20201222151509"></p>
<p>mapper.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mapper</span><span class="params">(line)</span>:</span></span><br><span class="line">    key = float(line.split(<span class="string">","</span>)[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    cat = <span class="string">''</span>        </span><br><span class="line">    <span class="keyword">if</span> key &lt;= <span class="number">630.00</span>:</span><br><span class="line">        cat = <span class="string">"mini"</span></span><br><span class="line">    <span class="keyword">elif</span> key &lt;= <span class="number">6300</span>:</span><br><span class="line">        cat = <span class="string">"mid"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cat = <span class="string">"over"</span></span><br><span class="line">    print(<span class="string">"%s\t%s"</span> % (cat, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> line.startswith(<span class="string">'child'</span>):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mapper(line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>reduce.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reducer</span><span class="params">(k, values)</span>:</span></span><br><span class="line">    print(<span class="string">"%s:\t:%s"</span> % (k, sum(values)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    current_key = <span class="literal">None</span></span><br><span class="line">    values = []</span><br><span class="line">    akey, avalue = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">        line = line.strip()</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            akey, avalue = line.split(<span class="string">'\t'</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"><span class="comment">#            2è¿˜æ˜¯ä¸Šæ¬¡å“ªå°</span></span><br><span class="line">        <span class="keyword">if</span> current_key == akey:</span><br><span class="line">            values.append(int(avalue))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line"><span class="comment">#        3å·²ç»åˆå§‹åŒ–è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> current_key:</span><br><span class="line"><span class="comment">#          4    åšä¸€æ¬¡è®¡ç®—</span></span><br><span class="line">                reducer(current_key, values)</span><br><span class="line"><span class="comment">#                é‡æ–°è®¡æ•°</span></span><br><span class="line">                values = []</span><br><span class="line">                <span class="comment">#           1 åˆå§‹åŒ–</span></span><br><span class="line">            values.append(int(avalue))</span><br><span class="line">            current_key = akey</span><br><span class="line"><span class="comment">#    å¾ªç¯å®Œæ¯•åå¤„ç†æœ€åä¸€æ³¢        </span></span><br><span class="line">    <span class="keyword">if</span> current_key == akey:</span><br><span class="line">        reducer(current_key, values)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>spark.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mingqing yisi</span><br><span class="line">xianying nobody</span><br><span class="line">xueling mingqing</span><br><span class="line">xueling xianying</span><br><span class="line">qingqing xueling</span><br><span class="line">qingqing yuelin</span><br><span class="line"></span><br><span class="line"><span class="comment">#grand.py</span></span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> Row</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder \</span><br><span class="line">        .appName(<span class="string">"grandparent"</span>) \</span><br><span class="line">        .getOrCreate()</span><br><span class="line"></span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">raw = sc.textFile(<span class="string">"/root/childs.txt"</span>) \</span><br><span class="line">        .map(<span class="keyword">lambda</span> x:x.strip().lower().encode(<span class="string">"utf-8"</span>).split(<span class="string">" "</span>)) \</span><br><span class="line">        .map(<span class="keyword">lambda</span> x: Row(child=x[<span class="number">0</span>], parent=x[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">relations = spark.createDataFrame(raw)</span><br><span class="line"></span><br><span class="line"><span class="comment"># relations.show()</span></span><br><span class="line"></span><br><span class="line">relations.createOrReplaceTempView(<span class="string">"table"</span>)</span><br><span class="line"></span><br><span class="line">result = spark.sql(<span class="string">"select a.child as grandchild, b.parent as grandparent from table as a inner join table as b  on a.parent=b.child "</span>)</span><br><span class="line"></span><br><span class="line">result.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">spark.stop()</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------</span></span><br><span class="line"><span class="comment"># word count via sparksql</span></span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> Row</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder \</span><br><span class="line">        .appName(<span class="string">"word count via sql"</span>) \</span><br><span class="line">        .getOrCreate()</span><br><span class="line"></span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">raw = sc.textFile(<span class="string">"/root/words.txt"</span>) \</span><br><span class="line">        .flatMap(<span class="keyword">lambda</span> x:x.strip().lower().encode(<span class="string">"utf-8"</span>).split(<span class="string">" "</span>)) \</span><br><span class="line">        .map(<span class="keyword">lambda</span> x:(x, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">words = raw.map(<span class="keyword">lambda</span> x:Row(counts=int(x[<span class="number">1</span>]), word=x[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">words_df = spark.createDataFrame(words)</span><br><span class="line">words_df.createOrReplaceTempView(<span class="string">"words_table"</span>)</span><br><span class="line"><span class="comment"># words_df.show(2)</span></span><br><span class="line">result = spark.sql(<span class="string">"select word, sum(counts) as cnt from words_table group by word order by cnt desc"</span>)</span><br><span class="line"> </span><br><span class="line">result.show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">spark.stop()</span><br><span class="line"></span><br><span class="line"><span class="comment">####------------------</span></span><br><span class="line"><span class="comment"># word cout by rdd</span></span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> Row</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder \</span><br><span class="line">       .appName(<span class="string">"app"</span>) \</span><br><span class="line">       .config(<span class="string">"spark.some.config.option"</span>, <span class="string">"some-value"</span>)   \</span><br><span class="line">       .getOrCreate()</span><br><span class="line"></span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">rdd = sc.textFile(<span class="string">"/root/words.txt"</span>) \</span><br><span class="line">        .flatMap(<span class="keyword">lambda</span> x:x.strip().lower().encode(<span class="string">"utf-8"</span>).split(<span class="string">" "</span>)) \</span><br><span class="line">        .map(<span class="keyword">lambda</span> x: (x, <span class="number">1</span>)) \</span><br><span class="line">        .reduceByKey(<span class="keyword">lambda</span> x, y: x+y) \</span><br><span class="line">        .sortBy(<span class="keyword">lambda</span> x:x[<span class="number">1</span>], <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">print(rdd.collect())</span><br><span class="line"></span><br><span class="line">spark.stop()</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>å®ç”¨å·¥å…·ç«™æ•´ç†</title>
    <url>//post/43345.html</url>
    <content><![CDATA[<p>æ„Ÿè§‰æ”¶è—äº†å¾ˆå¤šä¹¦ç­¾ï¼Œæœ‰äº›å‡Œä¹±ï¼Œè¿˜æ˜¯æŠŠä¸€äº›å¥½ç”¨çš„å·¥å…·æ”¾åœ¨è¿™é‡Œå§</p><p>ç»ƒä¹ æ‰“å­—çš„ï¼š<a href="https://www.typingclub.com/da-zi" target="_blank" rel="noopener">https://www.typingclub.com/da-zi</a></p><a id="more"></a>

<p>Crontabå®šæ—¶ä»»åŠ¡è¡¨è¾¾å¼æ‰§è¡Œæ—¶é—´è®¡ç®— <a href="http://www.matools.com/crontab" target="_blank" rel="noopener">http://www.matools.com/crontab</a></p>
]]></content>
      <tags>
        <tag>åœ¨çº¿å·¥å…·</tag>
        <tag>æ”¶è—</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå¾®ä¿¡SDK</title>
    <url>//post/29637.html</url>
    <content><![CDATA[<h3 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h3><p><a href="https://wechat-python-sdk.readthedocs.io/" target="_blank" rel="noopener">https://wechat-python-sdk.readthedocs.io/</a></p>]]></content>
      <tags>
        <tag>å…¬ä¼—å·</tag>
      </tags>
  </entry>
  <entry>
    <title>åµŒå¥—è§†é¢‘</title>
    <url>//post/37773.html</url>
    <content><![CDATA[<iframe src="//player.bilibili.com/player.html?aid=639891787&bvid=BV1LY4y147VE&cid=745202922&page=1" width="780" height="480" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>]]></content>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿ</title>
    <url>//post/1079.html</url>
    <content><![CDATA[<h2 id="4ã€è°ƒåº¦ä¸æ­»é”"><a href="#4ã€è°ƒåº¦ä¸æ­»é”" class="headerlink" title="4ã€è°ƒåº¦ä¸æ­»é”"></a>4ã€è°ƒåº¦ä¸æ­»é”</h2><p><strong>ç£ç›˜æ•ˆç‡çš„è®¡ç®—</strong></p><p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/18/1e3a04cc8e7bee7b8f8af0cfe9d73d1a.png" alt="image-20201218103303641"></p><p>è°ƒåº¦ç®—æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/18/649aa73aa185c7995e90a7428eec7d5e.png" alt="image-20201218103417049"></p><p>2åˆ†é’Ÿ</p><p>0ç¬¬ä¸€è½®ï¼šA B C D E</p><p>8ç¬¬äºŒè½®ï¼šA B D E</p><p>6ç¬¬ä¸‰è½®ï¼š A B E</p><a id="more"></a>







<p>4ç¬¬å››è½®ï¼šA E</p>
<p>2ç¬¬äº”è½®ï¼šA</p>
<hr>
<p><strong>é“¶è¡Œå®¶ç®—æ³•</strong></p>
<p><strong>ä¾‹4.2.11</strong> è®¾ç³»ç»Ÿä¸­æœ‰ä¸‰ç§ç±»å‹çš„èµ„æºï¼ˆAã€Bã€Cï¼‰å’Œäº”ä¸ªè¿›ç¨‹ï¼ˆP1ã€P2ã€P3ã€P4ã€P5ï¼‰ï¼ŒAèµ„æºçš„æ•°é‡ä¸º17ï¼ŒBèµ„æºçš„æ•°é‡ä¸º5ï¼ŒCèµ„æºçš„æ•°é‡ä¸º20ã€‚åœ¨T0æ—¶åˆ»ç³»ç»ŸçŠ¶æ€å¦‚è¡¨1å’Œè¡¨2æ‰€ç¤ºã€‚ç³»ç»Ÿé‡‡ç”¨é“¶è¡Œå®¶ç®—æ³•å®æ–½æ­»é”é¿å…ç­–ç•¥ã€‚</p>
<p>(1)  T0æ—¶åˆ»æ˜¯å¦ä¸ºå®‰å…¨çŠ¶æ€ï¼Ÿè‹¥æ˜¯ï¼Œè¯·ç»™å‡ºå®‰å…¨åºåˆ—ã€‚</p>
<p>(2)  åœ¨T0æ—¶åˆ»è‹¥è¿›ç¨‹P2è¯·æ±‚èµ„æºï¼ˆ0ï¼Œ3ï¼Œ4ï¼‰ï¼Œæ˜¯å¦èƒ½å®æ–½èµ„æºåˆ†é…ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>(3)  åœ¨â‘¡çš„åŸºç¡€ä¸Šï¼Œè‹¥è¿›ç¨‹P4è¯·æ±‚èµ„æºï¼ˆ2ï¼Œ0ï¼Œ1ï¼‰ï¼Œæ˜¯å¦èƒ½å®æ–½èµ„æºåˆ†é…ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>(4)  åœ¨â‘¢çš„åŸºç¡€ä¸Šï¼Œè‹¥è¿›ç¨‹P1è¯·æ±‚èµ„æºï¼ˆ0ï¼Œ2ï¼Œ0ï¼‰ï¼Œæ˜¯å¦èƒ½å®æ–½èµ„æºåˆ†é…ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>è¡¨4.1  T0æ—¶åˆ»ç³»ç»ŸçŠ¶æ€</p>
<table>
<thead>
<tr>
<th>è¿›ç¨‹</th>
<th>æœ€å¤§èµ„æºéœ€æ±‚é‡</th>
<th>å·²åˆ†é…èµ„æºæ•°é‡</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>B</td>
<td>C</td>
<td>A</td>
<td>B</td>
<td>C</td>
<td></td>
</tr>
<tr>
<td>P1</td>
<td>5</td>
<td>5</td>
<td>9</td>
<td>2</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>P2</td>
<td>5</td>
<td>3</td>
<td>6</td>
<td>4</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<td>P3</td>
<td>4</td>
<td>0</td>
<td>11</td>
<td>4</td>
<td>0</td>
<td>5</td>
</tr>
<tr>
<td>P4</td>
<td>4</td>
<td>2</td>
<td>5</td>
<td>2</td>
<td>0</td>
<td>4</td>
</tr>
<tr>
<td>P5</td>
<td>4</td>
<td>2</td>
<td>4</td>
<td>3</td>
<td>1</td>
<td>4</td>
</tr>
</tbody></table>
<p>è¡¨4.2  T0æ—¶åˆ»ç³»ç»ŸçŠ¶æ€</p>
<table>
<thead>
<tr>
<th></th>
<th>A   B    C</th>
</tr>
</thead>
<tbody><tr>
<td>å‰©ä½™èµ„æºæ•°</td>
<td>2   3    3</td>
</tr>
</tbody></table>
<p><strong>è§£</strong></p>
<p>(1)  ç³»ç»Ÿåœ¨T0æ—¶åˆ»ï¼šå­˜åœ¨ä¸€ä¸ªå®‰å…¨çš„åºåˆ—ï¼ˆP4ã€P5ã€P1ã€P2ã€P3ï¼‰ï¼Œå› è€Œæ˜¯å®‰å…¨çš„ã€‚</p>
<p>(2)  è‹¥åœ¨T0æ—¶åˆ»è¿›ç¨‹P2è¯·æ±‚èµ„æºï¼ˆ0ï¼Œ3ï¼Œ4ï¼‰ï¼Œå› ä¸ºå¯ç”¨èµ„æºçš„æ•°é‡ä¸å¤Ÿï¼Œæ‰€ä»¥åªèƒ½æ¨è¿Ÿåˆ†é…ã€‚</p>
<p>(3)  åœ¨(2)åŸºç¡€ä¸Šï¼Œè‹¥è¿›ç¨‹P4è¯·æ±‚èµ„æºï¼ˆ2ï¼Œ0ï¼Œ1ï¼‰ï¼Œç³»ç»Ÿå¯ä»¥äºˆä»¥æ»¡è¶³ã€‚å› ä¸ºå½“åˆ†é…ç»™P4åï¼Œç³»ç»Ÿå‰©ä½™çš„å¯ç”¨èµ„æºä¸ºï¼ˆ0ï¼Œ3ï¼Œ2ï¼‰ï¼Œä»èƒ½æ‰¾åˆ°ä¸€ä¸ªå®‰å…¨çš„åºåˆ—ï¼Œæ¯”å¦‚ï¼ˆP4ã€P5ã€P1ã€P2ã€P3ï¼‰ã€‚</p>
<p>(4)  åœ¨(3)çš„åŸºç¡€ä¸Šï¼Œè‹¥è¿›ç¨‹P1è¯·æ±‚èµ„æºï¼ˆ0ï¼Œ2ï¼Œ0ï¼‰ï¼Œç³»ç»Ÿä¸äºˆä»¥åˆ†é…ã€‚å› ä¸ºåˆ†é…å‡ºå»åï¼Œç³»ç»Ÿæ‰¾ä¸åˆ°ä¸€ä¸ªå®‰å…¨åºåˆ—ã€‚</p>
<hr>
<p>3.2.6</p>
<p>å¸æœºå”®ç¥¨å‘˜åŒæ­¥é—®é¢˜</p>
]]></content>
  </entry>
  <entry>
    <title>åˆ†åŒºæ‰©å®¹</title>
    <url>//post/undefined.html</url>
    <content><![CDATA[<p>1ã€åˆ†åŒºçš„æŒ‚è½½</p><p><a href="https://blog.csdn.net/qq_14824885/article/details/82664635" target="_blank" rel="noopener">https://blog.csdn.net/qq_14824885/article/details/82664635</a></p><a id="more"></a>

<p>2ã€å¢åŠ swapåˆ†åŒº</p>
<p><a href="https://blog.csdn.net/weixin_43532644/article/details/106762314" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43532644/article/details/106762314</a></p>
<p>3ã€gpartedå›¾å½¢åŒ–åˆ†åŒºå·¥å…·çš„ä½¿ç”¨</p>
<p><a href="https://blog.csdn.net/superxlcr/article/details/78822770" target="_blank" rel="noopener">https://blog.csdn.net/superxlcr/article/details/78822770</a></p>
<p><a href="https://blog.csdn.net/wang328452854/article/details/51036724" target="_blank" rel="noopener">https://blog.csdn.net/wang328452854/article/details/51036724</a></p>
<p>ä½¿ç”¨æ–‡ä»¶å’Œç£ç›˜ä½œä¸ºswapåˆ†åŒº</p>
<p><a href="https://www.cnblogs.com/wuxie1989/p/5888595.html" target="_blank" rel="noopener">https://www.cnblogs.com/wuxie1989/p/5888595.html</a></p>
<p>4ã€å¸¸ç”¨å‘½ä»¤</p>
<p> free -hæŸ¥çœ‹å‰©ä½™å†…å­˜å’Œäº¤äº’åˆ†åŒº</p>
<p>fdisk -l è·å–åˆ†åŒºåˆ—è¡¨</p>
]]></content>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®åº“åŸç†ç¬”è®°</title>
    <url>//post/43793.html</url>
    <content><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/27330413" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/27330413</a></p><p><img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200306163830681.png" alt="image-20200306163830681"></p><p><img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200306164113473.png" alt="image-20200306164113473"></p><p>å…³ç³»è¿ç®—ï¼š</p><p>åŸºæœ¬è¿ç®—</p><p>ä¼ ç»Ÿè¿ç®—</p><p><img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200306164419437.png" alt="image-20200306164419437"></p><p><img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200306164725454.png" alt="image-20200306164725454"></p><p><img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200306164802547.png" alt="image-20200306164802547"></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A-&gt;B ä¸æ»¡è¶³</span><br><span class="line">A-&gt;C ä¸æ»¡è¶³</span><br><span class="line">AB-&gt;C æ»¡è¶³</span><br><span class="line">C-&gt;A ä¸æ»¡è¶³</span><br><span class="line">AC-&gt;B ä¸æ»¡è¶³</span><br></pre></td></tr></table></figure><a id="more"></a>










<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å­¦å·è¯¾å·å†³å®šæ•™å¸ˆ</span><br><span class="line">æ•™å¸ˆå†³å®šæ•™å¸ˆèŒåŠ¡</span><br><span class="line">äº§å“ç¼–ç  å†³å®šäº§å“åç§°</span><br><span class="line">æ•™å¸ˆèŒåŠ¡ éƒ¨åˆ†ä¾èµ–ï¼ˆç­çº§å’Œè¯¾ç¨‹å·ï¼‰</span><br><span class="line"></span><br><span class="line">å‘˜å·¥ç  åŸ¹è®­æ—¥æœŸå†³å®šåŸ¹è®­å†…å®¹</span><br><span class="line">æˆ‘é’‰é’‰å»¶è¿Ÿ2åˆ†é’Ÿ</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å€™é€‰é”®ï¼šé‚®ç¼–+è¡—é“å</span><br><span class="line">éä¸»å±æ€§ï¼šè¡—é“å</span><br><span class="line">åŸå¸‚+è¡—é“ç¡®å®šé‚®ç¼–</span><br><span class="line">é‚®ç¼–ç¡®å®š åŸå¸‚</span><br><span class="line"></span><br><span class="line">å€™é€‰é”®:AB</span><br></pre></td></tr></table></figure>

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200519143352601.png" alt="image-20200519143352601" style="zoom: 33%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200519150915792.png" alt="image-20200519150915792" style="zoom:33%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200519151301901.png" alt="image-20200519151301901" style="zoom:33%;">



<p><img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200519152045413.png" alt="image-20200519152045413" style="zoom:33%;">å¯¹</p>
<p>è€ƒè¯•é¢˜ç›®</p>
<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200519152125088.png" alt="image-20200519152125088" style="zoom:33%;">

<p>é¡¾å®¢ID+å•†å“ID+äº¤æ˜“æ—¶é—´</p>
<p>3NF</p>
<p>éä¸»å±æ€§å¯¹ç çš„ä¼ é€’ä¾èµ–</p>
<p>AB-&gt;C C-&gt;Dï¼ŒAB-&gt;D</p>
<p>2NFï¼Œéä¸»å±æ€§éƒ¨åˆ†ä¾èµ–äºä¸»å±æ€§ Dä¾èµ–äºE</p>
<p>1NF,å­˜åœ¨éä¸»å±æ€§å¯¹ç çš„éƒ¨åˆ†ä¾èµ–</p>
<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522160944865.png" alt="image-20200522160944865" style="zoom: 80%;">





<p><img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522161207628.png" alt="image-20200522161207628"></p>
<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522161141503.png" alt="image-20200522161141503" style="zoom:50%;">

<p>BCNFå¿…é¡»ä¿è¯å†³å®šå› ç´ éƒ½æ˜¯å€™é€‰ç ï¼Œè€Œä¸æ˜¯ä¸»å±æ€§</p>
<p>æ‰€æœ‰å±æ€§éƒ½æ˜¯ä¸»å±æ€§</p>
<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522162812594.png" alt="image-20200522162812594" style="zoom:50%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522163013941.png" alt="image-20200522163013941" style="zoom:50%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522163252154.png" alt="image-20200522163252154" style="zoom: 50%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522164433723.png" alt="image-20200522164433723" style="zoom: 80%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522164725099.png" alt="image-20200522164725099" style="zoom:50%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200522165246780.png" alt="image-20200522165246780" style="zoom: 50%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200526151110703.png" alt="image-20200526151110703" style="zoom:50%;">

<p><strong>æ³¢æµªçº¿è¡¨ç¤ºå¤–é”®</strong></p>
<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616151514024.png" alt="image-20200616151514024" style="zoom:50%;">

<p>å…³é”®å±æ€§ä¸è¦å¿½ç•¥ï¼Œéå…³é”®å±æ€§å¯ä»¥ä¸å¿½ç•¥</p>
<p><strong>å…³ç³»èŒƒå¼</strong> è§„èŒƒåŒ–åˆ†æ</p>
<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616152037633.png" alt="image-20200616152037633" style="zoom:50%;">

<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616152207996.png" alt="image-20200616152207996" style="zoom:50%;">

<p>è€ƒè¯•é‡ç‚¹ä¸æ˜¯å†™è¿‡ç¨‹ï¼Œæ¢å¤ä»¥åçš„å€¼æ˜¯å¤šå°‘</p>
<p>è¯»åˆ°æœªæäº¤ï¼Œå¹¶ä¸”å›æ»šçš„æ•°æ®,æ˜¯è„æ•°æ®ã€‚</p>
<p>ä¸å¯é‡å¤è¯»</p>
<img src="C:%5CUsers%5CDefault%20Account%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200616152911007.png" alt="image-20200616152911007" style="zoom:50%;">





<p>ï¼ˆ1ï¼‰å†—ä½™ï¼Œåˆ é™¤ææ–™çš„æ—¶å€™ï¼Œä¼šå‡ºç°åˆ é™¤å¼‚å¸¸ï¼Œæ’å…¥çš„æ—¶å€™ï¼Œæ²¡æœ‰ææ–™å·æ— æ³•åˆ é™¤</p>
<p>ï¼ˆ2ï¼‰å·¥ç¨‹å·â€“&gt;å¼€å·¥æ—¥æœŸï¼Œå®Œå·¥æ—¥æœŸ</p>
<p>ææ–™å·-&gt;f(ä»·æ ¼)</p>
<p>ä¸»é”®ï¼ˆå·¥ç¨‹å·ï¼Œææ–™å·ï¼‰</p>
<p>ç¬¬äºŒèŒƒå¼ï¼Œéä¸»å±æ€§å¯¹ç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–</p>
<p>R1(<u>å·¥ç¨‹å·</u>ï¼Œå¼€å·¥æ—¥æœŸï¼Œå®Œå·¥æ—¥æœŸ)</p>
<p>R2ï¼ˆ<u>ææ–™å·</u>,ä»·æ ¼ï¼‰</p>
<p>R3ï¼ˆ<u>å·¥ç¨‹å·</u>ï¼Œ<u>ææ–™å·</u>ï¼Œæ•°é‡ï¼‰</p>
]]></content>
      <tags>
        <tag>æ•°æ®åº“åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>æš‘æœŸåŸ¹è®­-Docker</title>
    <url>//post/493759.html</url>
    <content><![CDATA[<h1 id="Dockerç®€ä»‹"><a href="#Dockerç®€ä»‹" class="headerlink" title="Dockerç®€ä»‹"></a>Dockerç®€ä»‹</h1><p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/d2bcea1e46a59d50a24c95cccf5785a7.png" alt="image-20200727122403354"></p><blockquote>
<p>Dockeræ˜¯åŸºäºGOè¯­è¨€å®ç°çš„å¼€æºé¡¹ç›®ã€‚dockerçš„ä¸»è¦ç›®æ ‡æ˜¯â€œbuildï¼Œship and run APPï¼Œanywhereâ€œ</p>
<p>Build Ship and Run</p>
<p>Buildï¼ˆæ„å»ºé•œåƒï¼‰ ï¼š é•œåƒå°±åƒæ˜¯é›†è£…ç®±ï¼ŒåŒ…å«æ–‡ä»¶ä»¥åŠè¿è¡Œç¯å¢ƒç­‰ç­‰èµ„æºï¼›</p>
<p>Shipï¼ˆè¿è¾“é•œåƒï¼‰ ï¼šåœ¨<a href="https://cloud.tencent.com/product/cdh?from=10680" target="_blank" rel="noopener">å®¿ä¸»æœº</a>å’Œä»“åº“é—´è¿›è¡Œè¿è¾“ï¼Œè¿™é‡Œä»“åº“å°±åƒæ˜¯è¶…çº§ç å¤´ï¼›</p>
<p>Run ï¼ˆè¿è¡Œé•œåƒï¼‰ ï¼šè¿è¡Œçš„é•œåƒå°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®¹å™¨å°±æ˜¯è¿è¡Œç¨‹åºçš„åœ°æ–¹ã€‚</p>
<p>ä¹Ÿå°±æ˜¯é€šè¿‡å¯¹åº”ç”¨ç»„ä»¶çš„å°è£…ã€åˆ†å‘ã€éƒ¨ç½²ã€è¿è¡Œç­‰ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œ</p>
<p>ä½¿ç”¨æˆ·çš„APPåŠç”¨æˆ·ç¯å¢ƒèƒ½å¤Ÿåšåˆ°â€ä¸€æ¬¡å°è£…ï¼Œåˆ°å¤„è¿è¡Œâ€œ</p>
</blockquote><a id="more"></a>

<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/5dc7e7a9da0f5715b21bd733d3895614.png" alt="image-20200727125029710"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/01e1e5ca818440ad89d7e11ebc6f28ee.png" alt="image-20200730152100412"></p>
<h1 id="Dockerå’Œè™šæ‹Ÿæœºçš„åŒºåˆ«"><a href="#Dockerå’Œè™šæ‹Ÿæœºçš„åŒºåˆ«" class="headerlink" title="Dockerå’Œè™šæ‹Ÿæœºçš„åŒºåˆ«"></a>Dockerå’Œè™šæ‹Ÿæœºçš„åŒºåˆ«</h1><p>é¦–å…ˆï¼Œå¤§å®¶éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œ<strong>Docker</strong>å®¹å™¨<strong>ä¸æ˜¯</strong>è™šæ‹Ÿæœºã€‚</p>
<p>!(<a href="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3029876800,3884924252&amp;fm=26&amp;gp=0.jpg" target="_blank" rel="noopener">https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3029876800,3884924252&amp;fm=26&amp;gp=0.jpg</a>)</p>
<img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/39c33fd2036f523aedf415ceb1e1d61b.png" style="zoom: 80%;">

<img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/07724703293e82efc0afd3457f2ce9c5.png" alt="image-20200730151735325" style="zoom: 80%;">

<p>è™šæ‹Ÿæœºæ˜¯åœ¨ä¸€å°ç‰©ç†æœºå™¨ä¸Šï¼Œåˆ©ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œè™šæ‹Ÿå‡ºæ¥å¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œæ¯ä¸ªæ“ä½œç³»ç»Ÿä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚Dockeræ˜¯å¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œä¾ç„¶éœ€è¦å…ˆåœ¨ç”µè„‘ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿï¼Œ ç„¶åå®‰è£…Dockerå®¹å™¨çš„ç®¡ç†å™¨ï¼Œæ‰å¯ä»¥ã€‚</p>
<p>è™šæ‹Ÿæœºæ˜¯åœ¨ç¡¬ä»¶çº§åˆ«è¿›è¡Œè™šæ‹ŸåŒ–ï¼Œè€ŒDockeræ˜¯åœ¨æ“ä½œç³»ç»Ÿçš„å±‚é¢è™šæ‹ŸåŒ–ï¼›è™šæ‹Ÿæœºæ˜¯é€šè¿‡æ¨¡æ‹Ÿç¡¬ä»¶æ­å»ºæ“ä½œç³»ç»Ÿï¼Œè€ŒDockeråˆ™æ˜¯å¤ç”¨æ“ä½œç³»ç»Ÿï¼›è™šæ‹Ÿæœºå®ç°äº†æ“ä½œç³»ç»Ÿä¹‹é—´çš„éš”ç¦»ï¼ŒDockeråªæ˜¯è¿›ç¨‹ä¹‹é—´çš„éš”ç¦»ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºéš”ç¦»çº§åˆ«æ›´é«˜ã€å®‰å…¨æ€§æ–¹é¢ä¹Ÿæ›´å¼ºï¼Œä½†Dockerçš„è¿è¡Œé€Ÿåº¦å¾ˆå¿«ï¼Œå¯ä»¥ä½¿ç”¨ç§’æ¥è®¡ç®—ï¼Œè€Œè™šæ‹Ÿæœºçš„é€Ÿåº¦é€šå¸¸è¦æŒ‰åˆ†é’Ÿè®¡ç®—ã€‚</p>
<h1 id="Dockerå’Œè™šæ‹Ÿæœºå¯¹æ¯”"><a href="#Dockerå’Œè™šæ‹Ÿæœºå¯¹æ¯”" class="headerlink" title="Dockerå’Œè™šæ‹Ÿæœºå¯¹æ¯”"></a>Dockerå’Œè™šæ‹Ÿæœºå¯¹æ¯”</h1><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/81f6db7bf738da516d2da4f52bc6d588.png" alt="image-20200727125346344" style="zoom: 80%;">

<img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/8ae98472c9a938e522d66a0a675584f8.png" alt="image-20200730151935749" style="zoom:67%;">

<h1 id="Dockerçš„ä¼˜ç‚¹"><a href="#Dockerçš„ä¼˜ç‚¹" class="headerlink" title="Dockerçš„ä¼˜ç‚¹"></a>Dockerçš„ä¼˜ç‚¹</h1><ul>
<li>æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº</li>
<li>æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´</li>
<li>ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ</li>
<li>æ›´è½»æ¾çš„è¿ç§»</li>
<li>ç»Ÿä¸€çš„ç®¡ç†</li>
</ul>
<h1 id="Dockeræ¶æ„"><a href="#Dockeræ¶æ„" class="headerlink" title="Dockeræ¶æ„"></a>Dockeræ¶æ„</h1><p>Dockeræ˜¯ä¸€ä¸ªClient-Serverç»“æ„çš„ç³»ç»Ÿï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œç„¶åé€šè¿‡Socketè¿æ¥ä»å®¢æˆ·ç«¯è®¿é—®ï¼Œå®ˆæŠ¤è¿›ç¨‹ä»å®¢æˆ·ç«¯æ¥å—å‘½ä»¤å¹¶ç®¡ç†è¿è¡Œåœ¨ä¸»æœºä¸Šçš„å®¹å™¨ã€‚å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç¯å¢ƒï¼Œå°±æ˜¯æ‰€è°“çš„â€œé›†è£…ç®±â€ ã€‚</p>
<h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><h2 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ“ä½œç³»ç»Ÿåˆ†ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´ã€‚å¯¹äº Linux è€Œè¨€ï¼Œå†…æ ¸å¯åŠ¨åï¼Œä¼šæŒ‚è½½ root æ–‡ä»¶ç³»ç»Ÿä¸ºå…¶æä¾›ç”¨æˆ·ç©ºé—´æ”¯æŒã€‚è€Œ Docker é•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ ubuntu:18.04 å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥— Ubuntu 18.04 æœ€å°ç³»ç»Ÿçš„ root æ–‡ä»¶ç³»ç»Ÿã€‚Docker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚</p>
<img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/86c0e304658ec8e60109d28c6d03c284.png" alt="image-20200611162007055" style="zoom: 80%;">

<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/d178ebaeba6466e4eae81353052c89cb.png" alt="image-20200611163818495"></p>
<h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><p>é•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ ç±» å’Œ å®ä¾‹ ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚å®¹å™¨çš„å®è´¨æ˜¯è¿›ç¨‹ï¼Œä½†ä¸ç›´æ¥åœ¨å®¿ä¸»æ‰§è¡Œçš„è¿›ç¨‹ä¸åŒï¼Œå®¹å™¨è¿›ç¨‹è¿è¡Œäºå±äºè‡ªå·±çš„ç‹¬ç«‹çš„ å‘½åç©ºé—´ã€‚å› æ­¤å®¹å™¨å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ root æ–‡ä»¶ç³»ç»Ÿã€è‡ªå·±çš„ç½‘ç»œé…ç½®ã€è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ï¼Œç”šè‡³è‡ªå·±çš„ç”¨æˆ· ID ç©ºé—´ã€‚å®¹å™¨å†…çš„è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒé‡Œï¼Œä½¿ç”¨èµ·æ¥ï¼Œå°±å¥½åƒæ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹äºå®¿ä¸»çš„ç³»ç»Ÿä¸‹æ“ä½œä¸€æ ·ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—å®¹å™¨å°è£…çš„åº”ç”¨æ¯”ç›´æ¥åœ¨å®¿ä¸»è¿è¡Œæ›´åŠ å®‰å…¨ã€‚ä¹Ÿå› ä¸ºè¿™ç§éš”ç¦»çš„ç‰¹æ€§ï¼Œå¾ˆå¤šäººåˆå­¦ Docker æ—¶å¸¸å¸¸ä¼šæ··æ·†å®¹å™¨å’Œè™šæ‹Ÿæœºã€‚</p>
<h2 id="ä»“åº“"><a href="#ä»“åº“" class="headerlink" title="ä»“åº“"></a>ä»“åº“</h2><p>é•œåƒæ„å»ºå®Œæˆåï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨å½“å‰å®¿ä¸»æœºä¸Šè¿è¡Œï¼Œä½†æ˜¯ï¼Œå¦‚æœéœ€è¦åœ¨å…¶å®ƒæœåŠ¡å™¨ä¸Šä½¿ç”¨è¿™ä¸ªé•œåƒï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªé›†ä¸­çš„å­˜å‚¨ã€åˆ†å‘é•œåƒçš„æœåŠ¡ï¼ŒDocker Registry å°±æ˜¯è¿™æ ·çš„æœåŠ¡ã€‚ä¸€ä¸ª Docker Registry ä¸­å¯ä»¥åŒ…å«å¤šä¸ª ä»“åº“ï¼ˆRepositoryï¼‰ï¼›æ¯ä¸ªä»“åº“å¯ä»¥åŒ…å«å¤šä¸ª æ ‡ç­¾ï¼ˆTagï¼‰ï¼›æ¯ä¸ªæ ‡ç­¾å¯¹åº”ä¸€ä¸ªé•œåƒã€‚é€šå¸¸ï¼Œä¸€ä¸ªä»“åº“ä¼šåŒ…å«åŒä¸€ä¸ªè½¯ä»¶ä¸åŒç‰ˆæœ¬çš„é•œåƒï¼Œè€Œæ ‡ç­¾å°±å¸¸ç”¨äºå¯¹åº”è¯¥è½¯ä»¶çš„å„ä¸ªç‰ˆæœ¬ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;ä»“åº“å&gt;:&lt;æ ‡ç­¾&gt; çš„æ ¼å¼æ¥æŒ‡å®šå…·ä½“æ˜¯è¿™ä¸ªè½¯ä»¶å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœä¸ç»™å‡ºæ ‡ç­¾ï¼Œå°†ä»¥ latest ä½œä¸ºé»˜è®¤æ ‡ç­¾ã€‚</p>
<img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/c72a90d2d31c9c2b6fe99f0cc7b262b7.png" alt="image-20200730152314260" style="zoom: 67%;">

<h1 id="Dockerå®‰è£…ä¸å¯åŠ¨"><a href="#Dockerå®‰è£…ä¸å¯åŠ¨" class="headerlink" title="Dockerå®‰è£…ä¸å¯åŠ¨"></a>Dockerå®‰è£…ä¸å¯åŠ¨</h1><p>ä½¿ç”¨è„šæœ¬è‡ªåŠ¨å®‰è£…åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­ Docker å®˜æ–¹ä¸ºäº†ç®€åŒ–å®‰è£…æµç¨‹ï¼Œæä¾›äº†ä¸€å¥—ä¾¿æ·çš„å®‰è£…è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡ â€“mirror é€‰é¡¹ä½¿ç”¨å›½å†…æºè¿›è¡Œå®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -fsSL get.docker.com -o get-docker.sh \</span><br><span class="line">&amp;&amp; sudo sh get-docker.sh --mirror TxCloud \</span><br><span class="line">&amp;&amp; sudo systemctl enable docker \</span><br><span class="line">&amp;&amp; sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨çš„å°†ä¸€åˆ‡å‡†å¤‡å·¥ä½œåšå¥½ï¼Œå¹¶ä¸”æŠŠ Docker CE çš„ç¨³å®š(stable)ç‰ˆæœ¬å®‰è£…åœ¨ç³»ç»Ÿä¸­ã€‚</p>
<p>å¯åŠ¨ Docker CE</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable docker</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">sed -i "s/#PermitRootLogin.*/PermitRootLogin yes/g" /etc/ssh/sshd_config</span><br><span class="line">sed -i "s/#PubkeyAuthentication yes/PubkeyAuthentication yes/g" /etc/ssh/sshd_config</span><br><span class="line">sed -i "s/#PasswordAuthentication yes/PasswordAuthentication yes/g" /etc/ssh/sshd_config</span><br><span class="line">service sshd restart</span><br></pre></td></tr></table></figure>

<h1 id="é•œåƒåŠ é€Ÿ"><a href="#é•œåƒåŠ é€Ÿ" class="headerlink" title="é•œåƒåŠ é€Ÿ"></a>é•œåƒåŠ é€Ÿ</h1><p>Ubuntu 16.04+ã€Debian 8+ã€CentOS 7ï¼Œåœ¨ /etc/docker/daemon.json ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨è¯·æ–°å»ºè¯¥æ–‡ä»¶ï¼‰</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">echo " &#123; \</span><br><span class="line">\"registry-mirrors\": [ </span><br><span class="line">\"https://mirror.ccs.tencentyun.com\"</span><br><span class="line">] </span><br><span class="line">&#125;" &gt;  /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>

<h1 id="Docker-Composeå®‰è£…"><a href="#Docker-Composeå®‰è£…" class="headerlink" title="Docker Composeå®‰è£…"></a>Docker Composeå®‰è£…</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose \</span><br><span class="line">&amp;&amp; chmod +x /usr/local/bin/docker-compose \</span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<h1 id="Dockerå¯è§†åŒ–"><a href="#Dockerå¯è§†åŒ–" class="headerlink" title="Dockerå¯è§†åŒ–"></a>Dockerå¯è§†åŒ–</h1><h2 id="æ±‰åŒ–ç‰ˆ"><a href="#æ±‰åŒ–ç‰ˆ" class="headerlink" title="æ±‰åŒ–ç‰ˆ"></a>æ±‰åŒ–ç‰ˆ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 9000:9000 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v portainer_data:/data \</span><br><span class="line">--name portainer \</span><br><span class="line">--restart=always \</span><br><span class="line">registry.cn-zhangjiakou.aliyuncs.com/ctgu/portainer</span><br></pre></td></tr></table></figure>

<h2 id="åŸç‰ˆ"><a href="#åŸç‰ˆ" class="headerlink" title="åŸç‰ˆ"></a>åŸç‰ˆ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-p 9000:9000 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v portainer_data:/data \</span><br><span class="line">--name portainer \</span><br><span class="line">--restart=always \</span><br><span class="line">portainer/portainer</span><br><span class="line"></span><br><span class="line">æœ€æ–°ç‰ˆ</span><br><span class="line">docker run -d \</span><br><span class="line">-p 9000:9000 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v portainer_data:/data \</span><br><span class="line">--name portainer \</span><br><span class="line">--restart=always \</span><br><span class="line">portainer/portainer-ce</span><br></pre></td></tr></table></figure>

<h1 id="é•œåƒçš„æ„å»º"><a href="#é•œåƒçš„æ„å»º" class="headerlink" title="é•œåƒçš„æ„å»º"></a>é•œåƒçš„æ„å»º</h1><h2 id="Pythonå¼€å‘ç¯å¢ƒæ„å»º"><a href="#Pythonå¼€å‘ç¯å¢ƒæ„å»º" class="headerlink" title="Pythonå¼€å‘ç¯å¢ƒæ„å»º"></a>Pythonå¼€å‘ç¯å¢ƒæ„å»º</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@iZ8vbc32qrjl6z690p658hZ:~/docker# docker build -t qmx:1.0 .</span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/5 : FROM python:3.6-alpine</span><br><span class="line">3.6-alpine: Pulling from library/python</span><br><span class="line">df20fa9351a1: Pull complete </span><br><span class="line">36b3adc4ff6f: Pull complete </span><br><span class="line">98eb400f742f: Pull complete </span><br><span class="line">31cc876ef68f: Pull complete </span><br><span class="line">e8928b84e39a: Pull complete </span><br><span class="line">Digest: sha256:56320bd9f0d878ae0842fc03f078b4e081ca8cf58492bc71bd4aa53a6958a632</span><br><span class="line">Status: Downloaded newer image for python:3.6-alpine</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> d6b500d78779</span></span><br><span class="line">Step 2/5 : WORKDIR ~/qmx</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 3aafa7bef149</span></span><br><span class="line">Removing intermediate container 3aafa7bef149</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> c2892117f608</span></span><br><span class="line">Step 3/5 : RUN echo "Hello Docker!"</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 33461defb47a</span></span><br><span class="line">Hello Docker!</span><br><span class="line">Removing intermediate container 33461defb47a</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 3da8c691a4c8</span></span><br><span class="line">Step 4/5 : COPY app.py main.py</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 82b24de5eae7</span></span><br><span class="line">Step 5/5 : CMD python main.py</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 8328eccf17a9</span></span><br><span class="line">Removing intermediate container 8328eccf17a9</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 8a05929b777c</span></span><br><span class="line">Successfully built 8a05929b777c</span><br><span class="line">Successfully tagged qmx:1.0</span><br><span class="line">root@iZ8vbc32qrjl6z690p658hZ:~/docker# ls</span><br><span class="line">1  app.py  Dockerfile</span><br></pre></td></tr></table></figure>



<h2 id="Flaskç¯å¢ƒæ„å»º"><a href="#Flaskç¯å¢ƒæ„å»º" class="headerlink" title="Flaskç¯å¢ƒæ„å»º"></a>Flaskç¯å¢ƒæ„å»º</h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.6</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> author=<span class="string">"iBoy&lt;547142436@qq.com&gt;"</span> version=<span class="string">"1.0"</span> description=<span class="string">"CTGU SWZL"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /www/wwwroot/ctguswzl.cn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x docker-entrypoint.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">'s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g'</span> /etc/apk/repositories \</span></span><br><span class="line"><span class="bash">    &amp;&amp;  apk --update  add --no-cache --virtual build-dependencies g++ gcc  libxslt-dev python-dev zlib-dev python3-dev openssl-dev \</span></span><br><span class="line"><span class="bash">    &amp;&amp;  apk add jpeg-dev mysql-dev freetype-dev \</span></span><br><span class="line"><span class="bash">    &amp;&amp;  pip config <span class="built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple \</span></span><br><span class="line"><span class="bash">    &amp;&amp;  pip install  --upgrade pip \</span></span><br><span class="line"><span class="bash">    &amp;&amp;  pip install --no-cache-dir -r requirements.txt \</span></span><br><span class="line"><span class="bash">    &amp;&amp;  apk del build-dependencies \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/cache/apk/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /root/.cache \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /tmp/*</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">ENV</span> C_FORCE_ROOT True</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [ <span class="string">"./docker-entrypoint.sh"</span> ]</span></span><br></pre></td></tr></table></figure>



<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.8</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TZ Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> pyproject.toml poetry.lock  bot.py  /app/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -ex; \</span></span><br><span class="line"><span class="bash">    sed -i <span class="string">'s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g'</span> /etc/apk/repositories; \</span></span><br><span class="line"><span class="bash">    apk --update  add --no-cache --virtual build-dependencies  build-base gcc  g++  python3-dev musl-dev jpeg-dev libressl-dev libffi-dev libxslt-dev  zlib-dev  openssl-dev; \</span></span><br><span class="line"><span class="bash">	pip config <span class="built_in">set</span> global.index-url https://pypi.doubanio.com/simple; \</span></span><br><span class="line"><span class="bash">    pip install  --upgrade pip; \</span></span><br><span class="line"><span class="bash">    pip install -U setuptools pip; \</span></span><br><span class="line"><span class="bash">	python3 -m pip install poetry; \</span></span><br><span class="line"><span class="bash">    poetry config virtualenvs.create <span class="literal">false</span>; \</span></span><br><span class="line"><span class="bash">    poetry install --no-root --no-dev; \</span></span><br><span class="line"><span class="bash">    rm -rf /var/cache/apk/*; \</span></span><br><span class="line"><span class="bash">    rm -rf /root/.cache; \</span></span><br><span class="line"><span class="bash">    rm -rf /tmp/* /var/tmp/* ;</span></span><br><span class="line">    <span class="comment">#apk --purge del build-dependencies; \</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"python"</span>,<span class="string">"bot.py"</span>]</span></span><br></pre></td></tr></table></figure>



<h2 id="Tomcaté•œåƒæ„å»º"><a href="#Tomcaté•œåƒæ„å»º" class="headerlink" title="Tomcaté•œåƒæ„å»º"></a>Tomcaté•œåƒæ„å»º</h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨çš„åŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="comment">#åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /docker_home/<span class="built_in">local</span></span></span><br><span class="line"><span class="comment">#æŠŠå½“å‰ç›®å½•ä¸‹çš„jdkæ–‡ä»¶å¤¹æ·»åŠ åˆ°é•œåƒ</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> tomcat7 /docker_home/<span class="built_in">local</span>/tomcat7</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> java18 /docker_home/<span class="built_in">local</span>/java18</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /docker_home/local/java18/</span><br><span class="line"><span class="keyword">ENV</span> CATALINA_HOME /docker_home/local/tomcat7</span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/bin</span><br><span class="line"><span class="comment">#æš´éœ²8080ç«¯å£</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="comment">#å¯åŠ¨æ—¶è¿è¡Œtomcat</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"/docker_home/local/tomcat7/bin/catalina.sh"</span>,<span class="string">"run"</span>]</span></span><br></pre></td></tr></table></figure>

<h1 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h1><p>å®¹å™¨å’Œå®¿ä¸»æœºé€šä¿¡</p>
<p>å®¹å™¨ä¹‹é—´å¦‚ä½•é€šä¿¡</p>
<p>ä¸åŒDockerç½‘ç»œä¹‹é—´æ€ä¹ˆé€šä¿¡</p>
<p>Dockerç½‘ç»œçš„åŸç†</p>
<h1 id="å·æŠ€æœ¯-ï¼ˆæ•°æ®å·-volumesï¼‰"><a href="#å·æŠ€æœ¯-ï¼ˆæ•°æ®å·-volumesï¼‰" class="headerlink" title="å·æŠ€æœ¯ ï¼ˆæ•°æ®å· volumesï¼‰"></a>å·æŠ€æœ¯ ï¼ˆæ•°æ®å· volumesï¼‰</h1><p>å…·åæŒ‚è½½</p>
<p>åŒ¿åæŒ‚è½½</p>
<p>/vae/lib/docker/volumes/</p>
<p>å®ç°å®¹å™¨æ•°æ®çš„æŒä¹…åŒ–ï¼ˆMysqlï¼ŒRedisï¼‰</p>
<p>å®ç°é…ç½®æ–‡ä»¶çš„è‡ªå®šä¹‰</p>
<h1 id="å®¹å™¨æ•°æ®å·"><a href="#å®¹å™¨æ•°æ®å·" class="headerlink" title="å®¹å™¨æ•°æ®å·"></a>å®¹å™¨æ•°æ®å·</h1><p>å®ç°å®¹å™¨é—´çš„æ•°æ®å…±äº«</p>
<h1 id="å®¹å™¨ç¼–æ’ä¸è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#å®¹å™¨ç¼–æ’ä¸è‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="å®¹å™¨ç¼–æ’ä¸è‡ªåŠ¨åŒ–éƒ¨ç½²"></a>å®¹å™¨ç¼–æ’ä¸è‡ªåŠ¨åŒ–éƒ¨ç½²</h1><p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/6e5297692ad363dec8ee7d4ab6376988.png" alt="image-20200730194742362"></p>
<h2 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">springboot1:</span></span><br><span class="line">    <span class="comment"># build: /www/wwwroot/ctguswzl.cn</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">openjdk:8-jdk-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">web1</span></span><br><span class="line">    <span class="comment"># ports:</span></span><br><span class="line">    <span class="comment">#   - '8888:8888'</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># å®¹å™¨æ•°æ®å·æŒ‚è½½</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot/m.iboy.tech/demo-0.0.1-SNAPSHOT.jar:/www/wwwroot/m.iboy.tech/app.jar</span> <span class="comment"># æŒ‚è½½æºç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">command:</span>  <span class="string">/bin/sh</span> <span class="string">-c</span> <span class="string">"cd /www/wwwroot/m.iboy.tech &amp;&amp; nohup java -jar app.jar"</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">springboot2:</span></span><br><span class="line">    <span class="comment"># build: /www/wwwroot/ctguswzl.cn</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">openjdk:8-jdk-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">web2</span></span><br><span class="line">    <span class="comment"># ports:</span></span><br><span class="line">    <span class="comment">#   - '8888:8888'</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># å®¹å™¨æ•°æ®å·æŒ‚è½½</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot/m.iboy.tech/demo-0.0.1-SNAPSHOT1.jar:/www/wwwroot/m.iboy.tech/app.jar</span> <span class="comment"># æŒ‚è½½æºç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/sh</span> <span class="string">-c</span> <span class="string">"cd /www/wwwroot/m.iboy.tech &amp;&amp; nohup java -jar app.jar"</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/data:/var/lib/mysql</span> <span class="comment"># æŒ‚è½½æ•°æ®ç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/conf:/etc/mysql/conf.d</span> <span class="comment"># æŒ‚è½½é…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/logs:/var/log/mysql</span> <span class="comment"># æŒ‚è½½é…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">      </span><br><span class="line">    <span class="attr">privileged:</span> <span class="string">'true'</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/mysql.env</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--character-set-server=utf8mb4</span> <span class="string">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis/conf/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'80:80'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'7000:7000'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'443:443'</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># æ–‡ä»¶å¤¹æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/proxy:/etc/nginx/proxy</span> <span class="comment">#åå‘ä»£ç†é…ç½®æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/cert:/etc/nginx/cert</span> <span class="comment">#è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/conf.d:/etc/nginx/conf.d</span> <span class="comment"># nginxç«™ç‚¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./www/wwwroot:/etc/nginx/sites-available</span> <span class="comment"># å®¿ä¸»:docker:åªè¯»  ,wwwç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/conf/nginx.conf:/etc/nginx/nginx.conf</span> <span class="comment"># nginxé…ç½®æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/logs:/var/log/nginx</span> <span class="comment"># ç½‘ç«™æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶é—´</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/server/nginx/cache:/etc/nginx/cache</span> <span class="comment">#ç¼“å­˜é…ç½®</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot:/www/wwwroot</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">springboot1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">springboot2</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'net'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<h2 id="åŠ å…¥å·²æœ‰çš„é¡¹ç›®"><a href="#åŠ å…¥å·²æœ‰çš„é¡¹ç›®" class="headerlink" title="åŠ å…¥å·²æœ‰çš„é¡¹ç›®"></a>åŠ å…¥å·²æœ‰çš„é¡¹ç›®</h2><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">springboot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">openjdk:8-jdk-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">springboot_app</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/www/wwwroot/java</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># æ–‡ä»¶å¤¹æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/www/wwwroot/java:/www/wwwroot/java</span> <span class="comment"># æŒ‚è½½æºç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime</span> <span class="comment">#åŒæ­¥æ—¶åŒº</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/sh</span> <span class="string">-c</span> <span class="string">"nohup java -jar app.jar"</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'server_net'</span></span><br><span class="line">    <span class="attr">cap_add:</span> <span class="comment">#å†…æ ¸èƒ½åŠ›</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">server_net:</span></span><br><span class="line"><span class="comment">#    driver: bridge</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h1 id="ç›¸å…³èµ„æº"><a href="#ç›¸å…³èµ„æº" class="headerlink" title="ç›¸å…³èµ„æº"></a>ç›¸å…³èµ„æº</h1><blockquote>
<p>ğŸ‘‰ Dockerç»ƒä¹ å¹³å°ï¼š<a href="http://play-with-docker.com" target="_blank" rel="noopener">http://play-with-docker.com</a></p>
<p>ğŸ‘‰ Dockerå®˜æ–¹æ–‡æ¡£ï¼š <a href="https://docs.docker.com" target="_blank" rel="noopener">https://docs.docker.com</a></p>
<p>ğŸ‘‰ Dockerå®˜ç½‘ï¼š<a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a></p>
<p>ğŸ‘‰ Docker Hubï¼š<a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a></p>
<p>ğŸ‘‰ èœé¸Ÿæ•™ç¨‹Dockerï¼š <a href="https://www.runoob.com/docker/docker-tutorial.html" target="_blank" rel="noopener">https://www.runoob.com/docker/docker-tutorial.html</a></p>
</blockquote>
<h1 id="æ·±å…¥å­¦ä¹ "><a href="#æ·±å…¥å­¦ä¹ " class="headerlink" title="æ·±å…¥å­¦ä¹ "></a>æ·±å…¥å­¦ä¹ </h1><p>docker machine</p>
<p>docker swam</p>
<p>k8s</p>
<p>jenkins</p>
<p>docker run <br>  â€“volume=/:/rootfs:ro <br>  â€“volume=/var/run:/var/run:rw <br>  â€“volume=/sys:/sys:ro <br>  â€“volume=/var/lib/docker/:/var/lib/docker:ro <br>  â€“volume=/dev/disk/:/dev/disk:ro <br>  â€“volume portainer_data:/data <br>  â€“publish=9000:9000 <br>  â€“detach=true <br>  â€“name=portainer <br>  portainer/portainer-ce:2.16.2</p>
]]></content>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ€åä¸€å¤©æŠ˜è…¾æ±‡æ€»</title>
    <url>//post/14725.html</url>
    <content><![CDATA[<h1 id="Windows10ä¸‹å®‰è£…Anaconda3-64ä½-è¯¦ç»†è¿‡ç¨‹"><a href="#Windows10ä¸‹å®‰è£…Anaconda3-64ä½-è¯¦ç»†è¿‡ç¨‹" class="headerlink" title="Windows10ä¸‹å®‰è£…Anaconda3(64ä½)è¯¦ç»†è¿‡ç¨‹"></a>Windows10ä¸‹å®‰è£…Anaconda3(64ä½)è¯¦ç»†è¿‡ç¨‹</h1><p>ä¸‹è½½åœ°å€ï¼š<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/</a></p><a id="more"></a>
<p><a href="https://blog.csdn.net/ychgyyn/article/details/82119201" target="_blank" rel="noopener">https://blog.csdn.net/ychgyyn/article/details/82119201</a></p>
<p><a href="https://www.jianshu.com/p/1f94ff0c6e68" target="_blank" rel="noopener">https://www.jianshu.com/p/1f94ff0c6e68</a></p>
<p>condaå®‰è£…celery</p>
<p><a href="https://blog.csdn.net/weixin_30760895/article/details/101983Ubuntu538" target="_blank" rel="noopener">https://blog.csdn.net/weixin_30760895/article/details/101983Ubuntu538</a></p>
<p>codaæŒ‡å®šå®‰è£…è·¯å¾„3.5.2</p>
<p><a href="https://www.cnblogs.com/lemonbit/p/7068091.html" target="_blank" rel="noopener">https://www.cnblogs.com/lemonbit/p/7068091.html</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Anacondaåˆ›å»ºç¯å¢ƒï¼š</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ä¸‹é¢æ˜¯åˆ›å»ºpython&#x3D;3.6ç‰ˆæœ¬çš„ç¯å¢ƒï¼Œå–åå«py36</span><br><span class="line"></span><br><span class="line">conda create -n py36 python&#x3D;3.6Â </span><br><span class="line"></span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">åˆ é™¤ç¯å¢ƒï¼ˆä¸è¦ä¹±åˆ å•Šå•Šå•Šï¼‰</span><br><span class="line"></span><br><span class="line">conda remove -n swzl --all</span><br><span class="line"></span><br><span class="line">Â æŸ¥çœ‹æ‰€æœ‰çš„è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">conda env list</span><br><span class="line"></span><br><span class="line">æ¿€æ´»ç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;ä¸‹é¢è¿™ä¸ªpy36æ˜¯ä¸ªç¯å¢ƒå</span><br><span class="line"></span><br><span class="line">source activate py36Â  (conda4çš„æ˜¯ï¼šconda activate py36)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conda create --help</span><br><span class="line">å®‰è£…è™šæ‹Ÿç¯å¢ƒåˆ°æŒ‡å®šè·¯å¾„çš„å‘½ä»¤å¦‚ä¸‹ï¼š</span><br><span class="line">conda create --prefix&#x3D;O:\Python\SWZL\venv -n python&#x3D;3.5.2</span><br><span class="line">æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">conda activate O:\Python\SWZL\venv</span><br><span class="line">é€€å‡ºè™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤å¦‚ä¸‹ï¼š</span><br><span class="line">deactivate</span><br><span class="line">åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">conda remove --p&#x3D;O:\Python\SWZL\  -n venv --all</span><br></pre></td></tr></table></figure>

<p>æŸ¥æ‰¾æŒ‡å®šç‰ˆæœ¬çš„åŒ…</p>
<p><a href="https://blog.csdn.net/ksws0292756/article/details/79192268" target="_blank" rel="noopener">https://blog.csdn.net/ksws0292756/article/details/79192268</a></p>
<p>condaå®‰è£…æºæ›´æ¢</p>
<p><a href="https://blog.csdn.net/ffscript/article/details/78447197" target="_blank" rel="noopener">https://blog.csdn.net/ffscript/article/details/78447197</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">anaconda search -t conda celery</span><br><span class="line">anaconda show   prometeia&#x2F;celery </span><br><span class="line">conda install</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pipenv+anacondaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">pipenv --python D:\ProgramData\Anaconda3\pkgs\python-3.5.2-0\python.exe</span><br><span class="line">æ›´æ–° pypiæºæ¥æé«˜ä¾èµ–åº“å®‰è£…çš„é€Ÿåº¦</span><br><span class="line">åœ¨ä½¿ç”¨pipenvçš„æ—¶å€™ï¼Œå¸¸å¸¸ä¼šåœ¨å®‰è£…çš„æ—¶å€™ï¼Œä¸€ç›´å¡åœ¨äº† Locking è¿™é‡Œï¼Œé€šè¿‡åŠ ä¸Š -v å‚æ•°ï¼Œå¯ä»¥çœ‹åˆ°å®‰è£…è¿‡ç¨‹ä¸­çš„æ­¥éª¤ä¿¡æ¯ï¼Œå¡åœ¨äº†ä¸‹è½½é‚£é‡Œï¼Œè¿™æ—¶åº”è¯¥å¯ä»¥æ„è¯†åˆ°æ˜¯å› ä¸ºç½‘ç»œçš„åŸå› ï¼Œpipenvåˆ›å»ºçš„ Pipfile ä¸­é»˜è®¤çš„pypiæºæ˜¯pythonå®˜æ–¹çš„ https:&#x2F;&#x2F;pypi.python.org&#x2F;simpleã€‚æˆ‘ä»¬å›½å†…ç”¨æˆ·è®¿é—®ä¸‹è½½çš„æ—¶å€™ä¼šå¾ˆæ…¢ã€‚</span><br><span class="line">https:&#x2F;&#x2F;vimiix.com&#x2F;post&#x2F;2018&#x2F;03&#x2F;11&#x2F;manage-your-virtualenv-with-pipenv&#x2F;</span><br><span class="line">æ‰€ä»¥ï¼Œæˆ‘ä¸€èˆ¬ä¼šåœ¨åˆ›å»ºå¥½Pipfileä»¥åï¼Œä¿®æ”¹åˆ°æ–‡ä»¶ä¸­ source å—ä¸‹çš„ url å­—æ®µï¼Œè®¾ç½®ä¸ºå›½å†…çš„ pypi æºå°±å¥½äº†ï¼Œæˆ‘æ¨èçš„æ˜¯æ¸…åçš„pypiæºï¼Œå…·ä½“è®¾ç½®å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">å¤‡æ³¨ï¼šæˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°å¦‚ä½•ä¿®æ”¹èƒ½åœ¨åˆ›å»ºæ—¶å°±è®¾å¥½çš„æ–¹æ³•ï¼Œåº”è¯¥ä¿®æ”¹æºç æ˜¯å¯ä»¥çš„ï¼Œä½†è¿™æ ·ä¸å°Šé‡æºç ï¼Œæ¯•ç«Ÿé«˜å¢™æ˜¯æˆ‘ä»¬è‡ªå·±ç­‘èµ·çš„ï¼Œå¦‚æœæœ‰å¥½çš„æ–¹æ³•ï¼Œæ‚¨ä¸å¦¨åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ä¸€ä¸‹</span><br><span class="line">[[source]]</span><br><span class="line"></span><br><span class="line"> url &#x3D; &quot;https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple&quot;</span><br><span class="line"> verify_ssl &#x3D; true</span><br><span class="line"> name &#x3D; &quot;pypi&quot;</span><br><span class="line"> </span><br><span class="line"> è™šæ‹Ÿç¯å¢ƒä½ç½®</span><br><span class="line"></span><br><span class="line">Pipenv ç”Ÿæˆçš„è™šæ‹Ÿç¯å¢ƒé»˜è®¤åœ¨ç”¨æˆ·ç›®å½•, ä½ å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡: PIPENV_VENV_IN_PROJECT&#x3D;1 æ¥ä½¿ç”Ÿæˆçš„è™šæ‹Ÿç¯å¢ƒä½äºé¡¹ç›®ç›®å½•.</span><br><span class="line">Windows-x64 10</span><br><span class="line">Celery 3.1.23</span><br><span class="line">Celery-with-redis 3.0</span><br><span class="line">Redis-win32-win64 2.4.5</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install celery&#x3D;&#x3D;3.1.15</span><br><span class="line">pip install redis&#x3D;&#x3D;2.10</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM python:3.5</span><br><span class="line">MAINTAINER iBoy &quot;547142436@qq.com&quot;</span><br><span class="line">COPY requirements.txt &#x2F;root&#x2F;www&#x2F;app&#x2F;</span><br><span class="line">WORKDIR &#x2F;root&#x2F;www&#x2F;app</span><br><span class="line">CMD [&quot;python&quot;]</span><br><span class="line">RUN pip install -r requirements.txt -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br><span class="line"></span><br><span class="line">Flask + Docker æ— è„‘éƒ¨ç½²æ–°æ‰‹æ•™ç¨‹</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;78432719</span><br><span class="line"></span><br><span class="line">æ„å»ºæ–‡ä»¶</span><br><span class="line">docker build -t flask-sample:latest .</span><br><span class="line"></span><br><span class="line">sudo docker run -it --rm -p 80:80 testflask</span><br><span class="line"></span><br><span class="line"> pip3 install -r requirements.txt  -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹é»˜è®¤æŒ‡å‘æ–¹å¼</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ›´æ”¹Linux Pythoné•œåƒ</span><br><span class="line">cd ~</span><br><span class="line">mkdir .pip</span><br><span class="line">cd .pip</span><br><span class="line">vim pip.conf</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">timeout &#x3D; 6000</span><br><span class="line">index-url &#x3D; https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br><span class="line">trusted-host &#x3D; pypi.tuna.tsinghua.edu.cn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç”Ÿæˆçº¯å‡€çš„ä¾èµ–</span><br><span class="line">ç¬¬äºŒç§ (æ¨è) ä½¿ç”¨ pipreqs ï¼Œgithubåœ°å€ä¸ºï¼š https:&#x2F;&#x2F;github.com&#x2F;bndr&#x2F;pipreqs</span><br><span class="line"></span><br><span class="line"># å®‰è£…</span><br><span class="line">pip install pipreqs</span><br><span class="line"># åœ¨å½“å‰ç›®å½•ç”Ÿæˆ</span><br><span class="line">pipreqs . --encoding&#x3D;utf8 --force</span><br><span class="line">æ³¨æ„ --encoding&#x3D;utf8 ä¸ºä½¿ç”¨utf8ç¼–ç ï¼Œä¸ç„¶å¯èƒ½ä¼šæŠ¥UnicodeDecodeError: &#39;gbk&#39; codec can&#39;t decode byte 0xae in position 406: illegal multibyte sequence çš„é”™è¯¯ã€‚</span><br><span class="line"></span><br><span class="line">--force å¼ºåˆ¶æ‰§è¡Œï¼Œå½“ ç”Ÿæˆç›®å½•ä¸‹çš„requirements.txtå­˜åœ¨æ—¶è¦†ç›–ã€‚</span><br><span class="line"></span><br><span class="line">å½“å½“å½“ï¼Œå¯ä»¥çœ‹è§æˆ‘ä¾èµ–çš„åªæœ‰è¿™äº›å•¦</span><br><span class="line">python3 run.py  --host&#x3D;0.0.0.0 --port&#x3D;8888 --no-reload</span><br><span class="line">celery worker -A run.celery -l  DEBUG -E</span><br><span class="line">celery worker -A app.celery -l  DEBUG -E</span><br><span class="line"></span><br><span class="line">pip3 install gunicorn</span><br><span class="line">python3 run.py  --host&#x3D;0.0.0.0 --port&#x3D;8889 --no-reload</span><br><span class="line">sudo apt-get install gunicorn</span><br><span class="line">gunicorn -b 0.0.0.0:8889 run:app</span><br><span class="line">pip3 install -U git+https:&#x2F;&#x2F;github.com&#x2F;benoitc&#x2F;gunicorn.git</span><br><span class="line"></span><br><span class="line">export C_FORCE_ROOT&#x3D;&quot;True&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rediså…è®¸å¤–éƒ¨è¿æ¥ https:&#x2F;&#x2F;www.cnblogs.com&#x2F;sheseido&#x2F;p&#x2F;11239137.html</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">UbuntuåŒ…ç®¡ç†å·¥å…·æ›´æ”¹</span><br><span class="line">è§£å†³Ubuntu æ— æ³•ç”¨ apt-get install å®‰è£…ä»»ä½•è½¯ä»¶</span><br><span class="line">https:&#x2F;&#x2F;www.codelast.com&#x2F;%E5%8E%9F%E5%88%9B-%E8%A7%A3%E5%86%B3ubuntu-%E6%97%A0%E6%B3%95%E7%94%A8-apt-get-install-%E5%AE%89%E8%A3%85%E4%BB%BB%E4%BD%95%E8%BD%AF%E4%BB%B6dpkg-error-processing-package-xxx%E7%9A%84%E9%97%AE&#x2F;</span><br><span class="line"></span><br><span class="line">wget http:&#x2F;&#x2F;security.ubuntu.com&#x2F;ubuntu&#x2F;pool&#x2F;main&#x2F;a&#x2F;apt&#x2F;apt_1.6.12_amd64.deb</span><br><span class="line">dpkg -i apt_1.6.12_amd64.deb</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®‰è£…Redishttps:&#x2F;&#x2F;juejin.im&#x2F;entry&#x2F;5bac46dd5188255c960c3d27</span><br><span class="line">sudo apt-get install redis-server</span><br><span class="line">æ£€æŸ¥è¿›ç¨‹</span><br><span class="line">ps -agx|grep redis</span><br><span class="line">æ£€æŸ¥å¯åŠ¨</span><br><span class="line">netstat -nlt|grep 6379</span><br><span class="line">æ£€æŸ¥çŠ¶æ€</span><br><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;redis-server status</span><br><span class="line">redis-cli</span><br><span class="line">RedisæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶redis.conf</span><br><span class="line">sudo vim &#x2F;etc&#x2F;redis&#x2F;redis.conf</span><br><span class="line">vim æœç´¢</span><br><span class="line">å‘½ä»¤æ¨¡å¼ä¸‹ &#x2F;127.0.0.1</span><br><span class="line">æŒ‰ä¸‹næŸ¥æ‰¾ä¸‹ä¸€ä¸ªï¼ŒæŒ‰ä¸‹NæŸ¥æ‰¾ä¸Šä¸€ä¸ªã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯ç”¨apt-getæˆ–è€…yum installå®‰è£…çš„redisï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤åœæ­¢&#x2F;å¯åŠ¨&#x2F;é‡å¯redis</span><br><span class="line"></span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;redis-server stop </span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;redis-server start </span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;redis-server restart</span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯é€šè¿‡æºç å®‰è£…çš„redisï¼Œåˆ™å¯ä»¥é€šè¿‡redisçš„å®¢æˆ·ç«¯ç¨‹åºredis-cliçš„shutdownå‘½ä»¤æ¥é‡å¯redis</span><br><span class="line"></span><br><span class="line">1.rediså…³é—­ </span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379 shutdown</span><br><span class="line"></span><br><span class="line">2.rediså¯åŠ¨ </span><br><span class="line">redis-server</span><br><span class="line"></span><br><span class="line">å¦‚æœä¸Šè¿°æ–¹å¼éƒ½æ²¡æœ‰æˆåŠŸåœæ­¢redisï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç»ˆææ­¦å™¨ kill -9</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Ubuntu18.04æ¢æº</span><br><span class="line">sudo mv &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sourses.list.backup</span><br><span class="line">vim &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class="line">#æ¸…åæº</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-updates main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-backports main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-security main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-security main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">#3 æ›´æ”¹å®Œæˆä¹‹åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgradeã€‚</span><br><span class="line">mysqlclientæ— æ³•å®‰è£…è§£å†³</span><br><span class="line">sudo apt-get install python3.6-dev</span><br><span class="line">mysqlclinetå®‰è£…æŠ¥é”™https:&#x2F;&#x2F;blog.ducthinh.net&#x2F;gcc-no-such-file-python-h&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€å…è®¸mysqlè¿œç¨‹è®¿é—®,å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸‰ç§æ–¹å¼:</span><br><span class="line">aã€æ”¹è¡¨ã€‚</span><br><span class="line">mysql -u root â€“p</span><br><span class="line">mysql&gt;use mysql;</span><br><span class="line">mysql&gt;update user set host &#x3D; &#39;%&#39; where user &#x3D; &#39;root&#39;;</span><br><span class="line">mysql&gt;select host, user from user;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ubuntu18.04å®‰è£…MySQL Server</span><br><span class="line">Ok, I solved in this way:</span><br><span class="line"></span><br><span class="line">I used Software &amp; Updates application to remove mariadb sources</span><br><span class="line">and executed the followings steps (ref https:&#x2F;&#x2F;askubuntu.com&#x2F;a&#x2F;934576):</span><br><span class="line">sudo apt purge mysql-client-5.7 mysql-client-core-5.7 mysql-common mysql-server-5.7 mysql-server-core-5.7 mysql-server</span><br><span class="line">sudo apt update &amp;&amp; sudo apt dist-upgrade &amp;&amp; sudo apt autoremove &amp;&amp; sudo apt -f install</span><br><span class="line">sudo apt install mysql-server</span><br><span class="line"></span><br><span class="line">ç»ˆç«¯è¿æ¥MySQL</span><br><span class="line">mysql -h 192.168.19.1 -u  root -p</span><br><span class="line"></span><br><span class="line">å®‰è£…MYSQL-python</span><br><span class="line">ip install configparser</span><br><span class="line">sudo cp &#x2F;usr&#x2F;lib&#x2F;python3.6&#x2F;configparser.py &#x2F;usr&#x2F;lib&#x2F;python3.6&#x2F;ConfigParser.py</span><br><span class="line">Then try to install the MYSQL-python again. That Worked for me</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Docker</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>æš‘æœŸåŸ¹è®­-Redis</title>
    <url>//post/30045.html</url>
    <content><![CDATA[<h1 id="NoSQLæ¦‚è¿°"><a href="#NoSQLæ¦‚è¿°" class="headerlink" title="NoSQLæ¦‚è¿°"></a>NoSQLæ¦‚è¿°</h1><h2 id="1ã€ä»€ä¹ˆæ˜¯-NoSQL"><a href="#1ã€ä»€ä¹ˆæ˜¯-NoSQL" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯ NoSQL"></a>1ã€ä»€ä¹ˆæ˜¯ NoSQL</h2><p>NoSQLæ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“Not Only SQLã€‚</p><h2 id="2ã€NoSQL-æ•°æ®åº“çš„å››å¤§åˆ†ç±»"><a href="#2ã€NoSQL-æ•°æ®åº“çš„å››å¤§åˆ†ç±»" class="headerlink" title="2ã€NoSQL æ•°æ®åº“çš„å››å¤§åˆ†ç±»"></a>2ã€NoSQL æ•°æ®åº“çš„å››å¤§åˆ†ç±»</h2><a id="more"></a>
<ul>
<li>é”®å€¼ï¼ˆkey-valueï¼‰å­˜å‚¨</li>
<li>åˆ—å­˜å‚¨</li>
<li>æ–‡æ¡£æ•°æ®åº“</li>
<li>å›¾å½¢æ•°æ®åº“</li>
</ul>
<table>
<thead>
<tr>
<th><strong>åˆ†ç±»</strong></th>
<th><strong>ç›¸å…³äº§å“</strong></th>
<th><strong>å…¸å‹åº”ç”¨</strong></th>
<th><strong>æ•°æ®æ¨¡å‹</strong></th>
<th><strong>ä¼˜ç‚¹</strong></th>
<th><strong>ç¼ºç‚¹</strong></th>
</tr>
</thead>
<tbody><tr>
<td>é”®å€¼ï¼ˆkey-value)</td>
<td>Tokyoã€  Cabinet/Tyrantã€<strong>Redis</strong>ã€Voldemortã€Berkeley DBã€Memcached</td>
<td>å†…å®¹ç¼“å­˜ï¼Œä¸»è¦ç”¨äºå¤„ç†å¤§é‡æ•°æ®çš„é«˜è®¿é—®è´Ÿè½½</td>
<td>ä¸€ç³»åˆ—é”®å€¼å¯¹</td>
<td>å¿«é€ŸæŸ¥è¯¢</td>
<td>å­˜å‚¨çš„æ•°æ®ç¼ºå°‘ç»“æ„åŒ–</td>
</tr>
<tr>
<td>åˆ—å­˜å‚¨æ•°æ®åº“</td>
<td>Cassandra, HBase, Riak</td>
<td>åˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ</td>
<td>ä»¥åˆ—ç°‡å¼å­˜å‚¨ï¼Œå°†åŒä¸€åˆ—æ•°æ®å­˜åœ¨ä¸€èµ·</td>
<td>æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œæ›´å®¹æ˜“è¿›è¡Œåˆ†å¸ƒå¼æ‰©å±•</td>
<td>åŠŸèƒ½ç›¸å¯¹å±€é™</td>
</tr>
<tr>
<td>æ–‡æ¡£æ•°æ®åº“</td>
<td>CouchDB, <strong>MongoDB</strong></td>
<td>Webåº”ç”¨ï¼ˆä¸Key-Valueç±»ä¼¼ï¼Œvalueæ˜¯ç»“æ„åŒ–çš„ï¼‰</td>
<td>ä¸€ç³»åˆ—é”®å€¼å¯¹</td>
<td>æ•°æ®ç»“æ„è¦æ±‚ä¸ä¸¥æ ¼</td>
<td>æŸ¥è¯¢æ€§èƒ½ä¸é«˜ï¼Œè€Œä¸”ç¼ºä¹ç»Ÿä¸€çš„æŸ¥è¯¢è¯­æ³•</td>
</tr>
<tr>
<td>å›¾å½¢ï¼ˆGraphï¼‰æ•°æ®åº“</td>
<td>Neo4J, InfoGrid, Infinite Graph</td>
<td>ç¤¾äº¤ç½‘ç»œï¼Œæ¨èç³»ç»Ÿç­‰ã€‚ä¸“æ³¨äºæ„å»ºå…³ç³»å›¾è°±</td>
<td>å›¾ç»“æ„</td>
<td>åˆ©ç”¨å›¾ç»“æ„ç›¸å…³ç®—æ³•</td>
<td>éœ€è¦å¯¹æ•´ä¸ªå›¾åšè®¡ç®—æ‰èƒ½å¾—å‡ºç»“æœï¼Œä¸å®¹æ˜“åšåˆ†å¸ƒå¼é›†ç¾¤æ–¹æ¡ˆ</td>
</tr>
</tbody></table>
<p>MongoDBä¸»è¦ç”¨æ¥è§£å†³æµ·é‡æ•°æ®çš„è®¿é—®æ•ˆç‡é—®é¢˜ï¼Œä»–æ˜¯æœ€åƒå…³ç³»å‹æ•°æ®åº“çš„éå…³ç³»å‹æ•°æ®åº“ã€‚</p>
<p>MongoDB çš„ä¸»è¦é€‚ç”¨åœºæ™¯ä¸ºï¼šæ•°æ®ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼ˆä¾‹å¦‚é€šçŸ¥ï¼Œæ¨é€è¿™äº›ï¼‰ï¼Œæ•°æ®è¡¨ç»“æ„å˜åŒ–è¾ƒä¸ºé¢‘ç¹ï¼Œæ•°æ®é‡ç‰¹åˆ«å¤§ï¼Œæ•°æ®çš„å¹¶å‘æ€§ç‰¹åˆ«é«˜ï¼Œæ•°æ®ç»“æ„æ¯”è¾ƒç‰¹åˆ«ï¼ˆä¾‹å¦‚åœ°å›¾çš„ä½ç½®åæ ‡ï¼‰ï¼Œè¿™äº›æƒ…å†µä¸‹ç”¨ MongoDB</p>
<p>Memcachedä¸»è¦æ˜¯ç”¨æ¥æé«˜è®¿é—®å…³ç³»å‹æ•°æ®åº“çš„æ•ˆç‡é—®é¢˜ï¼Œåªå±€é™äºè®¿é—®ã€‚</p>
<p>redisåœ¨æˆ‘çœ‹æ¥ç®—æ˜¯Memcachedçš„å‡çº§ç‰ˆï¼ŒåŠ å…¥äº†æé«˜æ•°æ®åº“å†™å…¥çš„åŠŸèƒ½ã€‚</p>
<h2 id="3ã€NoSQL-çš„ç‰¹ç‚¹"><a href="#3ã€NoSQL-çš„ç‰¹ç‚¹" class="headerlink" title="3ã€NoSQL çš„ç‰¹ç‚¹"></a>3ã€NoSQL çš„ç‰¹ç‚¹</h2><ul>
<li><p>æ˜“æ‰©å±•</p>
</li>
<li><p>çµæ´»çš„æ•°æ®æ¨¡å‹</p>
</li>
<li><p>å¤§æ•°æ®é‡ï¼Œé«˜æ€§èƒ½</p>
</li>
<li><p>é«˜å¯ç”¨</p>
</li>
</ul>
<h2 id="4ã€ä¸ºä»€ä¹ˆéœ€è¦-NoSQL"><a href="#4ã€ä¸ºä»€ä¹ˆéœ€è¦-NoSQL" class="headerlink" title="4ã€ä¸ºä»€ä¹ˆéœ€è¦ NoSQL"></a>4ã€ä¸ºä»€ä¹ˆéœ€è¦ NoSQL</h2><p>éšç€web2.0äº’è”ç½‘çš„è¯ç”Ÿï¼ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å¾ˆéš¾å¯¹ä»˜web2.0æ—¶ä»£ï¼å°¤å…¶<br>æ˜¯è¶…å¤§è§„æ¨¡çš„é«˜å¹¶å‘çš„ç¤¾åŒºï¼ æš´éœ²å‡ºæ¥å¾ˆå¤šéš¾ä»¥å…‹æœçš„é—®é¢˜ï¼ŒNoSQLåœ¨å½“ä»Šå¤§æ•°æ®ç¯å¢ƒä¸‹å‘å±•çš„ååˆ†è¿…<br>é€Ÿï¼ŒRedisæ˜¯å‘å±•æœ€å¿«çš„ï¼Œè€Œä¸”æ˜¯æˆ‘ä»¬å½“ä¸‹å¿…é¡»è¦æŒæ¡çš„ä¸€ä¸ªæŠ€æœ¯ï¼<br>å¾ˆå¤šçš„æ•°æ®ç±»å‹ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œç¤¾äº¤ç½‘ç»œï¼Œåœ°ç†ä½ç½®ã€‚è¿™äº›æ•°æ®ç±»å‹çš„å­˜å‚¨ä¸éœ€è¦ä¸€ä¸ªå›ºå®šçš„æ ¼å¼ï¼<br>ä¸éœ€è¦å¤šæœˆçš„æ“ä½œå°±å¯ä»¥æ¨ªå‘æ‰©å±•çš„ ï¼ Map&lt;String,Object&gt; ä½¿ç”¨é”®å€¼å¯¹æ¥æ§åˆ¶ï¼</p>
<h1 id="Redisç®€ä»‹"><a href="#Redisç®€ä»‹" class="headerlink" title="Redisç®€ä»‹"></a>Redisç®€ä»‹</h1><p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/898a7a4fe0597409d8dabe40fc2ecbd6.png" alt="image-20200726194039683"></p>
<ul>
<li><p>Redisï¼ˆRemote Dictionary Server )ï¼Œå³è¿œç¨‹å­—å…¸æœåŠ¡</p>
</li>
<li><p>ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„å¼€æºNoSQLæ•°æ®åº“</p>
</li>
<li><p>é«˜æ€§èƒ½Key-Valueå†…å­˜æ•°æ®åº“</p>
</li>
<li><p>æ”¯æŒå°†å†…å­˜æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜å’Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ï¼ˆRDBå’ŒAOFï¼‰</p>
</li>
</ul>
<h2 id="5ã€å¤§åŸºæœ¬æ•°æ®ç±»å‹"><a href="#5ã€å¤§åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="5ã€å¤§åŸºæœ¬æ•°æ®ç±»å‹"></a>5ã€å¤§åŸºæœ¬æ•°æ®ç±»å‹</h2><ul>
<li><p>stringï¼ˆå­—ç¬¦ä¸²ï¼‰æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ä¸€ä¸ªredisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512M nx      set if    not exists</p>
</li>
<li><p>hashï¼ˆHashè¡¨ï¼‰</p>
</li>
<li><p>listï¼ˆåˆ—è¡¨ï¼‰</p>
</li>
<li><p>setï¼ˆæ— åºé›†åˆï¼‰</p>
</li>
<li><p>zset(sorted set) ï¼ˆæœ‰åºé›†åˆï¼‰</p>
<p>ä¸‹é¢æ¥å¯¹è¿™5ç§æ•°æ®ç»“æ„ç±»å‹ä½œç®€å•çš„ä»‹ç»ï¼š</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>ç»“æ„ç±»å‹</th>
<th align="left">ç»“æ„å­˜å‚¨çš„å€¼</th>
<th>ç»“æ„çš„è¯»å†™èƒ½åŠ›</th>
</tr>
</thead>
<tbody><tr>
<td>String</td>
<td align="left">å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°</td>
<td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œï¼›å¯¹è±¡å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢(increment)æˆ–è€…è‡ªå‡(decrement)</td>
</tr>
<tr>
<td>List</td>
<td align="left">ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²</td>
<td>ä»é“¾è¡¨çš„ä¸¤ç«¯æ¨å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ ï¼›æ ¹æ®åç§»é‡å¯¹é“¾è¡¨è¿›è¡Œä¿®å‰ª(trim)ï¼›è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æ¥æŸ¥æ‰¾æˆ–è€…ç§»é™¤å…ƒç´ </td>
</tr>
<tr>
<td>Set</td>
<td align="left">åŒ…å«å­—ç¬¦ä¸²çš„æ— åºæ”¶é›†å™¨(unorderedcollection)ï¼Œå¹¶ä¸”è¢«åŒ…å«çš„æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€å„ä¸ç›¸åŒ</td>
<td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ ï¼›æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºæŸä¸ªé›†åˆä¸­ï¼›è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼›ä»é›†åˆé‡Œå–å¼„éšæœºè·å–å…ƒç´ </td>
</tr>
<tr>
<td>Hash</td>
<td align="left">åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td>
<td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ï¼›è·å–æ‰€æœ‰é”®å€¼å¯¹</td>
</tr>
<tr>
<td>Zset</td>
<td align="left">å­—ç¬¦ä¸²æˆå‘˜(member)ä¸æµ®ç‚¹æ•°åˆ†å€¼(score)ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼Œå…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†å€¼çš„å¤§å°å†³å®š</td>
<td>æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ï¼›æ ¹æ®åˆ†å€¼èŒƒå›´(range)æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´ </td>
</tr>
</tbody></table>
<h1 id="3ç§ç‰¹æ®Šæ•°æ®ç±»å‹"><a href="#3ç§ç‰¹æ®Šæ•°æ®ç±»å‹" class="headerlink" title="3ç§ç‰¹æ®Šæ•°æ®ç±»å‹"></a>3ç§ç‰¹æ®Šæ•°æ®ç±»å‹</h1><ul>
<li><p>Geospatial åœ°ç†ä½ç½®</p>
<p>æ¨ç®—åœ°ç†ä½ç½®çš„ä¿¡æ¯ï¼Œä¸¤åœ°ä¹‹é—´çš„è·ç¦»ï¼Œæ–¹åœ†å‡ é‡Œçš„äºº</p>
</li>
<li><p>Hyperloglog</p>
<p>ä½¿ç”¨åŸºæ•°ä¼°è®¡ç»Ÿè®¡ç½‘ç«™è®¿å®¢æ•°</p>
</li>
<li><p>Bitmap</p>
<p>ç»Ÿè®¡ç”¨æˆ·ä¿¡æ¯ï¼Œæ´»è·ƒï¼Œä¸æ´»è·ƒï¼ ç™»å½• ã€ æœªç™»å½•ï¼ç­¾åˆ°æ‰“å¡ ä¸¤ä¸ªçŠ¶æ€çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨</p>
</li>
</ul>
<h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><ul>
<li><p>set / get / del /getset</p>
</li>
<li><p>expire</p>
<p>â€‹       Rediså¯¹äºè¿‡æœŸé”®æœ‰ä¸‰ç§æ¸…é™¤ç­–ç•¥ï¼š</p>
<ul>
<li><p>è¢«åŠ¨åˆ é™¤ï¼šå½“è¯»/å†™ä¸€ä¸ªå·²ç»è¿‡æœŸçš„keyæ—¶ï¼Œä¼šè§¦å‘æƒ°æ€§åˆ é™¤ç­–ç•¥ï¼Œç›´æ¥åˆ é™¤æ‰è¿™ä¸ªè¿‡æœŸkey</p>
</li>
<li><p>ä¸»åŠ¨åˆ é™¤ï¼šç”±äºæƒ°æ€§åˆ é™¤ç­–ç•¥æ— æ³•ä¿è¯å†·æ•°æ®è¢«åŠæ—¶åˆ æ‰ï¼Œæ‰€ä»¥Redisä¼šå®šæœŸä¸»åŠ¨æ·˜æ±°ä¸€æ‰¹å·²è¿‡æœŸçš„key</p>
</li>
<li><p>å½“å‰å·²ç”¨å†…å­˜è¶…è¿‡maxmemoryé™å®šæ—¶ï¼Œè§¦å‘ä¸»åŠ¨æ¸…ç†ç­–ç•¥</p>
<p>maxmemory å½“å‰å·²ç”¨å†…å­˜è¶…è¿‡maxmemoryé™å®šæ—¶ï¼Œè§¦å‘ä¸»åŠ¨æ¸…ç†ç­–ç•¥</p>
<ul>
<li>volatile-lruï¼šåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyè¿›è¡ŒLRUï¼ˆé»˜è®¤å€¼ï¼‰</li>
<li>allkeys-lru ï¼š åˆ é™¤lruç®—æ³•çš„key</li>
<li>volatile-randomï¼šéšæœºåˆ é™¤å³å°†è¿‡æœŸkey</li>
<li>allkeys-randomï¼šéšæœºåˆ é™¤</li>
<li>volatile-ttl ï¼š åˆ é™¤å³å°†è¿‡æœŸçš„</li>
<li>noeviction ï¼š æ°¸ä¸è¿‡æœŸï¼Œè¿”å›é”™è¯¯</li>
</ul>
</li>
</ul>
</li>
<li><p>exists</p>
</li>
<li><p>incr</p>
</li>
<li><p>setrange</p>
</li>
</ul>
<h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><ul>
<li>ç¼“å­˜</li>
<li>é™æ—¶ä¸šåŠ¡çš„è¿ç”¨</li>
<li>è®¡æ•°å™¨ç›¸å…³é—®é¢˜(ç½‘ç«™è®¿é—®ç»Ÿè®¡)    </li>
<li>æ’è¡Œæ¦œç›¸å…³é—®é¢˜        </li>
<li>ä»»åŠ¡é˜Ÿåˆ—</li>
<li>åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„ä¸­çš„ session åˆ†ç¦»</li>
</ul>
<h1 id="SpringBootæ•´åˆ"><a href="#SpringBootæ•´åˆ" class="headerlink" title="SpringBootæ•´åˆ"></a>SpringBootæ•´åˆ</h1><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">## Redis é…ç½®</span><br><span class="line">## Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span><br><span class="line">spring.redis.database=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">## RedisæœåŠ¡å™¨åœ°å€</span><br><span class="line">spring.redis.host=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">## RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span><br><span class="line">spring.redis.port=<span class="number">6379</span></span><br><span class="line"></span><br><span class="line">## RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰</span><br><span class="line">spring.redis.password=</span><br><span class="line"></span><br><span class="line">## è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line">spring.redis.timeout=<span class="number">5000</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®æŒä¹…åŒ–"><a href="#æ•°æ®æŒä¹…åŒ–" class="headerlink" title="æ•°æ®æŒä¹…åŒ–"></a>æ•°æ®æŒä¹…åŒ–</h2><p>ä¸‹é¢ç»™å‡ºä¸€äº›å¸¸ç”¨çš„æ—¶é—´æ ¼å¼</p>
<blockquote>
<p>â€œâ€0 30 1 ? * * â€œæ¯å¤©å‡Œæ™¨1:30æ‰§è¡Œ</p>
<p>â€œ0 0 12 * * ?â€ æ¯å¤©ä¸­åˆåäºŒç‚¹è§¦å‘</p>
<p>â€œ0 15 10 ? * *â€ æ¯å¤©æ—©ä¸Š10ï¼š15è§¦å‘</p>
<p>â€œ0 15 10 * * ?â€ æ¯å¤©æ—©ä¸Š10ï¼š15è§¦å‘</p>
<p>â€œ0 15 10 * * ? *â€ æ¯å¤©æ—©ä¸Š10ï¼š15è§¦å‘</p>
<p>â€œ0 15 10 * * ? 2005â€ 2005å¹´çš„æ¯å¤©æ—©ä¸Š10ï¼š15è§¦å‘</p>
<p>â€œ0 * 14 * * ?â€ æ¯å¤©ä»ä¸‹åˆ2ç‚¹å¼€å§‹åˆ°2ç‚¹59åˆ†æ¯åˆ†é’Ÿä¸€æ¬¡è§¦å‘</p>
<p>â€œ0 0/5 14 * * ?â€ æ¯å¤©ä»ä¸‹åˆ2ç‚¹å¼€å§‹åˆ°2ï¼š55åˆ†ç»“æŸæ¯5åˆ†é’Ÿä¸€æ¬¡è§¦å‘</p>
<p>â€œ0 0/5 14,18 * * ?â€ æ¯å¤©çš„ä¸‹åˆ2ç‚¹è‡³2ï¼š55å’Œ6ç‚¹è‡³6ç‚¹55åˆ†ä¸¤ä¸ªæ—¶é—´æ®µå†…æ¯5åˆ†é’Ÿä¸€æ¬¡è§¦å‘</p>
<p>â€œ0 0-5 14 * * ?â€ æ¯å¤©14:00è‡³14:05æ¯åˆ†é’Ÿä¸€æ¬¡è§¦å‘</p>
<p>â€œ0 10,44 14 ? 3 WEDâ€ ä¸‰æœˆçš„æ¯å‘¨ä¸‰çš„14ï¼š10å’Œ14ï¼š44è§¦å‘</p>
<p>â€œ0 15 10 ? * MON-FRIâ€ æ¯ä¸ªå‘¨ä¸€ã€å‘¨äºŒã€å‘¨ä¸‰ã€å‘¨å››ã€å‘¨äº”çš„10ï¼š15è§¦å‘</p>
</blockquote>
<h2 id="Sessionå…±äº«é…ç½®"><a href="#Sessionå…±äº«é…ç½®" class="headerlink" title="Sessionå…±äº«é…ç½®"></a>Sessionå…±äº«é…ç½®</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!--session-redis--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.session&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Sessionå­˜å‚¨è®¾ç½®"><a href="#Sessionå­˜å‚¨è®¾ç½®" class="headerlink" title="Sessionå­˜å‚¨è®¾ç½®"></a>Sessionå­˜å‚¨è®¾ç½®</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">é…ç½®</span><br><span class="line">spring.session.store-type=redis</span><br></pre></td></tr></table></figure>

<h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h1><h2 id="Redisæ“ä½œå¤æ‚æ•°æ®ç±»å‹"><a href="#Redisæ“ä½œå¤æ‚æ•°æ®ç±»å‹" class="headerlink" title="Redisæ“ä½œå¤æ‚æ•°æ®ç±»å‹"></a>Redisæ“ä½œå¤æ‚æ•°æ®ç±»å‹</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctgu.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayName;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName</span>(<span class="string">"RediscaozSet"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testSet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SetOperations operations=redisTemplate.opsForSet();</span><br><span class="line">        operations.add(<span class="string">"s1"</span>, <span class="string">"v1"</span>);</span><br><span class="line">        operations.add(<span class="string">"s1"</span>,<span class="string">"v2"</span>);</span><br><span class="line">        Cursor&lt;String&gt;cursor=operations.scan(<span class="string">"s1"</span>, ScanOptions.NONE);</span><br><span class="line">        <span class="keyword">while</span> (cursor.hasNext())&#123;</span><br><span class="line">            System.out.println(cursor.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName</span>(<span class="string">"æµ‹è¯•Hash"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testHash</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HashOperations&lt;String,String,String&gt; operations=redisTemplate.opsForHash();</span><br><span class="line">        HashMap map=<span class="keyword">new</span> HashMap();</span><br><span class="line">        map.put(<span class="string">"t1"</span>,<span class="string">"tv1"</span>);</span><br><span class="line">        operations.putAll(<span class="string">"h1"</span>,map);</span><br><span class="line">        operations.put(<span class="string">"h1"</span>,<span class="string">"k1"</span>,<span class="string">"v1"</span>);</span><br><span class="line">        operations.put(<span class="string">"h1"</span>,<span class="string">"k2"</span>,<span class="string">"v2"</span>);</span><br><span class="line">        operations.put(<span class="string">"h1"</span>,<span class="string">"k3"</span>,<span class="string">"m2"</span>);</span><br><span class="line">        Cursor&lt;Map.Entry&lt;String, String&gt;&gt; cursor=operations.scan(<span class="string">"h1"</span>, <span class="keyword">new</span> ScanOptions.ScanOptionsBuilder().match(<span class="string">"*k*"</span>).build());</span><br><span class="line">        <span class="keyword">while</span> (cursor.hasNext())&#123;</span><br><span class="line">            Map.Entry&lt;String,String&gt; entry = cursor.next();</span><br><span class="line">            System.out.println(entry.getKey());;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        System.out.println(redisTemplate.opsForHash().entries("h1"));</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="é¡¹ç›®ä»£ç ï¼š"><a href="#é¡¹ç›®ä»£ç ï¼š" class="headerlink" title="é¡¹ç›®ä»£ç ï¼š"></a>é¡¹ç›®ä»£ç ï¼š</h1><blockquote>
<p>GitHubï¼š<a href="https://github.com/iboytech/2020-7-29-redis" target="_blank" rel="noopener">https://github.com/iboytech/2020-7-29-redis</a></p>
</blockquote>
<h1 id="å…³äºRedisçš„å‚è€ƒ"><a href="#å…³äºRedisçš„å‚è€ƒ" class="headerlink" title="å…³äºRedisçš„å‚è€ƒ"></a>å…³äºRedisçš„å‚è€ƒ</h1><blockquote>
<p>ğŸ‘‰ Rediså‘½ä»¤æ‰‹å†Œ   <a href="https://www.redis.net.cn/order/" target="_blank" rel="noopener">https://www.redis.net.cn/order/</a></p>
<p>ğŸ‘‰ Redisç»ƒä¹ å¹³å°  <a href="https://try.redis.io/" target="_blank" rel="noopener">https://try.redis.io/</a></p>
<p>ğŸ‘‰ èœé¸Ÿæ•™ç¨‹    <a href="https://www.runoob.com/redis/redis-keys.html" target="_blank" rel="noopener">https://www.runoob.com/redis/redis-keys.html</a>     </p>
<p> ğŸ‘‰ SpringBootæ•´åˆRedis    <a href="https://segmentfault.com/a/1190000017057950" target="_blank" rel="noopener">https://segmentfault.com/a/1190000017057950</a>    </p>
</blockquote>
]]></content>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡å›¾ç¬”è®°</title>
    <url>//post/54196.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>è…¾è®¯äº‘å‡½æ•°å®ç°ç–«æƒ…ä¸ŠæŠ¥</title>
    <url>//post/38264.html</url>
    <content><![CDATA[<p><strong>1ã€æ³¨å†Œè…¾è®¯äº‘</strong></p><p><a href="https://link.zhihu.com/?target=https%3A//cloud.tencent.com/">è…¾è®¯äº‘cloud.tencent.com</a></p><p><strong>2ã€è¿›å…¥â€œæ§åˆ¶å°â€</strong></p><p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/6abf1ef886775616001dbaa5da78a770.png" alt="img"></p><p><strong>3ã€æœç´¢â€œäº‘å‡½æ•°â€</strong></p><p><a href="https://link.zhihu.com/?target=http%3A//weixin.qq.com/q/02gMBYFjDs9bT1DISyxucO">http://weixin.qq.com/q/02gMBYFjDs9bT1DISyxucO</a> (äºŒç»´ç è‡ªåŠ¨è¯†åˆ«)</p><a id="more"></a>





<p><strong>4ã€è¿›è¡Œéƒ¨ç½²</strong><br>ï¼ˆ1ï¼‰åˆ›å»ºæ–°å‡½æ•°</p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/884be992ec770022f7be854068a15c9d.png" alt="img"></p>
<p>ï¼ˆ2ï¼‰å‡½æ•°é…ç½®</p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/5016b387e07b0e6bfdd0f7c2c4d5c216.png" alt="img"></p>
<p>ï¼ˆ3ï¼‰å°†pyå¤åˆ¶åˆ°</p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/09708bfaf8af3df11d62be76f360866b.png" alt="img"></p>
<p>å¡«å†™å®Œåå¾€ä¸‹ç¿»è¿›è¡Œé«˜çº§è®¾ç½®ï¼Œè¿™ä¸ªæ—¶é—´å»ºè®®è®¾é•¿ä¸€ç‚¹ï¼Œä¿è¯è„šæœ¬èƒ½å¤Ÿè¿è¡Œå®Œï¼Œå¡«å®Œåå°±å¯ä»¥ä¿å­˜äº†</p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/a2cb654d1b4ad1de12cccc7fe5d63bc2.png" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/80bf7c559ef1588c11d9986eccd280d9.png" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/702244e8c960b0978209d4e21afb0818.png" alt="img"></p>
<p>è¿™æ ·å°±æ˜¯å¯ä»¥ç”¨çš„äº†</p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/7dd1480785263bb2c3e29663ffc17745.png" alt="img"></p>
<p>psï¼šå‡ºç°è¿™ç§æƒ…å†µæ˜¾ç¤ºâ€è¯¥ipæ— æ³•è®¿é—®CXç­‰é—®é¢˜ï¼Œå¯ä»¥ç¬¬å››æ­¥ï¼Œé‡æ–°é€‰æ‹©ä¸€ä¸ªåœ°åŒºè¿›è¡Œåˆ›å»ºâ€ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/9a43745ea21e6b9659f5dce2c391573b.png" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2022/06/12/3562a3e47e2e5ffee9bf17d2ad4fc76b.png" alt="image-20200823173713009"></p>
]]></content>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿé‡ç‚¹</title>
    <url>//post/10605.html</url>
    <content><![CDATA[<h2 id="ç¬¬ä¸€ç« ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°"><a href="#ç¬¬ä¸€ç« ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="ç¬¬ä¸€ç« ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°"></a>ç¬¬ä¸€ç« ã€æ“ä½œç³»ç»Ÿæ¦‚è¿°</h2><p><strong>ä¸€ã€ä¸ºä»€ä¹ˆè¦åŒºåˆ†ç³»ç»Ÿæ€å’Œç”¨æˆ·æ€ï¼Ÿ</strong></p><p>â€‹        é˜²æ­¢æ“ä½œç³»ç»Ÿå’Œå…³é”®æ•°æ®å—åˆ°ç”¨æˆ·ç¨‹åºæœ‰æ„æˆ–æ— æ„çš„ç ´åï¼Œé€šå¸¸å°†å¤„ç†æœºçš„æ‰§è¡ŒçŠ¶æ€åˆ†ä¸ºç³»ç»Ÿæ€å’Œç”¨æˆ·æ€</p><a id="more"></a>

<ol>
<li><p>â€‹    ç”¨æˆ·æ€ä¸‹æ“ä½œå—åˆ°é™åˆ¶ä¸èƒ½æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œé˜²æ­¢æ“ä½œç³»ç»Ÿæˆ–å…¶ä»–ç¨‹åºæ”¶åˆ°ç ´åï¼Œç”¨æˆ·æ€çš„ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨</p>
<p>æ¥å—ç³»ç»Ÿæ€ä¸‹çš„è¿è¡Œçš„æœåŠ¡</p>
</li>
<li><p>ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºåªèƒ½å­˜å–è‡ªå·±çš„æŒ‡ä»¤å’Œæ•°æ®ï¼Œä¸èƒ½å­˜å–å…¶ä»–ç¨‹åºå’Œæ“ä½œç³»ç»Ÿçš„æŒ‡ä»¤å’Œæ•°æ®</p>
<p>ä½†æ˜¯ç³»ç»Ÿæ€ä¸‹çš„è¿›ç¨‹å¯ä»¥å­˜å–æ“ä½œç³»ç»Ÿå’Œç”¨æˆ·è¿›è¡Œçš„æ•°æ®ï¼Œå¯ä»¥æ‰§è¡Œä¸€åˆ‡æŒ‡ä»¤</p>
</li>
</ol>
<p><strong>äºŒã€å¤šé“ç¨‹åºè®¾è®¡çš„æ„ä¹‰ï¼Ÿ</strong></p>
<ol>
<li><p>æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡å’Œååç‡ã€‚å½“ç¨‹åºéœ€è¦ç­‰å¾…æŸç§äº‹æƒ…çš„å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸ç”¨ç©ºé—²ç­‰å¾…ï¼Œå¯ä»¥æ‰§è¡Œå…¶ä»–ç¨‹åºã€è¿™æ ·CPUå’Œå¤–è®¾å¯ä»¥å¹¶è¡Œæ“ä½œ</p>
</li>
<li><p>å®¢è§‚ä¸–ç•Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤šé“ï¼Œå®¢è§‚ä¸–ç•Œæœ‰äº›é—®é¢˜æƒ³è¦å¿«é€Ÿè§£å†³ï¼Œéœ€è¦å¤šé“ç³»ç»Ÿçš„å‡ºç°</p>
<hr>
</li>
</ol>
<p><strong>ä¸‰ã€å®¢æˆ·æœºå’ŒæœåŠ¡å™¨æ¨¡å‹å¸¸ç”¨è¯­ç½‘ç»œå’Œåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ˜¯å¦å¯ç”¨äºå•æœºç³»ç»Ÿï¼Ÿ</strong></p>
<p>â€‹        å®¢æˆ·æœº/æœåŠ¡å™¨æ¨¡å‹æ˜¯é€šç”¨æ¨¡å‹ï¼Œå¹¿ä¹‰ä¸Šè®²ï¼Œæä¾›æœåŠ¡çš„å«æœåŠ¡å™¨ï¼Œè¯·æ±‚æœåŠ¡çš„å«å®¢æˆ·æœºï¼Œåœ¨å®¢æˆ·æœº/æœåŠ¡å™¨æ¨¡å‹ä¸­çš„ï¼Œæ–‡ä»¶æœåŠ¡ï¼Œè¿›ç¨‹æœåŠ¡éƒ½æ˜¯ä»¥æœåŠ¡å™¨è¿›ç¨‹çš„å½¢å¼è¿è¡Œä¸ç”¨æˆ·æ€ï¼Œç”¨æˆ·è¿›ç¨‹é€šè¿‡å‘æœåŠ¡å™¨è¯·æ±‚æˆ–å¾—æœåŠ¡ï¼Œæ‰€ä»¥å®¢æˆ·æœº/æœåŠ¡å™¨æ¨¡å‹å³å¯ç”¨äºç½‘ç»œå’Œåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¹Ÿå¯ç”¨æˆ·å•æœºç³»ç»Ÿ</p>
<p><strong>å››ã€ç³»ç»Ÿè°ƒç”¨å’Œä¸€èˆ¬çš„å‡½æ•°è°ƒç”¨çš„åŒºåˆ«ï¼Ÿ</strong></p>
<p>â€‹    ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œçš„ç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸­çš„ç³»ç»Ÿæ€ä¸‹æ‰§è¡Œï¼Œä¸€èˆ¬çš„å‡½æ•°è°ƒç”¨ç”±ç”¨æˆ·å‡†å¤‡åœ¨ç”¨æˆ·æ€ä¸‹æ‰§è¡Œ</p>
<p><strong>äº”ã€è¿‡ç¨‹è°ƒç”¨å’Œç³»ç»Ÿè°ƒç”¨çš„ç›¸åŒç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬ä¸ä¸­æ–­è°ƒç”¨çš„å·®åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<ol>
<li><p>è¿‡ç¨‹è°ƒç”¨å’Œç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œæ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œåœ¨ç›¸åŒçš„æ•°æ®é›†ä¸Šé‡å¤æ‰§è¡Œï¼Œéƒ½éœ€è¦ä¿å­˜ç°åœºä¿¡æ¯è½¬è€Œæ‰§è¡Œå…¶ä»–çš„ç¨‹åºï¼Œæ‰§è¡Œåè¿”å›ã€‚</p>
</li>
<li><p>ä¸­æ–­è°ƒç”¨çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ï¼Œåœ¨ç›¸åŒçš„æ•°æ®é›†ä¸Šé‡å¤æ‰§è¡Œï¼Œä¸­æ–­çš„å‘ç”Ÿç‚¹å¯ä»¥æ˜¯ä¸åŒåˆ˜çš„ã€‚</p>
</li>
</ol>
<p><strong>å…­ã€ä¸€èˆ¬è®¡ç®—æœºçš„å¯åŠ¨è¿‡ç¨‹ï¼Ÿ</strong></p>
<ol>
<li><p>ç”±ROMç¨‹åºå¯¹ç¡¬ä»¶è¿›è¡Œæ£€æµ‹</p>
</li>
<li><p>ROMä¸­çš„å¯åŠ¨ç¨‹åºå°†ç£ç›˜å¼•å¯¼å—è¯»å…¥å†…å­˜</p>
</li>
<li><p>å¼•å¯¼å—å°†OSå†…æ ¸è°ƒå…¥å†…å­˜</p>
</li>
<li><p>æ‰§è¡ŒOSå†…æ ¸ç¨‹åºè¿›è¡Œåˆå§‹åŒ–</p>
</li>
<li><p>åŠ è½½å¤–æ ¸å¤„ç†ç¨‹åºï¼Œç»™å‡ºæç¤ºï¼Œç­‰å¾…ç”¨æˆ·æ“ä½œ</p>
</li>
</ol>
<p><strong>ä¸ƒã€å¤šé“ç¨‹åºå¦‚ä½•å®ç°CPUè®¡ç®—å’ŒIOæ“ä½œå¹¶è¡Œï¼Ÿ</strong></p>
<p>â€‹        å¤šé“ç¨‹åºç³»ç»Ÿä¸­CPUæ— éœ€ç›´æ¥æ§åˆ¶IOæ“ä½œçš„å®Œæˆï¼Œè€Œæ˜¯é€šè¿‡é€šé“ï¼ŒDMAï¼Œå’Œä¸­æ–­æœºæ„æ§åˆ¶IOå®Œæˆï¼ŒCPUä¸æ˜¯ç©ºé—²ç­‰å¾…IOæ“ä½œçš„å®Œæˆï¼Œè€Œæ˜¯è½¬è€Œæ‰§è¡Œå…¶ä»–åº”ç”¨ç¨‹åº</p>
<p><strong>å…«ã€ä¸ºä»€ä¹ˆç›¸åŒçš„ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åœ¨DOSå’ŒWindowsä¸‹è¿è¡Œå´ä¸èƒ½åœ¨UNIXä¸‹è¿è¡Œï¼Ÿ</strong></p>
<p>â€‹        è™½ç„¶ç¡¬ä»¶æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºçš„è¿è¡Œéœ€è¦OSçš„æ”¯æŒï¼ŒWindowsæ˜¯å…¼å®¹DOSçš„ï¼Œæ‰€ä»¥åœ¨DOSä¸‹è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿèƒ½åœ¨OSä¸‹é¢è¿è¡Œï¼Œä½†æ˜¯DOSï¼ŒWindowså’ŒUNIXåœ¨ç³»ç»Ÿç»“æ„,ç”¨æˆ·æ¥å£,APIç­‰æ–¹é¢æ˜¯ä¸å…¼å®¹çš„ï¼Œæ¯”å¦‚åº”ç”¨ç”¨åˆ°äº†windowsä¸‹çš„ç³»ç»Ÿè°ƒç”¨çš„APIï¼Œä½†æ˜¯UNIXä¸‹æ²¡æœ‰ï¼Œç¨‹åºå°±æ— æ³•è¿è¡Œã€‚</p>
<p><strong>ä¹ã€ä¸ºä»€ä¹ˆä¸­æ–­æœºæ„å¯¹å¤šé“æ“ä½œç³»ç»Ÿæ¥è¯´æ˜¯æ¯”ä¸å¯å°‘çš„ï¼Ÿ</strong></p>
<p>â€‹    æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹åˆ‡æ¢å¾ˆå¤šæ—¶å€™éƒ½æ˜¯é€šè¿‡ä¸­æ–­æ¥å®Œæˆçš„ï¼Œå¦‚æ—¶é’Ÿä¸­æ–­ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†æ—¶ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿè°ƒç”¨é€šè¿‡è½¯ä¸­æ–­æ¥å®ç°ï¼Œé€šé“å’Œå¤–è®¾çš„æ“ä½œä¹Ÿéœ€è¦å‘æ“ä½œç³»ç»Ÿå‘é€ä¸­æ–­ã€‚</p>
<p><strong>åã€ç½‘ç»œæ“ä½œç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿçš„åŒºåˆ«ï¼Ÿ</strong></p>
<p>â€‹        1ã€ç½‘ç»œæ“ä½œç³»ç»Ÿç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„æœºå™¨å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®å…¶ä»–æœºå™¨çš„èµ„æºï¼Œé€šè¿‡ç½‘ç»œå°†å¾ˆå¤šçš„æœºå™¨è¿æ¥èµ·æ¥å…±äº«ç¡¬ä»¶èµ„æºï¼Œä½†æ•´ä¸ªç³»ç»Ÿå¯¹ç”¨æˆ·æ¥è¯´æ˜¯åˆ†æ•£çš„ï¼Œä¸é€æ˜çš„</p>
<p>â€‹        2ã€åˆ†å¸ƒå¼OSä¹Ÿæ˜¯é€šè¿‡ç½‘ç»œå°†æ•´ä¸ªç³»ç»Ÿè¿æ¥èµ·æ¥ï¼Œä½†æ˜¯æ•´ä¸ªç³»ç»Ÿå¯¹ç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·ä½¿ç”¨åˆ†å¸ƒå¼OSå°±åƒåœ¨ä½¿ç”¨è‡ªå·±çš„ç”µè„‘</p>
<p><strong>åä¸€ã€å°†æ‰‹å·¥æ“ä½œï¼Œå•é“æ‰¹å¤„ç†ï¼Œå¤šé“æ‰¹å¤„ç†ï¼Œå¤šç”¨æˆ·åˆ†æ—¶ç³»ç»ŸæŒ‰ç…§CPUåˆ©ç”¨ç‡ä»å°åˆ°å¤§æ’åº</strong></p>
<p>æ‰‹å·¥&lt;å•é“æ‰¹å¤„ç†ç³»ç»Ÿ&lt;å¤šç”¨æˆ·åˆ†æ—¶ç³»ç»Ÿ&lt;å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ</p>
<hr>
<h2 id="ç¬¬äºŒç« ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„ç®¡ç†"><a href="#ç¬¬äºŒç« ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„ç®¡ç†" class="headerlink" title="ç¬¬äºŒç« ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„ç®¡ç†"></a>ç¬¬äºŒç« ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„ç®¡ç†</h2><p><strong>ä¸€ã€ä¸¾ä¾‹è¯´æ˜å¤šé“ç¨‹åºç³»ç»Ÿæ—¶åŒºå°é—­æ€§å’Œå†ç°æ€§</strong></p>
<p>æœ‰ä¸¤ä¸ªå¾ªç¯ç¨‹åºï¼Œå…±äº«ä¸€ä¸ªå˜é‡Nï¼Œ</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Pa&#123;</span><br><span class="line">	repeat</span><br><span class="line">		N:=N+<span class="number">1</span>;</span><br><span class="line">	until <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Pb&#123;</span><br><span class="line">	repeat</span><br><span class="line">		print(N);</span><br><span class="line">		N=<span class="number">0</span>;</span><br><span class="line">	until <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸæ—¶åˆ»Nçš„åˆå€¼ä¸ºn,å¯èƒ½å‡ºç°ä»¥ä¸‹ä¸‰ç§æƒ…å†µ</p>
<p>â€‹        1ã€åœ¨åœ¨print(N)å’ŒN:=0ä¹‹å‰ï¼Œnçš„å˜åŒ–è¿‡ç¨‹ä¸ºï¼šn+1,n+1,0</p>
<p>â€‹        2ã€åœ¨print(N)å’ŒN:=0ä¸­é—´ï¼Œnçš„å˜åŒ–è¿‡ç¨‹æ˜¯ï¼šn,n+1,0</p>
<p>â€‹        3ã€åœ¨print(N)å’ŒN:=0ä¹‹åï¼Œnçš„å˜åŒ–è¿‡ç¨‹æ˜¯ï¼šn,0,n+1</p>
<p><strong>äºŒã€è¿›ç¨‹çš„æŒ‚èµ·çŠ¶æ€ã€é˜»å¡çŠ¶æ€ã€ä»¥åŠå°±ç»ªçŠ¶æ€çš„åŒºåˆ«ï¼Ÿ</strong></p>
<p>â€‹    å…±åŒç‚¹æ˜¯å®ƒä»¬éƒ½æ²¡æœ‰å ç”¨CPU</p>
<p>â€‹    ä¸åŒç‚¹æ˜¯æŒ‚èµ·çš„è¿›ç¨‹å¤„äºç¦æ­¢çŠ¶æ€ï¼Œåœ¨è§£é™¤æŒ‚èµ·ä¹‹å‰ä¸ä¼šå‚ä¸å¯¹èµ„æºçš„ç«äº‰ï¼Œä¹Ÿæ²¡æœ‰æœºä¼šå ç”¨CPU</p>
<p>â€‹    é˜»å¡çŠ¶æ€å’Œå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œéƒ½æœ‰æ´»åŠ¨å¤„ç†æœºçš„æœºä¼šï¼Œéƒ½å¯èƒ½æœ‰æ–°çš„èµ„æºè¦æ±‚</p>
<p><strong>ä¸‰ã€ã€åœ¨å¤šé“ç¨‹åºç³»ç»Ÿä¸­ï¼Œå½“éœ€è¦ç­‰å¾…æŸç§äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿå°†å¤„äºä½•ç§çŠ¶æ€ï¼Ÿ</strong></p>
<p>â€‹            è¿™å–å†³äºè¿›ç¨‹ç¨‹åºçš„å¤„ç†æ–¹å¼</p>
<p>â€‹            1ã€è°ƒç”¨é˜»å¡åŸè¯­ï¼Œé˜»å¡è‡ªå·±ã€è®©å‡ºCPUèµ„æº</p>
<p>â€‹            2ã€è¿›è¡Œå¿™ç­‰ï¼Œä¸æ”¾å¼ƒCPU</p>
<p>â€‹            å½“ç­‰å¾…æŸç§äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¸ä¸€å®šè¦è¿›å…¥é˜»å¡çŠ¶æ€</p>
<p><strong>å››ã€ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸æ”¯æŒçº¿ç¨‹æœ‰ä½•åŒºåˆ«ï¼Ÿ</strong></p>
<p>â€‹    1ã€ç”¨æˆ·çº§çº¿ç¨‹æ˜¯OSä¸å¯æ„ŸçŸ¥çš„ï¼Œå†…æ ¸æ”¯æŒçº§çº¿ç¨‹æ˜¯OSå¯æ„ŸçŸ¥çš„</p>
<p>â€‹    2ã€ç”¨æˆ· çº§çº¿ç¨‹çš„åˆ›å»ºã€æ’¤é”€å’Œè°ƒåº¦ä¸éœ€è¦OSå†…æ ¸æ”¯æŒï¼Œæ˜¯åœ¨è¯­è¨€è¿™ä¸€çº§å¤„ç†çš„ï¼Œè€Œå†…æ ¸æ”¯æŒçº§çº¿ç¨‹çš„åˆ›å»ºã€æ’¤é”€ã€è°ƒåº¦éƒ½éœ€è¦OSå†…æ ¸çš„æ”¯æŒï¼Œä¸è¿›ç¨‹çš„åˆ›å»ºæ’¤é”€å’Œè°ƒåº¦æ˜¯å¤§è‡´ç›¸åŒçš„</p>
<p>â€‹    3ã€ç”¨æˆ·çº§çº¿ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤æ—¶ä¼šå¯¼è‡´å…¶æ‰€å±è¿›ç¨‹è¢«ä¸­æ–­ï¼Œå†…æ ¸æ”¯æŒçº¿ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤æ—¶åªä¼šå¯¼è‡´æ”¹çº¿ç¨‹è¢«ä¸­æ–­</p>
<p>â€‹    4ã€åœ¨åªæœ‰ç”¨æˆ·çº§çº¿ç¨‹çš„ç³»ç»Ÿå†…ï¼ŒCPUè°ƒåº¦æ˜¯ä»¥è¿›ç¨‹ä¸ºå•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹æ‰€å¯¹åº”çš„å¤šä¸ªçº¿ç¨‹ç”±ç”¨æˆ·ç¨‹åºåˆ‡æ¢è¿è¡Œï¼Œè€Œåœ¨å†…æ ¸æ”¯æŒç³»ç»Ÿï¼ŒCPUçš„è°ƒåº¦ä»¥çº¿ç¨‹ä¸ºå•ä½ï¼Œé€šè¿‡OSçš„çº¿ç¨‹è°ƒåº¦ç¨‹åºè´Ÿè´£è°ƒåº¦</p>
<p>â€‹    5ã€ç”¨æˆ·çº§çº¿ç¨‹æ”¯æŒçš„ç¨‹åºå®ä½“æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹é¢çš„ç¨‹åºï¼Œå†…æ ¸æ”¯æŒç”¨æˆ·ç¨‹åºå®ä½“å¯ä»¥è¿è¡Œåœ¨ä»»ä½•çŠ¶æ€ä¸‹</p>
<h2 id="ç¬¬ä¸‰ç« ã€è¿›ç¨‹çš„åŒæ­¥ä¸é€šä¿¡"><a href="#ç¬¬ä¸‰ç« ã€è¿›ç¨‹çš„åŒæ­¥ä¸é€šä¿¡" class="headerlink" title="ç¬¬ä¸‰ç« ã€è¿›ç¨‹çš„åŒæ­¥ä¸é€šä¿¡"></a>ç¬¬ä¸‰ç« ã€è¿›ç¨‹çš„åŒæ­¥ä¸é€šä¿¡</h2><p><strong>ä¸€ã€å¤šä¸ªè¿›ç¨‹å¯¹ä¿¡å·é‡Sè¿›è¡Œäº†5æ¬¡ Pæ“ä½œï¼Œ2æ¬¡Væ“ä½œåï¼Œç°åœ¨ä¿¡å·é‡çš„å€¼æ˜¯ -3ï¼Œä¸ä¿¡å·é‡Sç›¸å…³çš„å¤„äºé˜»å¡çŠ¶æ€çš„è¿›ç¨‹æœ‰å‡ ä¸ªï¼Ÿä¿¡å·é‡çš„åˆå€¼æ˜¯å¤šå°‘ï¼Ÿ</strong> </p>
<ol>
<li><p>å¤„äºé˜»å¡çŠ¶æ€çš„è¿›ç¨‹æœ‰3ä¸ª</p>
</li>
<li><p>åˆå€¼ä¸º-3+5-2=0</p>
</li>
</ol>
<p><strong>äºŒã€è®¾å…¬å…±æ±½è½¦ä¸Šï¼Œå¸æœºå’Œå”®ç¥¨å‘˜çš„æ´»åŠ¨åˆ†åˆ«ä¸ºï¼šå¸æœºçš„æ´»åŠ¨ä¸ºå¯åŠ¨è½¦è¾†ï¼Œæ­£å¸¸è¡Œè½¦ï¼Œåˆ°ç«™åœè½¦ï¼›å”®ç¥¨å‘˜çš„æ´»åŠ¨ä¸ºå…³è½¦é—¨ï¼Œå”®ç¥¨ï¼Œå¼€è½¦é—¨ã€‚è¯•é—®ï¼š</strong></p>
<p>(1)  åœ¨æ±½è½¦ä¸æ–­åœ°åˆ°ç«™ã€åœè½¦ã€è¡Œé©¶è¿‡ç¨‹ä¸­ï¼Œå¸æœºå’Œå”®ç¥¨å‘˜çš„æ´»åŠ¨æ˜¯åŒæ­¥å…³ç³»è¿˜æ˜¯äº’æ–¥å…³ç³»ï¼Ÿ</p>
<p>â€‹    å¸æœºçš„æ´»åŠ¨ï¼šå¼€è½¦ã€åœè½¦</p>
<p>â€‹    å”®ç¥¨å‘˜çš„æ´»åŠ¨ï¼šå…³è½¦é—¨ã€å”®ç¥¨ã€å¼€è½¦é—¨</p>
<p>â€‹    å¸æœºåœè½¦ã€å”®ç¥¨å‘˜å¼€é—¨ã€ä¹˜å®¢ä¸‹è½¦ã€å”®ç¥¨å‘˜å…³é—¨ã€å¸æœºå¼€è½¦ã€å”®ç¥¨å‘˜å”®ç¥¨</p>
<p>â€‹     å¸æœºå’Œå”®ç¥¨å‘˜çš„æ´»åŠ¨æ˜¯åŒæ­¥å…³ç³»</p>
<p>(2)  ç”¨ä¿¡å·é‡å’ŒPã€Væ“ä½œå®ç°ä»–ä»¬é—´çš„åè°ƒæ“ä½œã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">&lt;å¸æœºè¿›ç¨‹&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">      è½¦é—¨æ˜¯å¦å…³é—­?æ²¡å…³åˆ™ç­‰å¾…</span><br><span class="line">      å¯åŠ¨è½¦è¾†</span><br><span class="line">      æ­£å¸¸è¡Œè½¦</span><br><span class="line">      åˆ°ç«™åœè½¦</span><br><span class="line">      è®¾ç½®è½¦è¾†å·²åœæ ‡å¿—</span><br><span class="line">    until <span class="literal">false</span> </span><br><span class="line">&#125;</span><br><span class="line">&lt;å”®ç¥¨å‘˜è¿›ç¨‹&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">        å…³è½¦é—¨</span><br><span class="line">        è®¾ç½®è½¦é—¨å·²å…³æ ‡å¿—</span><br><span class="line">        å”®ç¥¨</span><br><span class="line">        è½¦è¾†æ˜¯å¦åˆ°ç«™ï¼Ÿæ²¡åˆ°ç«™åˆ™ç­‰å¾…</span><br><span class="line">        å¼€è½¦é—¨</span><br><span class="line">        ä¹˜å®¢ä¸Šä¸‹è½¦</span><br><span class="line">    until <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ä¸¤ä¸ªä¿¡å·é‡</p>
<p>S1è½¦é—¨æ˜¯å¦å…³é—­ 0</p>
<p>S2è½¦è¾†æ˜¯å¦åœè½¦ 1</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">&lt;å¸æœºè¿›ç¨‹&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">        P(S1);</span><br><span class="line">        è½¦è¾†å¯åŠ¨;</span><br><span class="line">        æ­£å¸¸è¡Œè½¦;</span><br><span class="line">        åˆ°ç«™åœè½¦;</span><br><span class="line">        V(S2);</span><br><span class="line">     until <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;å¸æœºè¿›ç¨‹&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">        V(S1);</span><br><span class="line">        å”®ç¥¨;</span><br><span class="line">        P(S2);</span><br><span class="line">        å¼€è½¦é—¨;</span><br><span class="line">        ä¹˜å®¢ä¸Šä¸‹è½¦;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸‰ã€è¯´æ˜ç®¡ç¨‹ä¸­æ¡ä»¶å˜é‡çš„å«ä¹‰å’Œä½œç”¨ï¼Ÿ</strong></p>
<p>ç®¡ç¨‹ä¸­çš„æ¡ä»¶å˜é‡æ˜¯è°ƒç”¨ç®¡ç¨‹è¿‡ç¨‹çš„è¿›ç¨‹ç”¨æ¥æ‰§è¡ŒWaitå’ŒSignalæ“ä½œæ¥æŒ‚èµ·æˆ–è§£æŒ‚çš„å˜é‡</p>
<p>ä¿¡å·é‡ä¸ç®¡ç¨‹çš„æ¡ä»¶å˜é‡çš„å¯¹æ¯”ï¼š</p>
<ol>
<li><p>ä¿¡å·é‡è¦èµ‹åˆå€¼ï¼Œè€Œæ¡ä»¶å˜é‡ä¸ç”¨ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªé˜Ÿé¦–æŒ‡é’ˆ</p>
</li>
<li><p>åœ¨ä¿¡å·é‡æ‰§è¡ŒPæ“ä½œä¸ä¸€å®šä¼šè¢«é˜»å¡ï¼Œåœ¨æ¡ä»¶å˜é‡ä¸Šæ‰§è¡ŒWait()æ“ä½œä¼šè¢«æŒ‚èµ·</p>
</li>
<li><p>åœ¨ä¿¡å·é‡ä¸Šæ‰§è¡ŒSæ“ä½œï¼Œä¿¡å·é‡çš„å€¼åŠ 1ï¼Œè‹¥åŠ 1åçš„å€¼ä»å°äº0ï¼Œåˆ™ä¼šå”¤é†’ç­‰å¾…çš„è¿›ç¨‹ï¼Œä½†å”¤é†’è€…è‡ªèº«ä¸å—å½±å“</p>
<p>ä½†æ˜¯åœ¨æ¡ä»¶å˜é‡ä¸Šæ‰§è¡ŒSignal()æ“ä½œåˆ™æœ‰ä¸¤ç§é€‰æ‹©ï¼Œ1ã€Pç­‰å¾…ï¼ŒQç¦»å¼€æˆ–ç­‰å¾…å¦ä¸€æ¡ä»¶å‘ç”Ÿï¼Œ2ã€Qç­‰å¾…ï¼ŒPç¦»å¼€æˆ–ç­‰å¾…å¦ä¸€æ¡ä»¶å‘ç”Ÿï¼ŒPå’ŒQæ˜¯ä¸¤ä¸ªè¿›ç¨‹</p>
</li>
</ol>
<p><strong>å››ã€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ‰å¤šä¸ªPUTæ“ä½œåŒæ—¶å‘BUFF1æ”¾æ•°æ®ï¼Œæœ‰ä¸€ä¸ªMOVEæ“ä½œä¸æ–­åœ°å°†BUFF1çš„æ•°æ®ç§»åˆ°Buff2ï¼Œæœ‰å¤šä¸ªGETæ“ä½œä¸æ–­åœ°ä»Buff2ä¸­å°†æ•°æ®å–èµ°ã€‚BUFF1çš„å®¹é‡ä¸ºmï¼ŒBUFF2çš„å®¹é‡æ˜¯n, PUTã€ MOVEã€ GETæ¯æ¬¡æ“ä½œä¸€ä¸ªæ•°æ®ï¼Œåœ¨æ“ä½œçš„è¿‡ç¨‹ä¸­è¦ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚è¯•ç”¨ï¼°ã€ï¼¶åŸè¯­åè°ƒPUTã€ MOVEçš„æ“ä½œï¼Œå¹¶è¯´æ˜æ¯ä¸ªä¿¡å·é‡çš„å«ä¹‰å’Œåˆå€¼ã€‚</strong></p>
<p>å¤šç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/26/b7d318d5bb78a723a5bcec1a50e3fe62.png" alt="image-20201226142330701"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">buff1 m</span><br><span class="line">buff2 n</span><br><span class="line">put into buff1</span><br><span class="line">move from buff1 to buff2</span><br><span class="line">get from buff2ã€</span><br><span class="line">å¤šä¸ªPUT</span><br><span class="line">&lt;PUT&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">        buff1æ˜¯å¦æœ‰ç©ºé—´?æ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">        buff1æ˜¯å¦å¯æ“ä½œ</span><br><span class="line">        PUT</span><br><span class="line">        è®¾ç½®buff1å¯æ“ä½œæ ‡å¿—</span><br><span class="line">        è®¾ç½®buff1æœ‰æ•°æ®æ ‡å¿—</span><br><span class="line">    until <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">ä¸€ä¸ªMOVE</span><br><span class="line">&lt;MOVE&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">        buffer1æ˜¯å¦æœ‰æ•°æ®ï¼Œæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">        buff2æ˜¯å¦æœ‰ç©ºé—´ï¼Œæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">        buff1æ˜¯å¦å¯æ“ä½œ</span><br><span class="line">        buff2æ˜¯å¦å¯æ“ä½œ</span><br><span class="line">        MOVE</span><br><span class="line">        è®¾ç½®buff1å¯æ“ä½œæ ‡å¿—</span><br><span class="line">        è®¾ç½®buff2å¯æ“ä½œæ ‡å¿—</span><br><span class="line">        è®¾ç½®buff1æœ‰ç©ºé—´æ ‡å¿—</span><br><span class="line">        è®¾ç½®buff2æœ‰æ•°æ®æ ‡å¿—</span><br><span class="line">    until <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">å¤šä¸ªGET</span><br><span class="line">&lt;GET&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">        buff2æ˜¯å¦æœ‰æ•°æ®ï¼Ÿæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">        buff2æ˜¯å¦å¯æ“ä½œ</span><br><span class="line">        GET</span><br><span class="line">        è®¾ç½®buff2å¯æ“ä½œæ ‡å¿—</span><br><span class="line">        è®¾ç½®buff2æœ‰ç©ºé—´æ ‡å¿—</span><br><span class="line">    until <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>äº”ã€æŸé«˜æ ¡è®¡ç®—æœºç³»å¼€è®¾ç½‘ç»œè¯¾å¹¶å®‰æ’ä¸Šæœºå®ä¹ ï¼Œå‡è®¾æœºæˆ¿å…±æœ‰2må°æœºå™¨ï¼Œæœ‰2nåå­¦ç”Ÿé€‰è¯¥è¯¾ï¼Œè§„å®šï¼š</strong></p>
<p>â€‹        <strong>(1) æ¯ä¸¤ä¸ªå­¦ç”Ÿç»„æˆä¸€ç»„ï¼Œå„å ä¸€å°æœºå™¨ï¼ŒååŒå®Œæˆä¸Šæœºå®ä¹ ï¼›</strong></p>
<p>â€‹        <strong>(2) åªæœ‰å‡‘å¤Ÿä¸¤ä¸ªå­¦ç”Ÿï¼Œå¹¶ä¸”æ­¤æ—¶æœºæˆ¿æœ‰ç©ºé—²æœºå™¨ï¼Œé—¨å«æ‰å…è®¸è¯¥ç»„å­¦ç”Ÿè¿›å…¥æœºæˆ¿ï¼›</strong></p>
<p>â€‹        <strong>(3) ä¸Šæœºå®ä¹ ç”±ä¸€åæ•™å¸ˆæ£€æŸ¥ï¼Œæ£€æŸ¥å®Œæ¯•ï¼Œä¸€ç»„å­¦ç”Ÿæ‰å¯ä»¥ç¦»å¼€æœºæˆ¿ã€‚</strong></p>
<p>â€‹        <strong>è¯•ç”¨Pã€Væ“ä½œæ¨¡æ‹Ÿä¸Šæœºå®ä¹ è¿‡ç¨‹ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">&lt;é—¨å«&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">        å­¦ç”Ÿ<span class="number">1</span>æ˜¯å¦åˆ°è¾¾ï¼Ÿæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">        å­¦ç”Ÿ<span class="number">2</span>æ˜¯å¦åˆ°è¾¾ï¼Ÿæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">        æ˜¯å¦æœ‰ç©ºé—²è®¡ç®—æœº<span class="number">1</span>ï¼Ÿæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">        æ˜¯å¦æœ‰ç©ºé—²è®¡ç®—æœº<span class="number">2</span>ï¼Ÿæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">        åˆ†é…è®¡ç®—æœº</span><br><span class="line">        è®¾ç½®å­¦ç”Ÿ<span class="number">1</span>å¯è¿›å…¥æ ‡å¿—</span><br><span class="line">        è®¾ç½®å­¦ç”Ÿ<span class="number">2</span>å¯è¿›å…¥æ ‡å¿—</span><br><span class="line">    until <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;å­¦ç”Ÿ&gt;&#123;</span><br><span class="line">	   è®¾ç½®æœ‰å­¦ç”Ÿåˆ°è¾¾æ ‡å¿—</span><br><span class="line">       å­¦ç”Ÿæ˜¯å¦å¯è¿›å…¥ï¼Ÿ</span><br><span class="line">       ä¸Šæœºå®ä¹ </span><br><span class="line">       è®¾ç½®å®ä¹ å®Œæˆæ ‡å¿— </span><br><span class="line">       è€å¸ˆæ˜¯å¦å¯æ£€æŸ¥ï¼Ÿä¸èƒ½åˆ™ç­‰å¾…</span><br><span class="line">       ç¦»å¼€æœºæˆ¿</span><br><span class="line">&#125;</span><br><span class="line">&lt;æ•™å¸ˆ&gt;&#123;</span><br><span class="line">     repeat</span><br><span class="line">         æ˜¯å¦æœ‰å­¦ç”Ÿ<span class="number">1</span>å®Œæˆå®ä¹ ï¼Ÿæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">         æ˜¯å¦æœ‰å­¦ç”Ÿ<span class="number">2</span>å®Œæˆå®ä¹ ï¼Ÿæ²¡æœ‰åˆ™ç­‰å¾…</span><br><span class="line">         æ£€æŸ¥å®ä¹ </span><br><span class="line">         è®¾ç½®å­¦ç”Ÿ<span class="number">1</span>å®Œæˆå®ä¹ çš„æ ‡å¿—</span><br><span class="line">         è®¾ç½®å­¦ç”Ÿ<span class="number">2</span>å®Œæˆå®ä¹ çš„æ ‡å¿—</span><br><span class="line">     until <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">computer <span class="number">2</span>m	<span class="number">2</span>m</span><br><span class="line">student <span class="number">2</span>n	<span class="number">0</span>  åˆ°è¾¾çš„å­¦ç”Ÿ	<span class="number">0</span></span><br><span class="line">finishï¼šæ˜¯å¦æœ‰å­¦ç”Ÿå®Œæˆå®ä¹ 	<span class="number">0</span></span><br><span class="line">enterï¼šå­¦ç”Ÿæ˜¯å¦å¯ä»¥è¿›å…¥	 <span class="number">0</span></span><br><span class="line">testï¼šè€å¸ˆæ˜¯å¦æ£€æŸ¥å®Œä¸€ç»„å­¦ç”Ÿ <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">&lt;é—¨å«&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">		P(student);</span><br><span class="line">    	P(student);</span><br><span class="line">    	P(computer);</span><br><span class="line">    	P(computer);</span><br><span class="line">    	V(enter);</span><br><span class="line">    until <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;å­¦ç”Ÿ&gt;&#123;</span><br><span class="line">    V(studnet);</span><br><span class="line">    P(enter);</span><br><span class="line">    ä¸Šæœº</span><br><span class="line">    V(finish)</span><br><span class="line">    P(test(i))</span><br><span class="line">    V(computer)</span><br><span class="line">&#125;</span><br><span class="line">&lt;æ•™å¸ˆ&gt;&#123;</span><br><span class="line">    repeat</span><br><span class="line">        P(finish)<span class="comment">/**æ˜¯å¦æœ‰éœ€è¦æ£€æŸ¥çš„å­¦ç”Ÿï¼Œç­‰å¾…å®ä¹ å®Œæˆ**/</span></span><br><span class="line">        P(finish)<span class="comment">/**æ˜¯å¦æœ‰éœ€è¦æ£€æŸ¥çš„å­¦ç”Ÿï¼Œç­‰å¾…å®ä¹ å®Œæˆ**/</span></span><br><span class="line">        é€‰å‡ºå¯æ£€æŸ¥çš„ç¬¬iç»„å­¦ç”Ÿ</span><br><span class="line">        æ£€æŸ¥ç¬¬iç»„å­¦ç”Ÿçš„å®ä¹ æˆæœ</span><br><span class="line">        V(test(i))</span><br><span class="line">        V(test(i))</span><br><span class="line">    until <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬å››ç« ã€è°ƒåº¦ä¸æ­»é”"><a href="#ç¬¬å››ç« ã€è°ƒåº¦ä¸æ­»é”" class="headerlink" title="ç¬¬å››ç« ã€è°ƒåº¦ä¸æ­»é”"></a>ç¬¬å››ç« ã€è°ƒåº¦ä¸æ­»é”</h2><p><strong>ä¸€ã€æœ‰ä¸‰ä¸ªä½œä¸šAï¼ˆåˆ°è¾¾æ—¶é—´8:50ï¼Œæ‰§è¡Œæ—¶é—´1.5å°æ—¶ï¼‰ã€Bï¼ˆåˆ°è¾¾æ—¶é—´9:00ï¼Œæ‰§è¡Œæ—¶é—´0.4å°æ—¶ï¼‰ã€Cï¼ˆåˆ°è¾¾æ—¶é—´9:30ï¼Œæ‰§è¡Œæ—¶é—´1å°æ—¶ï¼‰ã€‚å½“ä½œä¸šå…¨éƒ¨åˆ°è¾¾åï¼Œå•é“æ‰¹å¤„ç†ç³»ç»ŸæŒ‰ç…§å“åº”æ¯”é«˜è€…ä¼˜å…ˆç®—æ³•è¿›è¡Œè°ƒåº¦ï¼Œåˆ™ä½œä¸šè¢«é€‰ä¸­çš„æ¬¡åºæ˜¯ï¼Ÿ</strong></p>
<p>å“åº”æ¯” = 1+(ç­‰å¾…æ—¶é—´/æ‰§è¡Œé•¿åº¦)</p>
<p>ä½œä¸šå…¨éƒ¨åˆ°è¾¾åï¼Œæ“ä½œç³»ç»Ÿæ‰å¼€å§‹è°ƒåº¦</p>
<table>
<thead>
<tr>
<th>è¿›ç¨‹</th>
<th>åˆ°è¾¾æ—¶é—´</th>
<th>å¼€å§‹æ—¶é—´</th>
<th>è¿è¡Œé•¿åº¦</th>
<th>ç»“æŸæ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>8:50</td>
<td>9:54</td>
<td>1.5</td>
<td>11:44</td>
</tr>
<tr>
<td>B</td>
<td>9:00</td>
<td>9:30</td>
<td>0.4</td>
<td>9:54</td>
</tr>
<tr>
<td>C</td>
<td>9:30</td>
<td>11:44</td>
<td>1</td>
<td>12:44</td>
</tr>
</tbody></table>
<p>å„ä¸ªä½œä¸šçš„ç­‰å¾…æ—¶é—´ä¸ºï¼šå¼€å§‹è°ƒåº¦çš„æ—¶é—´-åˆ°è¾¾çš„æ—¶é—´</p>
<p>Aï¼š0.67</p>
<p>Bï¼š0.5</p>
<p>Cï¼š0</p>
<p>å„ä¸ªè¿›ç¨‹çš„å“åº”æ¯”ä¸º</p>
<p>å“åº”æ¯” = ï¼ˆç­‰å¾…æ—¶é—´+è¦æ±‚æœåŠ¡æ—¶é—´ï¼‰/ è¦æ±‚æœåŠ¡æ—¶é—´</p>
<p>å½“ä»»åŠ¡å…¨éƒ¨åˆ°è¾¾æ—¶ï¼Œç³»ç»Ÿå¼€å§‹è°ƒåº¦ï¼Œæ­¤æ—¶Açš„ç­‰å¾…æ—¶é—´</p>
<p>â€‹    Aï¼š1+0.67/1.5 =1.44</p>
<p>â€‹    Bï¼š1+0.5/0.4 = 2.25</p>
<p>â€‹    Cï¼š1+0/1 = 1</p>
<p>â€‹    é€‰æ‹©Bè¿›è¡Œè¿è¡Œ</p>
<p>å½“Bå®Œæˆåï¼Œæ—¶é—´ä¸º9:54,Açš„ç­‰å¾…æ—¶é—´64min,Cçš„ç­‰å¾…æ—¶é—´ä¸º24m</p>
<p>â€‹    A=1+64/90=1.71</p>
<p>â€‹    C=1+24/60=1.4</p>
<p>é€‰Aè¿è¡Œï¼Œæœ€åå†è¿è¡ŒC</p>
<p><strong>äºŒã€ æœ‰ä¸‰ä¸ªè¿›ç¨‹P1ã€P2å’ŒP3å¹¶å‘å·¥ä½œã€‚è¿›ç¨‹P1éœ€è¦èµ„æºS3å’ŒS1ï¼›è¿›ç¨‹P2éœ€ç”¨èµ„æºS1å’ŒS2ï¼›è¿›ç¨‹P3éœ€ç”¨èµ„æºS2å’ŒS3ï¼Œå›ç­”ï¼š</strong></p>
<p><strong>ï¼ˆ1ï¼‰è‹¥å¯¹èµ„æºåˆ†é…ä¸åŠ é™åˆ¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p>
<p>â€‹        å¯èƒ½å‘ç”Ÿæ­»é”ï¼ŒP1æŒæœ‰S1,P2æŒæœ‰S2ï¼ŒP3æŒæœ‰S3ï¼Œçš„åŒæ—¶ï¼Œå†åŒæ—¶ç”³è¯·å…¶ä»–èµ„æºï¼Œä¼šå½¢æˆå¾ªç¯ç­‰å¾…</p>
<p><strong>ï¼ˆ2ï¼‰ä¸ºä¿è¯è¿›ç¨‹æ­£ç¡®åœ°å·¥ä½œï¼Œåº”é‡‡ç”¨æ€æ ·çš„èµ„æºåˆ†é…ç­–ç•¥ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p>
<ol>
<li>é‡‡ç”¨é™æ€èµ„æºåˆ†é…ï¼Œåœ¨è¿›ç¨‹è¿è¡Œå‰åˆ†é…ç»™å…¶æ‰€éœ€çš„å…¨éƒ¨èµ„æº</li>
<li>èµ„æºæŒ‰åºåˆ†é…ï¼Œé¿å…å‡ºç°å¾ªç¯ç­‰å¾…çš„ç°è±¡</li>
<li>é‡‡ç”¨é“¶è¡Œå®¶ç®—æ³•å†åˆ†é…èµ„æºä¹‹å‰è¿›è¡Œæ£€æµ‹</li>
</ol>
<p><strong>ä¸‰ã€æœ‰5ä¸ªä»»åŠ¡Aï¼ŒBï¼ŒCï¼ŒDï¼ŒEï¼Œå®ƒä»¬å‡ ä¹åŒæ—¶åˆ°è¾¾ï¼Œé¢„è®¡å®ƒä»¬çš„è¿è¡Œæ—¶é—´ä¸º10ï¼Œ6ï¼Œ2ï¼Œ4ï¼Œ8minã€‚å…¶ä¼˜å…ˆçº§åˆ†åˆ«ä¸º3ï¼Œ5ï¼Œ2ï¼Œ1å’Œ4ï¼Œè¿™é‡Œ5ä¸ºæœ€é«˜ä¼˜å…ˆçº§ã€‚å¯¹äºä¸‹åˆ—æ¯ä¸€ç§è°ƒåº¦ç®—æ³•ï¼Œè®¡ç®—å…¶å¹³å‡è¿›ç¨‹å‘¨è½¬æ—¶é—´ï¼ˆè¿›ç¨‹åˆ‡æ¢å¼€é”€å¯ä¸è€ƒè™‘ï¼‰ã€‚</strong></p>
<p><strong>(1) å…ˆæ¥å…ˆæœåŠ¡ï¼ˆæŒ‰Aï¼ŒBï¼ŒCï¼ŒDï¼ŒEï¼‰ç®—æ³•ã€‚</strong></p>
<p>ä»æäº¤åˆ°å®Œæˆæ‰€ç”¨çš„æ—¶é—´</p>
<table>
<thead>
<tr>
<th>æ‰§è¡Œé¡ºåº</th>
<th>è¿è¡Œæ—¶é—´</th>
<th>ä¼˜å…ˆçº§</th>
<th>ç­‰å¾…æ—¶é—´</th>
<th>å‘¨è½¬æ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>10</td>
<td>3</td>
<td>0</td>
<td>10</td>
</tr>
<tr>
<td>B</td>
<td>6</td>
<td>5</td>
<td>10</td>
<td>16</td>
</tr>
<tr>
<td>C</td>
<td>2</td>
<td>2</td>
<td>16</td>
<td>18</td>
</tr>
<tr>
<td>D</td>
<td>4</td>
<td>1</td>
<td>18</td>
<td>22</td>
</tr>
<tr>
<td>E</td>
<td>8</td>
<td>4</td>
<td>22</td>
<td>30</td>
</tr>
</tbody></table>
<p>å¹³å‡å‘¨è½¬æ—¶é—´(10+16+18+22+30)/5=19.2min</p>
<p><strong>(2) ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚</strong></p>
<table>
<thead>
<tr>
<th>æ‰§è¡Œé¡ºåº</th>
<th>è¿è¡Œæ—¶é—´</th>
<th>ä¼˜å…ˆçº§</th>
<th>ç­‰å¾…æ—¶é—´</th>
<th>å‘¨è½¬æ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>B</td>
<td>6</td>
<td>5</td>
<td>0</td>
<td>6</td>
</tr>
<tr>
<td>E</td>
<td>8</td>
<td>4</td>
<td>6</td>
<td>14</td>
</tr>
<tr>
<td>A</td>
<td>10</td>
<td>3</td>
<td>14</td>
<td>24</td>
</tr>
<tr>
<td>C</td>
<td>2</td>
<td>2</td>
<td>24</td>
<td>26</td>
</tr>
<tr>
<td>D</td>
<td>4</td>
<td>1</td>
<td>26</td>
<td>30</td>
</tr>
</tbody></table>
<p>å¹³å‡å‘¨è½¬æ—¶é—´(6+14+24+26+30)/5=20</p>
<p><strong>(3) æ—¶é—´ç‰‡è½®è½¬ç®—æ³•ã€‚å¦‚æœç³»ç»Ÿé‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬ï¼ˆRRï¼‰ç®—æ³•ï¼Œä»¤æ—¶é—´ç‰‡ä¸º2åˆ†é’Ÿï¼Œ5ä¸ªä»»åŠ¡è½®æµæ‰§è¡Œçš„æƒ…å†µä¸ºï¼š</strong></p>
<p>ç¬¬ä¸€è½®ï¼šA B C D E</p>
<p>ç¬¬äºŒè½®ï¼šA  B  D  E</p>
<p>ç¬¬ä¸‰è½®ï¼šA  B   E</p>
<p>ç¬¬å››è½®ï¼šA  E</p>
<p>ç¬¬äº”è½®ï¼šA</p>
<p>å¹³å‡å‘¨è½¬æ—¶é—´ä¸ºï¼ˆ15+11+3+8+14ï¼‰*2/5 = 20.4 min</p>
<p><strong>å››ã€è€ƒè™‘ç”±nä¸ªè¿›ç¨‹å…±äº«çš„å…·æœ‰mä¸ªåŒç±»èµ„æºçš„ç³»ç»Ÿï¼Œè¯æ˜ï¼šå¦‚æœå¯¹i=1ï¼Œ2ï¼Œâ€¦ï¼Œnè¿›ç¨‹ï¼Œæœ‰Need&gt;0è€Œä¸”æ‰€æœ‰æœ€å¤§éœ€æ±‚é‡ä¹‹å’Œå°äºm+n,é‚£ä¹ˆè¯¥ç³»ç»Ÿæ˜¯æ­»é”æ— å…³çš„ã€‚</strong></p>
<p>è®¾æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§éœ€æ±‚é‡ä¸ºxï¼Œæœ€å·®çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹å æœ‰ï¼ˆx-1ï¼‰ä¸ªèµ„æºï¼Œå„è‡ªæœ€å¤šå†ç”³è¯·ä¸€ä¸ªèµ„æºå°±èƒ½å®Œæˆè¿è¡Œï¼Œè¿›è€Œé‡Šæ”¾å®ƒä»¬æ‰€å æœ‰çš„èµ„æº</p>
<p>æ­¤æ—¶ç³»ç»Ÿå‰©ä½™èµ„æºä¸º m-n(x-1),å½“m-n(x-1)&gt;=1ï¼Œå³n*x&lt;=(m+n-1),ä¹Ÿå°±æ˜¯å½“æœ€å¤§èµ„æºéœ€æ±‚é‡ä¹‹å’Œå°äº(m+n)ï¼Œé‚£ä¹ˆè¯¥ç³»ç»Ÿæ˜¯æ­»é”æ— å…³çš„</p>
<p><strong>äº”ã€ è®¾ç³»ç»Ÿä¸­æœ‰ä¸‰ç§ç±»å‹çš„èµ„æºï¼ˆAã€Bã€Cï¼‰å’Œäº”ä¸ªè¿›ç¨‹ï¼ˆP1ã€P2ã€P3ã€P4ã€P5ï¼‰ï¼ŒAèµ„æºçš„æ•°é‡ä¸º17ï¼ŒBèµ„æºçš„æ•°é‡ä¸º5ï¼ŒCèµ„æºçš„æ•°é‡ä¸º20ã€‚åœ¨T0æ—¶åˆ»ç³»ç»ŸçŠ¶æ€å¦‚è¡¨1å’Œè¡¨2æ‰€ç¤ºã€‚ç³»ç»Ÿé‡‡ç”¨é“¶è¡Œå®¶ç®—æ³•å®æ–½æ­»é”é¿å…ç­–ç•¥ã€‚</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/26/ec947109ad461d3b4ea5e46f21f691a9.png" alt="image-20201226194901090"></p>
<p><strong>(1)  T0æ—¶åˆ»æ˜¯å¦ä¸ºå®‰å…¨çŠ¶æ€ï¼Ÿè‹¥æ˜¯ï¼Œè¯·ç»™å‡ºå®‰å…¨åºåˆ—ã€‚</strong></p>
<p>â€‹        P1ï¼ˆ3ï¼Œ4ï¼Œ7ï¼‰</p>
<p>â€‹        P2ï¼ˆ1ï¼Œ3ï¼Œ4ï¼‰</p>
<p>â€‹        P3ï¼ˆ0ï¼Œ0ï¼Œ6ï¼‰</p>
<p>â€‹        P4ï¼ˆ2ï¼Œ2ï¼Œ1ï¼‰</p>
<p>â€‹        P5ï¼ˆ1ï¼Œ1ï¼Œ0ï¼‰</p>
<p>â€‹        åœ¨T0æ—¶åˆ»ï¼Œå­˜åœ¨ä¸€ä¸ªå®‰å…¨åºåˆ—ï¼ˆP4ï¼ŒP5ï¼ŒP3ï¼ŒP2ï¼ŒP1ï¼‰ï¼Œæ‰€ä»¥ç³»ç»Ÿæ˜¯å®‰å…¨çš„</p>
<p><strong>(2)  åœ¨T0æ—¶åˆ»è‹¥è¿›ç¨‹P2è¯·æ±‚èµ„æºï¼ˆ0ï¼Œ3ï¼Œ4ï¼‰ï¼Œæ˜¯å¦èƒ½å®æ–½èµ„æºåˆ†é…ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p>
<p>â€‹        ä¸èƒ½å®æ–½åˆ†é…ï¼Œå› ä¸ºç³»ç»Ÿçš„å¯ç”¨èµ„æºä¸è¶³ï¼Œæ‰€ä»¥åªèƒ½æ¨è¿Ÿåˆ†é…</p>
<p><strong>(3)  åœ¨â‘¡çš„åŸºç¡€ä¸Šï¼Œè‹¥è¿›ç¨‹P4è¯·æ±‚èµ„æºï¼ˆ2ï¼Œ0ï¼Œ1ï¼‰ï¼Œæ˜¯å¦èƒ½å®æ–½èµ„æºåˆ†é…ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p>
<p>â€‹        å¯ä»¥ï¼Œæ­¤æ—¶ç³»ç»Ÿä»èƒ½æ‰¾åˆ°ä¸€ä¸ªå®‰å…¨åºåˆ—ï¼ˆP4ï¼ŒP1ï¼ŒP3ï¼ŒP5ï¼ŒP2ï¼‰</p>
<p><strong>(4)  åœ¨â‘¢çš„åŸºç¡€ä¸Šï¼Œè‹¥è¿›ç¨‹P1è¯·æ±‚èµ„æºï¼ˆ0ï¼Œ2ï¼Œ0ï¼‰ï¼Œæ˜¯å¦èƒ½å®æ–½èµ„æºåˆ†é…ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p>
<p>â€‹        å¯ä»¥å®æ–½èµ„æºåˆ†é…</p>
<h2 id="ç¬¬äº”ç« ã€å­˜å‚¨å™¨ç®¡ç†"><a href="#ç¬¬äº”ç« ã€å­˜å‚¨å™¨ç®¡ç†" class="headerlink" title="ç¬¬äº”ç« ã€å­˜å‚¨å™¨ç®¡ç†"></a>ç¬¬äº”ç« ã€å­˜å‚¨å™¨ç®¡ç†</h2><p><strong>ä¸€ã€åŠ¨æ€é‡å®šä½çš„ç‰¹ç‚¹æœ‰å“ªäº›ï¼Ÿ</strong></p>
<ol>
<li><p>åŠ¨æ€é‡å®šä½çš„å®ç°ä¸»è¦ä¾é ç¡¬ä»¶åœ°å€å˜æ¢æœºæ„ï¼Œå¹¶ä¸”å­˜å‚¨ç®¡ç†çš„è½¯ä»¶ç®—æ³•æ¯”è¾ƒå¤æ‚</p>
</li>
<li><p>ç¨‹åºä»£ç æ˜¯æŒ‰ç…§åŸæ ·è£…å…¥å†…å­˜ï¼Œåœ¨é‡å®šä½è¿‡ç¨‹ä¸­ä¸å‘ç”Ÿå˜åŒ–</p>
</li>
<li><p>ç›¸åŒçš„é€»è¾‘åœ°å€ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½è¦é‡å®šä½ä¸€æ¬¡</p>
</li>
<li><p>æ”¹å˜åŸºåœ°å€ï¼Œå¾ˆå®¹æ˜“å®ç°ä»£ç åœ¨å†…å­˜ä¸­çš„ç§»åŠ¨</p>
</li>
<li><p>åŠ¨æ€é‡å®šä½å¯ä»¥å°†ç¨‹åºåˆ†é…åˆ°ä¸è¿ç»­çš„å­˜å‚¨åŒºä¸­</p>
</li>
<li><p>å®ç°è™šæ‹Ÿå­˜å‚¨å™¨éœ€è¦åŠ¨æ€é‡å®šä½æŠ€æœ¯çš„æ”¯æŒ</p>
</li>
</ol>
<p><strong>äºŒã€æœ‰ä¸€è®¡ç®—æœºç³»ç»Ÿï¼Œå†…å­˜å®¹é‡ä¸º512Kï¼Œè¾…å­˜å®¹é‡ä¸º2Gï¼Œé€»è¾‘åœ°å€å½¢å¼å¦‚ä¸‹ï¼Œæ±‚å…¶è™šæ‹Ÿå­˜å‚¨å™¨çš„å®é™…å®¹é‡ï¼Ÿ**</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/iboytech/static/images/2020/12/27/27e22ad5f118fcaead717aebdb4f8c6b.png" alt="image-20201227091459284"></p>
<p>è™šæ‹Ÿå†…å­˜çš„ç†è®ºå®¹é‡ï¼š2^10*2^20B=2^30B=1024M</p>
<p>æœ€å¤§æ®µå†…åœ°å€ï¼š2^20B =1Mï¼Œè¿œå¤§äºå†…å­˜å®¹é‡</p>
<p>æ®µé•¿è¶…è¿‡ 512Kçš„å†…å­˜å®¹é‡ï¼Œæ‰€ä»¥ï¼Œæœ€å¤§å®é™…æ®µé•¿ä¸º512K</p>
<p>æ‰€ä»¥è™šæ‹Ÿå­˜å‚¨å™¨çš„å®é™…å®¹é‡ä¸ºï¼š2^10*0.5M=0.5Gï¼Œæ‰€ä»¥è™šæ‹Ÿå­˜å‚¨å™¨çš„å®é™…å®¹é‡ä¸º0.5G</p>
<p><strong>ä¸‰ã€è§£é‡Šé™æ€é“¾æ¥ã€è£…å…¥æ—¶åŠ¨æ€é“¾æ¥å’Œæ‰§è¡Œæ—¶åŠ¨æ€é“¾æ¥çš„ä¸åŒï¼Ÿ</strong></p>
<p>1ã€é™æ€é“¾æ¥æœ¬æ¥æ˜¯ç¼–è¯‘ç³»ç»Ÿçš„å·¥ä½œï¼Œä½†æ˜¯éšç€ç¨‹åºæ‰§è¡Œæ–¹å¼çš„æ”¹è¿›ï¼Œâ€œç¨‹åºé“¾æ¥â€ä¸å†æ˜¯ç¼–è¯‘ç³»ç»Ÿçš„äº‹æƒ…ï¼Œå®ƒè¿˜éœ€è¦</p>
<p>OSçš„æ”¯æŒ</p>
<p>ç¨‹åºçš„é™æ€é“¾æ¥ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºè£…å…¥å†…å­˜ä¹‹å‰ï¼Œå°†å·²ç»ç¼–è¯‘å¥½çš„å¤šä¸ªæ¨¡å—é“¾æ¥æˆå¯æ‰§è¡Œç¨‹åºï¼Œå…¶ç‰¹ç‚¹ä¸ºï¼š1ã€é“¾æ¥å¥½çš„å¯æ‰§è¡Œç¨‹åºå¯åå¤æ‰§è¡Œ 2ã€è¢«é“¾æ¥å¥½çš„æ¨¡å—ä¸èƒ½å†æ‹†åˆ†ï¼Œä¸ä¾¿äºä¿®æ”¹3ã€ä¸ä¾¿äºå¤šä¸ªç¨‹åºå…±äº«æŸäº›æ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨åŒä¸€æ¨¡å—çš„å¤šä¸ªç¨‹åºéœ€è¦å°†è¯¥æ¨¡å—é“¾å…¥è‡ªå·±çš„ç¨‹åºç©ºé—´</p>
<p>è£…å…¥æ—¶åŠ¨æ€é“¾æ¥ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºåŠ è½½è¿›å†…å­˜çš„æ—¶å€™ï¼Œç”±OSå°†ç£ç›˜ä¸­çš„æ¨¡å—åœ¨å†…å­˜ä¸­é“¾æ¥æˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œç‰¹ç‚¹æ˜¯ï¼š</p>
<p>1ã€å¯æ‰§è¡Œç¨‹åºåªåœ¨å†…å­˜ä¸­ï¼Œæ¯æ¬¡æ‰§è¡Œéœ€è¦é‡æ–°é“¾æ¥</p>
<p> 2ã€è¢«é“¾æ¥çš„å„ä¸ªæ¨¡å—åœ¨ç£ç›˜ä¸Šæ˜¯ç‹¬ç«‹å­˜æ”¾çš„</p>
<p>3ã€å¤šä¸ªç¨‹åºå…±äº«æŸä¸€æ¨¡å—æ—¶ï¼Œåªéœ€è¦åœ¨å†…å­˜ä¸­ä¿ç•™è¯¥æ¨¡å—çš„ä¸€ä¸ªå‰¯æœ¬</p>
<p>æ‰§è¡Œæ—¶åŠ¨æ€é“¾æ¥æ˜¯æŠŠç¨‹åºçš„é“¾æ¥æ¨è¿Ÿåˆ°ç¨‹åºæ‰§è¡Œæ—¶åŠ¨æ€çš„æ ¹æ®éœ€è¦è¿›è¡Œé“¾æ¥ï¼Œå®ƒé™¤äº†æœ‰è£…å…¥æ—¶åŠ¨æ€é“¾æ¥çš„ç‰¹ç‚¹ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯ï¼Œåªä¼šè£…å…¥éœ€è¦çš„æ¨¡å—ï¼Œä»è€Œå‡å°‘æ—¶ç©ºçš„å¼€é”€ï¼Œä»–å¢åŠ äº†é“¾æ¥çš„å¤æ‚æ€§ï¼Œéœ€è¦ä¸€å®šçš„ç¡¬ä»¶æ”¯æŒã€‚</p>
<p><strong>å››ã€åœ¨åˆ†é¡µå­˜å‚¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå­˜å–ä¸€æ¬¡å†…å­˜çš„æ—¶é—´æ˜¯8usï¼ŒæŸ¥è¯¢ä¸€æ¬¡å¿«è¡¨çš„æ—¶é—´æ˜¯1usï¼Œç¼ºé¡µä¸­æ–­çš„æ—¶é—´æ˜¯20usï¼Œå‡è®¾é¡µè¡¨çš„æŸ¥è¯¢ä¸å¿«è¡¨çš„æŸ¥è¯¢åŒæ—¶è¿›è¡Œ ã€‚å½“æŸ¥è¯¢é¡µè¡¨æ—¶ï¼Œå¦‚æœè¯¥é¡µåœ¨å†…å­˜ä½†å¿«è¡¨ä¸­æ²¡æœ‰é¡µè¡¨é¡¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æŠŠè¯¥é¡µé¡µè¡¨é¡¹é€å…¥å¿«è¡¨ã€‚</strong></p>
<p><strong>(1) æ±‚å¯¹æŸä¸€æ•°æ®è¿›è¡Œä¸€æ¬¡æ¬¡å­˜å–å¯èƒ½éœ€è¦çš„æ—¶é—´ï¼Ÿ</strong></p>
<p>å¯¹æ•°æ®å­˜å–æœ‰3ä¸­æƒ…å†µï¼š</p>
<ol>
<li><p>æ•°æ®åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”å·²ç»å­˜æ”¾åˆ°å—è¡¨ï¼š</p>
<p>æ­¤æ—¶ç”¨æ—¶ï¼š1us+8us=9us</p>
</li>
<li><p>æ•°æ®åœ¨å†…å­˜ä¸­ï¼Œä½†æ˜¯å…¶é¡µè¡¨é¡¹æ²¡æœ‰å­˜å‚¨åˆ°å¿«è¡¨</p>
<p>æ­¤æ—¶çš„ç”¨æ—¶ä¸ºï¼š8usæŸ¥é¡µè¡¨+8uså­˜å–å†…å­˜æ•°æ®</p>
</li>
<li><p>å­˜å–çš„æ•°æ®ä¸å†å†…å­˜ï¼Œå‘ç”Ÿç¼ºé¡µä¸­æ–­</p>
<p>æ­¤æ—¶çš„ç”¨æ—¶ä¸ºï¼šæŸ¥è¯¢é¡µè¡¨+ç¼ºé¡µä¸­æ–­+æŸ¥è¯¢é¡µè¡¨+å­˜å–å†…å­˜</p>
<p>8us+20us+8us+8us=44us</p>
</li>
</ol>
<p><strong>(2) ç°è¿ç»­å¯¹åŒä¸€é¡µé¢ä¸Šçš„æ•°æ®è¿›è¡Œ4æ¬¡è¿ç»­è¯»å–ï¼Œæ±‚æ¯æ¬¡è¯»å–æ•°æ®å¯èƒ½éœ€è¦çš„æ—¶é—´?</strong></p>
<p>  ç¬¬ä¸€æ¬¡å­˜å–å¯èƒ½éœ€è¦çš„æ—¶é—´ä¸ºï¼š</p>
<p>1us+8us=9us,8us+8us=16usï¼Œ8us+20us+8us+8us=44us</p>
<p>ç¬¬äºŒæ¬¡ï¼Œç¬¬ä¸‰æ¬¡ï¼Œç¬¬å››æ¬¡å¯¹åº”çš„é¡µè¡¨é¡¹å·²ç»äº¤æ¢åˆ°äº†å¿«è¡¨ä¸­ï¼Œæ‰€ç”¨çš„å­˜å–æ—¶é—´éƒ½æ˜¯ä¸€æ ·çš„1us+8us=9us</p>
<p><strong>äº”ã€ä¸ºä»€ä¹ˆè¯´åˆ†æ®µç³»ç»Ÿç›¸æ¯”äºåˆ†é¡µç³»ç»Ÿæ›´å®¹æ˜“å®ç°ä¿¡æ¯çš„å…±äº«å’Œä¿æŠ¤ï¼Ÿå¦‚ä½•å®ç°ã€‚</strong></p>
<p>åœ¨åˆ†é¡µæˆ–åˆ†æ®µçš„å­˜å‚¨ç®¡ç†ä¸­ï¼Œå¤šä¸ªè¿›ç¨‹å¹¶å‘è¿è¡Œå…±äº«åŒä¸€å†…å­˜å—ä¸­çš„æ•°æ®æ˜¯å¯è¡Œçš„ï¼Œä¸ºäº†å®ç°å…±äº«ï¼Œåœ¨å…±äº«è€…çš„æ®µè¡¨æˆ–è€…é¡µè¡¨ä¸­ï¼Œå¿…é¡»æœ‰æŒ‡å‘å…±äº«å†…å­˜çš„è¡¨ç›®</p>
<p>åœ¨åˆ†æ®µç³»ç»Ÿä¸­ï¼Œè¢«å…±äº«çš„ç¨‹åºæˆ–æ•°æ®å¯ä»¥ä½œä¸ºå•ç‹¬çš„ä¸€æ®µï¼Œåœ¨ç‰©ç†ä¸Šå®ƒæ˜¯ä¸€æ®µï¼Œåœ¨ä¸åŒè¿›ç¨‹ä¸­ï¼Œå¯ä»¥å¯¹åº”ä¸åŒçš„é€»è¾‘æ®µï¼Œç›¸å¯¹æ¥è¯´ï¼Œå®ç°æ˜¯æ¯”è¾ƒå®¹æ˜“çš„</p>
<p>åœ¨åˆ†é¡µç®¡ç†ä¸­ï¼Œè¿™è¦å›°éš¾çš„å¤šï¼Œé¦–å…ˆå¿…é¡»ä¿è¯è¢«å…±äº«çš„ç¨‹åºæˆ–æ•°æ®å æœ‰æ•´æ•°å¿«ï¼Œä»¥ä¾¿å’Œéå…±äº«æ•°æ®åˆ†å¼€ï¼Œå…¶æ¬¡å¯¹äºå…±äº«æ•°æ®çš„è®¿é—®åº”è¯¥æ˜¯æœ‰é™åˆ¶æ¡ä»¶çš„</p>
<p>å› æ­¤ä»å…±äº«å’Œä¿æŠ¤çš„å®ç°æ¥çœ‹ï¼Œå…±äº«çš„ç¨‹åºæˆ–æ•°æ®åº”è¯¥ä½œä¸ºä¸€ä¸ªé€»è¾‘å•ä½ï¼Œåœ¨åˆ†æ®µç®¡ç†ä¸­ä¹Ÿå°±æ˜¯ä¸€æ®µï¼Œå®ç°å…±äº«å’Œä¿æŠ¤å°±æ–¹ä¾¿çš„å¤š</p>
<p>å®ç°æ–¹å¼ï¼šåˆ†æ®µç³»ç»Ÿä¸­æ˜¯é€šè¿‡ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹çš„æ®µè¡¨ä¸­çš„è¡¨ç›®æŒ‡å‘ç›¸åŒçš„ç‰©ç†å—ï¼Œå¹¶è®¾ç½®å…±äº«è®¡æ•°æ¥å®ç°çš„ã€‚</p>
<p>æ¯æ®µè®¾ç½®è®¿é—®æ–¹å¼ï¼Œå°±èƒ½å®ç°ä¿æŠ¤ã€‚</p>
<p><strong>å…­ã€åœ¨è™šæ‹Ÿé¡µå¼çš„å­˜å‚¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œä¸ºä»€ä¹ˆè¦å¼•å…¥ç¼ºé¡µä¸­æ–­ï¼Ÿç¼ºé¡µä¸­æ–­çš„å®ç°æœ‰é‚£å‡ éƒ¨æ„æˆï¼Ÿå„ä¸ªéƒ¨åˆ†æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</strong></p>
<ol>
<li><p>è™šæ‹Ÿé¡µå¼å­˜å‚¨ç®¡ç†ç³»ç»Ÿæ˜¯åœ¨é¡µå¼ç®¡ç†ç³»ç»Ÿä¸Šå®ç°çš„è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œä½œä¸šåœ¨æ‰§è¡Œæ—¶ï¼Œå¹¶ä¸æ˜¯æŠŠæ‰€æœ‰çš„é¡µéƒ½æ”¾åœ¨ä¸»å­˜ä¸­çš„ï¼Œå½“è¦è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨æ—¶ï¼Œéœ€è¦ç³»ç»Ÿé€šè¿‡ç¼ºé¡µä¸­æ®µå°†æ‰€éœ€é¡µé¢ç”±è¾…å­˜è£…å…¥ä¸»å­˜</p>
<p>ç¼ºé¡µä¸­æ–­ç”±ç¼ºé¡µå¤„ç†å’Œé¡µæ·˜æ±°å®Œæˆçš„</p>
<p>ç¼ºé¡µå¤„ç†å®ç°ï¼š</p>
<ol>
<li><p>ä¸­æ–­è§¦å‘</p>
<p>æŸ¥è¯¢é¡µè¡¨æ—¶å‘ç°é€»è¾‘é¡µä¸åœ¨å†…å­˜ä¸­ï¼Œå°†å…¶ä¿®æ”¹ä½ç½®ä¸º0ï¼Œè§¦å‘ç¼ºé¡µä¸­æ–­</p>
</li>
<li><p>é¡µé¢è°ƒå…¥</p>
<p>OSæŸ¥æ‰¾å¯¹åº”é¡µé¢çš„è¾…å­˜åœ°å€ï¼Œå°†é¡µé¢è°ƒå…¥å†…å­˜ï¼Œè¿›è¡Œé¡µé¢æ·˜æ±°</p>
</li>
<li><p>ä¿®æ”¹é¡µè¡¨</p>
<p>å°†é¡µé¢çš„å†…å­˜åœ°å€å¡«å…¥é¡µè¡¨ï¼Œå¹¶å°†çŠ¶æ€ä½ä¿®æ”¹ä¸º1ï¼Œç¼ºé¡µä¸­æ–­ç»“æŸï¼Œæ¢å¤ç°åœºï¼Œé‡æ–°æ‰§è¡ŒæŒ‡ä»¤</p>
</li>
</ol>
<p>é¡µæ·˜æ±°çš„å®ç°ï¼š</p>
<ol>
<li>å¦‚æœå†…å­˜æœ‰ç©ºé—²é¡µï¼Œç›´æ¥è°ƒå…¥å¤–å­˜çš„é¡µé¢ï¼Œä¿®æ”¹é¡µè¡¨</li>
<li>å¦‚æœå†…å­˜å·²æ»¡ï¼Œåˆ™æ ¹æ®é¡µé¢ç½®æ¢ç®—æ³•ï¼Œæ·˜æ±°é¡µé¢</li>
<li>å¦‚æœè¦æ·˜æ±°çš„é¡µé¢çš„ä¿®æ”¹ä½ä¸º0ï¼Œåˆ™ä»å¤–å­˜è°ƒå…¥é¡µé¢è¦†ç›–å¹¶ä¿®æ”¹é¡µè¡¨</li>
<li>å¦‚æœè¦æ·˜æ±°çš„é¡µé¢ä¿®æ”¹ä½ä¸º1ï¼Œåˆ™ç”³è¯·ä¸€å—äº¤æ¢ç©ºé—´ï¼Œå°†åŸé¡µé¢çš„å†…å®¹å¤åˆ¶åˆ°äº¤æ¢ç©ºé—´ä¸­ï¼Œç„¶åå°†è¾…å­˜çš„é¡µé¢è°ƒå…¥å…¶ä¸­ï¼Œå¹¶ä¿®æ”¹é¡µè¡¨</li>
</ol>
</li>
</ol>
<h2 id="ç¬¬å…­ç« ã€è®¾å¤‡ç®¡ç†"><a href="#ç¬¬å…­ç« ã€è®¾å¤‡ç®¡ç†" class="headerlink" title="ç¬¬å…­ç« ã€è®¾å¤‡ç®¡ç†"></a>ç¬¬å…­ç« ã€è®¾å¤‡ç®¡ç†</h2><p><strong>ä¸€ã€IOè½¯ä»¶ä¸€èˆ¬åˆ†ä¸ºå››ä¸ªå±‚æ¬¡ï¼Œç”¨æˆ·å±‚ï¼Œè®¾å¤‡æ— å…³è½¯ä»¶å±‚ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œä¸­æ–­å¤„ç†ç¨‹åºï¼Œè¯·è¯´æ˜ä¸‹é¢å„é¡¹å·¥ä½œæ˜¯åœ¨å“ªä¸€å±‚å®Œæˆçš„ï¼Ÿ</strong></p>
<p>è®¾å¤‡é©±åŠ¨å±‚ï¼š</p>
<p>â€‹    1ã€å°†æŠ½è±¡çš„è¦æ±‚è½¬åŒ–ä¸ºå…·ä½“çš„è¦æ±‚ï¼Œç¼–ç è½¬æ¢</p>
<p>   2ã€å‘é€IOæŒ‡ä»¤ï¼Œæ§åˆ¶è®¾å¤‡å¯åŠ¨</p>
<p>â€‹    3ã€æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒä½¿ç”¨è®¾å¤‡</p>
<p>è½¯ä»¶å±‚ï¼š</p>
<p>è´Ÿè´£è§£é‡Šç”¨æˆ·çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬åŒ–æˆå…·ä½“çš„è¾“å…¥è¾“å‡ºï¼Œä½†ä¸æ£€æŸ¥æƒé™</p>
<p>è®¾å¤‡æ— å…³çš„è½¯ä»¶å±‚ï¼šå°†é€»è¾‘è®¾å¤‡åè½¬æ¢ä¸ºå…·ä½“çš„ç‰©ç†è®¾å¤‡ï¼Œå®ç°è®¾å¤‡çš„åˆ†é…ä¸å›æ”¶ï¼Œä»¥åŠç¼“å†²åŒºç®¡ç†</p>
<ol>
<li><p>å‘è®¾å¤‡å¯„å­˜å™¨å†™å‘½ä»¤</p>
<p>å±äºç›´æ¥æ“ä½œè®¾å¤‡æ§åˆ¶å™¨çš„æ“ä½œï¼Œå±äºè®¾å¤‡é©±åŠ¨å±‚</p>
</li>
<li><p>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒä½¿ç”¨è®¾å¤‡</p>
<p>è®¾å¤‡é©±åŠ¨å±‚</p>
</li>
<li><p>å°†äºŒè¿›åˆ¶æ•´æ•°è½¬æ¢æˆASCIIç ä»¥ä¾¿æ‰“å°</p>
<p>è¿™å±äºå°†æŠ½è±¡çš„è¦æ±‚è½¬åŒ–ä¸ºå…·ä½“çš„è¦æ±‚</p>
</li>
</ol>
<p><strong>äºŒã€åœ¨ç¼“å†²æ± ä¸­æœ‰3ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«ä¸ºç©ºç™½ç¼“å†²é˜Ÿåˆ—emï¼Œè¾“å…¥ç¼“å†²é˜Ÿåˆ—inï¼Œä»¥åŠè¾“å‡ºç¼“å†²é˜Ÿåˆ—outã€‚è¿‡ç¨‹add_bufï¼ˆtypeï¼Œnumbï¼‰å’Œtake_bufï¼ˆtypeï¼Œnumbï¼‰åˆ†åˆ«ç”¨æ¥æŠŠç¼“å†²åŒºnumbæ’å…¥typeé˜Ÿåˆ—å’Œä»typeé˜Ÿåˆ—ä¸­å–å‡ºç¼“å†²åŒºnumbã€‚è¯•æè¿°è¿›ç¨‹ä»ä»»ä¸€ç¼“å†²é˜Ÿåˆ—å¾—åˆ°ä¸€ä¸ªç¼“å†²åŒºçš„è¿‡ç¨‹get_bufï¼ˆtype,numbï¼‰å’Œå°†ä¸€ä¸ªç¼“å†²åŒºnumbæ”¾å…¥ç¼“å†²é˜Ÿåˆ—çš„è¿‡ç¨‹put_bufï¼ˆtype,numbï¼‰ï¼Ÿ</strong></p>
<p>è®¾ç½®é˜Ÿåˆ—çš„äº’æ–¥ä¿¡å·é‡ä¸ºSï¼Œåˆå€¼ä¸º1ï¼Œè®¾ç½®èµ„æºæ•°ç›®ä¿¡å·é‡ä¸ºRSï¼Œåˆå€¼ä¸ºn</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Semaphore mutex=<span class="number">1</span>;</span><br><span class="line">Semaphore RS=n;</span><br><span class="line"><span class="function">procedure  <span class="title">put_buf</span><span class="params">(type,numb)</span></span></span><br><span class="line"><span class="function">begin</span></span><br><span class="line"><span class="function">	<span class="title">P</span><span class="params">(S)</span></span>;</span><br><span class="line">	add_buf(type,numb);</span><br><span class="line">	V(mutex);</span><br><span class="line">	V(RS);</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line"><span class="function">procedure <span class="title">get_buf</span><span class="params">(type,numb)</span></span></span><br><span class="line"><span class="function">begin</span></span><br><span class="line"><span class="function">    <span class="title">P</span><span class="params">(RS)</span></span>;</span><br><span class="line">	P(mutex);</span><br><span class="line">    buffer(numb)=get_buff(type,numb);</span><br><span class="line">    V(mutex);</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸‰ã€æè¿°æ“ä½œç³»ç»Ÿä½¿ç”¨å…¬ç”¨ç¼“å†²æ± æ—¶ï¼Œæ•°æ®æ’å…¥ç¼“å†²é˜Ÿåˆ—çš„è¾“å…¥è¿‡ç¨‹ï¼Ÿ</strong></p>
<p>ç¼“å†²æ± ç”±å¤šä¸ªç¼“å†²åŒºæ„æˆï¼Œæ¯ä¸ªç¼“å†²åŒºç”±ç¼“å†²æ± é¦–éƒ¨å’Œç¼“å†²ä½“æ„æˆï¼Œç³»ç»Ÿé€šè¿‡æ“ä½œç¼“å†²æ± çš„é¦–éƒ¨å®ç°å¯¹ç¼“å†²åŒºçš„ç®¡ç†ã€‚</p>
<p>é€šå¸¸ç¼“å†²æ± æœ‰3ä¸ªé˜Ÿåˆ—ï¼Œemä¸ºç©ºç™½ç¼“å†²åŒºé˜Ÿåˆ—ï¼Œinä¸ºè£…æ»¡è¾“å…¥æ•°æ®çš„ç¼“å†²åŒºé˜Ÿåˆ—ï¼Œoutä¸ºè£…æ»¡è¾“å‡ºæ•°æ®çš„ç¼“å†²åŒºé˜Ÿåˆ—ï¼Œ</p>
<p>å¦å‚æ•°typeè¡¨ç¤ºç¼“å†²é˜Ÿåˆ—ç±»å‹ï¼Œå‚æ•°numberè¡¨ç¤ºç¼“å†²åŒºå·ï¼Œç¼“å†²æ± ç®¡ç†ä¸­è´Ÿè´£æ•°æ®è¾“å…¥è¿‡ç¨‹å¯åŒ…æ‹¬ï¼š</p>
<p>1ã€è¿‡ç¨‹get_buff(type,numb)ï¼›ä»¥æŸç§è§„åˆ™ä»typeæŒ‡å®šçš„ç¼“å†²åŒºé˜Ÿåˆ—ä¸­æ‘˜å–ä¸€ä¸ªç¼“å†²åŒº</p>
<p>2ã€è¿‡ç¨‹put_buff(type,numb)ï¼›å°†numbç¼“å†²åŒºæ”¾å…¥ç›¸åº”çš„ç¼“å†²é˜Ÿåˆ—</p>
<p>ä½¿ç”¨ä¸Šè¿°æ“ä½œï¼š</p>
<p>è¾“å…¥è¿‡ç¨‹å¯è¢«æè¿°å¦‚ä¸‹ï¼š</p>
<p>1ã€è¿›ç¨‹è°ƒç”¨get_buff(type,numb),ä»emé˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªç©ºç™½ç¼“å†²åŒºï¼Œè¿”å›çš„ç¼–å·ä¸ºnumbï¼Œè·å–çš„ç¼“å†²åŒºå‘½åä¸ºhin</p>
<p>2ã€å°†è¾“å…¥çš„æ•°æ®è£…å…¥åˆ°hinä¸­ï¼Œå½“hinä¸­è£…æ»¡äº†æ•°æ®ä¹‹åï¼Œè°ƒç”¨put_buff(in,hin)å°†è¯¥ç¼“å†²åŒºæ’å…¥åˆ°è¾“å…¥ç¼“å†²é˜Ÿåˆ—ä¸­</p>
<p><strong>å››ã€è¯•ç»™å‡ºä¸¤ç§IOè°ƒåº¦ç®—æ³•ï¼Œå¹¶è¯´æ˜ä¸ºä»€ä¹ˆIOè°ƒåº¦ä¸èƒ½ä½¿ç”¨æ—¶é—´ç‰‡è½®è½¬æ³•ï¼Ÿ</strong></p>
<p>1ã€FCFS å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ã€‚å½“å¤šä¸ªè¿›ç¨‹å¯¹åŒä¸€IOè®¾å¤‡è¿›è¡Œè¾“å…¥è¾“å‡ºè¯·æ±‚æ—¶ï¼ŒæŒ‰ç…§åˆ°è¾¾æ—¶é—´æ’æˆé˜Ÿåˆ—ï¼Œå°†IOè®¾å¤‡åˆ†é…ç»™é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹</p>
<p>2ã€ä¼˜å…ˆçº§é«˜è€…ä¼˜å…ˆç®—æ³•ã€‚å¤šä¸ªè¿›ç¨‹å¯¹åŒä¸€IOè®¾å¤‡è¿›è¡Œè¾“å…¥è¾“å‡ºè¯·æ±‚æ—¶ï¼ŒæŒ‰ç…§è¿›ç¨‹çš„ä¼˜å…ˆçº§æ’æˆé˜Ÿåˆ—ï¼Œå°†IOè®¾å¤‡åˆ†é…ç»™ä¼˜å…ˆçº§æœ€é«˜çš„è®¾å¤‡</p>
<p>IOè®¾å¤‡å› å…¶å›ºæœ‰å±æ€§ï¼Œåªèƒ½ç‹¬å ä½¿ç”¨ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨å®Œçš„æ—¶å€™å…¶ä»–è¿›ç¨‹æ‰èƒ½ä½¿ç”¨ï¼Œåœ¨ç”±é€šé“æ§åˆ¶çš„è¾“å…¥è¾“å‡ºç³»ç»Ÿä¸­ï¼Œé€šé“ç¨‹åºä¸èƒ½è¢«æ—¶é’Ÿä¸­æ–­æ‰€æ‰“æ–­ï¼Œæ‰€ä»¥IOè°ƒåº¦ä¸èƒ½ä½¿ç”¨æ—¶é—´ç‰‡è½®è½¬æ³•ã€‚</p>
<p><strong>äº”ã€æŸæ“ä½œç³»ç»Ÿä¸­é‡‡ç”¨å•ç¼“å†²ä¼ é€ç£ç›˜æ•°æ®ã€‚è®¾ä»ç£ç›˜å°†æ•°æ®ä¼ é€åˆ°ç¼“å†²åŒºæ‰€ç”¨æ—¶é—´ä¸ºT1ï¼Œå°†ç¼“å†²åŒºæ•°æ®ä¼ é€åˆ°ç”¨æˆ·åŒºæ‰€ç”¨æ—¶é—´ä¸ºT2ï¼ŒCPUå¤„ç†æ•°æ®æ‰€ç”¨æ—¶é—´ä¸ºT3ã€‚é—®ç³»ç»Ÿå¤„ç†è¯¥æ•°æ®æ‰€ç”¨æ€»æ—¶é—´ä¸ºå¤šå°‘ï¼Ÿ</strong></p>
<p>ç¬¬ä¸€ä¸ªæ•°æ®å—ä»å¤–å­˜è¾“å…¥åˆ°ç¼“å†²åŒºå¹¶å°†ç¼“å†²åŒºçš„æ•°æ®è¾“å…¥åˆ°ç”¨æˆ·åŒºæ—¶ï¼Œç¬¬äºŒä¸ªæ•°æ®å—å°†æ•°æ®è¾“å…¥ç¼“å†²åŒºå°±èƒ½å’Œ</p>
]]></content>
  </entry>
  <entry>
    <title>è®¾ç½®npmå®‰è£…çš„é»˜è®¤ä½ç½®</title>
    <url>//post/18803.html</url>
    <content><![CDATA[<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> prefix "C:\\Users\\Admin\\.nodejs\\node_global"</span><br><span class="line">npm config <span class="built_in">set</span> cache "C:\\Users\\Admin\\.nodejs\\node_cache"</span><br></pre></td></tr></table></figure><a id="more"></a>

<p><a href="https://blog.csdn.net/runonway/article/details/79501510" target="_blank" rel="noopener">https://blog.csdn.net/runonway/article/details/79501510</a></p>
]]></content>
      <tags>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>é’‰é’‰ç½‘è¯¾æ‰¹é‡ä¸‹è½½è„šæœ¬</title>
    <url>//post/49280.html</url>
    <content><![CDATA[<p>èƒ½å¤Ÿè½¬åŒ–æ ¼å¼çš„</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*- coding:UTF-8 -*-</span></span><br><span class="line"><span class="comment"># !/usr/bin/python</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@File    : dingtalk.py</span></span><br><span class="line"><span class="string">@Time    : 2020/4/25 16:40</span></span><br><span class="line"><span class="string">@Author  : iBoy</span></span><br><span class="line"><span class="string">@Email   : iboy@iboy.tech</span></span><br><span class="line"><span class="string">@Description : é’‰é’‰ä¸­é‚£äº›æ— æ³•ä¸‹è½½çš„ç½‘è¯¾ï¼Œå¯ä»¥é€šè¿‡Pythonåç¨‹ä¸‹è½½ï¼Œä¸æƒ³åœ¨çº¿è§‚çœ‹ï¼Œçªç ´2å€é€Ÿé™åˆ¶</span></span><br><span class="line"><span class="string">@Software: PyCharm</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">download_dir = <span class="string">"download"</span>  <span class="comment"># å­˜æ”¾çš„ç›¸å¯¹ä½ç½®</span></span><br><span class="line">course_id = <span class="string">"##########"</span>  <span class="comment"># è¯¾ç¨‹ä»£ç </span></span><br><span class="line">auth_key = <span class="string">"################"</span>  <span class="comment"># ç”¨æˆ·çš„å”¯ä¸€æ ‡ç¤ºç¬¦</span></span><br><span class="line">total_time = <span class="string">"97:17"</span>  <span class="comment"># ç½‘è¯¾çš„æ—¶é•¿ï¼Œè¿™é‡Œæ˜¯97åˆ†17ç§’</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_video</span><span class="params">(k)</span>:</span></span><br><span class="line">    base_url = <span class="string">"http://dtliving-pre.alicdn.com/live_hp/&#123;&#125;/&#123;&#125;.ts?auth_key=&#123;&#125;"</span>.format(course_id, k, auth_key)</span><br><span class="line">    print(base_url)</span><br><span class="line">    resp = requests.get(base_url)</span><br><span class="line">    <span class="keyword">with</span> open(download_dir + <span class="string">"/&#123;&#125;.ts"</span>.format(k), <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(resp.content)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_max_video_num</span><span class="params">(play_time)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        play_time = play_time.split(<span class="string">":"</span>)</span><br><span class="line">        total_seconds = int(play_time[<span class="number">0</span>]) * <span class="number">60</span> + int(play_time[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"è·å–è§†é¢‘æœ€å¤§æ•°é‡å‡ºç°å¼‚å¸¸"</span>, str(e))</span><br><span class="line">    max_value = total_seconds // <span class="number">30</span></span><br><span class="line">    <span class="comment"># print(max_value)</span></span><br><span class="line">    <span class="keyword">while</span> max_value != <span class="number">0</span>:</span><br><span class="line">        base_url = <span class="string">"http://dtliving-pre.alicdn.com/live_hp/&#123;&#125;/&#123;&#125;.ts?auth_key=&#123;&#125;"</span>.format(course_id, max_value, auth_key)</span><br><span class="line">        resp = requests.get(base_url)</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == <span class="number">404</span>:</span><br><span class="line">            max_value = max_value - <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"å…±æœ‰"</span>, max_value, <span class="string">"ä¸ªè§†é¢‘"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> max_value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_videos</span><span class="params">(filename)</span>:</span></span><br><span class="line">    ts_list = os.listdir(download_dir)</span><br><span class="line">    ts_list.sort(key=<span class="keyword">lambda</span> x: int(x[:<span class="number">-3</span>]))</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"video.txt"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> ts_list:</span><br><span class="line">            f.write((<span class="string">"file "</span> + os.getcwd() + <span class="string">r'/&#123;&#125;/&#123;&#125;'</span>.format(download_dir, name) + <span class="string">"\n"</span>).replace(<span class="string">'\\'</span>, <span class="string">"/"</span>))</span><br><span class="line">    f.close()</span><br><span class="line">    cmd = <span class="string">"ffmpeg -f concat -safe 0 -i  video.txt -c copy &#123;&#125;/&#123;&#125;.mp4"</span>.format(download_dir, filename)</span><br><span class="line">    os.system(cmd)</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> ts_list:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.remove(download_dir + <span class="string">"/"</span> + f)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(str(e))</span><br><span class="line">    os.remove(<span class="string">"video.txt"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(download_dir):</span><br><span class="line">        print(<span class="string">"æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œæ–°å»ºæ–‡ä»¶å¤¹download"</span>)</span><br><span class="line">        os.mkdir(download_dir)</span><br><span class="line">    max_video_num = get_max_video_num(total_time)</span><br><span class="line">    <span class="comment"># å®šä¹‰åç¨‹æ–¹æ³•</span></span><br><span class="line">    time_start = time.time()</span><br><span class="line">    download_queue = [gevent.spawn(download_video, k) <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, max_video_num + <span class="number">1</span>)]</span><br><span class="line">    <span class="comment"># æ·»åŠ åç¨‹ä»»åŠ¡ï¼Œå¹¶ä¸”å¯åŠ¨è¿è¡Œ</span></span><br><span class="line">    gevent.joinall(download_queue)</span><br><span class="line">    time_end = time.time()</span><br><span class="line">    print(<span class="string">"ä¸‹è½½ç”¨æ—¶ï¼š"</span>, time_end - time_start, <span class="string">"s"</span>)</span><br><span class="line">    print(<span class="string">"ä¸‹è½½å®Œæˆæ­£åœ¨åˆå¹¶..."</span>)</span><br><span class="line">    merge_videos(<span class="string">"è®¡ç®—æœºç½‘ç»œ"</span>)</span><br><span class="line">    print(<span class="string">"åˆå¹¶å®Œæˆï¼"</span>)</span><br></pre></td></tr></table></figure><a id="more"></a>


<p>requests+åç¨‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF-8 -*-</span></span><br><span class="line"><span class="comment"># !/usr/bin/python</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@File    : dingtalk.py</span></span><br><span class="line"><span class="string">@Time    : 2020/4/25 16:40</span></span><br><span class="line"><span class="string">@Author  : iBoy</span></span><br><span class="line"><span class="string">@Email   : iboy@iboy.tech</span></span><br><span class="line"><span class="string">@Description : é’‰é’‰ä¸­é‚£äº›æ— æ³•ä¸‹è½½çš„ç½‘è¯¾ï¼Œå¯ä»¥é€šè¿‡Pythonåç¨‹ä¸‹è½½ï¼Œä¸æƒ³åœ¨çº¿è§‚çœ‹ï¼Œçªç ´2å€é€Ÿé™åˆ¶</span></span><br><span class="line"><span class="string">@Software: PyCharm</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">download_dir = <span class="string">"download"</span>  <span class="comment"># å­˜æ”¾çš„ç›¸å¯¹ä½ç½®</span></span><br><span class="line">course_id = <span class="string">"1111111111"</span>  <span class="comment"># è¯¾ç¨‹ä»£ç </span></span><br><span class="line"><span class="comment"># auth_key = "1111111111111111"  # ç”¨æˆ·çš„å”¯ä¸€æ ‡ç¤ºç¬¦</span></span><br><span class="line">total_time = <span class="string">"101:3"</span>  <span class="comment"># ç½‘è¯¾çš„æ—¶é•¿ï¼Œè¿™é‡Œæ˜¯97åˆ†17ç§’</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_video</span><span class="params">(k)</span>:</span></span><br><span class="line">    base_url = <span class="string">"http://dtliving-pre.alicdn.com/live_hp/&#123;&#125;/&#123;&#125;.ts"</span>.format(course_id, k)</span><br><span class="line">    print(base_url)</span><br><span class="line">    resp = requests.get(base_url)</span><br><span class="line">    <span class="keyword">with</span> open(download_dir + <span class="string">"/%05d.ts"</span> % int(k), <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(resp.content)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_max_video_num</span><span class="params">(play_time)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        play_time = play_time.split(<span class="string">":"</span>)</span><br><span class="line">        total_seconds = int(play_time[<span class="number">0</span>]) * <span class="number">60</span> + int(play_time[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"è·å–è§†é¢‘æœ€å¤§æ•°é‡å‡ºç°å¼‚å¸¸"</span>, str(e))</span><br><span class="line">    max_value = total_seconds // <span class="number">30</span></span><br><span class="line">    <span class="comment"># print(max_value)</span></span><br><span class="line">    <span class="keyword">while</span> max_value != <span class="number">0</span>:</span><br><span class="line">        base_url = <span class="string">"http://dtliving-pre.alicdn.com/live_hp/&#123;&#125;/&#123;&#125;.ts"</span>.format(course_id, max_value)</span><br><span class="line">        resp = requests.get(base_url)</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == <span class="number">404</span>:</span><br><span class="line">            max_value = max_value - <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"å…±æœ‰"</span>, max_value, <span class="string">"ä¸ªè§†é¢‘"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> max_value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_videos</span><span class="params">(filename)</span>:</span></span><br><span class="line">    ts_list = os.listdir(download_dir)</span><br><span class="line">    cmd=<span class="string">r"copy /b download\*.ts  download\&#123;&#125;.ts"</span>.format(filename)</span><br><span class="line">    os.system(cmd)</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> ts_list:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.remove(download_dir + <span class="string">"/"</span> + f)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(str(e))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(download_dir):</span><br><span class="line">        print(<span class="string">"æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œæ–°å»ºæ–‡ä»¶å¤¹download"</span>)</span><br><span class="line">        os.mkdir(download_dir)</span><br><span class="line">    max_video_num = get_max_video_num(total_time)</span><br><span class="line">    <span class="comment"># å®šä¹‰åç¨‹æ–¹æ³•</span></span><br><span class="line">    time_start = time.time()</span><br><span class="line">    download_queue = [gevent.spawn(download_video, k) <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, max_video_num + <span class="number">1</span>)]</span><br><span class="line">    <span class="comment"># æ·»åŠ åç¨‹ä»»åŠ¡ï¼Œå¹¶ä¸”å¯åŠ¨è¿è¡Œ</span></span><br><span class="line">    gevent.joinall(download_queue)</span><br><span class="line">    time_end = time.time()</span><br><span class="line">    print(<span class="string">"ä¸‹è½½ç”¨æ—¶ï¼š"</span>, time_end - time_start, <span class="string">"s"</span>)</span><br><span class="line">    print(<span class="string">"ä¸‹è½½å®Œæˆæ­£åœ¨åˆå¹¶..."</span>)</span><br><span class="line">    merge_videos(<span class="string">"è®¡ç®—æœºç½‘ç»œ"</span>)</span><br><span class="line">    print(<span class="string">"åˆå¹¶å®Œæˆï¼"</span>)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>åç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>éªŒè¯ç æ¥ç å¹³å°</title>
    <url>//post/26203.html</url>
    <content><![CDATA[<p>å›½å¤–å…è´¹æ¥ç å¹³å°</p><p><a href="https://ch.freephonenum.com" target="_blank" rel="noopener">https://ch.freephonenum.com</a><br><a href="https://smsreceivefree.com" target="_blank" rel="noopener">https://smsreceivefree.com</a><br><a href="https://zh.mytrashmobile.com" target="_blank" rel="noopener">https://zh.mytrashmobile.com</a><br><a href="https://www.receive-sms-online.info" target="_blank" rel="noopener">https://www.receive-sms-online.info</a><br><a href="https://receiveasms.com" target="_blank" rel="noopener">https://receiveasms.com</a><br><a href="https://sms-online.co/receive-free-sms" target="_blank" rel="noopener">https://sms-online.co/receive-free-sms</a><br><a href="https://receive-sms.com" target="_blank" rel="noopener">https://receive-sms.com</a><br><a href="http://receivefreesms.com/" target="_blank" rel="noopener">http://receivefreesms.com/</a><br><a href="https://www.receivesmsonline.net/" target="_blank" rel="noopener">https://www.receivesmsonline.net/</a><br><a href="https://www.freeonlinephone.org/" target="_blank" rel="noopener">https://www.freeonlinephone.org/</a><br><a href="https://us-phone-number.com" target="_blank" rel="noopener">https://us-phone-number.com</a><br><a href="https://temporary-phone-number.com" target="_blank" rel="noopener">https://temporary-phone-number.com</a><br><a href="https://www.receivesms.co/" target="_blank" rel="noopener">https://www.receivesms.co/</a><br><a href="https://www.smstibo.com/" target="_blank" rel="noopener">https://www.smstibo.com/</a><br>PingMe å…è´¹æ¥ç å¹³å°ï¼š <a href="https://pingme.tel/receive-sms-online-cn/" target="_blank" rel="noopener">https://pingme.tel/receive-sms-online-cn/</a><br><a href="http://receivefreesms.net/" target="_blank" rel="noopener">http://receivefreesms.net/</a><br><a href="http://receivesmsonline.in/" target="_blank" rel="noopener">http://receivesmsonline.in/</a><br><a href="https://sms-receive.net/" target="_blank" rel="noopener">https://sms-receive.net/</a><br><a href="https://www.receivesms.net/" target="_blank" rel="noopener">https://www.receivesms.net/</a><br><a href="https://www.yaysms.com/" target="_blank" rel="noopener">https://www.yaysms.com/</a><br>å›½å†…å…è´¹æ¥ç å¹³å°<br>è¶…çº§äº‘çŸ­ä¿¡ï¼š <a href="http://www.bfkdim.com/" target="_blank" rel="noopener">http://www.bfkdim.com/</a><br>éšç§çŸ­ä¿¡ï¼š<a href="https://www.yinsiduanxin.com" target="_blank" rel="noopener">https://www.yinsiduanxin.com</a><br>äº‘çŸ­ä¿¡ï¼š <a href="https://www.materialtools.com/" target="_blank" rel="noopener">https://www.materialtools.com/</a><br>åœ¨çº¿çŸ­ä¿¡ï¼š<a href="http://www.smszk.com/" target="_blank" rel="noopener">http://www.smszk.com/</a><br>æ¸¸å®¢çŸ­ä¿¡ï¼š<a href="https://www.visitorsms.com/cn" target="_blank" rel="noopener">https://www.visitorsms.com/cn</a><br>å…è´¹æ¥ç ï¼š<a href="https://www.becmd.com/" target="_blank" rel="noopener">https://www.becmd.com/</a><br>æ¥ç å¹³å°ï¼š<a href="http://www.114sim.com/" target="_blank" rel="noopener">http://www.114sim.com/</a> <a href="http://zg.114sim.com/" target="_blank" rel="noopener">http://zg.114sim.com/</a><br>äº‘çŸ­ä¿¡ï¼š<a href="https://yunduanxin.net/" target="_blank" rel="noopener">https://yunduanxin.net/</a><br>å…è´¹æ¥ç ï¼š<a href="http://z-sms.com/" target="_blank" rel="noopener">http://z-sms.com/</a><br>æ å½±ç½‘ç»œï¼š<a href="https://zusms.com/receiving-sms" target="_blank" rel="noopener">https://zusms.com/receiving-sms</a><br>å…è´¹æ¥ç ï¼š<a href="https://www.shejiinn.com/" target="_blank" rel="noopener">https://www.shejiinn.com/</a><br>äº‘æ¥ç ï¼š<a href="https://yunjiema.net" target="_blank" rel="noopener">https://yunjiema.net</a><br>äº‘éªŒè¯ç ï¼š<a href="https://www.cnwml.com" target="_blank" rel="noopener">https://www.cnwml.com</a><br>å…è´¹æ¥ç ï¼š<a href="https://www.mffac.com" target="_blank" rel="noopener">https://www.mffac.com</a><br>æ¥ç ç§‘æŠ€å…è´¹å¹³å°ï¼š<a href="http://jiema.tech/sms/" target="_blank" rel="noopener">http://jiema.tech/sms/</a><br>æ¥ç å·ï¼š<a href="https://jiemahao.com" target="_blank" rel="noopener">https://jiemahao.com</a><br>å…è´¹æ¥ç ï¼š <a href="https://mianfeijiema.com/" target="_blank" rel="noopener">https://mianfeijiema.com/</a><br>å°é¸Ÿæ¥ç å¹³å°ï¼š <a href="http://www.xnsms.com/" target="_blank" rel="noopener">http://www.xnsms.com/</a><br>zeroæ¥ç å¹³å°ï¼š <a href="https://xinghai.party/" target="_blank" rel="noopener">https://xinghai.party/</a><br>LotHelperï¼š <a href="https://www.lothelper.com/cn" target="_blank" rel="noopener">https://www.lothelper.com/cn</a><br>å…è´¹æ¥ç å¹³å°ï¼š <a href="http://www.zsrq.net/" target="_blank" rel="noopener">http://www.zsrq.net/</a><br>å›½å¤–æ”¶è´¹æ¥ç å¹³å°<br><a href="https://sms-activate.ru/cn/" target="_blank" rel="noopener">https://sms-activate.ru/cn/</a> 1$èµ·å……ï¼Œæœ‰ä¸­æ–‡é¡µé¢<br><a href="https://5sim.net" target="_blank" rel="noopener">https://5sim.net</a><br>ä¾¿å®œå›½å®¶ï¼šä¿„ç½—æ–¯ï¼ˆ Russia ï¼‰ç½—é©¬å°¼äºšï¼ˆ Romania ï¼‰è²å¾‹å®¾ï¼ˆ Philippines ï¼‰è’™å¤ï¼ˆ Mongolia ï¼‰æ‹‰è„±ç»´äºšï¼ˆ Latvia ï¼‰å“ˆè¨å…‹æ–¯å¦ï¼ˆ Kazakhstan ï¼‰ä»¥è‰²åˆ—ï¼ˆ Israel ï¼‰å“¥ä¼¦æ¯”äºšï¼ˆ Colombia ï¼‰<br><a href="http://smspva.com" target="_blank" rel="noopener">http://smspva.com</a> è¿™å®¶èµ·æ­¥å°±æ˜¯0.1$ï¼Œä¹Ÿå°±æ˜¯æœ€ä¾¿å®œ7æ¯›èµ·æ­¥<br><a href="https://onlinesim.ru/zh" target="_blank" rel="noopener">https://onlinesim.ru/zh</a> å°±ä¿„ç½—æ–¯çš„ç ä¾¿å®œï¼Œèµ·æ­¥0.1å¢å¸ƒ<br><a href="https://www.jindousms.com/" target="_blank" rel="noopener">https://www.jindousms.com/</a> å›½äººå¼€çš„å›½å¤–å·ç æ¥ç å¹³å°ï¼Œä¸åšå›½å†…ä¸šåŠ¡<br>TGç¾¤<br><a href="https://meiguojiema.com" target="_blank" rel="noopener">https://meiguojiema.com</a> åˆä¸€ä¸ªå›½äººå¼€çš„å›½å¤–æ¥ç ï¼Œä¸»è¦ç¾å›½å’ŒåŠ æ‹¿å¤§å·ç <br><a href="https://www.smsjiema.com/" target="_blank" rel="noopener">https://www.smsjiema.com/</a> ç¾å›½å®ä½“å¡å·ç ï¼Œå¯ä»¥æ³¨å†ŒGV<br><a href="https://www.textverified.com/" target="_blank" rel="noopener">https://www.textverified.com/</a> 2åˆ€èµ·å……ï¼Œæ¥ç ä¹ŸæŒºè´µçš„<br><a href="https://autofications.com/" target="_blank" rel="noopener">https://autofications.com/</a> ä¸ç®—è´µä¹Ÿä¸ç®—ä¾¿å®œï¼Œæœ€ä½$0.5ä¸€ä¸ªç <br>å›½å†…æ”¶è´¹æ¥ç å¹³å°<br>ä¸ç¡®å®šä»€ä¹ˆæ—¶å€™ä¼šè·‘è·¯ï¼Œç”¨å¤šå°‘å……å¤šå°‘</p><a id="more"></a>

<p>ç±³ç²’æ¥ç ï¼š<a href="http://www.yyyung.cn:9000/" target="_blank" rel="noopener">http://www.yyyung.cn:9000/</a> ã€2å…ƒèµ·å……ã€‘<br>å°ç±³å¹³å°ï¼š <a href="http://mili02.com:9000/" target="_blank" rel="noopener">http://mili02.com:9000/</a> ä¸¤ä¸ªæ˜¯ä¸€æ ·çš„ï¼Œè´¦å·é€šç”¨<br>å¯å¯ç  ï¼š <a href="http://www.hfsxf.com/" target="_blank" rel="noopener">http://www.hfsxf.com/</a><br>666éªŒè¯ç å¹³å°ï¼š <a href="http://www.666yzm.com/" target="_blank" rel="noopener">http://www.666yzm.com/</a><br>æ¢¦ç å¹³å°ï¼š<a href="https://www.5151mma.com/" target="_blank" rel="noopener">https://www.5151mma.com/</a> ã€1å…ƒèµ·å……ã€‘<br>æ¥ç ç§‘æŠ€ï¼š<a href="http://sim.vividly.cn/app/login.php?q=" target="_blank" rel="noopener">http://sim.vividly.cn/app/login.php?q=</a> ã€1å…ƒèµ·å……ï¼Œä½†è¦æ±‚è´¦å·ä½™é¢å¤§äº10å…ƒæ‰èƒ½ä½¿ç”¨æ¥ç ã€‘<br>è·¯è™æ¥ç å¹³å°ï¼š <a href="http://www.luhujiema.com/" target="_blank" rel="noopener">http://www.luhujiema.com/</a><br>çŸ­ä¿¡éªŒè¯ç æ¥ç å¹³å° ï¼š<a href="http://www.zhbmz.com" target="_blank" rel="noopener">http://www.zhbmz.com</a> ã€èµ·å……ä¸é™ã€‘<br>é£äº«å¹³å°ï¼š<a href="http://feixiang.taixingwds.com/" target="_blank" rel="noopener">http://feixiang.taixingwds.com/</a><br>å¯å¯éªŒè¯ï¼š<a href="http://www.hfsxf.com/oszc.html" target="_blank" rel="noopener">http://www.hfsxf.com/oszc.html</a><br>ä¹Œé¾Ÿç çŸ­ä¿¡éªŒè¯ç å¹³å°ï¼š <a href="http://wuguima.cn/" target="_blank" rel="noopener">http://wuguima.cn/</a><br>è‡´æ•¬å…ˆçƒˆï¼š<a href="http://www.myzjxl.com/" target="_blank" rel="noopener">http://www.myzjxl.com/</a><br>æ–°ç ï¼š <a href="http://www.xinma1.com:10001/zc.html" target="_blank" rel="noopener">http://www.xinma1.com:10001/zc.html</a><br>ä¿¡é¸½ï¼š <a href="http://html.reyne.cn/" target="_blank" rel="noopener">http://html.reyne.cn/</a><br>è€ƒæ‹‰äº‘ï¼š <a href="http://www.kaolama.com/" target="_blank" rel="noopener">http://www.kaolama.com/</a><br>æ–‘ç ï¼š <a href="http://www.banma1024.net/reg/?wafcloud=1" target="_blank" rel="noopener">http://www.banma1024.net/reg/?wafcloud=1</a> ã€10å…ƒèµ·å……ã€‘<br>é­”å¡æ¥ç å¹³å°ï¼š <a href="http://92moka.com/" target="_blank" rel="noopener">http://92moka.com/</a><br>çˆ±ç æ¥ç å¹³å°ï¼š <a href="http://www.aimajiema.com/" target="_blank" rel="noopener">http://www.aimajiema.com/</a><br>ä¹å¯å¯æ¥ç å¹³å°ï¼š <a href="http://lekeke.92zyb.com/" target="_blank" rel="noopener">http://lekeke.92zyb.com/</a><br>ç•ªèŒ„æ¥ç ï¼š <a href="http://ifanqie.cc/" target="_blank" rel="noopener">http://ifanqie.cc/</a><br>è¿…æ·éªŒè¯ç å¹³å°ï¼š <a href="http://xunjie.taixingwds.com/" target="_blank" rel="noopener">http://xunjie.taixingwds.com/</a><br>è“ç‹æ•°æ®å…±äº«å¹³å°ï¼š <a href="http://xiangjiuer.cn/" target="_blank" rel="noopener">http://xiangjiuer.cn/</a><br>ç å¤§å¸ˆï¼š <a href="http://mds.js.sdmpay.com/" target="_blank" rel="noopener">http://mds.js.sdmpay.com/</a><br>èµµäº‘æ¥ç å¹³å°ï¼š <a href="http://www.17lift.com/" target="_blank" rel="noopener">http://www.17lift.com/</a><br>ç¥ç ï¼š <a href="http://202.79.167.29/" target="_blank" rel="noopener">http://202.79.167.29/</a><br>æ–°çˆ±ç ï¼š<a href="http://aima.taixingwds.com/" target="_blank" rel="noopener">http://aima.taixingwds.com/</a></p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>æ¥ç å¹³å°</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè°ƒåº¦ç®—æ³•</title>
    <url>//post/2783.html</url>
    <content><![CDATA[<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: GPL-2.0-only</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  kernel/sched/core.c</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Core kernel scheduler code and related syscalls</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Copyright (C) 1991-2002  Linus Torvalds</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sched.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/nospec.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kcov.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/scs.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;asm/switch_to.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;asm/tlb.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../workqueue_internal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../../fs/io-wq.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../smpboot.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pelt.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"smp.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CREATE_TRACE_POINTS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;trace/events/sched.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Export tracepoints that act as a bare tracehook (ie: have no trace event</span></span><br><span class="line"><span class="comment"> * associated with them) to allow external modules to probe them.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">EXPORT_TRACEPOINT_SYMBOL_GPL(pelt_cfs_tp);</span><br><span class="line">EXPORT_TRACEPOINT_SYMBOL_GPL(pelt_rt_tp);</span><br><span class="line">EXPORT_TRACEPOINT_SYMBOL_GPL(pelt_dl_tp);</span><br><span class="line">EXPORT_TRACEPOINT_SYMBOL_GPL(pelt_irq_tp);</span><br><span class="line">EXPORT_TRACEPOINT_SYMBOL_GPL(pelt_se_tp);</span><br><span class="line">EXPORT_TRACEPOINT_SYMBOL_GPL(sched_overutilized_tp);</span><br><span class="line"></span><br><span class="line">DEFINE_PER_CPU_SHARED_ALIGNED(struct rq, runqueues);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_SCHED_DEBUG) &amp;&amp; defined(CONFIG_JUMP_LABEL)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Debugging: various feature bits</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If SCHED_DEBUG is disabled, each compilation unit has its own copy of</span></span><br><span class="line"><span class="comment"> * sysctl_sched_features, defined in sched.h, to allow constants propagation</span></span><br><span class="line"><span class="comment"> * at compile time and compiler optimization based on features default.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCHED_FEAT(name, enabled)	\</span></span><br><span class="line">	(<span class="number">1U</span>L &lt;&lt; __SCHED_FEAT_##name) * enabled |</span><br><span class="line">const_debug <span class="keyword">unsigned</span> <span class="keyword">int</span> sysctl_sched_features =</span><br><span class="line">#include <span class="string">"features.h"</span></span><br><span class="line">	<span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> SCHED_FEAT</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Number of tasks to iterate in a single balance run.</span></span><br><span class="line"><span class="comment"> * Limited because this is done with IRQs disabled.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">const_debug <span class="keyword">unsigned</span> <span class="keyword">int</span> sysctl_sched_nr_migrate = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * period over which we measure -rt task CPU usage in us.</span></span><br><span class="line"><span class="comment"> * default: 1s</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> sysctl_sched_rt_period = <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line">__read_mostly <span class="keyword">int</span> scheduler_running;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * part of the period that we allow rt tasks to run in us.</span></span><br><span class="line"><span class="comment"> * default: 0.95s</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> sysctl_sched_rt_runtime = <span class="number">950000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * __task_rq_lock - lock the rq @p resides on.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *__<span class="title">task_rq_lock</span>(<span class="title">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>, <span class="title">struct</span> <span class="title">rq_flags</span> *<span class="title">rf</span>)</span></span><br><span class="line"><span class="class">	__<span class="title">acquires</span>(<span class="title">rq</span>-&gt;<span class="title">lock</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	lockdep_assert_held(&amp;p-&gt;pi_lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		rq = task_rq(p);</span><br><span class="line">		raw_spin_lock(&amp;rq-&gt;lock);</span><br><span class="line">		<span class="keyword">if</span> (likely(rq == task_rq(p) &amp;&amp; !task_on_rq_migrating(p))) &#123;</span><br><span class="line">			rq_pin_lock(rq, rf);</span><br><span class="line">			<span class="keyword">return</span> rq;</span><br><span class="line">		&#125;</span><br><span class="line">		raw_spin_unlock(&amp;rq-&gt;lock);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (unlikely(task_on_rq_migrating(p)))</span><br><span class="line">			cpu_relax();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * task_rq_lock - lock p-&gt;pi_lock and lock the rq @p resides on.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">struct rq *<span class="title">task_rq_lock</span><span class="params">(struct task_struct *p, struct rq_flags *rf)</span></span></span><br><span class="line"><span class="function">	__<span class="title">acquires</span><span class="params">(p-&gt;pi_lock)</span></span></span><br><span class="line"><span class="function">	__<span class="title">acquires</span><span class="params">(rq-&gt;lock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		raw_spin_lock_irqsave(&amp;p-&gt;pi_lock, rf-&gt;flags);</span><br><span class="line">		rq = task_rq(p);</span><br><span class="line">		raw_spin_lock(&amp;rq-&gt;lock);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 *	move_queued_task()		task_rq_lock()</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 *	ACQUIRE (rq-&gt;lock)</span></span><br><span class="line"><span class="comment">		 *	[S] -&gt;on_rq = MIGRATING		[L] rq = task_rq()</span></span><br><span class="line"><span class="comment">		 *	WMB (__set_task_cpu())		ACQUIRE (rq-&gt;lock);</span></span><br><span class="line"><span class="comment">		 *	[S] -&gt;cpu = new_cpu		[L] task_rq()</span></span><br><span class="line"><span class="comment">		 *					[L] -&gt;on_rq</span></span><br><span class="line"><span class="comment">		 *	RELEASE (rq-&gt;lock)</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * If we observe the old CPU in task_rq_lock(), the acquire of</span></span><br><span class="line"><span class="comment">		 * the old rq-&gt;lock will fully serialize against the stores.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * If we observe the new CPU in task_rq_lock(), the address</span></span><br><span class="line"><span class="comment">		 * dependency headed by '[L] rq = task_rq()' and the acquire</span></span><br><span class="line"><span class="comment">		 * will pair with the WMB to ensure we then also see migrating.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (likely(rq == task_rq(p) &amp;&amp; !task_on_rq_migrating(p))) &#123;</span><br><span class="line">			rq_pin_lock(rq, rf);</span><br><span class="line">			<span class="keyword">return</span> rq;</span><br><span class="line">		&#125;</span><br><span class="line">		raw_spin_unlock(&amp;rq-&gt;lock);</span><br><span class="line">		raw_spin_unlock_irqrestore(&amp;p-&gt;pi_lock, rf-&gt;flags);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (unlikely(task_on_rq_migrating(p)))</span><br><span class="line">			cpu_relax();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * RQ-clock updating methods:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">update_rq_clock_task</span><span class="params">(struct rq *rq, s64 delta)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * In theory, the compile should just see 0 here, and optimize out the call</span></span><br><span class="line"><span class="comment"> * to sched_rt_avg_update. But I don't trust it...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">	s64 __maybe_unused steal = <span class="number">0</span>, irq_delta = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_IRQ_TIME_ACCOUNTING</span></span><br><span class="line">	irq_delta = irq_time_read(cpu_of(rq)) - rq-&gt;prev_irq_time;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Since irq_time is only updated on &#123;soft,&#125;irq_exit, we might run into</span></span><br><span class="line"><span class="comment">	 * this case when a previous update_rq_clock() happened inside a</span></span><br><span class="line"><span class="comment">	 * &#123;soft,&#125;irq region.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * When this happens, we stop -&gt;clock_task and only update the</span></span><br><span class="line"><span class="comment">	 * prev_irq_time stamp to account for the part that fit, so that a next</span></span><br><span class="line"><span class="comment">	 * update will consume the rest. This ensures -&gt;clock_task is</span></span><br><span class="line"><span class="comment">	 * monotonic.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * It does however cause some slight miss-attribution of &#123;soft,&#125;irq</span></span><br><span class="line"><span class="comment">	 * time, a more accurate solution would be to update the irq_time using</span></span><br><span class="line"><span class="comment">	 * the current rq-&gt;clock timestamp, except that would require using</span></span><br><span class="line"><span class="comment">	 * atomic ops.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (irq_delta &gt; delta)</span><br><span class="line">		irq_delta = delta;</span><br><span class="line"></span><br><span class="line">	rq-&gt;prev_irq_time += irq_delta;</span><br><span class="line">	delta -= irq_delta;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_PARAVIRT_TIME_ACCOUNTING</span></span><br><span class="line">	<span class="keyword">if</span> (static_key_false((&amp;paravirt_steal_rq_enabled))) &#123;</span><br><span class="line">		steal = paravirt_steal_clock(cpu_of(rq));</span><br><span class="line">		steal -= rq-&gt;prev_steal_time_rq;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (unlikely(steal &gt; delta))</span><br><span class="line">			steal = delta;</span><br><span class="line"></span><br><span class="line">		rq-&gt;prev_steal_time_rq += steal;</span><br><span class="line">		delta -= steal;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	rq-&gt;clock_task += delta;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_HAVE_SCHED_AVG_IRQ</span></span><br><span class="line">	<span class="keyword">if</span> ((irq_delta + steal) &amp;&amp; sched_feat(NONTASK_CAPACITY))</span><br><span class="line">		update_irq_load_avg(rq, irq_delta + steal);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	update_rq_clock_pelt(rq, delta);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_rq_clock</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	s64 delta;</span><br><span class="line"></span><br><span class="line">	lockdep_assert_held(&amp;rq-&gt;lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;clock_update_flags &amp; RQCF_ACT_SKIP)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHED_DEBUG</span></span><br><span class="line">	<span class="keyword">if</span> (sched_feat(WARN_DOUBLE_CLOCK))</span><br><span class="line">		SCHED_WARN_ON(rq-&gt;clock_update_flags &amp; RQCF_UPDATED);</span><br><span class="line">	rq-&gt;clock_update_flags |= RQCF_UPDATED;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	delta = sched_clock_cpu(cpu_of(rq)) - rq-&gt;clock;</span><br><span class="line">	<span class="keyword">if</span> (delta &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	rq-&gt;clock += delta;</span><br><span class="line">	update_rq_clock_task(rq, delta);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">rq_csd_init(struct rq *rq, <span class="keyword">call_single_data_t</span> *csd, <span class="keyword">smp_call_func_t</span> func)</span><br><span class="line">&#123;</span><br><span class="line">	csd-&gt;flags = <span class="number">0</span>;</span><br><span class="line">	csd-&gt;func = func;</span><br><span class="line">	csd-&gt;info = rq;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHED_HRTICK</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Use HR-timers to deliver accurate preemption points.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hrtick_clear</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (hrtimer_active(&amp;rq-&gt;hrtick_timer))</span><br><span class="line">		hrtimer_cancel(&amp;rq-&gt;hrtick_timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * High-resolution timer tick.</span></span><br><span class="line"><span class="comment"> * Runs from hardirq context with interrupts disabled.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">enum</span> hrtimer_restart <span class="title">hrtick</span><span class="params">(struct hrtimer *timer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">container_of</span>(<span class="title">timer</span>, <span class="title">struct</span> <span class="title">rq</span>, <span class="title">hrtick_timer</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line">	WARN_ON_ONCE(cpu_of(rq) != smp_processor_id());</span><br><span class="line"></span><br><span class="line">	rq_lock(rq, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line">	rq-&gt;curr-&gt;sched_class-&gt;task_tick(rq, rq-&gt;curr, <span class="number">1</span>);</span><br><span class="line">	rq_unlock(rq, &amp;rf);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> HRTIMER_NORESTART;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __hrtick_restart(struct rq *rq)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">hrtimer</span> *<span class="title">timer</span> = &amp;<span class="title">rq</span>-&gt;<span class="title">hrtick_timer</span>;</span></span><br><span class="line"></span><br><span class="line">	hrtimer_start_expires(timer, HRTIMER_MODE_ABS_PINNED_HARD);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * called from hardirq (IPI) context</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __hrtick_start(<span class="keyword">void</span> *arg)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">arg</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line">	rq_lock(rq, &amp;rf);</span><br><span class="line">	__hrtick_restart(rq);</span><br><span class="line">	rq_unlock(rq, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Called to set the hrtick timer state.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * called with rq-&gt;lock held and irqs disabled</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hrtick_start</span><span class="params">(struct rq *rq, u64 delay)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">hrtimer</span> *<span class="title">timer</span> = &amp;<span class="title">rq</span>-&gt;<span class="title">hrtick_timer</span>;</span></span><br><span class="line">	<span class="keyword">ktime_t</span> time;</span><br><span class="line">	s64 delta;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Don't schedule slices shorter than 10000ns, that just</span></span><br><span class="line"><span class="comment">	 * doesn't make sense and can cause timer DoS.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	delta = <span class="keyword">max_t</span>(s64, delay, <span class="number">10000L</span>L);</span><br><span class="line">	time = ktime_add_ns(timer-&gt;base-&gt;get_time(), delta);</span><br><span class="line"></span><br><span class="line">	hrtimer_set_expires(timer, time);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (rq == this_rq())</span><br><span class="line">		__hrtick_restart(rq);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		smp_call_function_single_async(cpu_of(rq), &amp;rq-&gt;hrtick_csd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Called to set the hrtick timer state.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * called with rq-&gt;lock held and irqs disabled</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hrtick_start</span><span class="params">(struct rq *rq, u64 delay)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Don't schedule slices shorter than 10000ns, that just</span></span><br><span class="line"><span class="comment">	 * doesn't make sense. Rely on vruntime for fairness.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	delay = <span class="keyword">max_t</span>(u64, delay, <span class="number">10000L</span>L);</span><br><span class="line">	hrtimer_start(&amp;rq-&gt;hrtick_timer, ns_to_ktime(delay),</span><br><span class="line">		      HRTIMER_MODE_REL_PINNED_HARD);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SMP */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hrtick_rq_init</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	rq_csd_init(rq, &amp;rq-&gt;hrtick_csd, __hrtick_start);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	hrtimer_init(&amp;rq-&gt;hrtick_timer, CLOCK_MONOTONIC, HRTIMER_MODE_REL_HARD);</span><br><span class="line">	rq-&gt;hrtick_timer.function = hrtick;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span>	<span class="comment">/* CONFIG_SCHED_HRTICK */</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">hrtick_clear</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">hrtick_rq_init</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>	<span class="comment">/* CONFIG_SCHED_HRTICK */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * cmpxchg based fetch_or, macro so it works for different integer types</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fetch_or(ptr, mask)						\</span></span><br><span class="line">	(&#123;								\</span><br><span class="line">		typeof(ptr) _ptr = (ptr);				\</span><br><span class="line">		typeof(mask) _mask = (mask);				\</span><br><span class="line">		typeof(*_ptr) _old, _val = *_ptr;			\</span><br><span class="line">									\</span><br><span class="line">		<span class="keyword">for</span> (;;) &#123;						\</span><br><span class="line">			_old = cmpxchg(_ptr, _val, _val | _mask);	\</span><br><span class="line">			<span class="keyword">if</span> (_old == _val)				\</span><br><span class="line">				<span class="keyword">break</span>;					\</span><br><span class="line">			_val = _old;					\</span><br><span class="line">		&#125;							\</span><br><span class="line">	_old;								\</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_SMP) &amp;&amp; defined(TIF_POLLING_NRFLAG)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Atomically set TIF_NEED_RESCHED and test for TIF_POLLING_NRFLAG,</span></span><br><span class="line"><span class="comment"> * this avoids any races wrt polling state changes and thereby avoids</span></span><br><span class="line"><span class="comment"> * spurious IPIs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">set_nr_and_not_polling</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">thread_info</span> *<span class="title">ti</span> = <span class="title">task_thread_info</span>(<span class="title">p</span>);</span></span><br><span class="line">	<span class="keyword">return</span> !(fetch_or(&amp;ti-&gt;flags, _TIF_NEED_RESCHED) &amp; _TIF_POLLING_NRFLAG);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Atomically set TIF_NEED_RESCHED if TIF_POLLING_NRFLAG is set.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If this returns true, then the idle task promises to call</span></span><br><span class="line"><span class="comment"> * sched_ttwu_pending() and reschedule soon.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">set_nr_if_polling</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">thread_info</span> *<span class="title">ti</span> = <span class="title">task_thread_info</span>(<span class="title">p</span>);</span></span><br><span class="line">	typeof(ti-&gt;flags) old, val = READ_ONCE(ti-&gt;flags);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!(val &amp; _TIF_POLLING_NRFLAG))</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (val &amp; _TIF_NEED_RESCHED)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		old = cmpxchg(&amp;ti-&gt;flags, val, val | _TIF_NEED_RESCHED);</span><br><span class="line">		<span class="keyword">if</span> (old == val)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		val = old;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">set_nr_and_not_polling</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	set_tsk_need_resched(p);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">set_nr_if_polling</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">bool</span> __wake_q_add(struct wake_q_head *head, struct task_struct *task)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">wake_q_node</span> *<span class="title">node</span> = &amp;<span class="title">task</span>-&gt;<span class="title">wake_q</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Atomically grab the task, if -&gt;wake_q is !nil already it means</span></span><br><span class="line"><span class="comment">	 * its already queued (either by us or someone else) and will get the</span></span><br><span class="line"><span class="comment">	 * wakeup due to that.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * In order to ensure that a pending wakeup will observe our pending</span></span><br><span class="line"><span class="comment">	 * state, even in the failed case, an explicit smp_mb() must be used.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	smp_mb__before_atomic();</span><br><span class="line">	<span class="keyword">if</span> (unlikely(cmpxchg_relaxed(&amp;node-&gt;next, <span class="literal">NULL</span>, WAKE_Q_TAIL)))</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The head is context local, there can be no concurrency.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	*head-&gt;lastp = node;</span><br><span class="line">	head-&gt;lastp = &amp;node-&gt;next;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wake_q_add() - queue a wakeup for 'later' waking.</span></span><br><span class="line"><span class="comment"> * @head: the wake_q_head to add @task to</span></span><br><span class="line"><span class="comment"> * @task: the task to queue for 'later' wakeup</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Queue a task for later wakeup, most likely by the wake_up_q() call in the</span></span><br><span class="line"><span class="comment"> * same context, _HOWEVER_ this is not guaranteed, the wakeup can come</span></span><br><span class="line"><span class="comment"> * instantly.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function must be used as-if it were wake_up_process(); IOW the task</span></span><br><span class="line"><span class="comment"> * must be ready to be woken at this location.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wake_q_add</span><span class="params">(struct wake_q_head *head, struct task_struct *task)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (__wake_q_add(head, task))</span><br><span class="line">		get_task_struct(task);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wake_q_add_safe() - safely queue a wakeup for 'later' waking.</span></span><br><span class="line"><span class="comment"> * @head: the wake_q_head to add @task to</span></span><br><span class="line"><span class="comment"> * @task: the task to queue for 'later' wakeup</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Queue a task for later wakeup, most likely by the wake_up_q() call in the</span></span><br><span class="line"><span class="comment"> * same context, _HOWEVER_ this is not guaranteed, the wakeup can come</span></span><br><span class="line"><span class="comment"> * instantly.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function must be used as-if it were wake_up_process(); IOW the task</span></span><br><span class="line"><span class="comment"> * must be ready to be woken at this location.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function is essentially a task-safe equivalent to wake_q_add(). Callers</span></span><br><span class="line"><span class="comment"> * that already hold reference to @task can call the 'safe' version and trust</span></span><br><span class="line"><span class="comment"> * wake_q to do the right thing depending whether or not the @task is already</span></span><br><span class="line"><span class="comment"> * queued for wakeup.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wake_q_add_safe</span><span class="params">(struct wake_q_head *head, struct task_struct *task)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!__wake_q_add(head, task))</span><br><span class="line">		put_task_struct(task);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wake_up_q</span><span class="params">(struct wake_q_head *head)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">wake_q_node</span> *<span class="title">node</span> = <span class="title">head</span>-&gt;<span class="title">first</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (node != WAKE_Q_TAIL) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span>;</span></span><br><span class="line"></span><br><span class="line">		task = container_of(node, struct task_struct, wake_q);</span><br><span class="line">		BUG_ON(!task);</span><br><span class="line">		<span class="comment">/* Task can safely be re-inserted now: */</span></span><br><span class="line">		node = node-&gt;next;</span><br><span class="line">		task-&gt;wake_q.next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * wake_up_process() executes a full barrier, which pairs with</span></span><br><span class="line"><span class="comment">		 * the queueing in wake_q_add() so as not to miss wakeups.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		wake_up_process(task);</span><br><span class="line">		put_task_struct(task);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * resched_curr - mark rq's current task 'to be rescheduled now'.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * On UP this means the setting of the need_resched flag, on SMP it</span></span><br><span class="line"><span class="comment"> * might also involve a cross-CPU call to trigger the scheduler on</span></span><br><span class="line"><span class="comment"> * the target CPU.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resched_curr</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">curr</span> = <span class="title">rq</span>-&gt;<span class="title">curr</span>;</span></span><br><span class="line">	<span class="keyword">int</span> cpu;</span><br><span class="line"></span><br><span class="line">	lockdep_assert_held(&amp;rq-&gt;lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (test_tsk_need_resched(curr))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	cpu = cpu_of(rq);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cpu == smp_processor_id()) &#123;</span><br><span class="line">		set_tsk_need_resched(curr);</span><br><span class="line">		set_preempt_need_resched();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (set_nr_and_not_polling(curr))</span><br><span class="line">		smp_send_reschedule(cpu);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		trace_sched_wake_idle_without_ipi(cpu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resched_cpu</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;rq-&gt;lock, flags);</span><br><span class="line">	<span class="keyword">if</span> (cpu_online(cpu) || cpu == smp_processor_id())</span><br><span class="line">		resched_curr(rq);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;rq-&gt;lock, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NO_HZ_COMMON</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * In the semi idle case, use the nearest busy CPU for migrating timers</span></span><br><span class="line"><span class="comment"> * from an idle CPU.  This is good for power-savings.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * We don't do similar optimization for completely idle system, as</span></span><br><span class="line"><span class="comment"> * selecting an idle CPU will add more delays to the timers than intended</span></span><br><span class="line"><span class="comment"> * (as that CPU's timer base may not be uptodate wrt jiffies etc).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_nohz_timer_target</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, cpu = smp_processor_id(), default_cpu = <span class="number">-1</span>;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_domain</span> *<span class="title">sd</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (housekeeping_cpu(cpu, HK_FLAG_TIMER)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!idle_cpu(cpu))</span><br><span class="line">			<span class="keyword">return</span> cpu;</span><br><span class="line">		default_cpu = cpu;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	for_each_domain(cpu, sd) &#123;</span><br><span class="line">		for_each_cpu_and(i, sched_domain_span(sd),</span><br><span class="line">			housekeeping_cpumask(HK_FLAG_TIMER)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (cpu == i)</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (!idle_cpu(i)) &#123;</span><br><span class="line">				cpu = i;</span><br><span class="line">				<span class="keyword">goto</span> unlock;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (default_cpu == <span class="number">-1</span>)</span><br><span class="line">		default_cpu = housekeeping_any_cpu(HK_FLAG_TIMER);</span><br><span class="line">	cpu = default_cpu;</span><br><span class="line">unlock:</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	<span class="keyword">return</span> cpu;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * When add_timer_on() enqueues a timer into the timer wheel of an</span></span><br><span class="line"><span class="comment"> * idle CPU then this timer might expire before the next timer event</span></span><br><span class="line"><span class="comment"> * which is scheduled to wake up that CPU. In case of a completely</span></span><br><span class="line"><span class="comment"> * idle system the next event might even be infinite time into the</span></span><br><span class="line"><span class="comment"> * future. wake_up_idle_cpu() ensures that the CPU is woken up and</span></span><br><span class="line"><span class="comment"> * leaves the inner idle loop so the newly added timer is taken into</span></span><br><span class="line"><span class="comment"> * account when the CPU goes back to idle and evaluates the timer</span></span><br><span class="line"><span class="comment"> * wheel for the next timer event.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wake_up_idle_cpu</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cpu == smp_processor_id())</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (set_nr_and_not_polling(rq-&gt;idle))</span><br><span class="line">		smp_send_reschedule(cpu);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		trace_sched_wake_idle_without_ipi(cpu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">wake_up_full_nohz_cpu</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We just need the target to call irq_exit() and re-evaluate</span></span><br><span class="line"><span class="comment">	 * the next tick. The nohz full kick at least implies that.</span></span><br><span class="line"><span class="comment">	 * If needed we can still optimize that later with an</span></span><br><span class="line"><span class="comment">	 * empty IRQ.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (cpu_is_offline(cpu))</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">/* Don't try to wake offline CPUs. */</span></span><br><span class="line">	<span class="keyword">if</span> (tick_nohz_full_cpu(cpu)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (cpu != smp_processor_id() ||</span><br><span class="line">		    tick_nohz_tick_stopped())</span><br><span class="line">			tick_nohz_full_kick_cpu(cpu);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Wake up the specified CPU.  If the CPU is going offline, it is the</span></span><br><span class="line"><span class="comment"> * caller's responsibility to deal with the lost wakeup, for example,</span></span><br><span class="line"><span class="comment"> * by hooking into the CPU_DEAD notifier like timers and hrtimers do.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wake_up_nohz_cpu</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!wake_up_full_nohz_cpu(cpu))</span><br><span class="line">		wake_up_idle_cpu(cpu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">nohz_csd_func</span><span class="params">(<span class="keyword">void</span> *info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">info</span>;</span></span><br><span class="line">	<span class="keyword">int</span> cpu = cpu_of(rq);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> flags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Release the rq::nohz_csd.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	flags = atomic_fetch_andnot(NOHZ_KICK_MASK, nohz_flags(cpu));</span><br><span class="line">	WARN_ON(!(flags &amp; NOHZ_KICK_MASK));</span><br><span class="line"></span><br><span class="line">	rq-&gt;idle_balance = idle_cpu(cpu);</span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;idle_balance &amp;&amp; !need_resched()) &#123;</span><br><span class="line">		rq-&gt;nohz_idle_balance = flags;</span><br><span class="line">		raise_softirq_irqoff(SCHED_SOFTIRQ);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_NO_HZ_COMMON */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NO_HZ_FULL</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sched_can_stop_tick</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> fifo_nr_running;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Deadline tasks, even if single, need the tick */</span></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;dl.dl_nr_running)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If there are more than one RR tasks, we need the tick to effect the</span></span><br><span class="line"><span class="comment">	 * actual RR behaviour.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;rt.rr_nr_running) &#123;</span><br><span class="line">		<span class="keyword">if</span> (rq-&gt;rt.rr_nr_running == <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If there's no RR tasks, but FIFO tasks, we can skip the tick, no</span></span><br><span class="line"><span class="comment">	 * forced preemption between FIFO tasks.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	fifo_nr_running = rq-&gt;rt.rt_nr_running - rq-&gt;rt.rr_nr_running;</span><br><span class="line">	<span class="keyword">if</span> (fifo_nr_running)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If there are no DL,RR/FIFO tasks, there must only be CFS tasks left;</span></span><br><span class="line"><span class="comment">	 * if there's more than one we need the tick for involuntary</span></span><br><span class="line"><span class="comment">	 * preemption.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;nr_running &gt; <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_NO_HZ_FULL */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SMP */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_RT_GROUP_SCHED) || (defined(CONFIG_FAIR_GROUP_SCHED) &amp;&amp; \</span></span><br><span class="line">			(defined(CONFIG_SMP) || defined(CONFIG_CFS_BANDWIDTH)))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Iterate task_group tree rooted at *from, calling @down when first entering a</span></span><br><span class="line"><span class="comment"> * node and @up when leaving it for the final time.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Caller must hold rcu_lock or sufficient equivalent.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">walk_tg_tree_from</span><span class="params">(struct task_group *from,</span></span></span><br><span class="line"><span class="function"><span class="params">			     tg_visitor down, tg_visitor up, <span class="keyword">void</span> *data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">parent</span>, *<span class="title">child</span>;</span></span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line"></span><br><span class="line">	parent = from;</span><br><span class="line"></span><br><span class="line">down:</span><br><span class="line">	ret = (*down)(parent, data);</span><br><span class="line">	<span class="keyword">if</span> (ret)</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line">	list_for_each_entry_rcu(child, &amp;parent-&gt;children, siblings) &#123;</span><br><span class="line">		parent = child;</span><br><span class="line">		<span class="keyword">goto</span> down;</span><br><span class="line"></span><br><span class="line">up:</span><br><span class="line">		<span class="keyword">continue</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ret = (*up)(parent, data);</span><br><span class="line">	<span class="keyword">if</span> (ret || parent == from)</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	child = parent;</span><br><span class="line">	parent = parent-&gt;parent;</span><br><span class="line">	<span class="keyword">if</span> (parent)</span><br><span class="line">		<span class="keyword">goto</span> up;</span><br><span class="line">out:</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tg_nop</span><span class="params">(struct task_group *tg, <span class="keyword">void</span> *data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">set_load_weight</span><span class="params">(struct task_struct *p, <span class="keyword">bool</span> update_load)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> prio = p-&gt;static_prio - MAX_RT_PRIO;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">load_weight</span> *<span class="title">load</span> = &amp;<span class="title">p</span>-&gt;<span class="title">se</span>.<span class="title">load</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * SCHED_IDLE tasks get minimal weight:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (task_has_idle_policy(p)) &#123;</span><br><span class="line">		load-&gt;weight = scale_load(WEIGHT_IDLEPRIO);</span><br><span class="line">		load-&gt;inv_weight = WMULT_IDLEPRIO;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * SCHED_OTHER tasks have to update their load when changing their</span></span><br><span class="line"><span class="comment">	 * weight</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (update_load &amp;&amp; p-&gt;sched_class == &amp;fair_sched_class) &#123;</span><br><span class="line">		reweight_task(p, prio);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		load-&gt;weight = scale_load(sched_prio_to_weight[prio]);</span><br><span class="line">		load-&gt;inv_weight = sched_prio_to_wmult[prio];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_UCLAMP_TASK</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Serializes updates of utilization clamp values</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The (slow-path) user-space triggers utilization clamp value updates which</span></span><br><span class="line"><span class="comment"> * can require updates on (fast-path) scheduler's data structures used to</span></span><br><span class="line"><span class="comment"> * support enqueue/dequeue operations.</span></span><br><span class="line"><span class="comment"> * While the per-CPU rq lock protects fast-path update operations, user-space</span></span><br><span class="line"><span class="comment"> * requests are serialized using a mutex to reduce the risk of conflicting</span></span><br><span class="line"><span class="comment"> * updates or API abuses.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">DEFINE_MUTEX</span><span class="params">(uclamp_mutex)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Max allowed minimum utilization */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> sysctl_sched_uclamp_util_min = SCHED_CAPACITY_SCALE;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Max allowed maximum utilization */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> sysctl_sched_uclamp_util_max = SCHED_CAPACITY_SCALE;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* All clamps are required to be less or equal than these values */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> <span class="title">uclamp_default</span>[<span class="title">UCLAMP_CNT</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Integer rounded range for each bucket */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UCLAMP_BUCKET_DELTA DIV_ROUND_CLOSEST(SCHED_CAPACITY_SCALE, UCLAMP_BUCKETS)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> for_each_clamp_id(clamp_id) \</span></span><br><span class="line">	<span class="keyword">for</span> ((clamp_id) = <span class="number">0</span>; (clamp_id) &lt; UCLAMP_CNT; (clamp_id)++)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">uclamp_bucket_id</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> clamp_value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> clamp_value / UCLAMP_BUCKET_DELTA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">uclamp_bucket_base_value</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> clamp_value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> UCLAMP_BUCKET_DELTA * uclamp_bucket_id(clamp_value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">uclamp_none</span><span class="params">(<span class="keyword">enum</span> uclamp_id clamp_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (clamp_id == UCLAMP_MIN)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> SCHED_CAPACITY_SCALE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_se_set</span><span class="params">(struct uclamp_se *uc_se,</span></span></span><br><span class="line"><span class="function"><span class="params">				 <span class="keyword">unsigned</span> <span class="keyword">int</span> value, <span class="keyword">bool</span> user_defined)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	uc_se-&gt;value = value;</span><br><span class="line">	uc_se-&gt;bucket_id = uclamp_bucket_id(value);</span><br><span class="line">	uc_se-&gt;user_defined = user_defined;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">unsigned</span> <span class="keyword">int</span></span><br><span class="line">uclamp_idle_value(struct rq *rq, <span class="keyword">enum</span> uclamp_id clamp_id,</span><br><span class="line">		  <span class="keyword">unsigned</span> <span class="keyword">int</span> clamp_value)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Avoid blocked utilization pushing up the frequency when we go</span></span><br><span class="line"><span class="comment">	 * idle (which drops the max-clamp) by retaining the last known</span></span><br><span class="line"><span class="comment">	 * max-clamp.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (clamp_id == UCLAMP_MAX) &#123;</span><br><span class="line">		rq-&gt;uclamp_flags |= UCLAMP_FLAG_IDLE;</span><br><span class="line">		<span class="keyword">return</span> clamp_value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> uclamp_none(UCLAMP_MIN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_idle_reset</span><span class="params">(struct rq *rq, <span class="keyword">enum</span> uclamp_id clamp_id,</span></span></span><br><span class="line"><span class="function"><span class="params">				     <span class="keyword">unsigned</span> <span class="keyword">int</span> clamp_value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* Reset max-clamp retention only on idle exit */</span></span><br><span class="line">	<span class="keyword">if</span> (!(rq-&gt;uclamp_flags &amp; UCLAMP_FLAG_IDLE))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	WRITE_ONCE(rq-&gt;uclamp[clamp_id].value, clamp_value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">uclamp_rq_max_value</span><span class="params">(struct rq *rq, <span class="keyword">enum</span> uclamp_id clamp_id,</span></span></span><br><span class="line"><span class="function"><span class="params">				   <span class="keyword">unsigned</span> <span class="keyword">int</span> clamp_value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_bucket</span> *<span class="title">bucket</span> = <span class="title">rq</span>-&gt;<span class="title">uclamp</span>[<span class="title">clamp_id</span>].<span class="title">bucket</span>;</span></span><br><span class="line">	<span class="keyword">int</span> bucket_id = UCLAMP_BUCKETS - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Since both min and max clamps are max aggregated, find the</span></span><br><span class="line"><span class="comment">	 * top most bucket with tasks in.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">for</span> ( ; bucket_id &gt;= <span class="number">0</span>; bucket_id--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!bucket[bucket_id].tasks)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">return</span> bucket[bucket_id].value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* No tasks -- default clamp values */</span></span><br><span class="line">	<span class="keyword">return</span> uclamp_idle_value(rq, clamp_id, clamp_value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span></span></span><br><span class="line"><span class="class"><span class="title">uclamp_tg_restrict</span>(<span class="title">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>, <span class="title">enum</span> <span class="title">uclamp_id</span> <span class="title">clamp_id</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> <span class="title">uc_req</span> = <span class="title">p</span>-&gt;<span class="title">uclamp_req</span>[<span class="title">clamp_id</span>];</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_UCLAMP_TASK_GROUP</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> <span class="title">uc_max</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Tasks in autogroups or root task group will be</span></span><br><span class="line"><span class="comment">	 * restricted by system defaults.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (task_group_is_autogroup(task_group(p)))</span><br><span class="line">		<span class="keyword">return</span> uc_req;</span><br><span class="line">	<span class="keyword">if</span> (task_group(p) == &amp;root_task_group)</span><br><span class="line">		<span class="keyword">return</span> uc_req;</span><br><span class="line"></span><br><span class="line">	uc_max = task_group(p)-&gt;uclamp[clamp_id];</span><br><span class="line">	<span class="keyword">if</span> (uc_req.value &gt; uc_max.value || !uc_req.user_defined)</span><br><span class="line">		<span class="keyword">return</span> uc_max;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> uc_req;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The effective clamp bucket index of a task depends on, by increasing</span></span><br><span class="line"><span class="comment"> * priority:</span></span><br><span class="line"><span class="comment"> * - the task specific clamp value, when explicitly requested from userspace</span></span><br><span class="line"><span class="comment"> * - the task group effective clamp value, for tasks not either in the root</span></span><br><span class="line"><span class="comment"> *   group or in an autogroup</span></span><br><span class="line"><span class="comment"> * - the system default clamp value, defined by the sysadmin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span></span></span><br><span class="line"><span class="class"><span class="title">uclamp_eff_get</span>(<span class="title">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>, <span class="title">enum</span> <span class="title">uclamp_id</span> <span class="title">clamp_id</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> <span class="title">uc_req</span> = <span class="title">uclamp_tg_restrict</span>(<span class="title">p</span>, <span class="title">clamp_id</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> <span class="title">uc_max</span> = <span class="title">uclamp_default</span>[<span class="title">clamp_id</span>];</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* System default restrictions always apply */</span></span><br><span class="line">	<span class="keyword">if</span> (unlikely(uc_req.value &gt; uc_max.value))</span><br><span class="line">		<span class="keyword">return</span> uc_max;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> uc_req;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">uclamp_eff_value</span><span class="params">(struct task_struct *p, <span class="keyword">enum</span> uclamp_id clamp_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> <span class="title">uc_eff</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Task currently refcounted: use back-annotated (effective) value */</span></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;uclamp[clamp_id].active)</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">long</span>)p-&gt;uclamp[clamp_id].value;</span><br><span class="line"></span><br><span class="line">	uc_eff = uclamp_eff_get(p, clamp_id);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">long</span>)uc_eff.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * When a task is enqueued on a rq, the clamp bucket currently defined by the</span></span><br><span class="line"><span class="comment"> * task's uclamp::bucket_id is refcounted on that rq. This also immediately</span></span><br><span class="line"><span class="comment"> * updates the rq's clamp value if required.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Tasks can have a task-specific value requested from user-space, track</span></span><br><span class="line"><span class="comment"> * within each bucket the maximum value for tasks refcounted in it.</span></span><br><span class="line"><span class="comment"> * This "local max aggregation" allows to track the exact "requested" value</span></span><br><span class="line"><span class="comment"> * for each bucket when all its RUNNABLE tasks require the same clamp.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_rq_inc_id</span><span class="params">(struct rq *rq, struct task_struct *p,</span></span></span><br><span class="line"><span class="function"><span class="params">				    <span class="keyword">enum</span> uclamp_id clamp_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_rq</span> *<span class="title">uc_rq</span> = &amp;<span class="title">rq</span>-&gt;<span class="title">uclamp</span>[<span class="title">clamp_id</span>];</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> *<span class="title">uc_se</span> = &amp;<span class="title">p</span>-&gt;<span class="title">uclamp</span>[<span class="title">clamp_id</span>];</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_bucket</span> *<span class="title">bucket</span>;</span></span><br><span class="line"></span><br><span class="line">	lockdep_assert_held(&amp;rq-&gt;lock);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Update task effective clamp */</span></span><br><span class="line">	p-&gt;uclamp[clamp_id] = uclamp_eff_get(p, clamp_id);</span><br><span class="line"></span><br><span class="line">	bucket = &amp;uc_rq-&gt;bucket[uc_se-&gt;bucket_id];</span><br><span class="line">	bucket-&gt;tasks++;</span><br><span class="line">	uc_se-&gt;active = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	uclamp_idle_reset(rq, clamp_id, uc_se-&gt;value);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Local max aggregation: rq buckets always track the max</span></span><br><span class="line"><span class="comment">	 * "requested" clamp value of its RUNNABLE tasks.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (bucket-&gt;tasks == <span class="number">1</span> || uc_se-&gt;value &gt; bucket-&gt;value)</span><br><span class="line">		bucket-&gt;value = uc_se-&gt;value;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (uc_se-&gt;value &gt; READ_ONCE(uc_rq-&gt;value))</span><br><span class="line">		WRITE_ONCE(uc_rq-&gt;value, uc_se-&gt;value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * When a task is dequeued from a rq, the clamp bucket refcounted by the task</span></span><br><span class="line"><span class="comment"> * is released. If this is the last task reference counting the rq's max</span></span><br><span class="line"><span class="comment"> * active clamp value, then the rq's clamp value is updated.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Both refcounted tasks and rq's cached clamp values are expected to be</span></span><br><span class="line"><span class="comment"> * always valid. If it's detected they are not, as defensive programming,</span></span><br><span class="line"><span class="comment"> * enforce the expected state and warn.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_rq_dec_id</span><span class="params">(struct rq *rq, struct task_struct *p,</span></span></span><br><span class="line"><span class="function"><span class="params">				    <span class="keyword">enum</span> uclamp_id clamp_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_rq</span> *<span class="title">uc_rq</span> = &amp;<span class="title">rq</span>-&gt;<span class="title">uclamp</span>[<span class="title">clamp_id</span>];</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> *<span class="title">uc_se</span> = &amp;<span class="title">p</span>-&gt;<span class="title">uclamp</span>[<span class="title">clamp_id</span>];</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_bucket</span> *<span class="title">bucket</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> bkt_clamp;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> rq_clamp;</span><br><span class="line"></span><br><span class="line">	lockdep_assert_held(&amp;rq-&gt;lock);</span><br><span class="line"></span><br><span class="line">	bucket = &amp;uc_rq-&gt;bucket[uc_se-&gt;bucket_id];</span><br><span class="line">	SCHED_WARN_ON(!bucket-&gt;tasks);</span><br><span class="line">	<span class="keyword">if</span> (likely(bucket-&gt;tasks))</span><br><span class="line">		bucket-&gt;tasks--;</span><br><span class="line">	uc_se-&gt;active = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Keep "local max aggregation" simple and accept to (possibly)</span></span><br><span class="line"><span class="comment">	 * overboost some RUNNABLE tasks in the same bucket.</span></span><br><span class="line"><span class="comment">	 * The rq clamp bucket value is reset to its base value whenever</span></span><br><span class="line"><span class="comment">	 * there are no more RUNNABLE tasks refcounting it.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (likely(bucket-&gt;tasks))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	rq_clamp = READ_ONCE(uc_rq-&gt;value);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Defensive programming: this should never happen. If it happens,</span></span><br><span class="line"><span class="comment">	 * e.g. due to future modification, warn and fixup the expected value.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	SCHED_WARN_ON(bucket-&gt;value &gt; rq_clamp);</span><br><span class="line">	<span class="keyword">if</span> (bucket-&gt;value &gt;= rq_clamp) &#123;</span><br><span class="line">		bkt_clamp = uclamp_rq_max_value(rq, clamp_id, uc_se-&gt;value);</span><br><span class="line">		WRITE_ONCE(uc_rq-&gt;value, bkt_clamp);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_rq_inc</span><span class="params">(struct rq *rq, struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">enum</span> uclamp_id clamp_id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (unlikely(!p-&gt;sched_class-&gt;uclamp_enabled))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	for_each_clamp_id(clamp_id)</span><br><span class="line">		uclamp_rq_inc_id(rq, p, clamp_id);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Reset clamp idle holding when there is one RUNNABLE task */</span></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;uclamp_flags &amp; UCLAMP_FLAG_IDLE)</span><br><span class="line">		rq-&gt;uclamp_flags &amp;= ~UCLAMP_FLAG_IDLE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_rq_dec</span><span class="params">(struct rq *rq, struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">enum</span> uclamp_id clamp_id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (unlikely(!p-&gt;sched_class-&gt;uclamp_enabled))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	for_each_clamp_id(clamp_id)</span><br><span class="line">		uclamp_rq_dec_id(rq, p, clamp_id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">uclamp_update_active(struct task_struct *p, <span class="keyword">enum</span> uclamp_id clamp_id)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Lock the task and the rq where the task is (or was) queued.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * We might lock the (previous) rq of a !RUNNABLE task, but that's the</span></span><br><span class="line"><span class="comment">	 * price to pay to safely serialize util_&#123;min,max&#125; updates with</span></span><br><span class="line"><span class="comment">	 * enqueues, dequeues and migration operations.</span></span><br><span class="line"><span class="comment">	 * This is the same locking schema used by __set_cpus_allowed_ptr().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rq = task_rq_lock(p, &amp;rf);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Setting the clamp bucket is serialized by task_rq_lock().</span></span><br><span class="line"><span class="comment">	 * If the task is not yet RUNNABLE and its task_struct is not</span></span><br><span class="line"><span class="comment">	 * affecting a valid clamp bucket, the next time it's enqueued,</span></span><br><span class="line"><span class="comment">	 * it will already see the updated clamp bucket value.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;uclamp[clamp_id].active) &#123;</span><br><span class="line">		uclamp_rq_dec_id(rq, p, clamp_id);</span><br><span class="line">		uclamp_rq_inc_id(rq, p, clamp_id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_UCLAMP_TASK_GROUP</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">uclamp_update_active_tasks(struct cgroup_subsys_state *css,</span><br><span class="line">			   <span class="keyword">unsigned</span> <span class="keyword">int</span> clamps)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">enum</span> uclamp_id clamp_id;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">css_task_iter</span> <span class="title">it</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line"></span><br><span class="line">	css_task_iter_start(css, <span class="number">0</span>, &amp;it);</span><br><span class="line">	<span class="keyword">while</span> ((p = css_task_iter_next(&amp;it))) &#123;</span><br><span class="line">		for_each_clamp_id(clamp_id) &#123;</span><br><span class="line">			<span class="keyword">if</span> ((<span class="number">0x1</span> &lt;&lt; clamp_id) &amp; clamps)</span><br><span class="line">				uclamp_update_active(p, clamp_id);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	css_task_iter_end(&amp;it);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cpu_util_update_eff</span><span class="params">(struct cgroup_subsys_state *css)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">uclamp_update_root_tg</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = &amp;<span class="title">root_task_group</span>;</span></span><br><span class="line"></span><br><span class="line">	uclamp_se_set(&amp;tg-&gt;uclamp_req[UCLAMP_MIN],</span><br><span class="line">		      sysctl_sched_uclamp_util_min, <span class="literal">false</span>);</span><br><span class="line">	uclamp_se_set(&amp;tg-&gt;uclamp_req[UCLAMP_MAX],</span><br><span class="line">		      sysctl_sched_uclamp_util_max, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	cpu_util_update_eff(&amp;root_task_group.css);</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">uclamp_update_root_tg</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123; &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sysctl_sched_uclamp_handler</span><span class="params">(struct ctl_table *table, <span class="keyword">int</span> write,</span></span></span><br><span class="line"><span class="function"><span class="params">				<span class="keyword">void</span> *buffer, <span class="keyword">size_t</span> *lenp, <span class="keyword">loff_t</span> *ppos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> update_root_tg = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">int</span> old_min, old_max;</span><br><span class="line">	<span class="keyword">int</span> result;</span><br><span class="line"></span><br><span class="line">	mutex_lock(&amp;uclamp_mutex);</span><br><span class="line">	old_min = sysctl_sched_uclamp_util_min;</span><br><span class="line">	old_max = sysctl_sched_uclamp_util_max;</span><br><span class="line"></span><br><span class="line">	result = proc_dointvec(table, write, buffer, lenp, ppos);</span><br><span class="line">	<span class="keyword">if</span> (result)</span><br><span class="line">		<span class="keyword">goto</span> undo;</span><br><span class="line">	<span class="keyword">if</span> (!write)</span><br><span class="line">		<span class="keyword">goto</span> done;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (sysctl_sched_uclamp_util_min &gt; sysctl_sched_uclamp_util_max ||</span><br><span class="line">	    sysctl_sched_uclamp_util_max &gt; SCHED_CAPACITY_SCALE) &#123;</span><br><span class="line">		result = -EINVAL;</span><br><span class="line">		<span class="keyword">goto</span> undo;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (old_min != sysctl_sched_uclamp_util_min) &#123;</span><br><span class="line">		uclamp_se_set(&amp;uclamp_default[UCLAMP_MIN],</span><br><span class="line">			      sysctl_sched_uclamp_util_min, <span class="literal">false</span>);</span><br><span class="line">		update_root_tg = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (old_max != sysctl_sched_uclamp_util_max) &#123;</span><br><span class="line">		uclamp_se_set(&amp;uclamp_default[UCLAMP_MAX],</span><br><span class="line">			      sysctl_sched_uclamp_util_max, <span class="literal">false</span>);</span><br><span class="line">		update_root_tg = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (update_root_tg)</span><br><span class="line">		uclamp_update_root_tg();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We update all RUNNABLE tasks only when task groups are in use.</span></span><br><span class="line"><span class="comment">	 * Otherwise, keep it simple and do just a lazy update at each next</span></span><br><span class="line"><span class="comment">	 * task enqueue time.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">goto</span> done;</span><br><span class="line"></span><br><span class="line">undo:</span><br><span class="line">	sysctl_sched_uclamp_util_min = old_min;</span><br><span class="line">	sysctl_sched_uclamp_util_max = old_max;</span><br><span class="line">done:</span><br><span class="line">	mutex_unlock(&amp;uclamp_mutex);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">uclamp_validate</span><span class="params">(struct task_struct *p,</span></span></span><br><span class="line"><span class="function"><span class="params">			   <span class="keyword">const</span> struct sched_attr *attr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> lower_bound = p-&gt;uclamp_req[UCLAMP_MIN].value;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> upper_bound = p-&gt;uclamp_req[UCLAMP_MAX].value;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (attr-&gt;sched_flags &amp; SCHED_FLAG_UTIL_CLAMP_MIN)</span><br><span class="line">		lower_bound = attr-&gt;sched_util_min;</span><br><span class="line">	<span class="keyword">if</span> (attr-&gt;sched_flags &amp; SCHED_FLAG_UTIL_CLAMP_MAX)</span><br><span class="line">		upper_bound = attr-&gt;sched_util_max;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (lower_bound &gt; upper_bound)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (upper_bound &gt; SCHED_CAPACITY_SCALE)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __setscheduler_uclamp(struct task_struct *p,</span><br><span class="line">				  <span class="keyword">const</span> struct sched_attr *attr)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">enum</span> uclamp_id clamp_id;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * On scheduling class change, reset to default clamps for tasks</span></span><br><span class="line"><span class="comment">	 * without a task-specific value.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	for_each_clamp_id(clamp_id) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> *<span class="title">uc_se</span> = &amp;<span class="title">p</span>-&gt;<span class="title">uclamp_req</span>[<span class="title">clamp_id</span>];</span></span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">int</span> clamp_value = uclamp_none(clamp_id);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Keep using defined clamps across class changes */</span></span><br><span class="line">		<span class="keyword">if</span> (uc_se-&gt;user_defined)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* By default, RT tasks always get 100% boost */</span></span><br><span class="line">		<span class="keyword">if</span> (unlikely(rt_task(p) &amp;&amp; clamp_id == UCLAMP_MIN))</span><br><span class="line">			clamp_value = uclamp_none(UCLAMP_MAX);</span><br><span class="line"></span><br><span class="line">		uclamp_se_set(uc_se, clamp_value, <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (likely(!(attr-&gt;sched_flags &amp; SCHED_FLAG_UTIL_CLAMP)))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (attr-&gt;sched_flags &amp; SCHED_FLAG_UTIL_CLAMP_MIN) &#123;</span><br><span class="line">		uclamp_se_set(&amp;p-&gt;uclamp_req[UCLAMP_MIN],</span><br><span class="line">			      attr-&gt;sched_util_min, <span class="literal">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (attr-&gt;sched_flags &amp; SCHED_FLAG_UTIL_CLAMP_MAX) &#123;</span><br><span class="line">		uclamp_se_set(&amp;p-&gt;uclamp_req[UCLAMP_MAX],</span><br><span class="line">			      attr-&gt;sched_util_max, <span class="literal">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">uclamp_fork</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">enum</span> uclamp_id clamp_id;</span><br><span class="line"></span><br><span class="line">	for_each_clamp_id(clamp_id)</span><br><span class="line">		p-&gt;uclamp[clamp_id].active = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (likely(!p-&gt;sched_reset_on_fork))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	for_each_clamp_id(clamp_id) &#123;</span><br><span class="line">		uclamp_se_set(&amp;p-&gt;uclamp_req[clamp_id],</span><br><span class="line">			      uclamp_none(clamp_id), <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> __init <span class="title">init_uclamp</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> <span class="title">uc_max</span> = &#123;</span>&#125;;</span><br><span class="line">	<span class="keyword">enum</span> uclamp_id clamp_id;</span><br><span class="line">	<span class="keyword">int</span> cpu;</span><br><span class="line"></span><br><span class="line">	mutex_init(&amp;uclamp_mutex);</span><br><span class="line"></span><br><span class="line">	for_each_possible_cpu(cpu) &#123;</span><br><span class="line">		<span class="built_in">memset</span>(&amp;cpu_rq(cpu)-&gt;uclamp, <span class="number">0</span>,</span><br><span class="line">				<span class="keyword">sizeof</span>(struct uclamp_rq)*UCLAMP_CNT);</span><br><span class="line">		cpu_rq(cpu)-&gt;uclamp_flags = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	for_each_clamp_id(clamp_id) &#123;</span><br><span class="line">		uclamp_se_set(&amp;init_task.uclamp_req[clamp_id],</span><br><span class="line">			      uclamp_none(clamp_id), <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* System defaults allow max clamp values for both indexes */</span></span><br><span class="line">	uclamp_se_set(&amp;uc_max, uclamp_none(UCLAMP_MAX), <span class="literal">false</span>);</span><br><span class="line">	for_each_clamp_id(clamp_id) &#123;</span><br><span class="line">		uclamp_default[clamp_id] = uc_max;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_UCLAMP_TASK_GROUP</span></span><br><span class="line">		root_task_group.uclamp_req[clamp_id] = uc_max;</span><br><span class="line">		root_task_group.uclamp[clamp_id] = uc_max;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> <span class="comment">/* CONFIG_UCLAMP_TASK */</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_rq_inc</span><span class="params">(struct rq *rq, struct task_struct *p)</span> </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_rq_dec</span><span class="params">(struct rq *rq, struct task_struct *p)</span> </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">uclamp_validate</span><span class="params">(struct task_struct *p,</span></span></span><br><span class="line"><span class="function"><span class="params">				  <span class="keyword">const</span> struct sched_attr *attr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> -EOPNOTSUPP;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __setscheduler_uclamp(struct task_struct *p,</span><br><span class="line">				  <span class="keyword">const</span> struct sched_attr *attr) &#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">uclamp_fork</span><span class="params">(struct task_struct *p)</span> </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init_uclamp</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123; &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_UCLAMP_TASK */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">enqueue_task</span><span class="params">(struct rq *rq, struct task_struct *p, <span class="keyword">int</span> flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!(flags &amp; ENQUEUE_NOCLOCK))</span><br><span class="line">		update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!(flags &amp; ENQUEUE_RESTORE)) &#123;</span><br><span class="line">		sched_info_queued(rq, p);</span><br><span class="line">		psi_enqueue(p, flags &amp; ENQUEUE_WAKEUP);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	uclamp_rq_inc(rq, p);</span><br><span class="line">	p-&gt;sched_class-&gt;enqueue_task(rq, p, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dequeue_task</span><span class="params">(struct rq *rq, struct task_struct *p, <span class="keyword">int</span> flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!(flags &amp; DEQUEUE_NOCLOCK))</span><br><span class="line">		update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!(flags &amp; DEQUEUE_SAVE)) &#123;</span><br><span class="line">		sched_info_dequeued(rq, p);</span><br><span class="line">		psi_dequeue(p, flags &amp; DEQUEUE_SLEEP);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	uclamp_rq_dec(rq, p);</span><br><span class="line">	p-&gt;sched_class-&gt;dequeue_task(rq, p, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">activate_task</span><span class="params">(struct rq *rq, struct task_struct *p, <span class="keyword">int</span> flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	enqueue_task(rq, p, flags);</span><br><span class="line"></span><br><span class="line">	p-&gt;on_rq = TASK_ON_RQ_QUEUED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deactivate_task</span><span class="params">(struct rq *rq, struct task_struct *p, <span class="keyword">int</span> flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	p-&gt;on_rq = (flags &amp; DEQUEUE_SLEEP) ? <span class="number">0</span> : TASK_ON_RQ_MIGRATING;</span><br><span class="line"></span><br><span class="line">	dequeue_task(rq, p, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * __normal_prio - return the priority that is based on the static prio</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> __normal_prio(struct task_struct *p)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> p-&gt;static_prio;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Calculate the expected normal priority: i.e. priority</span></span><br><span class="line"><span class="comment"> * without taking RT-inheritance into account. Might be</span></span><br><span class="line"><span class="comment"> * boosted by interactivity modifiers. Changes upon fork,</span></span><br><span class="line"><span class="comment"> * setprio syscalls, and whenever the interactivity</span></span><br><span class="line"><span class="comment"> * estimator recalculates.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">normal_prio</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> prio;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_has_dl_policy(p))</span><br><span class="line">		prio = MAX_DL_PRIO<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (task_has_rt_policy(p))</span><br><span class="line">		prio = MAX_RT_PRIO<span class="number">-1</span> - p-&gt;rt_priority;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		prio = __normal_prio(p);</span><br><span class="line">	<span class="keyword">return</span> prio;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Calculate the current priority, i.e. the priority</span></span><br><span class="line"><span class="comment"> * taken into account by the scheduler. This value might</span></span><br><span class="line"><span class="comment"> * be boosted by RT tasks, or might be boosted by</span></span><br><span class="line"><span class="comment"> * interactivity modifiers. Will be RT if the task got</span></span><br><span class="line"><span class="comment"> * RT-boosted. If not then it returns p-&gt;normal_prio.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">effective_prio</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	p-&gt;normal_prio = normal_prio(p);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If we are RT tasks or we were boosted to RT priority,</span></span><br><span class="line"><span class="comment">	 * keep the priority unchanged. Otherwise, update priority</span></span><br><span class="line"><span class="comment">	 * to the normal priority:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!rt_prio(p-&gt;prio))</span><br><span class="line">		<span class="keyword">return</span> p-&gt;normal_prio;</span><br><span class="line">	<span class="keyword">return</span> p-&gt;prio;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * task_curr - is this task currently executing on a CPU?</span></span><br><span class="line"><span class="comment"> * @p: the task in question.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 1 if the task is currently executing. 0 otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">task_curr</span><span class="params">(<span class="keyword">const</span> struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> cpu_curr(task_cpu(p)) == p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * switched_from, switched_to and prio_changed must _NOT_ drop rq-&gt;lock,</span></span><br><span class="line"><span class="comment"> * use the balance_callback list if you want balancing.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * this means any call to check_class_changed() must be followed by a call to</span></span><br><span class="line"><span class="comment"> * balance_callback().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">check_class_changed</span><span class="params">(struct rq *rq, struct task_struct *p,</span></span></span><br><span class="line"><span class="function"><span class="params">				       <span class="keyword">const</span> struct sched_class *prev_class,</span></span></span><br><span class="line"><span class="function"><span class="params">				       <span class="keyword">int</span> oldprio)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (prev_class != p-&gt;sched_class) &#123;</span><br><span class="line">		<span class="keyword">if</span> (prev_class-&gt;switched_from)</span><br><span class="line">			prev_class-&gt;switched_from(rq, p);</span><br><span class="line"></span><br><span class="line">		p-&gt;sched_class-&gt;switched_to(rq, p);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldprio != p-&gt;prio || dl_task(p))</span><br><span class="line">		p-&gt;sched_class-&gt;prio_changed(rq, p, oldprio);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">check_preempt_curr</span><span class="params">(struct rq *rq, struct task_struct *p, <span class="keyword">int</span> flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sched_class</span> *<span class="title">class</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;sched_class == rq-&gt;curr-&gt;sched_class) &#123;</span><br><span class="line">		rq-&gt;curr-&gt;sched_class-&gt;check_preempt_curr(rq, p, flags);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		for_each_class(class) &#123;</span><br><span class="line">			<span class="keyword">if</span> (class == rq-&gt;curr-&gt;sched_class)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">if</span> (class == p-&gt;sched_class) &#123;</span><br><span class="line">				resched_curr(rq);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * A queue event has occurred, and we're going to schedule.  In</span></span><br><span class="line"><span class="comment">	 * this case, we can save a useless back to back clock update.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (task_on_rq_queued(rq-&gt;curr) &amp;&amp; test_tsk_need_resched(rq-&gt;curr))</span><br><span class="line">		rq_clock_skip_update(rq);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Per-CPU kthreads are allowed to run on !active &amp;&amp; online CPUs, see</span></span><br><span class="line"><span class="comment"> * __set_cpus_allowed_ptr() and select_fallback_rq().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">is_cpu_allowed</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!cpumask_test_cpu(cpu, p-&gt;cpus_ptr))</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (is_per_cpu_kthread(p))</span><br><span class="line">		<span class="keyword">return</span> cpu_online(cpu);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> cpu_active(cpu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is how migration works:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1) we invoke migration_cpu_stop() on the target CPU using</span></span><br><span class="line"><span class="comment"> *    stop_one_cpu().</span></span><br><span class="line"><span class="comment"> * 2) stopper starts to run (implicitly forcing the migrated thread</span></span><br><span class="line"><span class="comment"> *    off the CPU)</span></span><br><span class="line"><span class="comment"> * 3) it checks whether the migrated task is still in the wrong runqueue.</span></span><br><span class="line"><span class="comment"> * 4) if it's in the wrong runqueue then the migration thread removes</span></span><br><span class="line"><span class="comment"> *    it and puts it into the right queue.</span></span><br><span class="line"><span class="comment"> * 5) stopper completes and stop_one_cpu() returns and the migration</span></span><br><span class="line"><span class="comment"> *    is done.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * move_queued_task - move a queued task to new rq.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Returns (locked) new rq. Old rq's lock is released.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> struct rq *<span class="title">move_queued_task</span><span class="params">(struct rq *rq, struct rq_flags *rf,</span></span></span><br><span class="line"><span class="function"><span class="params">				   struct task_struct *p, <span class="keyword">int</span> new_cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	lockdep_assert_held(&amp;rq-&gt;lock);</span><br><span class="line"></span><br><span class="line">	WRITE_ONCE(p-&gt;on_rq, TASK_ON_RQ_MIGRATING);</span><br><span class="line">	dequeue_task(rq, p, DEQUEUE_NOCLOCK);</span><br><span class="line">	set_task_cpu(p, new_cpu);</span><br><span class="line">	rq_unlock(rq, rf);</span><br><span class="line"></span><br><span class="line">	rq = cpu_rq(new_cpu);</span><br><span class="line"></span><br><span class="line">	rq_lock(rq, rf);</span><br><span class="line">	BUG_ON(task_cpu(p) != new_cpu);</span><br><span class="line">	enqueue_task(rq, p, <span class="number">0</span>);</span><br><span class="line">	p-&gt;on_rq = TASK_ON_RQ_QUEUED;</span><br><span class="line">	check_preempt_curr(rq, p, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> rq;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">migration_arg</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span>;</span></span><br><span class="line">	<span class="keyword">int</span> dest_cpu;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Move (not current) task off this CPU, onto the destination CPU. We're doing</span></span><br><span class="line"><span class="comment"> * this because either it can't run here any more (set_cpus_allowed()</span></span><br><span class="line"><span class="comment"> * away from this CPU, or CPU going down), or because we're</span></span><br><span class="line"><span class="comment"> * attempting to rebalance this task on exec (sched_exec).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * So we race with normal scheduler movements, but that's OK, as long</span></span><br><span class="line"><span class="comment"> * as the task is no longer on this CPU.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *__<span class="title">migrate_task</span>(<span class="title">struct</span> <span class="title">rq</span> *<span class="title">rq</span>, <span class="title">struct</span> <span class="title">rq_flags</span> *<span class="title">rf</span>,</span></span><br><span class="line"><span class="class">				 <span class="title">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>, <span class="title">int</span> <span class="title">dest_cpu</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="comment">/* Affinity changed (again). */</span></span><br><span class="line">	<span class="keyword">if</span> (!is_cpu_allowed(p, dest_cpu))</span><br><span class="line">		<span class="keyword">return</span> rq;</span><br><span class="line"></span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line">	rq = move_queued_task(rq, rf, p, dest_cpu);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> rq;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * migration_cpu_stop - this will be executed by a highprio stopper thread</span></span><br><span class="line"><span class="comment"> * and performs thread migration by bumping thread off CPU then</span></span><br><span class="line"><span class="comment"> * 'pushing' onto another runqueue.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">migration_cpu_stop</span><span class="params">(<span class="keyword">void</span> *data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">migration_arg</span> *<span class="title">arg</span> = <span class="title">data</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span> = <span class="title">arg</span>-&gt;<span class="title">task</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">this_rq</span>();</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The original target CPU might have gone down and we might</span></span><br><span class="line"><span class="comment">	 * be on another CPU but it doesn't matter.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	local_irq_disable();</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We need to explicitly wake pending tasks before running</span></span><br><span class="line"><span class="comment">	 * __migrate_task() such that we will not miss enforcing cpus_ptr</span></span><br><span class="line"><span class="comment">	 * during wakeups, see set_cpus_allowed_ptr()'s TASK_WAKING test.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	flush_smp_call_function_from_idle();</span><br><span class="line"></span><br><span class="line">	raw_spin_lock(&amp;p-&gt;pi_lock);</span><br><span class="line">	rq_lock(rq, &amp;rf);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If task_rq(p) != rq, it cannot be migrated here, because we're</span></span><br><span class="line"><span class="comment">	 * holding rq-&gt;lock, if p-&gt;on_rq == 0 it cannot get enqueued because</span></span><br><span class="line"><span class="comment">	 * we're holding p-&gt;pi_lock.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (task_rq(p) == rq) &#123;</span><br><span class="line">		<span class="keyword">if</span> (task_on_rq_queued(p))</span><br><span class="line">			rq = __migrate_task(rq, &amp;rf, p, arg-&gt;dest_cpu);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			p-&gt;wake_cpu = arg-&gt;dest_cpu;</span><br><span class="line">	&#125;</span><br><span class="line">	rq_unlock(rq, &amp;rf);</span><br><span class="line">	raw_spin_unlock(&amp;p-&gt;pi_lock);</span><br><span class="line"></span><br><span class="line">	local_irq_enable();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * sched_class::set_cpus_allowed must do the below, but is not required to</span></span><br><span class="line"><span class="comment"> * actually call this function.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_cpus_allowed_common</span><span class="params">(struct task_struct *p, <span class="keyword">const</span> struct cpumask *new_mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cpumask_copy(&amp;p-&gt;cpus_mask, new_mask);</span><br><span class="line">	p-&gt;nr_cpus_allowed = cpumask_weight(new_mask);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_set_cpus_allowed</span><span class="params">(struct task_struct *p, <span class="keyword">const</span> struct cpumask *new_mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">task_rq</span>(<span class="title">p</span>);</span></span><br><span class="line">	<span class="keyword">bool</span> queued, running;</span><br><span class="line"></span><br><span class="line">	lockdep_assert_held(&amp;p-&gt;pi_lock);</span><br><span class="line"></span><br><span class="line">	queued = task_on_rq_queued(p);</span><br><span class="line">	running = task_current(rq, p);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Because __kthread_bind() calls this on blocked tasks without</span></span><br><span class="line"><span class="comment">		 * holding rq-&gt;lock.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		lockdep_assert_held(&amp;rq-&gt;lock);</span><br><span class="line">		dequeue_task(rq, p, DEQUEUE_SAVE | DEQUEUE_NOCLOCK);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		put_prev_task(rq, p);</span><br><span class="line"></span><br><span class="line">	p-&gt;sched_class-&gt;set_cpus_allowed(p, new_mask);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		enqueue_task(rq, p, ENQUEUE_RESTORE | ENQUEUE_NOCLOCK);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		set_next_task(rq, p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Change a given task's CPU affinity. Migrate the thread to a</span></span><br><span class="line"><span class="comment"> * proper CPU and schedule it away if the CPU it's executing on</span></span><br><span class="line"><span class="comment"> * is removed from the allowed bitmask.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span> the caller must have a valid reference to the task, the</span></span><br><span class="line"><span class="comment"> * task must not exit() &amp; deallocate itself prematurely. The</span></span><br><span class="line"><span class="comment"> * call is not atomic; no spinlocks may be held.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> __set_cpus_allowed_ptr(struct task_struct *p,</span><br><span class="line">				  <span class="keyword">const</span> struct cpumask *new_mask, <span class="keyword">bool</span> check)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cpumask</span> *<span class="title">cpu_valid_mask</span> = <span class="title">cpu_active_mask</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> dest_cpu;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	rq = task_rq_lock(p, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;flags &amp; PF_KTHREAD) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Kernel threads are allowed on online &amp;&amp; !active CPUs</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		cpu_valid_mask = cpu_online_mask;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Must re-check here, to close a race against __kthread_bind(),</span></span><br><span class="line"><span class="comment">	 * sched_setaffinity() is not guaranteed to observe the flag.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (check &amp;&amp; (p-&gt;flags &amp; PF_NO_SETAFFINITY)) &#123;</span><br><span class="line">		ret = -EINVAL;</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cpumask_equal(&amp;p-&gt;cpus_mask, new_mask))</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Picking a ~random cpu helps in cases where we are changing affinity</span></span><br><span class="line"><span class="comment">	 * for groups of tasks (ie. cpuset), so that load balancing is not</span></span><br><span class="line"><span class="comment">	 * immediately required to distribute the tasks within their new mask.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	dest_cpu = cpumask_any_and_distribute(cpu_valid_mask, new_mask);</span><br><span class="line">	<span class="keyword">if</span> (dest_cpu &gt;= nr_cpu_ids) &#123;</span><br><span class="line">		ret = -EINVAL;</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	do_set_cpus_allowed(p, new_mask);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;flags &amp; PF_KTHREAD) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * For kernel threads that do indeed end up on online &amp;&amp;</span></span><br><span class="line"><span class="comment">		 * !active we want to ensure they are strict per-CPU threads.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		WARN_ON(cpumask_intersects(new_mask, cpu_online_mask) &amp;&amp;</span><br><span class="line">			!cpumask_intersects(new_mask, cpu_active_mask) &amp;&amp;</span><br><span class="line">			p-&gt;nr_cpus_allowed != <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Can the task run on the task's current CPU? If so, we're done */</span></span><br><span class="line">	<span class="keyword">if</span> (cpumask_test_cpu(task_cpu(p), new_mask))</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_running(rq, p) || p-&gt;state == TASK_WAKING) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">migration_arg</span> <span class="title">arg</span> = &#123;</span> p, dest_cpu &#125;;</span><br><span class="line">		<span class="comment">/* Need help from migration thread: drop lock and wait. */</span></span><br><span class="line">		task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line">		stop_one_cpu(cpu_of(rq), migration_cpu_stop, &amp;arg);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (task_on_rq_queued(p)) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * OK, since we're going to drop the lock immediately</span></span><br><span class="line"><span class="comment">		 * afterwards anyway.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		rq = move_queued_task(rq, &amp;rf, p, dest_cpu);</span><br><span class="line">	&#125;</span><br><span class="line">out:</span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">set_cpus_allowed_ptr</span><span class="params">(struct task_struct *p, <span class="keyword">const</span> struct cpumask *new_mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> __set_cpus_allowed_ptr(p, new_mask, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(set_cpus_allowed_ptr);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_task_cpu</span><span class="params">(struct task_struct *p, <span class="keyword">unsigned</span> <span class="keyword">int</span> new_cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHED_DEBUG</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We should never call set_task_cpu() on a blocked task,</span></span><br><span class="line"><span class="comment">	 * ttwu() will sort out the placement.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	WARN_ON_ONCE(p-&gt;state != TASK_RUNNING &amp;&amp; p-&gt;state != TASK_WAKING &amp;&amp;</span><br><span class="line">			!p-&gt;on_rq);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Migrating fair class task must have p-&gt;on_rq = TASK_ON_RQ_MIGRATING,</span></span><br><span class="line"><span class="comment">	 * because schedstat_wait_&#123;start,end&#125; rebase migrating task's wait_start</span></span><br><span class="line"><span class="comment">	 * time relying on p-&gt;on_rq.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	WARN_ON_ONCE(p-&gt;state == TASK_RUNNING &amp;&amp;</span><br><span class="line">		     p-&gt;sched_class == &amp;fair_sched_class &amp;&amp;</span><br><span class="line">		     (p-&gt;on_rq &amp;&amp; !task_on_rq_migrating(p)));</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_LOCKDEP</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The caller should hold either p-&gt;pi_lock or rq-&gt;lock, when changing</span></span><br><span class="line"><span class="comment">	 * a task's CPU. -&gt;pi_lock for waking tasks, rq-&gt;lock for runnable tasks.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * sched_move_task() holds both and thus holding either pins the cgroup,</span></span><br><span class="line"><span class="comment">	 * see task_group().</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Furthermore, all task_rq users should acquire both locks, see</span></span><br><span class="line"><span class="comment">	 * task_rq_lock().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	WARN_ON_ONCE(debug_locks &amp;&amp; !(lockdep_is_held(&amp;p-&gt;pi_lock) ||</span><br><span class="line">				      lockdep_is_held(&amp;task_rq(p)-&gt;lock)));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Clearly, migrating tasks to offline CPUs is a fairly daft thing.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	WARN_ON_ONCE(!cpu_online(new_cpu));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	trace_sched_migrate_task(p, new_cpu);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_cpu(p) != new_cpu) &#123;</span><br><span class="line">		<span class="keyword">if</span> (p-&gt;sched_class-&gt;migrate_task_rq)</span><br><span class="line">			p-&gt;sched_class-&gt;migrate_task_rq(p, new_cpu);</span><br><span class="line">		p-&gt;se.nr_migrations++;</span><br><span class="line">		rseq_migrate(p);</span><br><span class="line">		perf_event_task_migrate(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	__set_task_cpu(p, new_cpu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NUMA_BALANCING</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __migrate_swap_task(struct task_struct *p, <span class="keyword">int</span> cpu)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (task_on_rq_queued(p)) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">src_rq</span>, *<span class="title">dst_rq</span>;</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">srf</span>, <span class="title">drf</span>;</span></span><br><span class="line"></span><br><span class="line">		src_rq = task_rq(p);</span><br><span class="line">		dst_rq = cpu_rq(cpu);</span><br><span class="line"></span><br><span class="line">		rq_pin_lock(src_rq, &amp;srf);</span><br><span class="line">		rq_pin_lock(dst_rq, &amp;drf);</span><br><span class="line"></span><br><span class="line">		deactivate_task(src_rq, p, <span class="number">0</span>);</span><br><span class="line">		set_task_cpu(p, cpu);</span><br><span class="line">		activate_task(dst_rq, p, <span class="number">0</span>);</span><br><span class="line">		check_preempt_curr(dst_rq, p, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		rq_unpin_lock(dst_rq, &amp;drf);</span><br><span class="line">		rq_unpin_lock(src_rq, &amp;srf);</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Task isn't running anymore; make it appear like we migrated</span></span><br><span class="line"><span class="comment">		 * it before it went to sleep. This means on wakeup we make the</span></span><br><span class="line"><span class="comment">		 * previous CPU our target instead of where it really is.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		p-&gt;wake_cpu = cpu;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">migration_swap_arg</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">src_task</span>, *<span class="title">dst_task</span>;</span></span><br><span class="line">	<span class="keyword">int</span> src_cpu, dst_cpu;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">migrate_swap_stop</span><span class="params">(<span class="keyword">void</span> *data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">migration_swap_arg</span> *<span class="title">arg</span> = <span class="title">data</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">src_rq</span>, *<span class="title">dst_rq</span>;</span></span><br><span class="line">	<span class="keyword">int</span> ret = -EAGAIN;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!cpu_active(arg-&gt;src_cpu) || !cpu_active(arg-&gt;dst_cpu))</span><br><span class="line">		<span class="keyword">return</span> -EAGAIN;</span><br><span class="line"></span><br><span class="line">	src_rq = cpu_rq(arg-&gt;src_cpu);</span><br><span class="line">	dst_rq = cpu_rq(arg-&gt;dst_cpu);</span><br><span class="line"></span><br><span class="line">	double_raw_lock(&amp;arg-&gt;src_task-&gt;pi_lock,</span><br><span class="line">			&amp;arg-&gt;dst_task-&gt;pi_lock);</span><br><span class="line">	double_rq_lock(src_rq, dst_rq);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_cpu(arg-&gt;dst_task) != arg-&gt;dst_cpu)</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_cpu(arg-&gt;src_task) != arg-&gt;src_cpu)</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!cpumask_test_cpu(arg-&gt;dst_cpu, arg-&gt;src_task-&gt;cpus_ptr))</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!cpumask_test_cpu(arg-&gt;src_cpu, arg-&gt;dst_task-&gt;cpus_ptr))</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	__migrate_swap_task(arg-&gt;src_task, arg-&gt;dst_cpu);</span><br><span class="line">	__migrate_swap_task(arg-&gt;dst_task, arg-&gt;src_cpu);</span><br><span class="line"></span><br><span class="line">	ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">unlock:</span><br><span class="line">	double_rq_unlock(src_rq, dst_rq);</span><br><span class="line">	raw_spin_unlock(&amp;arg-&gt;dst_task-&gt;pi_lock);</span><br><span class="line">	raw_spin_unlock(&amp;arg-&gt;src_task-&gt;pi_lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Cross migrate two tasks</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">migrate_swap</span><span class="params">(struct task_struct *cur, struct task_struct *p,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">int</span> target_cpu, <span class="keyword">int</span> curr_cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">migration_swap_arg</span> <span class="title">arg</span>;</span></span><br><span class="line">	<span class="keyword">int</span> ret = -EINVAL;</span><br><span class="line"></span><br><span class="line">	arg = (struct migration_swap_arg)&#123;</span><br><span class="line">		.src_task = cur,</span><br><span class="line">		.src_cpu = curr_cpu,</span><br><span class="line">		.dst_task = p,</span><br><span class="line">		.dst_cpu = target_cpu,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (arg.src_cpu == arg.dst_cpu)</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * These three tests are all lockless; this is OK since all of them</span></span><br><span class="line"><span class="comment">	 * will be re-checked with proper locks held further down the line.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!cpu_active(arg.src_cpu) || !cpu_active(arg.dst_cpu))</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!cpumask_test_cpu(arg.dst_cpu, arg.src_task-&gt;cpus_ptr))</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!cpumask_test_cpu(arg.src_cpu, arg.dst_task-&gt;cpus_ptr))</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	trace_sched_swap_numa(cur, arg.src_cpu, p, arg.dst_cpu);</span><br><span class="line">	ret = stop_two_cpus(arg.dst_cpu, arg.src_cpu, migrate_swap_stop, &amp;arg);</span><br><span class="line"></span><br><span class="line">out:</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_NUMA_BALANCING */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * wait_task_inactive - wait for a thread to unschedule.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If @match_state is nonzero, it's the @p-&gt;state value just checked and</span></span><br><span class="line"><span class="comment"> * not expected to change.  If it changes, i.e. @p might have woken up,</span></span><br><span class="line"><span class="comment"> * then return zero.  When we succeed in waiting for @p to be off its CPU,</span></span><br><span class="line"><span class="comment"> * we return a positive number (its total switch count).  If a second call</span></span><br><span class="line"><span class="comment"> * a short while later returns the same number, the caller can be sure that</span></span><br><span class="line"><span class="comment"> * @p has remained unscheduled the whole time.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The caller must ensure that the task *will* unschedule sometime soon,</span></span><br><span class="line"><span class="comment"> * else this function might spin for a *long* time. This function can't</span></span><br><span class="line"><span class="comment"> * be called with interrupts off, or it may introduce deadlock with</span></span><br><span class="line"><span class="comment"> * smp_call_function() if an IPI is sent by the same process we are</span></span><br><span class="line"><span class="comment"> * waiting to become inactive.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">wait_task_inactive</span><span class="params">(struct task_struct *p, <span class="keyword">long</span> match_state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> running, queued;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> ncsw;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * We do the initial early heuristics without holding</span></span><br><span class="line"><span class="comment">		 * any task-queue locks at all. We'll only try to get</span></span><br><span class="line"><span class="comment">		 * the runqueue lock when things look like they will</span></span><br><span class="line"><span class="comment">		 * work out!</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		rq = task_rq(p);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * If the task is actively running on another CPU</span></span><br><span class="line"><span class="comment">		 * still, just relax and busy-wait without holding</span></span><br><span class="line"><span class="comment">		 * any locks.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * NOTE! Since we don't hold any locks, it's not</span></span><br><span class="line"><span class="comment">		 * even sure that "rq" stays as the right runqueue!</span></span><br><span class="line"><span class="comment">		 * But we don't care, since "task_running()" will</span></span><br><span class="line"><span class="comment">		 * return false if the runqueue has changed and p</span></span><br><span class="line"><span class="comment">		 * is actually now running somewhere else!</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">while</span> (task_running(rq, p)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (match_state &amp;&amp; unlikely(p-&gt;state != match_state))</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			cpu_relax();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Ok, time to look more closely! We need the rq</span></span><br><span class="line"><span class="comment">		 * lock now, to be *sure*. If we're wrong, we'll</span></span><br><span class="line"><span class="comment">		 * just go back and repeat.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		rq = task_rq_lock(p, &amp;rf);</span><br><span class="line">		trace_sched_wait_task(p);</span><br><span class="line">		running = task_running(rq, p);</span><br><span class="line">		queued = task_on_rq_queued(p);</span><br><span class="line">		ncsw = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (!match_state || p-&gt;state == match_state)</span><br><span class="line">			ncsw = p-&gt;nvcsw | LONG_MIN; <span class="comment">/* sets MSB */</span></span><br><span class="line">		task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * If it changed from the expected state, bail out now.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (unlikely(!ncsw))</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Was it really running after all now that we</span></span><br><span class="line"><span class="comment">		 * checked with the proper locks actually held?</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * Oops. Go back and try again..</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (unlikely(running)) &#123;</span><br><span class="line">			cpu_relax();</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * It's not enough that it's not actively running,</span></span><br><span class="line"><span class="comment">		 * it must be off the runqueue _entirely_, and not</span></span><br><span class="line"><span class="comment">		 * preempted!</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * So if it was still runnable (but just not actively</span></span><br><span class="line"><span class="comment">		 * running right now), it's preempted, and we should</span></span><br><span class="line"><span class="comment">		 * yield - it could be a while.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (unlikely(queued)) &#123;</span><br><span class="line">			<span class="keyword">ktime_t</span> to = NSEC_PER_SEC / HZ;</span><br><span class="line"></span><br><span class="line">			set_current_state(TASK_UNINTERRUPTIBLE);</span><br><span class="line">			schedule_hrtimeout(&amp;to, HRTIMER_MODE_REL);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Ahh, all good. It wasn't running, and it wasn't</span></span><br><span class="line"><span class="comment">		 * runnable, which means that it will never become</span></span><br><span class="line"><span class="comment">		 * running in the future either. We're all done!</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ncsw;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * kick_process - kick a running thread to enter/exit the kernel</span></span><br><span class="line"><span class="comment"> * @p: the to-be-kicked thread</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Cause a process which is running on another CPU to enter</span></span><br><span class="line"><span class="comment"> * kernel-mode, without any delay. (to get signals handled.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span> this function doesn't have to take the runqueue lock,</span></span><br><span class="line"><span class="comment"> * because all it wants to ensure is that the remote task enters</span></span><br><span class="line"><span class="comment"> * the kernel. If the IPI races and the task has been migrated</span></span><br><span class="line"><span class="comment"> * to another CPU then no harm is done and the purpose has been</span></span><br><span class="line"><span class="comment"> * achieved as well.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">kick_process</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> cpu;</span><br><span class="line"></span><br><span class="line">	preempt_disable();</span><br><span class="line">	cpu = task_cpu(p);</span><br><span class="line">	<span class="keyword">if</span> ((cpu != smp_processor_id()) &amp;&amp; task_curr(p))</span><br><span class="line">		smp_send_reschedule(cpu);</span><br><span class="line">	preempt_enable();</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(kick_process);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * -&gt;cpus_ptr is protected by both rq-&gt;lock and p-&gt;pi_lock</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * A few notes on cpu_active vs cpu_online:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  - cpu_active must be a subset of cpu_online</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  - on CPU-up we allow per-CPU kthreads on the online &amp;&amp; !active CPU,</span></span><br><span class="line"><span class="comment"> *    see __set_cpus_allowed_ptr(). At this point the newly online</span></span><br><span class="line"><span class="comment"> *    CPU isn't yet part of the sched domains, and balancing will not</span></span><br><span class="line"><span class="comment"> *    see it.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  - on CPU-down we clear cpu_active() to mask the sched domains and</span></span><br><span class="line"><span class="comment"> *    avoid the load balancer to place new tasks on the to be removed</span></span><br><span class="line"><span class="comment"> *    CPU. Existing tasks will remain running there and will be taken</span></span><br><span class="line"><span class="comment"> *    off.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This means that fallback selection must not select !active CPUs.</span></span><br><span class="line"><span class="comment"> * And can assume that any active CPU must be online. Conversely</span></span><br><span class="line"><span class="comment"> * select_task_rq() below may allow selection of !active CPUs in order</span></span><br><span class="line"><span class="comment"> * to satisfy the above rules.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">select_fallback_rq</span><span class="params">(<span class="keyword">int</span> cpu, struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> nid = cpu_to_node(cpu);</span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cpumask</span> *<span class="title">nodemask</span> = <span class="title">NULL</span>;</span></span><br><span class="line">	<span class="keyword">enum</span> &#123; cpuset, possible, fail &#125; state = cpuset;</span><br><span class="line">	<span class="keyword">int</span> dest_cpu;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If the node that the CPU is on has been offlined, cpu_to_node()</span></span><br><span class="line"><span class="comment">	 * will return -1. There is no CPU on the node, and we should</span></span><br><span class="line"><span class="comment">	 * select the CPU on the other node.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (nid != <span class="number">-1</span>) &#123;</span><br><span class="line">		nodemask = cpumask_of_node(nid);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Look for allowed, online CPU in same node. */</span></span><br><span class="line">		for_each_cpu(dest_cpu, nodemask) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!cpu_active(dest_cpu))</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span> (cpumask_test_cpu(dest_cpu, p-&gt;cpus_ptr))</span><br><span class="line">				<span class="keyword">return</span> dest_cpu;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		<span class="comment">/* Any allowed, online CPU? */</span></span><br><span class="line">		for_each_cpu(dest_cpu, p-&gt;cpus_ptr) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!is_cpu_allowed(p, dest_cpu))</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">goto</span> out;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* No more Mr. Nice Guy. */</span></span><br><span class="line">		<span class="keyword">switch</span> (state) &#123;</span><br><span class="line">		<span class="keyword">case</span> cpuset:</span><br><span class="line">			<span class="keyword">if</span> (IS_ENABLED(CONFIG_CPUSETS)) &#123;</span><br><span class="line">				cpuset_cpus_allowed_fallback(p);</span><br><span class="line">				state = possible;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/* Fall-through */</span></span><br><span class="line">		<span class="keyword">case</span> possible:</span><br><span class="line">			do_set_cpus_allowed(p, cpu_possible_mask);</span><br><span class="line">			state = fail;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> fail:</span><br><span class="line">			BUG();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">out:</span><br><span class="line">	<span class="keyword">if</span> (state != cpuset) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Don't tell them about moving exiting tasks or</span></span><br><span class="line"><span class="comment">		 * kernel threads (both mm NULL), since they never</span></span><br><span class="line"><span class="comment">		 * leave kernel.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (p-&gt;mm &amp;&amp; printk_ratelimit()) &#123;</span><br><span class="line">			printk_deferred(<span class="string">"process %d (%s) no longer affine to cpu%d\n"</span>,</span><br><span class="line">					task_pid_nr(p), p-&gt;comm, cpu);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dest_cpu;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The caller (fork, wakeup) owns p-&gt;pi_lock, -&gt;cpus_ptr is stable.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select_task_rq</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> cpu, <span class="keyword">int</span> sd_flags, <span class="keyword">int</span> wake_flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	lockdep_assert_held(&amp;p-&gt;pi_lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;nr_cpus_allowed &gt; <span class="number">1</span>)</span><br><span class="line">		cpu = p-&gt;sched_class-&gt;select_task_rq(p, cpu, sd_flags, wake_flags);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		cpu = cpumask_any(p-&gt;cpus_ptr);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * In order not to call set_task_cpu() on a blocking task we need</span></span><br><span class="line"><span class="comment">	 * to rely on ttwu() to place the task on a valid -&gt;cpus_ptr</span></span><br><span class="line"><span class="comment">	 * CPU.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Since this is common to all placement strategies, this lives here.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * [ this allows -&gt;select_task() to simply return task_cpu(p) and</span></span><br><span class="line"><span class="comment">	 *   not worry about this generic constraint ]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (unlikely(!is_cpu_allowed(p, cpu)))</span><br><span class="line">		cpu = select_fallback_rq(task_cpu(p), p);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> cpu;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_set_stop_task</span><span class="params">(<span class="keyword">int</span> cpu, struct task_struct *stop)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_param</span> <span class="title">param</span> = &#123;</span> .sched_priority = MAX_RT_PRIO - <span class="number">1</span> &#125;;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">old_stop</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>)-&gt;<span class="title">stop</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (stop) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Make it appear like a SCHED_FIFO task, its something</span></span><br><span class="line"><span class="comment">		 * userspace knows about and won't get confused about.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * Also, it will make PI more or less work without too</span></span><br><span class="line"><span class="comment">		 * much confusion -- but then, stop work should not</span></span><br><span class="line"><span class="comment">		 * rely on PI working anyway.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		sched_setscheduler_nocheck(stop, SCHED_FIFO, &amp;param);</span><br><span class="line"></span><br><span class="line">		stop-&gt;sched_class = &amp;stop_sched_class;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cpu_rq(cpu)-&gt;stop = stop;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (old_stop) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Reset it back to a normal scheduling class so that</span></span><br><span class="line"><span class="comment">		 * it can die in pieces.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		old_stop-&gt;sched_class = &amp;rt_sched_class;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> __set_cpus_allowed_ptr(struct task_struct *p,</span><br><span class="line">					 <span class="keyword">const</span> struct cpumask *new_mask, <span class="keyword">bool</span> check)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> set_cpus_allowed_ptr(p, new_mask);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SMP */</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">ttwu_stat(struct task_struct *p, <span class="keyword">int</span> cpu, <span class="keyword">int</span> wake_flags)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!schedstat_enabled())</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	rq = this_rq();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="keyword">if</span> (cpu == rq-&gt;cpu) &#123;</span><br><span class="line">		__schedstat_inc(rq-&gt;ttwu_local);</span><br><span class="line">		__schedstat_inc(p-&gt;se.statistics.nr_wakeups_local);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		struct sched_domain *sd;</span><br><span class="line"></span><br><span class="line">		__schedstat_inc(p-&gt;se.statistics.nr_wakeups_remote);</span><br><span class="line">		rcu_read_lock();</span><br><span class="line">		for_each_domain(rq-&gt;cpu, sd) &#123;</span><br><span class="line">			<span class="keyword">if</span> (cpumask_test_cpu(cpu, sched_domain_span(sd))) &#123;</span><br><span class="line">				__schedstat_inc(sd-&gt;ttwu_wake_remote);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		rcu_read_unlock();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (wake_flags &amp; WF_MIGRATED)</span><br><span class="line">		__schedstat_inc(p-&gt;se.statistics.nr_wakeups_migrate);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SMP */</span></span></span><br><span class="line"></span><br><span class="line">	__schedstat_inc(rq-&gt;ttwu_count);</span><br><span class="line">	__schedstat_inc(p-&gt;se.statistics.nr_wakeups);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (wake_flags &amp; WF_SYNC)</span><br><span class="line">		__schedstat_inc(p-&gt;se.statistics.nr_wakeups_sync);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Mark the task runnable and perform wakeup-preemption.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ttwu_do_wakeup</span><span class="params">(struct rq *rq, struct task_struct *p, <span class="keyword">int</span> wake_flags,</span></span></span><br><span class="line"><span class="function"><span class="params">			   struct rq_flags *rf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	check_preempt_curr(rq, p, wake_flags);</span><br><span class="line">	p-&gt;state = TASK_RUNNING;</span><br><span class="line">	trace_sched_wakeup(p);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;sched_class-&gt;task_woken) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Our task @p is fully woken up and running; so its safe to</span></span><br><span class="line"><span class="comment">		 * drop the rq-&gt;lock, hereafter rq is only used for statistics.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		rq_unpin_lock(rq, rf);</span><br><span class="line">		p-&gt;sched_class-&gt;task_woken(rq, p);</span><br><span class="line">		rq_repin_lock(rq, rf);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;idle_stamp) &#123;</span><br><span class="line">		u64 delta = rq_clock(rq) - rq-&gt;idle_stamp;</span><br><span class="line">		u64 max = <span class="number">2</span>*rq-&gt;max_idle_balance_cost;</span><br><span class="line"></span><br><span class="line">		update_avg(&amp;rq-&gt;avg_idle, delta);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (rq-&gt;avg_idle &gt; max)</span><br><span class="line">			rq-&gt;avg_idle = max;</span><br><span class="line"></span><br><span class="line">		rq-&gt;idle_stamp = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">ttwu_do_activate(struct rq *rq, struct task_struct *p, <span class="keyword">int</span> wake_flags,</span><br><span class="line">		 struct rq_flags *rf)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> en_flags = ENQUEUE_WAKEUP | ENQUEUE_NOCLOCK;</span><br><span class="line"></span><br><span class="line">	lockdep_assert_held(&amp;rq-&gt;lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;sched_contributes_to_load)</span><br><span class="line">		rq-&gt;nr_uninterruptible--;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="keyword">if</span> (wake_flags &amp; WF_MIGRATED)</span><br><span class="line">		en_flags |= ENQUEUE_MIGRATED;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	activate_task(rq, p, en_flags);</span><br><span class="line">	ttwu_do_wakeup(rq, p, wake_flags, rf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Called in case the task @p isn't fully descheduled from its runqueue,</span></span><br><span class="line"><span class="comment"> * in this case we must do a remote wakeup. Its a 'light' wakeup though,</span></span><br><span class="line"><span class="comment"> * since all we need to do is flip p-&gt;state to TASK_RUNNING, since</span></span><br><span class="line"><span class="comment"> * the task is still -&gt;on_rq.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">ttwu_remote</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> wake_flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	rq = __task_rq_lock(p, &amp;rf);</span><br><span class="line">	<span class="keyword">if</span> (task_on_rq_queued(p)) &#123;</span><br><span class="line">		<span class="comment">/* check_preempt_curr() may use rq clock */</span></span><br><span class="line">		update_rq_clock(rq);</span><br><span class="line">		ttwu_do_wakeup(rq, p, wake_flags, &amp;rf);</span><br><span class="line">		ret = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	__task_rq_unlock(rq, &amp;rf);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_ttwu_pending</span><span class="params">(<span class="keyword">void</span> *arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">llist_node</span> *<span class="title">llist</span> = <span class="title">arg</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">this_rq</span>();</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>, *<span class="title">t</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!llist)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * rq::ttwu_pending racy indication of out-standing wakeups.</span></span><br><span class="line"><span class="comment">	 * Races such that false-negatives are possible, since they</span></span><br><span class="line"><span class="comment">	 * are shorter lived that false-positives would be.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	WRITE_ONCE(rq-&gt;ttwu_pending, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	rq_lock_irqsave(rq, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	llist_for_each_entry_safe(p, t, llist, wake_entry.llist) &#123;</span><br><span class="line">		<span class="keyword">if</span> (WARN_ON_ONCE(p-&gt;on_cpu))</span><br><span class="line">			smp_cond_load_acquire(&amp;p-&gt;on_cpu, !VAL);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (WARN_ON_ONCE(task_cpu(p) != cpu_of(rq)))</span><br><span class="line">			set_task_cpu(p, cpu_of(rq));</span><br><span class="line"></span><br><span class="line">		ttwu_do_activate(rq, p, p-&gt;sched_remote_wakeup ? WF_MIGRATED : <span class="number">0</span>, &amp;rf);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	rq_unlock_irqrestore(rq, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_call_function_single_ipi</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!set_nr_if_polling(rq-&gt;idle))</span><br><span class="line">		arch_send_call_function_single_ipi(cpu);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		trace_sched_wake_idle_without_ipi(cpu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Queue a task on the target CPUs wake_list and wake the CPU via IPI if</span></span><br><span class="line"><span class="comment"> * necessary. The wakee CPU on receipt of the IPI will queue the task</span></span><br><span class="line"><span class="comment"> * via sched_ttwu_wakeup() for activation so the wakee incurs the cost</span></span><br><span class="line"><span class="comment"> * of the wakeup instead of the waker.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __ttwu_queue_wakelist(struct task_struct *p, <span class="keyword">int</span> cpu, <span class="keyword">int</span> wake_flags)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line"></span><br><span class="line">	p-&gt;sched_remote_wakeup = !!(wake_flags &amp; WF_MIGRATED);</span><br><span class="line"></span><br><span class="line">	WRITE_ONCE(rq-&gt;ttwu_pending, <span class="number">1</span>);</span><br><span class="line">	__smp_call_single_queue(cpu, &amp;p-&gt;wake_entry.llist);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wake_up_if_idle</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!is_idle_task(rcu_dereference(rq-&gt;curr)))</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (set_nr_if_polling(rq-&gt;idle)) &#123;</span><br><span class="line">		trace_sched_wake_idle_without_ipi(cpu);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		rq_lock_irqsave(rq, &amp;rf);</span><br><span class="line">		<span class="keyword">if</span> (is_idle_task(rq-&gt;curr))</span><br><span class="line">			smp_send_reschedule(cpu);</span><br><span class="line">		<span class="comment">/* Else CPU is not idle, do nothing here: */</span></span><br><span class="line">		rq_unlock_irqrestore(rq, &amp;rf);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">out:</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cpus_share_cache</span><span class="params">(<span class="keyword">int</span> this_cpu, <span class="keyword">int</span> that_cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> per_cpu(sd_llc_id, this_cpu) == per_cpu(sd_llc_id, that_cpu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">ttwu_queue_cond</span><span class="params">(<span class="keyword">int</span> cpu, <span class="keyword">int</span> wake_flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If the CPU does not share cache, then queue the task on the</span></span><br><span class="line"><span class="comment">	 * remote rqs wakelist to avoid accessing remote data.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!cpus_share_cache(smp_processor_id(), cpu))</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If the task is descheduling and the only running task on the</span></span><br><span class="line"><span class="comment">	 * CPU then use the wakelist to offload the task activation to</span></span><br><span class="line"><span class="comment">	 * the soon-to-be-idle CPU as the current CPU is likely busy.</span></span><br><span class="line"><span class="comment">	 * nr_running is checked to avoid unnecessary task stacking.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> ((wake_flags &amp; WF_ON_CPU) &amp;&amp; cpu_rq(cpu)-&gt;nr_running &lt;= <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">ttwu_queue_wakelist</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> cpu, <span class="keyword">int</span> wake_flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (sched_feat(TTWU_QUEUE) &amp;&amp; ttwu_queue_cond(cpu, wake_flags)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (WARN_ON_ONCE(cpu == smp_processor_id()))</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		sched_clock_cpu(cpu); <span class="comment">/* Sync clocks across CPUs */</span></span><br><span class="line">		__ttwu_queue_wakelist(p, cpu, wake_flags);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SMP */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ttwu_queue</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> cpu, <span class="keyword">int</span> wake_flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_SMP)</span></span><br><span class="line">	<span class="keyword">if</span> (ttwu_queue_wakelist(p, cpu, wake_flags))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	rq_lock(rq, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line">	ttwu_do_activate(rq, p, wake_flags, &amp;rf);</span><br><span class="line">	rq_unlock(rq, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Notes on Program-Order guarantees on SMP systems.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  MIGRATION</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The basic program-order guarantee on SMP systems is that when a task [t]</span></span><br><span class="line"><span class="comment"> * migrates, all its activity on its old CPU [c0] happens-before any subsequent</span></span><br><span class="line"><span class="comment"> * execution on its new CPU [c1].</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For migration (of runnable tasks) this is provided by the following means:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  A) UNLOCK of the rq(c0)-&gt;lock scheduling out task t</span></span><br><span class="line"><span class="comment"> *  B) migration for t is required to synchronize *both* rq(c0)-&gt;lock and</span></span><br><span class="line"><span class="comment"> *     rq(c1)-&gt;lock (if not at the same time, then in that order).</span></span><br><span class="line"><span class="comment"> *  C) LOCK of the rq(c1)-&gt;lock scheduling in task</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Release/acquire chaining guarantees that B happens after A and C after B.</span></span><br><span class="line"><span class="comment"> * Note: the CPU doing B need not be c0 or c1</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Example:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   CPU0            CPU1            CPU2</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   LOCK rq(0)-&gt;lock</span></span><br><span class="line"><span class="comment"> *   sched-out X</span></span><br><span class="line"><span class="comment"> *   sched-in Y</span></span><br><span class="line"><span class="comment"> *   UNLOCK rq(0)-&gt;lock</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                                   LOCK rq(0)-&gt;lock // orders against CPU0</span></span><br><span class="line"><span class="comment"> *                                   dequeue X</span></span><br><span class="line"><span class="comment"> *                                   UNLOCK rq(0)-&gt;lock</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                                   LOCK rq(1)-&gt;lock</span></span><br><span class="line"><span class="comment"> *                                   enqueue X</span></span><br><span class="line"><span class="comment"> *                                   UNLOCK rq(1)-&gt;lock</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                   LOCK rq(1)-&gt;lock // orders against CPU2</span></span><br><span class="line"><span class="comment"> *                   sched-out Z</span></span><br><span class="line"><span class="comment"> *                   sched-in X</span></span><br><span class="line"><span class="comment"> *                   UNLOCK rq(1)-&gt;lock</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  BLOCKING -- aka. SLEEP + WAKEUP</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For blocking we (obviously) need to provide the same guarantee as for</span></span><br><span class="line"><span class="comment"> * migration. However the means are completely different as there is no lock</span></span><br><span class="line"><span class="comment"> * chain to provide order. Instead we do:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1) smp_store_release(X-&gt;on_cpu, 0)</span></span><br><span class="line"><span class="comment"> *   2) smp_cond_load_acquire(!X-&gt;on_cpu)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Example:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   CPU0 (schedule)  CPU1 (try_to_wake_up) CPU2 (schedule)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   LOCK rq(0)-&gt;lock LOCK X-&gt;pi_lock</span></span><br><span class="line"><span class="comment"> *   dequeue X</span></span><br><span class="line"><span class="comment"> *   sched-out X</span></span><br><span class="line"><span class="comment"> *   smp_store_release(X-&gt;on_cpu, 0);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                    smp_cond_load_acquire(&amp;X-&gt;on_cpu, !VAL);</span></span><br><span class="line"><span class="comment"> *                    X-&gt;state = WAKING</span></span><br><span class="line"><span class="comment"> *                    set_task_cpu(X,2)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                    LOCK rq(2)-&gt;lock</span></span><br><span class="line"><span class="comment"> *                    enqueue X</span></span><br><span class="line"><span class="comment"> *                    X-&gt;state = RUNNING</span></span><br><span class="line"><span class="comment"> *                    UNLOCK rq(2)-&gt;lock</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                                          LOCK rq(2)-&gt;lock // orders against CPU1</span></span><br><span class="line"><span class="comment"> *                                          sched-out Z</span></span><br><span class="line"><span class="comment"> *                                          sched-in X</span></span><br><span class="line"><span class="comment"> *                                          UNLOCK rq(2)-&gt;lock</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *                    UNLOCK X-&gt;pi_lock</span></span><br><span class="line"><span class="comment"> *   UNLOCK rq(0)-&gt;lock</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * However, for wakeups there is a second guarantee we must provide, namely we</span></span><br><span class="line"><span class="comment"> * must ensure that CONDITION=1 done by the caller can not be reordered with</span></span><br><span class="line"><span class="comment"> * accesses to the task state; see try_to_wake_up() and set_current_state().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * try_to_wake_up - wake up a thread</span></span><br><span class="line"><span class="comment"> * @p: the thread to be awakened</span></span><br><span class="line"><span class="comment"> * @state: the mask of task states that can be woken</span></span><br><span class="line"><span class="comment"> * @wake_flags: wake modifier flags (WF_*)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If (@state &amp; @p-&gt;state) @p-&gt;state = TASK_RUNNING.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If the task was not queued/runnable, also place it back on a runqueue.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Atomic against schedule() which would dequeue a task, also see</span></span><br><span class="line"><span class="comment"> * set_current_state().</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function executes a full memory barrier before accessing the task</span></span><br><span class="line"><span class="comment"> * state; see set_current_state().</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: %true if @p-&gt;state changes (an actual wakeup was done),</span></span><br><span class="line"><span class="comment"> *	   %false otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">try_to_wake_up(struct task_struct *p, <span class="keyword">unsigned</span> <span class="keyword">int</span> state, <span class="keyword">int</span> wake_flags)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line">	<span class="keyword">int</span> cpu, success = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	preempt_disable();</span><br><span class="line">	<span class="keyword">if</span> (p == current) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * We're waking current, this means 'p-&gt;on_rq' and 'task_cpu(p)</span></span><br><span class="line"><span class="comment">		 * == smp_processor_id()'. Together this means we can special</span></span><br><span class="line"><span class="comment">		 * case the whole 'p-&gt;on_rq &amp;&amp; ttwu_remote()' case below</span></span><br><span class="line"><span class="comment">		 * without taking any locks.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * In particular:</span></span><br><span class="line"><span class="comment">		 *  - we rely on Program-Order guarantees for all the ordering,</span></span><br><span class="line"><span class="comment">		 *  - we're serialized against set_special_state() by virtue of</span></span><br><span class="line"><span class="comment">		 *    it disabling IRQs (this allows not taking -&gt;pi_lock).</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (!(p-&gt;state &amp; state))</span><br><span class="line">			<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">		success = <span class="number">1</span>;</span><br><span class="line">		trace_sched_waking(p);</span><br><span class="line">		p-&gt;state = TASK_RUNNING;</span><br><span class="line">		trace_sched_wakeup(p);</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If we are going to wake up a thread waiting for CONDITION we</span></span><br><span class="line"><span class="comment">	 * need to ensure that CONDITION=1 done by the caller can not be</span></span><br><span class="line"><span class="comment">	 * reordered with p-&gt;state check below. This pairs with mb() in</span></span><br><span class="line"><span class="comment">	 * set_current_state() the waiting thread does.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	raw_spin_lock_irqsave(&amp;p-&gt;pi_lock, flags);</span><br><span class="line">	smp_mb__after_spinlock();</span><br><span class="line">	<span class="keyword">if</span> (!(p-&gt;state &amp; state))</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	trace_sched_waking(p);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* We're going to change -&gt;state: */</span></span><br><span class="line">	success = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Ensure we load p-&gt;on_rq _after_ p-&gt;state, otherwise it would</span></span><br><span class="line"><span class="comment">	 * be possible to, falsely, observe p-&gt;on_rq == 0 and get stuck</span></span><br><span class="line"><span class="comment">	 * in smp_cond_load_acquire() below.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * sched_ttwu_pending()			try_to_wake_up()</span></span><br><span class="line"><span class="comment">	 *   STORE p-&gt;on_rq = 1			  LOAD p-&gt;state</span></span><br><span class="line"><span class="comment">	 *   UNLOCK rq-&gt;lock</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * __schedule() (switch to task 'p')</span></span><br><span class="line"><span class="comment">	 *   LOCK rq-&gt;lock			  smp_rmb();</span></span><br><span class="line"><span class="comment">	 *   smp_mb__after_spinlock();</span></span><br><span class="line"><span class="comment">	 *   UNLOCK rq-&gt;lock</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * [task p]</span></span><br><span class="line"><span class="comment">	 *   STORE p-&gt;state = UNINTERRUPTIBLE	  LOAD p-&gt;on_rq</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Pairs with the LOCK+smp_mb__after_spinlock() on rq-&gt;lock in</span></span><br><span class="line"><span class="comment">	 * __schedule().  See the comment for smp_mb__after_spinlock().</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * A similar smb_rmb() lives in try_invoke_on_locked_down_task().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	smp_rmb();</span><br><span class="line">	<span class="keyword">if</span> (READ_ONCE(p-&gt;on_rq) &amp;&amp; ttwu_remote(p, wake_flags))</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;in_iowait) &#123;</span><br><span class="line">		delayacct_blkio_end(p);</span><br><span class="line">		atomic_dec(&amp;task_rq(p)-&gt;nr_iowait);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Ensure we load p-&gt;on_cpu _after_ p-&gt;on_rq, otherwise it would be</span></span><br><span class="line"><span class="comment">	 * possible to, falsely, observe p-&gt;on_cpu == 0.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * One must be running (-&gt;on_cpu == 1) in order to remove oneself</span></span><br><span class="line"><span class="comment">	 * from the runqueue.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * __schedule() (switch to task 'p')	try_to_wake_up()</span></span><br><span class="line"><span class="comment">	 *   STORE p-&gt;on_cpu = 1		  LOAD p-&gt;on_rq</span></span><br><span class="line"><span class="comment">	 *   UNLOCK rq-&gt;lock</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * __schedule() (put 'p' to sleep)</span></span><br><span class="line"><span class="comment">	 *   LOCK rq-&gt;lock			  smp_rmb();</span></span><br><span class="line"><span class="comment">	 *   smp_mb__after_spinlock();</span></span><br><span class="line"><span class="comment">	 *   STORE p-&gt;on_rq = 0			  LOAD p-&gt;on_cpu</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Pairs with the LOCK+smp_mb__after_spinlock() on rq-&gt;lock in</span></span><br><span class="line"><span class="comment">	 * __schedule().  See the comment for smp_mb__after_spinlock().</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Form a control-dep-acquire with p-&gt;on_rq == 0 above, to ensure</span></span><br><span class="line"><span class="comment">	 * schedule()'s deactivate_task() has 'happened' and p will no longer</span></span><br><span class="line"><span class="comment">	 * care about it's own p-&gt;state. See the comment in __schedule().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	smp_acquire__after_ctrl_dep();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We're doing the wakeup (@success == 1), they did a dequeue (p-&gt;on_rq</span></span><br><span class="line"><span class="comment">	 * == 0), which means we need to do an enqueue, change p-&gt;state to</span></span><br><span class="line"><span class="comment">	 * TASK_WAKING such that we can unlock p-&gt;pi_lock before doing the</span></span><br><span class="line"><span class="comment">	 * enqueue, such as ttwu_queue_wakelist().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	p-&gt;state = TASK_WAKING;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If the owning (remote) CPU is still in the middle of schedule() with</span></span><br><span class="line"><span class="comment">	 * this task as prev, considering queueing p on the remote CPUs wake_list</span></span><br><span class="line"><span class="comment">	 * which potentially sends an IPI instead of spinning on p-&gt;on_cpu to</span></span><br><span class="line"><span class="comment">	 * let the waker make forward progress. This is safe because IRQs are</span></span><br><span class="line"><span class="comment">	 * disabled and the IPI will deliver after on_cpu is cleared.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Ensure we load task_cpu(p) after p-&gt;on_cpu:</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * set_task_cpu(p, cpu);</span></span><br><span class="line"><span class="comment">	 *   STORE p-&gt;cpu = @cpu</span></span><br><span class="line"><span class="comment">	 * __schedule() (switch to task 'p')</span></span><br><span class="line"><span class="comment">	 *   LOCK rq-&gt;lock</span></span><br><span class="line"><span class="comment">	 *   smp_mb__after_spin_lock()		smp_cond_load_acquire(&amp;p-&gt;on_cpu)</span></span><br><span class="line"><span class="comment">	 *   STORE p-&gt;on_cpu = 1		LOAD p-&gt;cpu</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * to ensure we observe the correct CPU on which the task is currently</span></span><br><span class="line"><span class="comment">	 * scheduling.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (smp_load_acquire(&amp;p-&gt;on_cpu) &amp;&amp;</span><br><span class="line">	    ttwu_queue_wakelist(p, task_cpu(p), wake_flags | WF_ON_CPU))</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If the owning (remote) CPU is still in the middle of schedule() with</span></span><br><span class="line"><span class="comment">	 * this task as prev, wait until its done referencing the task.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Pairs with the smp_store_release() in finish_task().</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * This ensures that tasks getting woken will be fully ordered against</span></span><br><span class="line"><span class="comment">	 * their previous state and preserve Program Order.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	smp_cond_load_acquire(&amp;p-&gt;on_cpu, !VAL);</span><br><span class="line"></span><br><span class="line">	cpu = select_task_rq(p, p-&gt;wake_cpu, SD_BALANCE_WAKE, wake_flags);</span><br><span class="line">	<span class="keyword">if</span> (task_cpu(p) != cpu) &#123;</span><br><span class="line">		wake_flags |= WF_MIGRATED;</span><br><span class="line">		psi_ttwu_dequeue(p);</span><br><span class="line">		set_task_cpu(p, cpu);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	cpu = task_cpu(p);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SMP */</span></span></span><br><span class="line"></span><br><span class="line">	ttwu_queue(p, cpu, wake_flags);</span><br><span class="line">unlock:</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;p-&gt;pi_lock, flags);</span><br><span class="line">out:</span><br><span class="line">	<span class="keyword">if</span> (success)</span><br><span class="line">		ttwu_stat(p, task_cpu(p), wake_flags);</span><br><span class="line">	preempt_enable();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> success;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * try_invoke_on_locked_down_task - Invoke a function on task in fixed state</span></span><br><span class="line"><span class="comment"> * @p: Process for which the function is to be invoked.</span></span><br><span class="line"><span class="comment"> * @func: Function to invoke.</span></span><br><span class="line"><span class="comment"> * @arg: Argument to function.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If the specified task can be quickly locked into a definite state</span></span><br><span class="line"><span class="comment"> * (either sleeping or on a given runqueue), arrange to keep it in that</span></span><br><span class="line"><span class="comment"> * state while invoking @func(@arg).  This function can use -&gt;on_rq and</span></span><br><span class="line"><span class="comment"> * task_curr() to work out what the state is, if required.  Given that</span></span><br><span class="line"><span class="comment"> * @func can be invoked with a runqueue lock held, it had better be quite</span></span><br><span class="line"><span class="comment"> * lightweight.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Returns:</span></span><br><span class="line"><span class="comment"> *	@false if the task slipped out from under the locks.</span></span><br><span class="line"><span class="comment"> *	@true if the task was locked onto a runqueue or is sleeping.</span></span><br><span class="line"><span class="comment"> *		However, @func can override this by returning @false.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">try_invoke_on_locked_down_task</span><span class="params">(struct task_struct *p, <span class="keyword">bool</span> (*func)(struct task_struct *t, <span class="keyword">void</span> *arg), <span class="keyword">void</span> *arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> ret = <span class="literal">false</span>;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	lockdep_assert_irqs_enabled();</span><br><span class="line">	raw_spin_lock_irq(&amp;p-&gt;pi_lock);</span><br><span class="line">	<span class="keyword">if</span> (p-&gt;on_rq) &#123;</span><br><span class="line">		rq = __task_rq_lock(p, &amp;rf);</span><br><span class="line">		<span class="keyword">if</span> (task_rq(p) == rq)</span><br><span class="line">			ret = func(p, arg);</span><br><span class="line">		rq_unlock(rq, &amp;rf);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">switch</span> (p-&gt;state) &#123;</span><br><span class="line">		<span class="keyword">case</span> TASK_RUNNING:</span><br><span class="line">		<span class="keyword">case</span> TASK_WAKING:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			smp_rmb(); <span class="comment">// See smp_rmb() comment in try_to_wake_up().</span></span><br><span class="line">			<span class="keyword">if</span> (!p-&gt;on_rq)</span><br><span class="line">				ret = func(p, arg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	raw_spin_unlock_irq(&amp;p-&gt;pi_lock);</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wake_up_process - Wake up a specific process</span></span><br><span class="line"><span class="comment"> * @p: The process to be woken up.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Attempt to wake up the nominated process and move it to the set of runnable</span></span><br><span class="line"><span class="comment"> * processes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 1 if the process was woken up, 0 if it was already running.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function executes a full memory barrier before accessing the task state.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">wake_up_process</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> try_to_wake_up(p, TASK_NORMAL, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(wake_up_process);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">wake_up_state</span><span class="params">(struct task_struct *p, <span class="keyword">unsigned</span> <span class="keyword">int</span> state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> try_to_wake_up(p, state, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Perform scheduler related setup for a newly forked process p.</span></span><br><span class="line"><span class="comment"> * p is forked by current.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * __sched_fork() is basic setup used by init_idle() too:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __sched_fork(<span class="keyword">unsigned</span> <span class="keyword">long</span> clone_flags, struct task_struct *p)</span><br><span class="line">&#123;</span><br><span class="line">	p-&gt;on_rq			= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	p-&gt;se.on_rq			= <span class="number">0</span>;</span><br><span class="line">	p-&gt;se.exec_start		= <span class="number">0</span>;</span><br><span class="line">	p-&gt;se.sum_exec_runtime		= <span class="number">0</span>;</span><br><span class="line">	p-&gt;se.prev_sum_exec_runtime	= <span class="number">0</span>;</span><br><span class="line">	p-&gt;se.nr_migrations		= <span class="number">0</span>;</span><br><span class="line">	p-&gt;se.vruntime			= <span class="number">0</span>;</span><br><span class="line">	INIT_LIST_HEAD(&amp;p-&gt;se.group_node);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line">	p-&gt;se.cfs_rq			= <span class="literal">NULL</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHEDSTATS</span></span><br><span class="line">	<span class="comment">/* Even if schedstat is disabled, there should not be garbage */</span></span><br><span class="line">	<span class="built_in">memset</span>(&amp;p-&gt;se.statistics, <span class="number">0</span>, <span class="keyword">sizeof</span>(p-&gt;se.statistics));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	RB_CLEAR_NODE(&amp;p-&gt;dl.rb_node);</span><br><span class="line">	init_dl_task_timer(&amp;p-&gt;dl);</span><br><span class="line">	init_dl_inactive_task_timer(&amp;p-&gt;dl);</span><br><span class="line">	__dl_clear_params(p);</span><br><span class="line"></span><br><span class="line">	INIT_LIST_HEAD(&amp;p-&gt;rt.run_list);</span><br><span class="line">	p-&gt;rt.timeout		= <span class="number">0</span>;</span><br><span class="line">	p-&gt;rt.time_slice	= sched_rr_timeslice;</span><br><span class="line">	p-&gt;rt.on_rq		= <span class="number">0</span>;</span><br><span class="line">	p-&gt;rt.on_list		= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_PREEMPT_NOTIFIERS</span></span><br><span class="line">	INIT_HLIST_HEAD(&amp;p-&gt;preempt_notifiers);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_COMPACTION</span></span><br><span class="line">	p-&gt;capture_control = <span class="literal">NULL</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	init_numa_balancing(clone_flags, p);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	p-&gt;wake_entry.u_flags = CSD_TYPE_TTWU;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DEFINE_STATIC_KEY_FALSE(sched_numa_balancing);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NUMA_BALANCING</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_numabalancing_state</span><span class="params">(<span class="keyword">bool</span> enabled)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (enabled)</span><br><span class="line">		static_branch_enable(&amp;sched_numa_balancing);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		static_branch_disable(&amp;sched_numa_balancing);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_PROC_SYSCTL</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sysctl_numa_balancing</span><span class="params">(struct ctl_table *table, <span class="keyword">int</span> write,</span></span></span><br><span class="line"><span class="function"><span class="params">			  <span class="keyword">void</span> *buffer, <span class="keyword">size_t</span> *lenp, <span class="keyword">loff_t</span> *ppos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">ctl_table</span> <span class="title">t</span>;</span></span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line">	<span class="keyword">int</span> state = static_branch_likely(&amp;sched_numa_balancing);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (write &amp;&amp; !capable(CAP_SYS_ADMIN))</span><br><span class="line">		<span class="keyword">return</span> -EPERM;</span><br><span class="line"></span><br><span class="line">	t = *table;</span><br><span class="line">	t.data = &amp;state;</span><br><span class="line">	err = proc_dointvec_minmax(&amp;t, write, buffer, lenp, ppos);</span><br><span class="line">	<span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> err;</span><br><span class="line">	<span class="keyword">if</span> (write)</span><br><span class="line">		set_numabalancing_state(state);</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHEDSTATS</span></span><br><span class="line"></span><br><span class="line">DEFINE_STATIC_KEY_FALSE(sched_schedstats);</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">bool</span> __initdata __sched_schedstats = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">set_schedstats</span><span class="params">(<span class="keyword">bool</span> enabled)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (enabled)</span><br><span class="line">		static_branch_enable(&amp;sched_schedstats);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		static_branch_disable(&amp;sched_schedstats);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">force_schedstat_enabled</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!schedstat_enabled()) &#123;</span><br><span class="line">		pr_info(<span class="string">"kernel profiling enabled schedstats, disable via kernel.sched_schedstats.\n"</span>);</span><br><span class="line">		static_branch_enable(&amp;sched_schedstats);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> __init <span class="title">setup_schedstats</span><span class="params">(<span class="keyword">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (!str)</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * This code is called before jump labels have been set up, so we can't</span></span><br><span class="line"><span class="comment">	 * change the static branch directly just yet.  Instead set a temporary</span></span><br><span class="line"><span class="comment">	 * variable so init_schedstats() can do it later.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(str, <span class="string">"enable"</span>)) &#123;</span><br><span class="line">		__sched_schedstats = <span class="literal">true</span>;</span><br><span class="line">		ret = <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(str, <span class="string">"disable"</span>)) &#123;</span><br><span class="line">		__sched_schedstats = <span class="literal">false</span>;</span><br><span class="line">		ret = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">out:</span><br><span class="line">	<span class="keyword">if</span> (!ret)</span><br><span class="line">		pr_warn(<span class="string">"Unable to parse schedstats=\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">__setup(<span class="string">"schedstats="</span>, setup_schedstats);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> __init <span class="title">init_schedstats</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	set_schedstats(__sched_schedstats);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_PROC_SYSCTL</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sysctl_schedstats</span><span class="params">(struct ctl_table *table, <span class="keyword">int</span> write, <span class="keyword">void</span> *buffer,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">size_t</span> *lenp, <span class="keyword">loff_t</span> *ppos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">ctl_table</span> <span class="title">t</span>;</span></span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line">	<span class="keyword">int</span> state = static_branch_likely(&amp;sched_schedstats);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (write &amp;&amp; !capable(CAP_SYS_ADMIN))</span><br><span class="line">		<span class="keyword">return</span> -EPERM;</span><br><span class="line"></span><br><span class="line">	t = *table;</span><br><span class="line">	t.data = &amp;state;</span><br><span class="line">	err = proc_dointvec_minmax(&amp;t, write, buffer, lenp, ppos);</span><br><span class="line">	<span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> err;</span><br><span class="line">	<span class="keyword">if</span> (write)</span><br><span class="line">		set_schedstats(state);</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_PROC_SYSCTL */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span>  <span class="comment">/* !CONFIG_SCHEDSTATS */</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init_schedstats</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SCHEDSTATS */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * fork()/clone()-time setup:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_fork</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> clone_flags, struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line"></span><br><span class="line">	__sched_fork(clone_flags, p);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We mark the process as NEW here. This guarantees that</span></span><br><span class="line"><span class="comment">	 * nobody will actually run it, and a signal or other external</span></span><br><span class="line"><span class="comment">	 * event cannot wake it up and insert it on the runqueue either.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	p-&gt;state = TASK_NEW;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Make sure we do not leak PI boosting priority to the child.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	p-&gt;prio = current-&gt;normal_prio;</span><br><span class="line"></span><br><span class="line">	uclamp_fork(p);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Revert to default priority/policy on fork if requested.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (unlikely(p-&gt;sched_reset_on_fork)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (task_has_dl_policy(p) || task_has_rt_policy(p)) &#123;</span><br><span class="line">			p-&gt;policy = SCHED_NORMAL;</span><br><span class="line">			p-&gt;static_prio = NICE_TO_PRIO(<span class="number">0</span>);</span><br><span class="line">			p-&gt;rt_priority = <span class="number">0</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (PRIO_TO_NICE(p-&gt;static_prio) &lt; <span class="number">0</span>)</span><br><span class="line">			p-&gt;static_prio = NICE_TO_PRIO(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		p-&gt;prio = p-&gt;normal_prio = __normal_prio(p);</span><br><span class="line">		set_load_weight(p, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * We don't need the reset flag anymore after the fork. It has</span></span><br><span class="line"><span class="comment">		 * fulfilled its duty:</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		p-&gt;sched_reset_on_fork = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (dl_prio(p-&gt;prio))</span><br><span class="line">		<span class="keyword">return</span> -EAGAIN;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (rt_prio(p-&gt;prio))</span><br><span class="line">		p-&gt;sched_class = &amp;rt_sched_class;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		p-&gt;sched_class = &amp;fair_sched_class;</span><br><span class="line"></span><br><span class="line">	init_entity_runnable_average(&amp;p-&gt;se);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The child is not yet in the pid-hash so no cgroup attach races,</span></span><br><span class="line"><span class="comment">	 * and the cgroup is pinned to this child due to cgroup_fork()</span></span><br><span class="line"><span class="comment">	 * is ran before sched_fork().</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Silence PROVE_RCU.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	raw_spin_lock_irqsave(&amp;p-&gt;pi_lock, flags);</span><br><span class="line">	rseq_migrate(p);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We're setting the CPU for the first time, we don't migrate,</span></span><br><span class="line"><span class="comment">	 * so use __set_task_cpu().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	__set_task_cpu(p, smp_processor_id());</span><br><span class="line">	<span class="keyword">if</span> (p-&gt;sched_class-&gt;task_fork)</span><br><span class="line">		p-&gt;sched_class-&gt;task_fork(p);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;p-&gt;pi_lock, flags);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHED_INFO</span></span><br><span class="line">	<span class="keyword">if</span> (likely(sched_info_on()))</span><br><span class="line">		<span class="built_in">memset</span>(&amp;p-&gt;sched_info, <span class="number">0</span>, <span class="keyword">sizeof</span>(p-&gt;sched_info));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_SMP)</span></span><br><span class="line">	p-&gt;on_cpu = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	init_task_preempt_count(p);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	plist_node_init(&amp;p-&gt;pushable_tasks, MAX_PRIO);</span><br><span class="line">	RB_CLEAR_NODE(&amp;p-&gt;pushable_dl_tasks);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">to_ratio</span><span class="params">(u64 period, u64 runtime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (runtime == RUNTIME_INF)</span><br><span class="line">		<span class="keyword">return</span> BW_UNIT;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Doing this here saves a lot of checks in all</span></span><br><span class="line"><span class="comment">	 * the calling paths, and returning zero seems</span></span><br><span class="line"><span class="comment">	 * safe for them anyway.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (period == <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> div64_u64(runtime &lt;&lt; BW_SHIFT, period);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * wake_up_new_task - wake up a newly created task for the first time.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function will do some initial scheduler statistics housekeeping</span></span><br><span class="line"><span class="comment"> * that must be done for every newly created context, then puts the task</span></span><br><span class="line"><span class="comment"> * on the runqueue and wakes it.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wake_up_new_task</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;p-&gt;pi_lock, rf.flags);</span><br><span class="line">	p-&gt;state = TASK_RUNNING;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Fork balancing, do it here and not earlier because:</span></span><br><span class="line"><span class="comment">	 *  - cpus_ptr can change in the fork path</span></span><br><span class="line"><span class="comment">	 *  - any previously selected CPU might disappear through hotplug</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Use __set_task_cpu() to avoid calling sched_class::migrate_task_rq,</span></span><br><span class="line"><span class="comment">	 * as we're not fully set-up yet.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	p-&gt;recent_used_cpu = task_cpu(p);</span><br><span class="line">	rseq_migrate(p);</span><br><span class="line">	__set_task_cpu(p, select_task_rq(p, task_cpu(p), SD_BALANCE_FORK, <span class="number">0</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	rq = __task_rq_lock(p, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line">	post_init_entity_util_avg(p);</span><br><span class="line"></span><br><span class="line">	activate_task(rq, p, ENQUEUE_NOCLOCK);</span><br><span class="line">	trace_sched_wakeup_new(p);</span><br><span class="line">	check_preempt_curr(rq, p, WF_FORK);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;sched_class-&gt;task_woken) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Nothing relies on rq-&gt;lock after this, so its fine to</span></span><br><span class="line"><span class="comment">		 * drop it.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		rq_unpin_lock(rq, &amp;rf);</span><br><span class="line">		p-&gt;sched_class-&gt;task_woken(rq, p);</span><br><span class="line">		rq_repin_lock(rq, &amp;rf);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_PREEMPT_NOTIFIERS</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">DEFINE_STATIC_KEY_FALSE</span><span class="params">(preempt_notifier_key)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preempt_notifier_inc</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	static_branch_inc(&amp;preempt_notifier_key);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(preempt_notifier_inc);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preempt_notifier_dec</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	static_branch_dec(&amp;preempt_notifier_key);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(preempt_notifier_dec);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * preempt_notifier_register - tell me when current is being preempted &amp; rescheduled</span></span><br><span class="line"><span class="comment"> * @notifier: notifier struct to register</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preempt_notifier_register</span><span class="params">(struct preempt_notifier *notifier)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!static_branch_unlikely(&amp;preempt_notifier_key))</span><br><span class="line">		WARN(<span class="number">1</span>, <span class="string">"registering preempt_notifier while notifiers disabled\n"</span>);</span><br><span class="line"></span><br><span class="line">	hlist_add_head(&amp;notifier-&gt;link, &amp;current-&gt;preempt_notifiers);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(preempt_notifier_register);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * preempt_notifier_unregister - no longer interested in preemption notifications</span></span><br><span class="line"><span class="comment"> * @notifier: notifier struct to unregister</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is *not* safe to call from within a preemption notifier.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preempt_notifier_unregister</span><span class="params">(struct preempt_notifier *notifier)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	hlist_del(&amp;notifier-&gt;link);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(preempt_notifier_unregister);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __fire_sched_in_preempt_notifiers(struct task_struct *curr)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">preempt_notifier</span> *<span class="title">notifier</span>;</span></span><br><span class="line"></span><br><span class="line">	hlist_for_each_entry(notifier, &amp;curr-&gt;preempt_notifiers, link)</span><br><span class="line">		notifier-&gt;ops-&gt;sched_in(notifier, raw_smp_processor_id());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> __always_inline <span class="keyword">void</span> <span class="title">fire_sched_in_preempt_notifiers</span><span class="params">(struct task_struct *curr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (static_branch_unlikely(&amp;preempt_notifier_key))</span><br><span class="line">		__fire_sched_in_preempt_notifiers(curr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">__fire_sched_out_preempt_notifiers(struct task_struct *curr,</span><br><span class="line">				   struct task_struct *next)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">preempt_notifier</span> *<span class="title">notifier</span>;</span></span><br><span class="line"></span><br><span class="line">	hlist_for_each_entry(notifier, &amp;curr-&gt;preempt_notifiers, link)</span><br><span class="line">		notifier-&gt;ops-&gt;sched_out(notifier, next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> __always_inline <span class="keyword">void</span></span><br><span class="line">fire_sched_out_preempt_notifiers(struct task_struct *curr,</span><br><span class="line">				 struct task_struct *next)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (static_branch_unlikely(&amp;preempt_notifier_key))</span><br><span class="line">		__fire_sched_out_preempt_notifiers(curr, next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> <span class="comment">/* !CONFIG_PREEMPT_NOTIFIERS */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">fire_sched_in_preempt_notifiers</span><span class="params">(struct task_struct *curr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">fire_sched_out_preempt_notifiers(struct task_struct *curr,</span><br><span class="line">				 struct task_struct *next)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_PREEMPT_NOTIFIERS */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">prepare_task</span><span class="params">(struct task_struct *next)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Claim the task as running, we do this before switching to it</span></span><br><span class="line"><span class="comment">	 * such that any running task will have this set.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	next-&gt;on_cpu = <span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">finish_task</span><span class="params">(struct task_struct *prev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * After -&gt;on_cpu is cleared, the task can be moved to a different CPU.</span></span><br><span class="line"><span class="comment">	 * We must ensure this doesn't happen until the switch is completely</span></span><br><span class="line"><span class="comment">	 * finished.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * In particular, the load of prev-&gt;state in finish_task_switch() must</span></span><br><span class="line"><span class="comment">	 * happen before this.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Pairs with the smp_cond_load_acquire() in try_to_wake_up().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	smp_store_release(&amp;prev-&gt;on_cpu, <span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">prepare_lock_switch(struct rq *rq, struct task_struct *next, struct rq_flags *rf)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Since the runqueue lock will be released by the next</span></span><br><span class="line"><span class="comment">	 * task (which is an invalid locking op but in the case</span></span><br><span class="line"><span class="comment">	 * of the scheduler it's an obvious special-case), so we</span></span><br><span class="line"><span class="comment">	 * do an early lockdep release here:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rq_unpin_lock(rq, rf);</span><br><span class="line">	spin_release(&amp;rq-&gt;lock.dep_map, _THIS_IP_);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_SPINLOCK</span></span><br><span class="line">	<span class="comment">/* this is a valid case when another task releases the spinlock */</span></span><br><span class="line">	rq-&gt;lock.owner = next;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">finish_lock_switch</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If we are tracking spinlock dependencies then we have to</span></span><br><span class="line"><span class="comment">	 * fix up the runqueue lock - which gets 'carried over' from</span></span><br><span class="line"><span class="comment">	 * prev into current:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	spin_acquire(&amp;rq-&gt;lock.dep_map, <span class="number">0</span>, <span class="number">0</span>, _THIS_IP_);</span><br><span class="line">	raw_spin_unlock_irq(&amp;rq-&gt;lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * NOP if the arch has not defined these:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> prepare_arch_switch</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> prepare_arch_switch(next)	do &#123; &#125; while (0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> finish_arch_post_lock_switch</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> finish_arch_post_lock_switch()	do &#123; &#125; while (0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * prepare_task_switch - prepare to switch tasks</span></span><br><span class="line"><span class="comment"> * @rq: the runqueue preparing to switch</span></span><br><span class="line"><span class="comment"> * @prev: the current task that is being switched out</span></span><br><span class="line"><span class="comment"> * @next: the task we are going to switch to.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is called with the rq lock held and interrupts off. It must</span></span><br><span class="line"><span class="comment"> * be paired with a subsequent finish_task_switch after the context</span></span><br><span class="line"><span class="comment"> * switch.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * prepare_task_switch sets up locking and calls architecture specific</span></span><br><span class="line"><span class="comment"> * hooks.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">prepare_task_switch(struct rq *rq, struct task_struct *prev,</span><br><span class="line">		    struct task_struct *next)</span><br><span class="line">&#123;</span><br><span class="line">	kcov_prepare_switch(prev);</span><br><span class="line">	sched_info_switch(rq, prev, next);</span><br><span class="line">	perf_event_task_sched_out(prev, next);</span><br><span class="line">	rseq_preempt(prev);</span><br><span class="line">	fire_sched_out_preempt_notifiers(prev, next);</span><br><span class="line">	prepare_task(next);</span><br><span class="line">	prepare_arch_switch(next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * finish_task_switch - clean up after a task-switch</span></span><br><span class="line"><span class="comment"> * @prev: the thread we just switched away from.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * finish_task_switch must be called after the context switch, paired</span></span><br><span class="line"><span class="comment"> * with a prepare_task_switch call before the context switch.</span></span><br><span class="line"><span class="comment"> * finish_task_switch will reconcile locking set up by prepare_task_switch,</span></span><br><span class="line"><span class="comment"> * and do any other architecture-specific cleanup actions.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note that we may have delayed dropping an mm in context_switch(). If</span></span><br><span class="line"><span class="comment"> * so, we finish that here outside of the runqueue lock. (Doing it</span></span><br><span class="line"><span class="comment"> * with the lock held can cause deadlocks; see schedule() for</span></span><br><span class="line"><span class="comment"> * details.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The context switch have flipped the stack from under us and restored the</span></span><br><span class="line"><span class="comment"> * local variables which were saved when this task called schedule() in the</span></span><br><span class="line"><span class="comment"> * past. prev == current is still correct but we need to recalculate this_rq</span></span><br><span class="line"><span class="comment"> * because prev may have moved to another CPU.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> struct rq *<span class="title">finish_task_switch</span><span class="params">(struct task_struct *prev)</span></span></span><br><span class="line"><span class="function">	__<span class="title">releases</span><span class="params">(rq-&gt;lock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">this_rq</span>();</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mm_struct</span> *<span class="title">mm</span> = <span class="title">rq</span>-&gt;<span class="title">prev_mm</span>;</span></span><br><span class="line">	<span class="keyword">long</span> prev_state;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The previous task will have left us with a preempt_count of 2</span></span><br><span class="line"><span class="comment">	 * because it left us after:</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *	schedule()</span></span><br><span class="line"><span class="comment">	 *	  preempt_disable();			// 1</span></span><br><span class="line"><span class="comment">	 *	  __schedule()</span></span><br><span class="line"><span class="comment">	 *	    raw_spin_lock_irq(&amp;rq-&gt;lock)	// 2</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Also, see FORK_PREEMPT_COUNT.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (WARN_ONCE(preempt_count() != <span class="number">2</span>*PREEMPT_DISABLE_OFFSET,</span><br><span class="line">		      <span class="string">"corrupted preempt_count: %s/%d/0x%x\n"</span>,</span><br><span class="line">		      current-&gt;comm, current-&gt;pid, preempt_count()))</span><br><span class="line">		preempt_count_set(FORK_PREEMPT_COUNT);</span><br><span class="line"></span><br><span class="line">	rq-&gt;prev_mm = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * A task struct has one reference for the use as "current".</span></span><br><span class="line"><span class="comment">	 * If a task dies, then it sets TASK_DEAD in tsk-&gt;state and calls</span></span><br><span class="line"><span class="comment">	 * schedule one last time. The schedule call will never return, and</span></span><br><span class="line"><span class="comment">	 * the scheduled task must drop that reference.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * We must observe prev-&gt;state before clearing prev-&gt;on_cpu (in</span></span><br><span class="line"><span class="comment">	 * finish_task), otherwise a concurrent wakeup can get prev</span></span><br><span class="line"><span class="comment">	 * running on another CPU and we could rave with its RUNNING -&gt; DEAD</span></span><br><span class="line"><span class="comment">	 * transition, resulting in a double drop.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	prev_state = prev-&gt;state;</span><br><span class="line">	vtime_task_switch(prev);</span><br><span class="line">	perf_event_task_sched_in(prev, current);</span><br><span class="line">	finish_task(prev);</span><br><span class="line">	finish_lock_switch(rq);</span><br><span class="line">	finish_arch_post_lock_switch();</span><br><span class="line">	kcov_finish_switch(current);</span><br><span class="line"></span><br><span class="line">	fire_sched_in_preempt_notifiers(current);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * When switching through a kernel thread, the loop in</span></span><br><span class="line"><span class="comment">	 * membarrier_&#123;private,global&#125;_expedited() may have observed that</span></span><br><span class="line"><span class="comment">	 * kernel thread and not issued an IPI. It is therefore possible to</span></span><br><span class="line"><span class="comment">	 * schedule between user-&gt;kernel-&gt;user threads without passing though</span></span><br><span class="line"><span class="comment">	 * switch_mm(). Membarrier requires a barrier after storing to</span></span><br><span class="line"><span class="comment">	 * rq-&gt;curr, before returning to userspace, so provide them here:</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * - a full memory barrier for &#123;PRIVATE,GLOBAL&#125;_EXPEDITED, implicitly</span></span><br><span class="line"><span class="comment">	 *   provided by mmdrop(),</span></span><br><span class="line"><span class="comment">	 * - a sync_core for SYNC_CORE.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (mm) &#123;</span><br><span class="line">		membarrier_mm_sync_core_before_usermode(mm);</span><br><span class="line">		mmdrop(mm);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (unlikely(prev_state == TASK_DEAD)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (prev-&gt;sched_class-&gt;task_dead)</span><br><span class="line">			prev-&gt;sched_class-&gt;task_dead(prev);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Remove function-return probe instances associated with this</span></span><br><span class="line"><span class="comment">		 * task and put them back on the free list.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		kprobe_flush_task(prev);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Task is done with its stack. */</span></span><br><span class="line">		put_task_stack(prev);</span><br><span class="line"></span><br><span class="line">		put_task_struct_rcu_user(prev);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tick_nohz_task_switch();</span><br><span class="line">	<span class="keyword">return</span> rq;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* rq-&gt;lock is NOT held, but preemption is disabled */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __balance_callback(struct rq *rq)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">callback_head</span> *<span class="title">head</span>, *<span class="title">next</span>;</span></span><br><span class="line">	<span class="keyword">void</span> (*func)(struct rq *rq);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;rq-&gt;lock, flags);</span><br><span class="line">	head = rq-&gt;balance_callback;</span><br><span class="line">	rq-&gt;balance_callback = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">while</span> (head) &#123;</span><br><span class="line">		func = (<span class="keyword">void</span> (*)(struct rq *))head-&gt;func;</span><br><span class="line">		next = head-&gt;next;</span><br><span class="line">		head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">		head = next;</span><br><span class="line"></span><br><span class="line">		func(rq);</span><br><span class="line">	&#125;</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;rq-&gt;lock, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">balance_callback</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (unlikely(rq-&gt;balance_callback))</span><br><span class="line">		__balance_callback(rq);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">balance_callback</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * schedule_tail - first thing a freshly forked thread must call.</span></span><br><span class="line"><span class="comment"> * @prev: the thread we just switched away from.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">asmlinkage __visible <span class="keyword">void</span> <span class="title">schedule_tail</span><span class="params">(struct task_struct *prev)</span></span></span><br><span class="line"><span class="function">	__<span class="title">releases</span><span class="params">(rq-&gt;lock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * New tasks start with FORK_PREEMPT_COUNT, see there and</span></span><br><span class="line"><span class="comment">	 * finish_task_switch() for details.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * finish_task_switch() will drop rq-&gt;lock() and lower preempt_count</span></span><br><span class="line"><span class="comment">	 * and the preempt_enable() will end up enabling preemption (on</span></span><br><span class="line"><span class="comment">	 * PREEMPT_COUNT kernels).</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	rq = finish_task_switch(prev);</span><br><span class="line">	balance_callback(rq);</span><br><span class="line">	preempt_enable();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (current-&gt;set_child_tid)</span><br><span class="line">		put_user(task_pid_vnr(current), current-&gt;set_child_tid);</span><br><span class="line"></span><br><span class="line">	calculate_sigpending();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * context_switch - switch to the new MM and the new thread's register state.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> __always_inline <span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *</span></span><br><span class="line"><span class="class"><span class="title">context_switch</span>(<span class="title">struct</span> <span class="title">rq</span> *<span class="title">rq</span>, <span class="title">struct</span> <span class="title">task_struct</span> *<span class="title">prev</span>,</span></span><br><span class="line"><span class="class">	       <span class="title">struct</span> <span class="title">task_struct</span> *<span class="title">next</span>, <span class="title">struct</span> <span class="title">rq_flags</span> *<span class="title">rf</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	prepare_task_switch(rq, prev, next);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * For paravirt, this is coupled with an exit in switch_to to</span></span><br><span class="line"><span class="comment">	 * combine the page table reload and the switch backend into</span></span><br><span class="line"><span class="comment">	 * one hypercall.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	arch_start_context_switch(prev);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * kernel -&gt; kernel   lazy + transfer active</span></span><br><span class="line"><span class="comment">	 *   user -&gt; kernel   lazy + mmgrab() active</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * kernel -&gt;   user   switch + mmdrop() active</span></span><br><span class="line"><span class="comment">	 *   user -&gt;   user   switch</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!next-&gt;mm) &#123;                                <span class="comment">// to kernel</span></span><br><span class="line">		enter_lazy_tlb(prev-&gt;active_mm, next);</span><br><span class="line"></span><br><span class="line">		next-&gt;active_mm = prev-&gt;active_mm;</span><br><span class="line">		<span class="keyword">if</span> (prev-&gt;mm)                           <span class="comment">// from user</span></span><br><span class="line">			mmgrab(prev-&gt;active_mm);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			prev-&gt;active_mm = <span class="literal">NULL</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;                                        <span class="comment">// to user</span></span><br><span class="line">		membarrier_switch_mm(rq, prev-&gt;active_mm, next-&gt;mm);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * sys_membarrier() requires an smp_mb() between setting</span></span><br><span class="line"><span class="comment">		 * rq-&gt;curr / membarrier_switch_mm() and returning to userspace.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * The below provides this either through switch_mm(), or in</span></span><br><span class="line"><span class="comment">		 * case 'prev-&gt;active_mm == next-&gt;mm' through</span></span><br><span class="line"><span class="comment">		 * finish_task_switch()'s mmdrop().</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		switch_mm_irqs_off(prev-&gt;active_mm, next-&gt;mm, next);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!prev-&gt;mm) &#123;                        <span class="comment">// from kernel</span></span><br><span class="line">			<span class="comment">/* will mmdrop() in finish_task_switch(). */</span></span><br><span class="line">			rq-&gt;prev_mm = prev-&gt;active_mm;</span><br><span class="line">			prev-&gt;active_mm = <span class="literal">NULL</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	rq-&gt;clock_update_flags &amp;= ~(RQCF_ACT_SKIP|RQCF_REQ_SKIP);</span><br><span class="line"></span><br><span class="line">	prepare_lock_switch(rq, next, rf);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Here we just switch the register state and the stack. */</span></span><br><span class="line">	switch_to(prev, next, prev);</span><br><span class="line">	barrier();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> finish_task_switch(prev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * nr_running and nr_context_switches:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * externally visible scheduler statistics: current number of runnable</span></span><br><span class="line"><span class="comment"> * threads, total number of context switches performed since bootup.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">nr_running</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> i, sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	for_each_online_cpu(i)</span><br><span class="line">		sum += cpu_rq(i)-&gt;nr_running;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Check if only the current task is running on the CPU.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Caution: this function does not check that the caller has disabled</span></span><br><span class="line"><span class="comment"> * preemption, thus the result might have a time-of-check-to-time-of-use</span></span><br><span class="line"><span class="comment"> * race.  The caller is responsible to use it correctly, for example:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - from a non-preemptible section (of course)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - from a thread that is bound to a single CPU</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - in a loop with very short iterations (e.g. a polling loop)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">single_task_running</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> raw_rq()-&gt;nr_running == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(single_task_running);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">nr_context_switches</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	for_each_possible_cpu(i)</span><br><span class="line">		sum += cpu_rq(i)-&gt;nr_switches;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Consumers of these two interfaces, like for example the cpuidle menu</span></span><br><span class="line"><span class="comment"> * governor, are using nonsensical data. Preferring shallow idle state selection</span></span><br><span class="line"><span class="comment"> * for a CPU that has IO-wait which might not even end up running the task when</span></span><br><span class="line"><span class="comment"> * it does become runnable.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">nr_iowait_cpu</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> atomic_read(&amp;cpu_rq(cpu)-&gt;nr_iowait);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * IO-wait accounting, and how its mostly bollocks (on SMP).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The idea behind IO-wait account is to account the idle time that we could</span></span><br><span class="line"><span class="comment"> * have spend running if it were not for IO. That is, if we were to improve the</span></span><br><span class="line"><span class="comment"> * storage performance, we'd have a proportional reduction in IO-wait time.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This all works nicely on UP, where, when a task blocks on IO, we account</span></span><br><span class="line"><span class="comment"> * idle time as IO-wait, because if the storage were faster, it could've been</span></span><br><span class="line"><span class="comment"> * running and we'd not be idle.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This has been extended to SMP, by doing the same for each CPU. This however</span></span><br><span class="line"><span class="comment"> * is broken.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Imagine for instance the case where two tasks block on one CPU, only the one</span></span><br><span class="line"><span class="comment"> * CPU will have IO-wait accounted, while the other has regular idle. Even</span></span><br><span class="line"><span class="comment"> * though, if the storage were faster, both could've ran at the same time,</span></span><br><span class="line"><span class="comment"> * utilising both CPUs.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This means, that when looking globally, the current IO-wait accounting on</span></span><br><span class="line"><span class="comment"> * SMP is a lower bound, by reason of under accounting.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Worse, since the numbers are provided per CPU, they are sometimes</span></span><br><span class="line"><span class="comment"> * interpreted per CPU, and that is nonsensical. A blocked task isn't strictly</span></span><br><span class="line"><span class="comment"> * associated with any one particular CPU, it can wake to another CPU than it</span></span><br><span class="line"><span class="comment"> * blocked on. This means the per CPU IO-wait number is meaningless.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Task CPU affinities can make all that even more 'interesting'.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">nr_iowait</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> i, sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	for_each_possible_cpu(i)</span><br><span class="line">		sum += nr_iowait_cpu(i);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * sched_exec - execve() is a valuable balancing opportunity, because at</span></span><br><span class="line"><span class="comment"> * this point the task has the smallest effective memory and cache footprint.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_exec</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span> = <span class="title">current</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line">	<span class="keyword">int</span> dest_cpu;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;p-&gt;pi_lock, flags);</span><br><span class="line">	dest_cpu = p-&gt;sched_class-&gt;select_task_rq(p, task_cpu(p), SD_BALANCE_EXEC, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (dest_cpu == smp_processor_id())</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (likely(cpu_active(dest_cpu))) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">migration_arg</span> <span class="title">arg</span> = &#123;</span> p, dest_cpu &#125;;</span><br><span class="line"></span><br><span class="line">		raw_spin_unlock_irqrestore(&amp;p-&gt;pi_lock, flags);</span><br><span class="line">		stop_one_cpu(task_cpu(p), migration_cpu_stop, &amp;arg);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">unlock:</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;p-&gt;pi_lock, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">DEFINE_PER_CPU(struct kernel_stat, kstat);</span><br><span class="line">DEFINE_PER_CPU(struct kernel_cpustat, kernel_cpustat);</span><br><span class="line"></span><br><span class="line">EXPORT_PER_CPU_SYMBOL(kstat);</span><br><span class="line">EXPORT_PER_CPU_SYMBOL(kernel_cpustat);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The function fair_sched_class.update_curr accesses the struct curr</span></span><br><span class="line"><span class="comment"> * and its field curr-&gt;exec_start; when called from task_sched_runtime(),</span></span><br><span class="line"><span class="comment"> * we observe a high rate of cache misses in practice.</span></span><br><span class="line"><span class="comment"> * Prefetching this data results in improved performance.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">prefetch_curr_exec_start</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_entity</span> *<span class="title">curr</span> = (&amp;<span class="title">p</span>-&gt;<span class="title">se</span>)-&gt;<span class="title">cfs_rq</span>-&gt;<span class="title">curr</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_entity</span> *<span class="title">curr</span> = (&amp;<span class="title">task_rq</span>(<span class="title">p</span>)-&gt;<span class="title">cfs</span>)-&gt;<span class="title">curr</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	prefetch(curr);</span><br><span class="line">	prefetch(&amp;curr-&gt;exec_start);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Return accounted runtime for the task.</span></span><br><span class="line"><span class="comment"> * In case the task is currently running, return the runtime plus current's</span></span><br><span class="line"><span class="comment"> * pending runtime that have not been accounted yet.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">task_sched_runtime</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line">	u64 ns;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_64BIT) &amp;&amp; defined(CONFIG_SMP)</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 64-bit doesn't need locks to atomically read a 64-bit value.</span></span><br><span class="line"><span class="comment">	 * So we have a optimization chance when the task's delta_exec is 0.</span></span><br><span class="line"><span class="comment">	 * Reading -&gt;on_cpu is racy, but this is ok.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If we race with it leaving CPU, we'll take a lock. So we're correct.</span></span><br><span class="line"><span class="comment">	 * If we race with it entering CPU, unaccounted time is 0. This is</span></span><br><span class="line"><span class="comment">	 * indistinguishable from the read occurring a few cycles earlier.</span></span><br><span class="line"><span class="comment">	 * If we see -&gt;on_cpu without -&gt;on_rq, the task is leaving, and has</span></span><br><span class="line"><span class="comment">	 * been accounted, so we're correct here as well.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!p-&gt;on_cpu || !task_on_rq_queued(p))</span><br><span class="line">		<span class="keyword">return</span> p-&gt;se.sum_exec_runtime;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	rq = task_rq_lock(p, &amp;rf);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Must be -&gt;curr _and_ -&gt;on_rq.  If dequeued, we would</span></span><br><span class="line"><span class="comment">	 * project cycles that may never be accounted to this</span></span><br><span class="line"><span class="comment">	 * thread, breaking clock_gettime().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (task_current(rq, p) &amp;&amp; task_on_rq_queued(p)) &#123;</span><br><span class="line">		prefetch_curr_exec_start(p);</span><br><span class="line">		update_rq_clock(rq);</span><br><span class="line">		p-&gt;sched_class-&gt;update_curr(rq);</span><br><span class="line">	&#125;</span><br><span class="line">	ns = p-&gt;se.sum_exec_runtime;</span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ns;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DEFINE_PER_CPU(<span class="keyword">unsigned</span> <span class="keyword">long</span>, thermal_pressure);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">arch_set_thermal_pressure</span><span class="params">(struct cpumask *cpus,</span></span></span><br><span class="line"><span class="function"><span class="params">			       <span class="keyword">unsigned</span> <span class="keyword">long</span> th_pressure)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> cpu;</span><br><span class="line"></span><br><span class="line">	for_each_cpu(cpu, cpus)</span><br><span class="line">		WRITE_ONCE(per_cpu(thermal_pressure, cpu), th_pressure);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This function gets called by the timer code, with HZ frequency.</span></span><br><span class="line"><span class="comment"> * We call it with interrupts disabled.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">scheduler_tick</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> cpu = smp_processor_id();</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">curr</span> = <span class="title">rq</span>-&gt;<span class="title">curr</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> thermal_pressure;</span><br><span class="line"></span><br><span class="line">	arch_scale_freq_tick();</span><br><span class="line">	sched_clock_tick();</span><br><span class="line"></span><br><span class="line">	rq_lock(rq, &amp;rf);</span><br><span class="line"></span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line">	thermal_pressure = arch_scale_thermal_pressure(cpu_of(rq));</span><br><span class="line">	update_thermal_load_avg(rq_clock_thermal(rq), rq, thermal_pressure);</span><br><span class="line">	curr-&gt;sched_class-&gt;task_tick(rq, curr, <span class="number">0</span>);</span><br><span class="line">	calc_global_load_tick(rq);</span><br><span class="line">	psi_task_tick(rq);</span><br><span class="line"></span><br><span class="line">	rq_unlock(rq, &amp;rf);</span><br><span class="line"></span><br><span class="line">	perf_event_task_tick();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	rq-&gt;idle_balance = idle_cpu(cpu);</span><br><span class="line">	trigger_load_balance(rq);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NO_HZ_FULL</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tick_work</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span>			cpu;</span><br><span class="line">	<span class="keyword">atomic_t</span>		state;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">delayed_work</span>	<span class="title">work</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Values for -&gt;state, see diagram below. */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TICK_SCHED_REMOTE_OFFLINE	0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TICK_SCHED_REMOTE_OFFLINING	1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TICK_SCHED_REMOTE_RUNNING	2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * State diagram for -&gt;state:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *          TICK_SCHED_REMOTE_OFFLINE</span></span><br><span class="line"><span class="comment"> *                    |   ^</span></span><br><span class="line"><span class="comment"> *                    |   |</span></span><br><span class="line"><span class="comment"> *                    |   | sched_tick_remote()</span></span><br><span class="line"><span class="comment"> *                    |   |</span></span><br><span class="line"><span class="comment"> *                    |   |</span></span><br><span class="line"><span class="comment"> *                    +--TICK_SCHED_REMOTE_OFFLINING</span></span><br><span class="line"><span class="comment"> *                    |   ^</span></span><br><span class="line"><span class="comment"> *                    |   |</span></span><br><span class="line"><span class="comment"> * sched_tick_start() |   | sched_tick_stop()</span></span><br><span class="line"><span class="comment"> *                    |   |</span></span><br><span class="line"><span class="comment"> *                    V   |</span></span><br><span class="line"><span class="comment"> *          TICK_SCHED_REMOTE_RUNNING</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Other transitions get WARN_ON_ONCE(), except that sched_tick_remote()</span></span><br><span class="line"><span class="comment"> * and sched_tick_start() are happy to leave the state in RUNNING.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">tick_work</span> __<span class="title">percpu</span> *<span class="title">tick_work_cpu</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sched_tick_remote</span><span class="params">(struct work_struct *work)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">delayed_work</span> *<span class="title">dwork</span> = <span class="title">to_delayed_work</span>(<span class="title">work</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tick_work</span> *<span class="title">twork</span> = <span class="title">container_of</span>(<span class="title">dwork</span>, <span class="title">struct</span> <span class="title">tick_work</span>, <span class="title">work</span>);</span></span><br><span class="line">	<span class="keyword">int</span> cpu = twork-&gt;cpu;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">curr</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	u64 delta;</span><br><span class="line">	<span class="keyword">int</span> os;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Handle the tick only if it appears the remote CPU is running in full</span></span><br><span class="line"><span class="comment">	 * dynticks mode. The check is racy by nature, but missing a tick or</span></span><br><span class="line"><span class="comment">	 * having one too much is no big deal because the scheduler tick updates</span></span><br><span class="line"><span class="comment">	 * statistics and checks timeslices in a time-independent way, regardless</span></span><br><span class="line"><span class="comment">	 * of when exactly it is running.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!tick_nohz_tick_stopped_cpu(cpu))</span><br><span class="line">		<span class="keyword">goto</span> out_requeue;</span><br><span class="line"></span><br><span class="line">	rq_lock_irq(rq, &amp;rf);</span><br><span class="line">	curr = rq-&gt;curr;</span><br><span class="line">	<span class="keyword">if</span> (cpu_is_offline(cpu))</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!is_idle_task(curr)) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Make sure the next tick runs within a reasonable</span></span><br><span class="line"><span class="comment">		 * amount of time.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		delta = rq_clock_task(rq) - curr-&gt;se.exec_start;</span><br><span class="line">		WARN_ON_ONCE(delta &gt; (u64)NSEC_PER_SEC * <span class="number">3</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	curr-&gt;sched_class-&gt;task_tick(rq, curr, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	calc_load_nohz_remote(rq);</span><br><span class="line">out_unlock:</span><br><span class="line">	rq_unlock_irq(rq, &amp;rf);</span><br><span class="line">out_requeue:</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Run the remote tick once per second (1Hz). This arbitrary</span></span><br><span class="line"><span class="comment">	 * frequency is large enough to avoid overload but short enough</span></span><br><span class="line"><span class="comment">	 * to keep scheduler internal stats reasonably up to date.  But</span></span><br><span class="line"><span class="comment">	 * first update state to reflect hotplug activity if required.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	os = atomic_fetch_add_unless(&amp;twork-&gt;state, <span class="number">-1</span>, TICK_SCHED_REMOTE_RUNNING);</span><br><span class="line">	WARN_ON_ONCE(os == TICK_SCHED_REMOTE_OFFLINE);</span><br><span class="line">	<span class="keyword">if</span> (os == TICK_SCHED_REMOTE_RUNNING)</span><br><span class="line">		queue_delayed_work(system_unbound_wq, dwork, HZ);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sched_tick_start</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> os;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tick_work</span> *<span class="title">twork</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (housekeeping_cpu(cpu, HK_FLAG_TICK))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	WARN_ON_ONCE(!tick_work_cpu);</span><br><span class="line"></span><br><span class="line">	twork = per_cpu_ptr(tick_work_cpu, cpu);</span><br><span class="line">	os = atomic_xchg(&amp;twork-&gt;state, TICK_SCHED_REMOTE_RUNNING);</span><br><span class="line">	WARN_ON_ONCE(os == TICK_SCHED_REMOTE_RUNNING);</span><br><span class="line">	<span class="keyword">if</span> (os == TICK_SCHED_REMOTE_OFFLINE) &#123;</span><br><span class="line">		twork-&gt;cpu = cpu;</span><br><span class="line">		INIT_DELAYED_WORK(&amp;twork-&gt;work, sched_tick_remote);</span><br><span class="line">		queue_delayed_work(system_unbound_wq, &amp;twork-&gt;work, HZ);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_HOTPLUG_CPU</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sched_tick_stop</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tick_work</span> *<span class="title">twork</span>;</span></span><br><span class="line">	<span class="keyword">int</span> os;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (housekeeping_cpu(cpu, HK_FLAG_TICK))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	WARN_ON_ONCE(!tick_work_cpu);</span><br><span class="line"></span><br><span class="line">	twork = per_cpu_ptr(tick_work_cpu, cpu);</span><br><span class="line">	<span class="comment">/* There cannot be competing actions, but don't rely on stop-machine. */</span></span><br><span class="line">	os = atomic_xchg(&amp;twork-&gt;state, TICK_SCHED_REMOTE_OFFLINING);</span><br><span class="line">	WARN_ON_ONCE(os != TICK_SCHED_REMOTE_RUNNING);</span><br><span class="line">	<span class="comment">/* Don't cancel, as this would mess up the state machine. */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_HOTPLUG_CPU */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> __init <span class="title">sched_tick_offload_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	tick_work_cpu = alloc_percpu(struct tick_work);</span><br><span class="line">	BUG_ON(!tick_work_cpu);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> <span class="comment">/* !CONFIG_NO_HZ_FULL */</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">sched_tick_start</span><span class="params">(<span class="keyword">int</span> cpu)</span> </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">sched_tick_stop</span><span class="params">(<span class="keyword">int</span> cpu)</span> </span>&#123; &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_PREEMPTION) &amp;&amp; (defined(CONFIG_DEBUG_PREEMPT) || \</span></span><br><span class="line">				defined(CONFIG_TRACE_PREEMPT_TOGGLE))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * If the value passed in is equal to the current preempt count</span></span><br><span class="line"><span class="comment"> * then we just disabled preemption. Start timing the latency.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">preempt_latency_start</span><span class="params">(<span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (preempt_count() == val) &#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">long</span> ip = get_lock_parent_ip();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_PREEMPT</span></span><br><span class="line">		current-&gt;preempt_disable_ip = ip;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">		trace_preempt_off(CALLER_ADDR0, ip);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preempt_count_add</span><span class="params">(<span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_PREEMPT</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Underflow?</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (DEBUG_LOCKS_WARN_ON((preempt_count() &lt; <span class="number">0</span>)))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	__preempt_count_add(val);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_PREEMPT</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Spinlock count overflowing soon?</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	DEBUG_LOCKS_WARN_ON((preempt_count() &amp; PREEMPT_MASK) &gt;=</span><br><span class="line">				PREEMPT_MASK - <span class="number">10</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	preempt_latency_start(val);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(preempt_count_add);</span><br><span class="line">NOKPROBE_SYMBOL(preempt_count_add);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * If the value passed in equals to the current preempt count</span></span><br><span class="line"><span class="comment"> * then we just enabled preemption. Stop timing the latency.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">preempt_latency_stop</span><span class="params">(<span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (preempt_count() == val)</span><br><span class="line">		trace_preempt_on(CALLER_ADDR0, get_lock_parent_ip());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preempt_count_sub</span><span class="params">(<span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_PREEMPT</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Underflow?</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (DEBUG_LOCKS_WARN_ON(val &gt; preempt_count()))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Is the spinlock portion underflowing?</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (DEBUG_LOCKS_WARN_ON((val &lt; PREEMPT_MASK) &amp;&amp;</span><br><span class="line">			!(preempt_count() &amp; PREEMPT_MASK)))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	preempt_latency_stop(val);</span><br><span class="line">	__preempt_count_sub(val);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(preempt_count_sub);</span><br><span class="line">NOKPROBE_SYMBOL(preempt_count_sub);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">preempt_latency_start</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">preempt_latency_stop</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123; &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">get_preempt_disable_ip</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_PREEMPT</span></span><br><span class="line">	<span class="keyword">return</span> p-&gt;preempt_disable_ip;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Print scheduling while atomic bug:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> noinline <span class="keyword">void</span> __schedule_bug(struct task_struct *prev)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* Save this before calling printk(), since that will clobber it */</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> preempt_disable_ip = get_preempt_disable_ip(current);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (oops_in_progress)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	printk(KERN_ERR <span class="string">"BUG: scheduling while atomic: %s/%d/0x%08x\n"</span>,</span><br><span class="line">		prev-&gt;comm, prev-&gt;pid, preempt_count());</span><br><span class="line"></span><br><span class="line">	debug_show_held_locks(prev);</span><br><span class="line">	print_modules();</span><br><span class="line">	<span class="keyword">if</span> (irqs_disabled())</span><br><span class="line">		print_irqtrace_events(prev);</span><br><span class="line">	<span class="keyword">if</span> (IS_ENABLED(CONFIG_DEBUG_PREEMPT)</span><br><span class="line">	    &amp;&amp; in_atomic_preempt_off()) &#123;</span><br><span class="line">		pr_err(<span class="string">"Preemption disabled at:"</span>);</span><br><span class="line">		print_ip_sym(KERN_ERR, preempt_disable_ip);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (panic_on_warn)</span><br><span class="line">		panic(<span class="string">"scheduling while atomic\n"</span>);</span><br><span class="line"></span><br><span class="line">	dump_stack();</span><br><span class="line">	add_taint(TAINT_WARN, LOCKDEP_STILL_OK);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Various schedule()-time debugging checks and statistics:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">schedule_debug</span><span class="params">(struct task_struct *prev, <span class="keyword">bool</span> preempt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHED_STACK_END_CHECK</span></span><br><span class="line">	<span class="keyword">if</span> (task_stack_end_corrupted(prev))</span><br><span class="line">		panic(<span class="string">"corrupted stack end detected inside scheduler\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_scs_end_corrupted(prev))</span><br><span class="line">		panic(<span class="string">"corrupted shadow stack detected inside scheduler\n"</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_ATOMIC_SLEEP</span></span><br><span class="line">	<span class="keyword">if</span> (!preempt &amp;&amp; prev-&gt;state &amp;&amp; prev-&gt;non_block_count) &#123;</span><br><span class="line">		printk(KERN_ERR <span class="string">"BUG: scheduling in a non-blocking section: %s/%d/%i\n"</span>,</span><br><span class="line">			prev-&gt;comm, prev-&gt;pid, prev-&gt;non_block_count);</span><br><span class="line">		dump_stack();</span><br><span class="line">		add_taint(TAINT_WARN, LOCKDEP_STILL_OK);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (unlikely(in_atomic_preempt_off())) &#123;</span><br><span class="line">		__schedule_bug(prev);</span><br><span class="line">		preempt_count_set(PREEMPT_DISABLED);</span><br><span class="line">	&#125;</span><br><span class="line">	rcu_sleep_check();</span><br><span class="line"></span><br><span class="line">	profile_hit(SCHED_PROFILING, __builtin_return_address(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">	schedstat_inc(this_rq()-&gt;sched_count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">put_prev_task_balance</span><span class="params">(struct rq *rq, struct task_struct *prev,</span></span></span><br><span class="line"><span class="function"><span class="params">				  struct rq_flags *rf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sched_class</span> *<span class="title">class</span>;</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We must do the balancing pass before put_prev_task(), such</span></span><br><span class="line"><span class="comment">	 * that when we release the rq-&gt;lock the task is in the same</span></span><br><span class="line"><span class="comment">	 * state as before we took rq-&gt;lock.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * We can terminate the balance pass as soon as we know there is</span></span><br><span class="line"><span class="comment">	 * a runnable task of @class priority or higher.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	for_class_range(class, prev-&gt;sched_class, &amp;idle_sched_class) &#123;</span><br><span class="line">		<span class="keyword">if</span> (class-&gt;balance(rq, prev, rf))</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	put_prev_task(rq, prev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Pick up the highest-prio task:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *</span></span><br><span class="line"><span class="class"><span class="title">pick_next_task</span>(<span class="title">struct</span> <span class="title">rq</span> *<span class="title">rq</span>, <span class="title">struct</span> <span class="title">task_struct</span> *<span class="title">prev</span>, <span class="title">struct</span> <span class="title">rq_flags</span> *<span class="title">rf</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sched_class</span> *<span class="title">class</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Optimization: we know that if all tasks are in the fair class we can</span></span><br><span class="line"><span class="comment">	 * call that function directly, but only if the @prev task wasn't of a</span></span><br><span class="line"><span class="comment">	 * higher scheduling class, because otherwise those loose the</span></span><br><span class="line"><span class="comment">	 * opportunity to pull in more work from other CPUs.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (likely((prev-&gt;sched_class == &amp;idle_sched_class ||</span><br><span class="line">		    prev-&gt;sched_class == &amp;fair_sched_class) &amp;&amp;</span><br><span class="line">		   rq-&gt;nr_running == rq-&gt;cfs.h_nr_running)) &#123;</span><br><span class="line"></span><br><span class="line">		p = pick_next_task_fair(rq, prev, rf);</span><br><span class="line">		<span class="keyword">if</span> (unlikely(p == RETRY_TASK))</span><br><span class="line">			<span class="keyword">goto</span> restart;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Assumes fair_sched_class-&gt;next == idle_sched_class */</span></span><br><span class="line">		<span class="keyword">if</span> (!p) &#123;</span><br><span class="line">			put_prev_task(rq, prev);</span><br><span class="line">			p = pick_next_task_idle(rq);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> p;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">restart:</span><br><span class="line">	put_prev_task_balance(rq, prev, rf);</span><br><span class="line"></span><br><span class="line">	for_each_class(class) &#123;</span><br><span class="line">		p = class-&gt;pick_next_task(rq);</span><br><span class="line">		<span class="keyword">if</span> (p)</span><br><span class="line">			<span class="keyword">return</span> p;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* The idle class should always have a runnable task: */</span></span><br><span class="line">	BUG();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * __schedule() is the main scheduler function.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The main means of driving the scheduler and thus entering this function are:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   1. Explicit blocking: mutex, semaphore, waitqueue, etc.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   2. TIF_NEED_RESCHED flag is checked on interrupt and userspace return</span></span><br><span class="line"><span class="comment"> *      paths. For example, see arch/x86/entry_64.S.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      To drive preemption between tasks, the scheduler sets the flag in timer</span></span><br><span class="line"><span class="comment"> *      interrupt handler scheduler_tick().</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   3. Wakeups don't really cause entry into schedule(). They add a</span></span><br><span class="line"><span class="comment"> *      task to the run-queue and that's it.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      Now, if the new task added to the run-queue preempts the current</span></span><br><span class="line"><span class="comment"> *      task, then the wakeup sets TIF_NEED_RESCHED and schedule() gets</span></span><br><span class="line"><span class="comment"> *      called on the nearest possible occasion:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *       - If the kernel is preemptible (CONFIG_PREEMPTION=y):</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *         - in syscall or exception context, at the next outmost</span></span><br><span class="line"><span class="comment"> *           preempt_enable(). (this might be as soon as the wake_up()'s</span></span><br><span class="line"><span class="comment"> *           spin_unlock()!)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *         - in IRQ context, return from interrupt-handler to</span></span><br><span class="line"><span class="comment"> *           preemptible context</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *       - If the kernel is not preemptible (CONFIG_PREEMPTION is not set)</span></span><br><span class="line"><span class="comment"> *         then at the next:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *          - cond_resched() call</span></span><br><span class="line"><span class="comment"> *          - explicit schedule() call</span></span><br><span class="line"><span class="comment"> *          - return from syscall or exception to user-space</span></span><br><span class="line"><span class="comment"> *          - return from interrupt-handler to user-space</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * WARNING: must be called with preemption disabled!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __sched notrace __schedule(<span class="keyword">bool</span> preempt)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">prev</span>, *<span class="title">next</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> *switch_count;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> prev_state;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line">	<span class="keyword">int</span> cpu;</span><br><span class="line"></span><br><span class="line">	cpu = smp_processor_id();</span><br><span class="line">	rq = cpu_rq(cpu);</span><br><span class="line">	prev = rq-&gt;curr;</span><br><span class="line"></span><br><span class="line">	schedule_debug(prev, preempt);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (sched_feat(HRTICK))</span><br><span class="line">		hrtick_clear(rq);</span><br><span class="line"></span><br><span class="line">	local_irq_disable();</span><br><span class="line">	rcu_note_context_switch(preempt);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Make sure that signal_pending_state()-&gt;signal_pending() below</span></span><br><span class="line"><span class="comment">	 * can't be reordered with __set_current_state(TASK_INTERRUPTIBLE)</span></span><br><span class="line"><span class="comment">	 * done by the caller to avoid the race with signal_wake_up():</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * __set_current_state(@state)		signal_wake_up()</span></span><br><span class="line"><span class="comment">	 * schedule()				  set_tsk_thread_flag(p, TIF_SIGPENDING)</span></span><br><span class="line"><span class="comment">	 *					  wake_up_state(p, state)</span></span><br><span class="line"><span class="comment">	 *   LOCK rq-&gt;lock			    LOCK p-&gt;pi_state</span></span><br><span class="line"><span class="comment">	 *   smp_mb__after_spinlock()		    smp_mb__after_spinlock()</span></span><br><span class="line"><span class="comment">	 *     if (signal_pending_state())	    if (p-&gt;state &amp; @state)</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Also, the membarrier system call requires a full memory barrier</span></span><br><span class="line"><span class="comment">	 * after coming from user-space, before storing to rq-&gt;curr.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rq_lock(rq, &amp;rf);</span><br><span class="line">	smp_mb__after_spinlock();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Promote REQ to ACT */</span></span><br><span class="line">	rq-&gt;clock_update_flags &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	switch_count = &amp;prev-&gt;nivcsw;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We must load prev-&gt;state once (task_struct::state is volatile), such</span></span><br><span class="line"><span class="comment">	 * that:</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *  - we form a control dependency vs deactivate_task() below.</span></span><br><span class="line"><span class="comment">	 *  - ptrace_&#123;,un&#125;freeze_traced() can change -&gt;state underneath us.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	prev_state = prev-&gt;state;</span><br><span class="line">	<span class="keyword">if</span> (!preempt &amp;&amp; prev_state) &#123;</span><br><span class="line">		<span class="keyword">if</span> (signal_pending_state(prev_state, prev)) &#123;</span><br><span class="line">			prev-&gt;state = TASK_RUNNING;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			prev-&gt;sched_contributes_to_load =</span><br><span class="line">				(prev_state &amp; TASK_UNINTERRUPTIBLE) &amp;&amp;</span><br><span class="line">				!(prev_state &amp; TASK_NOLOAD) &amp;&amp;</span><br><span class="line">				!(prev-&gt;flags &amp; PF_FROZEN);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (prev-&gt;sched_contributes_to_load)</span><br><span class="line">				rq-&gt;nr_uninterruptible++;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * __schedule()			ttwu()</span></span><br><span class="line"><span class="comment">			 *   prev_state = prev-&gt;state;    if (p-&gt;on_rq &amp;&amp; ...)</span></span><br><span class="line"><span class="comment">			 *   if (prev_state)		    goto out;</span></span><br><span class="line"><span class="comment">			 *     p-&gt;on_rq = 0;		  smp_acquire__after_ctrl_dep();</span></span><br><span class="line"><span class="comment">			 *				  p-&gt;state = TASK_WAKING</span></span><br><span class="line"><span class="comment">			 *</span></span><br><span class="line"><span class="comment">			 * Where __schedule() and ttwu() have matching control dependencies.</span></span><br><span class="line"><span class="comment">			 *</span></span><br><span class="line"><span class="comment">			 * After this, schedule() must not care about p-&gt;state any more.</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			deactivate_task(rq, prev, DEQUEUE_SLEEP | DEQUEUE_NOCLOCK);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (prev-&gt;in_iowait) &#123;</span><br><span class="line">				atomic_inc(&amp;rq-&gt;nr_iowait);</span><br><span class="line">				delayacct_blkio_start();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		switch_count = &amp;prev-&gt;nvcsw;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	next = pick_next_task(rq, prev, &amp;rf);</span><br><span class="line">	clear_tsk_need_resched(prev);</span><br><span class="line">	clear_preempt_need_resched();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (likely(prev != next)) &#123;</span><br><span class="line">		rq-&gt;nr_switches++;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * RCU users of rcu_dereference(rq-&gt;curr) may not see</span></span><br><span class="line"><span class="comment">		 * changes to task_struct made by pick_next_task().</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		RCU_INIT_POINTER(rq-&gt;curr, next);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * The membarrier system call requires each architecture</span></span><br><span class="line"><span class="comment">		 * to have a full memory barrier after updating</span></span><br><span class="line"><span class="comment">		 * rq-&gt;curr, before returning to user-space.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * Here are the schemes providing that barrier on the</span></span><br><span class="line"><span class="comment">		 * various architectures:</span></span><br><span class="line"><span class="comment">		 * - mm ? switch_mm() : mmdrop() for x86, s390, sparc, PowerPC.</span></span><br><span class="line"><span class="comment">		 *   switch_mm() rely on membarrier_arch_switch_mm() on PowerPC.</span></span><br><span class="line"><span class="comment">		 * - finish_lock_switch() for weakly-ordered</span></span><br><span class="line"><span class="comment">		 *   architectures where spin_unlock is a full barrier,</span></span><br><span class="line"><span class="comment">		 * - switch_to() for arm64 (weakly-ordered, spin_unlock</span></span><br><span class="line"><span class="comment">		 *   is a RELEASE barrier),</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		++*switch_count;</span><br><span class="line"></span><br><span class="line">		psi_sched_switch(prev, next, !task_on_rq_queued(prev));</span><br><span class="line"></span><br><span class="line">		trace_sched_switch(preempt, prev, next);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Also unlocks the rq: */</span></span><br><span class="line">		rq = context_switch(rq, prev, next, &amp;rf);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		rq-&gt;clock_update_flags &amp;= ~(RQCF_ACT_SKIP|RQCF_REQ_SKIP);</span><br><span class="line">		rq_unlock_irq(rq, &amp;rf);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	balance_callback(rq);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> __noreturn <span class="title">do_task_dead</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* Causes final put_task_struct in finish_task_switch(): */</span></span><br><span class="line">	set_special_state(TASK_DEAD);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Tell freezer to ignore us: */</span></span><br><span class="line">	current-&gt;flags |= PF_NOFREEZE;</span><br><span class="line"></span><br><span class="line">	__schedule(<span class="literal">false</span>);</span><br><span class="line">	BUG();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Avoid "noreturn function does return" - but don't continue if BUG() is a NOP: */</span></span><br><span class="line">	<span class="keyword">for</span> (;;)</span><br><span class="line">		cpu_relax();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">sched_submit_work</span><span class="params">(struct task_struct *tsk)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!tsk-&gt;state)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If a worker went to sleep, notify and ask workqueue whether</span></span><br><span class="line"><span class="comment">	 * it wants to wake up a task to maintain concurrency.</span></span><br><span class="line"><span class="comment">	 * As this function is called inside the schedule() context,</span></span><br><span class="line"><span class="comment">	 * we disable preemption to avoid it calling schedule() again</span></span><br><span class="line"><span class="comment">	 * in the possible wakeup of a kworker and because wq_worker_sleeping()</span></span><br><span class="line"><span class="comment">	 * requires it.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (tsk-&gt;flags &amp; (PF_WQ_WORKER | PF_IO_WORKER)) &#123;</span><br><span class="line">		preempt_disable();</span><br><span class="line">		<span class="keyword">if</span> (tsk-&gt;flags &amp; PF_WQ_WORKER)</span><br><span class="line">			wq_worker_sleeping(tsk);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			io_wq_worker_sleeping(tsk);</span><br><span class="line">		preempt_enable_no_resched();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (tsk_is_pi_blocked(tsk))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If we are going to sleep and we have plugged IO queued,</span></span><br><span class="line"><span class="comment">	 * make sure to submit it to avoid deadlocks.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (blk_needs_flush_plug(tsk))</span><br><span class="line">		blk_schedule_flush_plug(tsk);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sched_update_worker</span><span class="params">(struct task_struct *tsk)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (tsk-&gt;flags &amp; (PF_WQ_WORKER | PF_IO_WORKER)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (tsk-&gt;flags &amp; PF_WQ_WORKER)</span><br><span class="line">			wq_worker_running(tsk);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			io_wq_worker_running(tsk);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">asmlinkage __visible <span class="keyword">void</span> __sched <span class="title">schedule</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">tsk</span> = <span class="title">current</span>;</span></span><br><span class="line"></span><br><span class="line">	sched_submit_work(tsk);</span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		preempt_disable();</span><br><span class="line">		__schedule(<span class="literal">false</span>);</span><br><span class="line">		sched_preempt_enable_no_resched();</span><br><span class="line">	&#125; <span class="keyword">while</span> (need_resched());</span><br><span class="line">	sched_update_worker(tsk);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(schedule);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * synchronize_rcu_tasks() makes sure that no task is stuck in preempted</span></span><br><span class="line"><span class="comment"> * state (have scheduled out non-voluntarily) by making sure that all</span></span><br><span class="line"><span class="comment"> * tasks have either left the run queue or have gone into user space.</span></span><br><span class="line"><span class="comment"> * As idle tasks do not do either, they must not ever be preempted</span></span><br><span class="line"><span class="comment"> * (schedule out non-voluntarily).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * schedule_idle() is similar to schedule_preempt_disable() except that it</span></span><br><span class="line"><span class="comment"> * never enables preemption because it does not call sched_submit_work().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> __sched <span class="title">schedule_idle</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * As this skips calling sched_submit_work(), which the idle task does</span></span><br><span class="line"><span class="comment">	 * regardless because that function is a nop when the task is in a</span></span><br><span class="line"><span class="comment">	 * TASK_RUNNING state, make sure this isn't used someplace that the</span></span><br><span class="line"><span class="comment">	 * current task can be in any other state. Note, idle is always in the</span></span><br><span class="line"><span class="comment">	 * TASK_RUNNING state.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	WARN_ON_ONCE(current-&gt;state);</span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		__schedule(<span class="literal">false</span>);</span><br><span class="line">	&#125; <span class="keyword">while</span> (need_resched());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CONTEXT_TRACKING</span></span><br><span class="line"><span class="function">asmlinkage __visible <span class="keyword">void</span> __sched <span class="title">schedule_user</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If we come here after a random call to set_need_resched(),</span></span><br><span class="line"><span class="comment">	 * or we have been woken up remotely but the IPI has not yet arrived,</span></span><br><span class="line"><span class="comment">	 * we haven't yet exited the RCU idle mode. Do it here manually until</span></span><br><span class="line"><span class="comment">	 * we find a better solution.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * NB: There are buggy callers of this function.  Ideally we</span></span><br><span class="line"><span class="comment">	 * should warn if prev_state != CONTEXT_USER, but that will trigger</span></span><br><span class="line"><span class="comment">	 * too frequently to make sense yet.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">enum</span> ctx_state prev_state = exception_enter();</span><br><span class="line">	schedule();</span><br><span class="line">	exception_exit(prev_state);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * schedule_preempt_disabled - called with preemption disabled</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Returns with preemption disabled. Note: preempt_count must be 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> __sched <span class="title">schedule_preempt_disabled</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sched_preempt_enable_no_resched();</span><br><span class="line">	schedule();</span><br><span class="line">	preempt_disable();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> __sched notrace <span class="title">preempt_schedule_common</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Because the function tracer can trace preempt_count_sub()</span></span><br><span class="line"><span class="comment">		 * and it also uses preempt_enable/disable_notrace(), if</span></span><br><span class="line"><span class="comment">		 * NEED_RESCHED is set, the preempt_enable_notrace() called</span></span><br><span class="line"><span class="comment">		 * by the function tracer will call this function again and</span></span><br><span class="line"><span class="comment">		 * cause infinite recursion.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * Preemption must be disabled here before the function</span></span><br><span class="line"><span class="comment">		 * tracer can trace. Break up preempt_disable() into two</span></span><br><span class="line"><span class="comment">		 * calls. One to disable preemption without fear of being</span></span><br><span class="line"><span class="comment">		 * traced. The other to still record the preemption latency,</span></span><br><span class="line"><span class="comment">		 * which can also be traced by the function tracer.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		preempt_disable_notrace();</span><br><span class="line">		preempt_latency_start(<span class="number">1</span>);</span><br><span class="line">		__schedule(<span class="literal">true</span>);</span><br><span class="line">		preempt_latency_stop(<span class="number">1</span>);</span><br><span class="line">		preempt_enable_no_resched_notrace();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Check again in case we missed a preemption opportunity</span></span><br><span class="line"><span class="comment">		 * between schedule and now.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">	&#125; <span class="keyword">while</span> (need_resched());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_PREEMPTION</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is the entry point to schedule() from in-kernel preemption</span></span><br><span class="line"><span class="comment"> * off of preempt_enable.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">asmlinkage __visible <span class="keyword">void</span> __sched notrace <span class="title">preempt_schedule</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If there is a non-zero preempt_count or interrupts are disabled,</span></span><br><span class="line"><span class="comment">	 * we do not want to preempt the current task. Just return..</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (likely(!preemptible()))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	preempt_schedule_common();</span><br><span class="line">&#125;</span><br><span class="line">NOKPROBE_SYMBOL(preempt_schedule);</span><br><span class="line">EXPORT_SYMBOL(preempt_schedule);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * preempt_schedule_notrace - preempt_schedule called by tracing</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The tracing infrastructure uses preempt_enable_notrace to prevent</span></span><br><span class="line"><span class="comment"> * recursion and tracing preempt enabling caused by the tracing</span></span><br><span class="line"><span class="comment"> * infrastructure itself. But as tracing can happen in areas coming</span></span><br><span class="line"><span class="comment"> * from userspace or just about to enter userspace, a preempt enable</span></span><br><span class="line"><span class="comment"> * can occur before user_exit() is called. This will cause the scheduler</span></span><br><span class="line"><span class="comment"> * to be called when the system is still in usermode.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * To prevent this, the preempt_enable_notrace will use this function</span></span><br><span class="line"><span class="comment"> * instead of preempt_schedule() to exit user context if needed before</span></span><br><span class="line"><span class="comment"> * calling the scheduler.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">asmlinkage __visible <span class="keyword">void</span> __sched notrace <span class="title">preempt_schedule_notrace</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">enum</span> ctx_state prev_ctx;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (likely(!preemptible()))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Because the function tracer can trace preempt_count_sub()</span></span><br><span class="line"><span class="comment">		 * and it also uses preempt_enable/disable_notrace(), if</span></span><br><span class="line"><span class="comment">		 * NEED_RESCHED is set, the preempt_enable_notrace() called</span></span><br><span class="line"><span class="comment">		 * by the function tracer will call this function again and</span></span><br><span class="line"><span class="comment">		 * cause infinite recursion.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * Preemption must be disabled here before the function</span></span><br><span class="line"><span class="comment">		 * tracer can trace. Break up preempt_disable() into two</span></span><br><span class="line"><span class="comment">		 * calls. One to disable preemption without fear of being</span></span><br><span class="line"><span class="comment">		 * traced. The other to still record the preemption latency,</span></span><br><span class="line"><span class="comment">		 * which can also be traced by the function tracer.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		preempt_disable_notrace();</span><br><span class="line">		preempt_latency_start(<span class="number">1</span>);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Needs preempt disabled in case user_exit() is traced</span></span><br><span class="line"><span class="comment">		 * and the tracer calls preempt_enable_notrace() causing</span></span><br><span class="line"><span class="comment">		 * an infinite recursion.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		prev_ctx = exception_enter();</span><br><span class="line">		__schedule(<span class="literal">true</span>);</span><br><span class="line">		exception_exit(prev_ctx);</span><br><span class="line"></span><br><span class="line">		preempt_latency_stop(<span class="number">1</span>);</span><br><span class="line">		preempt_enable_no_resched_notrace();</span><br><span class="line">	&#125; <span class="keyword">while</span> (need_resched());</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(preempt_schedule_notrace);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_PREEMPTION */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is the entry point to schedule() from kernel preemption</span></span><br><span class="line"><span class="comment"> * off of irq context.</span></span><br><span class="line"><span class="comment"> * Note, that this is called and return with irqs disabled. This will</span></span><br><span class="line"><span class="comment"> * protect us against recursive calling from irq.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">asmlinkage __visible <span class="keyword">void</span> __sched <span class="title">preempt_schedule_irq</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">enum</span> ctx_state prev_state;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Catch callers which need to be fixed */</span></span><br><span class="line">	BUG_ON(preempt_count() || !irqs_disabled());</span><br><span class="line"></span><br><span class="line">	prev_state = exception_enter();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		preempt_disable();</span><br><span class="line">		local_irq_enable();</span><br><span class="line">		__schedule(<span class="literal">true</span>);</span><br><span class="line">		local_irq_disable();</span><br><span class="line">		sched_preempt_enable_no_resched();</span><br><span class="line">	&#125; <span class="keyword">while</span> (need_resched());</span><br><span class="line"></span><br><span class="line">	exception_exit(prev_state);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">default_wake_function</span><span class="params">(<span class="keyword">wait_queue_entry_t</span> *curr, <span class="keyword">unsigned</span> mode, <span class="keyword">int</span> wake_flags,</span></span></span><br><span class="line"><span class="function"><span class="params">			  <span class="keyword">void</span> *key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	WARN_ON_ONCE(IS_ENABLED(CONFIG_SCHED_DEBUG) &amp;&amp; wake_flags &amp; ~WF_SYNC);</span><br><span class="line">	<span class="keyword">return</span> try_to_wake_up(curr-&gt;<span class="keyword">private</span>, mode, wake_flags);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(default_wake_function);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RT_MUTEXES</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> __rt_effective_prio(struct task_struct *pi_task, <span class="keyword">int</span> prio)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (pi_task)</span><br><span class="line">		prio = min(prio, pi_task-&gt;prio);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> prio;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rt_effective_prio</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> prio)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">pi_task</span> = <span class="title">rt_mutex_get_top_task</span>(<span class="title">p</span>);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> __rt_effective_prio(pi_task, prio);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * rt_mutex_setprio - set the current priority of a task</span></span><br><span class="line"><span class="comment"> * @p: task to boost</span></span><br><span class="line"><span class="comment"> * @pi_task: donor task</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function changes the 'effective' priority of a task. It does</span></span><br><span class="line"><span class="comment"> * not touch -&gt;normal_prio like __setscheduler().</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Used by the rt_mutex code to implement priority inheritance</span></span><br><span class="line"><span class="comment"> * logic. Call site only calls if the priority of the task changed.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rt_mutex_setprio</span><span class="params">(struct task_struct *p, struct task_struct *pi_task)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> prio, oldprio, queued, running, queue_flag =</span><br><span class="line">		DEQUEUE_SAVE | DEQUEUE_MOVE | DEQUEUE_NOCLOCK;</span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sched_class</span> *<span class="title">prev_class</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* XXX used to be waiter-&gt;prio, not waiter-&gt;task-&gt;prio */</span></span><br><span class="line">	prio = __rt_effective_prio(pi_task, p-&gt;normal_prio);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If nothing changed; bail early.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;pi_top_task == pi_task &amp;&amp; prio == p-&gt;prio &amp;&amp; !dl_prio(prio))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	rq = __task_rq_lock(p, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Set under pi_lock &amp;&amp; rq-&gt;lock, such that the value can be used under</span></span><br><span class="line"><span class="comment">	 * either lock.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Note that there is loads of tricky to make this pointer cache work</span></span><br><span class="line"><span class="comment">	 * right. rt_mutex_slowunlock()+rt_mutex_postunlock() work together to</span></span><br><span class="line"><span class="comment">	 * ensure a task is de-boosted (pi_task is set to NULL) before the</span></span><br><span class="line"><span class="comment">	 * task is allowed to run again (and can exit). This ensures the pointer</span></span><br><span class="line"><span class="comment">	 * points to a blocked task -- which guaratees the task is present.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	p-&gt;pi_top_task = pi_task;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * For FIFO/RR we only need to set prio, if that matches we're done.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (prio == p-&gt;prio &amp;&amp; !dl_prio(prio))</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Idle task boosting is a nono in general. There is one</span></span><br><span class="line"><span class="comment">	 * exception, when PREEMPT_RT and NOHZ is active:</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * The idle task calls get_next_timer_interrupt() and holds</span></span><br><span class="line"><span class="comment">	 * the timer wheel base-&gt;lock on the CPU and another CPU wants</span></span><br><span class="line"><span class="comment">	 * to access the timer (probably to cancel it). We can safely</span></span><br><span class="line"><span class="comment">	 * ignore the boosting request, as the idle CPU runs this code</span></span><br><span class="line"><span class="comment">	 * with interrupts disabled and will complete the lock</span></span><br><span class="line"><span class="comment">	 * protected section without being interrupted. So there is no</span></span><br><span class="line"><span class="comment">	 * real need to boost.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (unlikely(p == rq-&gt;idle)) &#123;</span><br><span class="line">		WARN_ON(p != rq-&gt;curr);</span><br><span class="line">		WARN_ON(p-&gt;pi_blocked_on);</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	trace_sched_pi_setprio(p, pi_task);</span><br><span class="line">	oldprio = p-&gt;prio;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (oldprio == prio)</span><br><span class="line">		queue_flag &amp;= ~DEQUEUE_MOVE;</span><br><span class="line"></span><br><span class="line">	prev_class = p-&gt;sched_class;</span><br><span class="line">	queued = task_on_rq_queued(p);</span><br><span class="line">	running = task_current(rq, p);</span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		dequeue_task(rq, p, queue_flag);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		put_prev_task(rq, p);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Boosting condition are:</span></span><br><span class="line"><span class="comment">	 * 1. -rt task is running and holds mutex A</span></span><br><span class="line"><span class="comment">	 *      --&gt; -dl task blocks on mutex A</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * 2. -dl task is running and holds mutex A</span></span><br><span class="line"><span class="comment">	 *      --&gt; -dl task blocks on mutex A and could preempt the</span></span><br><span class="line"><span class="comment">	 *          running task</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (dl_prio(prio)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!dl_prio(p-&gt;normal_prio) ||</span><br><span class="line">		    (pi_task &amp;&amp; dl_prio(pi_task-&gt;prio) &amp;&amp;</span><br><span class="line">		     dl_entity_preempt(&amp;pi_task-&gt;dl, &amp;p-&gt;dl))) &#123;</span><br><span class="line">			p-&gt;dl.dl_boosted = <span class="number">1</span>;</span><br><span class="line">			queue_flag |= ENQUEUE_REPLENISH;</span><br><span class="line">		&#125; <span class="keyword">else</span></span><br><span class="line">			p-&gt;dl.dl_boosted = <span class="number">0</span>;</span><br><span class="line">		p-&gt;sched_class = &amp;dl_sched_class;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (rt_prio(prio)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dl_prio(oldprio))</span><br><span class="line">			p-&gt;dl.dl_boosted = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (oldprio &lt; prio)</span><br><span class="line">			queue_flag |= ENQUEUE_HEAD;</span><br><span class="line">		p-&gt;sched_class = &amp;rt_sched_class;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (dl_prio(oldprio))</span><br><span class="line">			p-&gt;dl.dl_boosted = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (rt_prio(oldprio))</span><br><span class="line">			p-&gt;rt.timeout = <span class="number">0</span>;</span><br><span class="line">		p-&gt;sched_class = &amp;fair_sched_class;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	p-&gt;prio = prio;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		enqueue_task(rq, p, queue_flag);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		set_next_task(rq, p);</span><br><span class="line"></span><br><span class="line">	check_class_changed(rq, p, prev_class, oldprio);</span><br><span class="line">out_unlock:</span><br><span class="line">	<span class="comment">/* Avoid rq from going away on us: */</span></span><br><span class="line">	preempt_disable();</span><br><span class="line">	__task_rq_unlock(rq, &amp;rf);</span><br><span class="line"></span><br><span class="line">	balance_callback(rq);</span><br><span class="line">	preempt_enable();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rt_effective_prio</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> prio)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> prio;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_user_nice</span><span class="params">(struct task_struct *p, <span class="keyword">long</span> nice)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> queued, running;</span><br><span class="line">	<span class="keyword">int</span> old_prio;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_nice(p) == nice || nice &lt; MIN_NICE || nice &gt; MAX_NICE)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We have to be careful, if called from sys_setpriority(),</span></span><br><span class="line"><span class="comment">	 * the task might be in the middle of scheduling on another CPU.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rq = task_rq_lock(p, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The RT priorities are set via sched_setscheduler(), but we still</span></span><br><span class="line"><span class="comment">	 * allow the 'normal' nice value to be set - but as expected</span></span><br><span class="line"><span class="comment">	 * it wont have any effect on scheduling until the task is</span></span><br><span class="line"><span class="comment">	 * SCHED_DEADLINE, SCHED_FIFO or SCHED_RR:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (task_has_dl_policy(p) || task_has_rt_policy(p)) &#123;</span><br><span class="line">		p-&gt;static_prio = NICE_TO_PRIO(nice);</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line">	&#125;</span><br><span class="line">	queued = task_on_rq_queued(p);</span><br><span class="line">	running = task_current(rq, p);</span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		dequeue_task(rq, p, DEQUEUE_SAVE | DEQUEUE_NOCLOCK);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		put_prev_task(rq, p);</span><br><span class="line"></span><br><span class="line">	p-&gt;static_prio = NICE_TO_PRIO(nice);</span><br><span class="line">	set_load_weight(p, <span class="literal">true</span>);</span><br><span class="line">	old_prio = p-&gt;prio;</span><br><span class="line">	p-&gt;prio = effective_prio(p);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		enqueue_task(rq, p, ENQUEUE_RESTORE | ENQUEUE_NOCLOCK);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		set_next_task(rq, p);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If the task increased its priority or is running and</span></span><br><span class="line"><span class="comment">	 * lowered its priority, then reschedule its CPU:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	p-&gt;sched_class-&gt;prio_changed(rq, p, old_prio);</span><br><span class="line"></span><br><span class="line">out_unlock:</span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(set_user_nice);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * can_nice - check if a task can reduce its nice value</span></span><br><span class="line"><span class="comment"> * @p: task</span></span><br><span class="line"><span class="comment"> * @nice: nice value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">can_nice</span><span class="params">(<span class="keyword">const</span> struct task_struct *p, <span class="keyword">const</span> <span class="keyword">int</span> nice)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* Convert nice value [19,-20] to rlimit style value [1,40]: */</span></span><br><span class="line">	<span class="keyword">int</span> nice_rlim = nice_to_rlimit(nice);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (nice_rlim &lt;= task_rlimit(p, RLIMIT_NICE) ||</span><br><span class="line">		capable(CAP_SYS_NICE));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __ARCH_WANT_SYS_NICE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * sys_nice - change the priority of the current process.</span></span><br><span class="line"><span class="comment"> * @increment: priority increment</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * sys_setpriority is a more generic, but much slower function that</span></span><br><span class="line"><span class="comment"> * does similar things.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE1(nice, <span class="keyword">int</span>, increment)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">long</span> nice, retval;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Setpriority might change our priority at the same moment.</span></span><br><span class="line"><span class="comment">	 * We don't have to worry. Conceptually one call occurs first</span></span><br><span class="line"><span class="comment">	 * and we have a single winner.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	increment = clamp(increment, -NICE_WIDTH, NICE_WIDTH);</span><br><span class="line">	nice = task_nice(current) + increment;</span><br><span class="line"></span><br><span class="line">	nice = clamp_val(nice, MIN_NICE, MAX_NICE);</span><br><span class="line">	<span class="keyword">if</span> (increment &lt; <span class="number">0</span> &amp;&amp; !can_nice(current, nice))</span><br><span class="line">		<span class="keyword">return</span> -EPERM;</span><br><span class="line"></span><br><span class="line">	retval = security_task_setnice(current, nice);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">return</span> retval;</span><br><span class="line"></span><br><span class="line">	set_user_nice(current, nice);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * task_prio - return the priority value of a given task.</span></span><br><span class="line"><span class="comment"> * @p: the task in question.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: The priority value as seen by users in /proc.</span></span><br><span class="line"><span class="comment"> * RT tasks are offset by -200. Normal tasks are centered</span></span><br><span class="line"><span class="comment"> * around 0, value goes from -16 to +15.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">task_prio</span><span class="params">(<span class="keyword">const</span> struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> p-&gt;prio - MAX_RT_PRIO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * idle_cpu - is a given CPU idle currently?</span></span><br><span class="line"><span class="comment"> * @cpu: the processor in question.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 1 if the CPU is currently idle. 0 otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">idle_cpu</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;curr != rq-&gt;idle)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;nr_running)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;ttwu_pending)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * available_idle_cpu - is a given CPU idle for enqueuing work.</span></span><br><span class="line"><span class="comment"> * @cpu: the CPU in question.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 1 if the CPU is currently idle. 0 otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">available_idle_cpu</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!idle_cpu(cpu))</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (vcpu_is_preempted(cpu))</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * idle_task - return the idle task for a given CPU.</span></span><br><span class="line"><span class="comment"> * @cpu: the processor in question.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: The idle task for the CPU @cpu.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">struct task_struct *<span class="title">idle_task</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> cpu_rq(cpu)-&gt;idle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * find_process_by_pid - find a process with a matching PID value.</span></span><br><span class="line"><span class="comment"> * @pid: the pid in question.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The task of @pid, if found. %NULL otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> struct task_struct *<span class="title">find_process_by_pid</span><span class="params">(<span class="keyword">pid_t</span> pid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> pid ? find_task_by_vpid(pid) : current;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * sched_setparam() passes in -1 for its policy, to let the functions</span></span><br><span class="line"><span class="comment"> * it calls know not to change it.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SETPARAM_POLICY	-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __setscheduler_params(struct task_struct *p,</span><br><span class="line">		<span class="keyword">const</span> struct sched_attr *attr)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> policy = attr-&gt;sched_policy;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (policy == SETPARAM_POLICY)</span><br><span class="line">		policy = p-&gt;policy;</span><br><span class="line"></span><br><span class="line">	p-&gt;policy = policy;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (dl_policy(policy))</span><br><span class="line">		__setparam_dl(p, attr);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (fair_policy(policy))</span><br><span class="line">		p-&gt;static_prio = NICE_TO_PRIO(attr-&gt;sched_nice);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * __sched_setscheduler() ensures attr-&gt;sched_priority == 0 when</span></span><br><span class="line"><span class="comment">	 * !rt_policy. Always setting this ensures that things like</span></span><br><span class="line"><span class="comment">	 * getparam()/getattr() don't report silly values for !rt tasks.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	p-&gt;rt_priority = attr-&gt;sched_priority;</span><br><span class="line">	p-&gt;normal_prio = normal_prio(p);</span><br><span class="line">	set_load_weight(p, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Actually do priority change: must hold pi &amp; rq lock. */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __setscheduler(struct rq *rq, struct task_struct *p,</span><br><span class="line">			   <span class="keyword">const</span> struct sched_attr *attr, <span class="keyword">bool</span> keep_boost)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If params can't change scheduling class changes aren't allowed</span></span><br><span class="line"><span class="comment">	 * either.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (attr-&gt;sched_flags &amp; SCHED_FLAG_KEEP_PARAMS)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	__setscheduler_params(p, attr);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Keep a potential priority boosting if called from</span></span><br><span class="line"><span class="comment">	 * sched_setscheduler().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	p-&gt;prio = normal_prio(p);</span><br><span class="line">	<span class="keyword">if</span> (keep_boost)</span><br><span class="line">		p-&gt;prio = rt_effective_prio(p, p-&gt;prio);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (dl_prio(p-&gt;prio))</span><br><span class="line">		p-&gt;sched_class = &amp;dl_sched_class;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (rt_prio(p-&gt;prio))</span><br><span class="line">		p-&gt;sched_class = &amp;rt_sched_class;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		p-&gt;sched_class = &amp;fair_sched_class;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Check the target process has a UID that matches the current process's:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">check_same_owner</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cred</span> *<span class="title">cred</span> = <span class="title">current_cred</span>(), *<span class="title">pcred</span>;</span></span><br><span class="line">	<span class="keyword">bool</span> match;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	pcred = __task_cred(p);</span><br><span class="line">	match = (uid_eq(cred-&gt;euid, pcred-&gt;euid) ||</span><br><span class="line">		 uid_eq(cred-&gt;euid, pcred-&gt;uid));</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	<span class="keyword">return</span> match;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> __sched_setscheduler(struct task_struct *p,</span><br><span class="line">				<span class="keyword">const</span> struct sched_attr *attr,</span><br><span class="line">				<span class="keyword">bool</span> user, <span class="keyword">bool</span> pi)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> newprio = dl_policy(attr-&gt;sched_policy) ? MAX_DL_PRIO - <span class="number">1</span> :</span><br><span class="line">		      MAX_RT_PRIO - <span class="number">1</span> - attr-&gt;sched_priority;</span><br><span class="line">	<span class="keyword">int</span> retval, oldprio, oldpolicy = <span class="number">-1</span>, queued, running;</span><br><span class="line">	<span class="keyword">int</span> new_effective_prio, policy = attr-&gt;sched_policy;</span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sched_class</span> *<span class="title">prev_class</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="keyword">int</span> reset_on_fork;</span><br><span class="line">	<span class="keyword">int</span> queue_flags = DEQUEUE_SAVE | DEQUEUE_MOVE | DEQUEUE_NOCLOCK;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* The pi code expects interrupts enabled */</span></span><br><span class="line">	BUG_ON(pi &amp;&amp; in_interrupt());</span><br><span class="line">recheck:</span><br><span class="line">	<span class="comment">/* Double check policy once rq lock held: */</span></span><br><span class="line">	<span class="keyword">if</span> (policy &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		reset_on_fork = p-&gt;sched_reset_on_fork;</span><br><span class="line">		policy = oldpolicy = p-&gt;policy;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		reset_on_fork = !!(attr-&gt;sched_flags &amp; SCHED_FLAG_RESET_ON_FORK);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!valid_policy(policy))</span><br><span class="line">			<span class="keyword">return</span> -EINVAL;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (attr-&gt;sched_flags &amp; ~(SCHED_FLAG_ALL | SCHED_FLAG_SUGOV))</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Valid priorities for SCHED_FIFO and SCHED_RR are</span></span><br><span class="line"><span class="comment">	 * 1..MAX_USER_RT_PRIO-1, valid priority for SCHED_NORMAL,</span></span><br><span class="line"><span class="comment">	 * SCHED_BATCH and SCHED_IDLE is 0.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> ((p-&gt;mm &amp;&amp; attr-&gt;sched_priority &gt; MAX_USER_RT_PRIO<span class="number">-1</span>) ||</span><br><span class="line">	    (!p-&gt;mm &amp;&amp; attr-&gt;sched_priority &gt; MAX_RT_PRIO<span class="number">-1</span>))</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> ((dl_policy(policy) &amp;&amp; !__checkparam_dl(attr)) ||</span><br><span class="line">	    (rt_policy(policy) != (attr-&gt;sched_priority != <span class="number">0</span>)))</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Allow unprivileged RT tasks to decrease priority:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (user &amp;&amp; !capable(CAP_SYS_NICE)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (fair_policy(policy)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (attr-&gt;sched_nice &lt; task_nice(p) &amp;&amp;</span><br><span class="line">			    !can_nice(p, attr-&gt;sched_nice))</span><br><span class="line">				<span class="keyword">return</span> -EPERM;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (rt_policy(policy)) &#123;</span><br><span class="line">			<span class="keyword">unsigned</span> <span class="keyword">long</span> rlim_rtprio =</span><br><span class="line">					task_rlimit(p, RLIMIT_RTPRIO);</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* Can't set/change the rt policy: */</span></span><br><span class="line">			<span class="keyword">if</span> (policy != p-&gt;policy &amp;&amp; !rlim_rtprio)</span><br><span class="line">				<span class="keyword">return</span> -EPERM;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* Can't increase priority: */</span></span><br><span class="line">			<span class="keyword">if</span> (attr-&gt;sched_priority &gt; p-&gt;rt_priority &amp;&amp;</span><br><span class="line">			    attr-&gt;sched_priority &gt; rlim_rtprio)</span><br><span class="line">				<span class="keyword">return</span> -EPERM;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		 <span class="comment">/*</span></span><br><span class="line"><span class="comment">		  * Can't set/change SCHED_DEADLINE policy at all for now</span></span><br><span class="line"><span class="comment">		  * (safest behavior); in the future we would like to allow</span></span><br><span class="line"><span class="comment">		  * unprivileged DL tasks to increase their relative deadline</span></span><br><span class="line"><span class="comment">		  * or reduce their runtime (both ways reducing utilization)</span></span><br><span class="line"><span class="comment">		  */</span></span><br><span class="line">		<span class="keyword">if</span> (dl_policy(policy))</span><br><span class="line">			<span class="keyword">return</span> -EPERM;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Treat SCHED_IDLE as nice 20. Only allow a switch to</span></span><br><span class="line"><span class="comment">		 * SCHED_NORMAL if the RLIMIT_NICE would normally permit it.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (task_has_idle_policy(p) &amp;&amp; !idle_policy(policy)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!can_nice(p, task_nice(p)))</span><br><span class="line">				<span class="keyword">return</span> -EPERM;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Can't change other user's priorities: */</span></span><br><span class="line">		<span class="keyword">if</span> (!check_same_owner(p))</span><br><span class="line">			<span class="keyword">return</span> -EPERM;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Normal users shall not reset the sched_reset_on_fork flag: */</span></span><br><span class="line">		<span class="keyword">if</span> (p-&gt;sched_reset_on_fork &amp;&amp; !reset_on_fork)</span><br><span class="line">			<span class="keyword">return</span> -EPERM;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (user) &#123;</span><br><span class="line">		<span class="keyword">if</span> (attr-&gt;sched_flags &amp; SCHED_FLAG_SUGOV)</span><br><span class="line">			<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">		retval = security_task_setscheduler(p);</span><br><span class="line">		<span class="keyword">if</span> (retval)</span><br><span class="line">			<span class="keyword">return</span> retval;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Update task specific "requested" clamps */</span></span><br><span class="line">	<span class="keyword">if</span> (attr-&gt;sched_flags &amp; SCHED_FLAG_UTIL_CLAMP) &#123;</span><br><span class="line">		retval = uclamp_validate(p, attr);</span><br><span class="line">		<span class="keyword">if</span> (retval)</span><br><span class="line">			<span class="keyword">return</span> retval;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pi)</span><br><span class="line">		cpuset_read_lock();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Make sure no PI-waiters arrive (or leave) while we are</span></span><br><span class="line"><span class="comment">	 * changing the priority of the task:</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * To be able to change p-&gt;policy safely, the appropriate</span></span><br><span class="line"><span class="comment">	 * runqueue lock must be held.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rq = task_rq_lock(p, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Changing the policy of the stop threads its a very bad idea:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (p == rq-&gt;stop) &#123;</span><br><span class="line">		retval = -EINVAL;</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If not changing anything there's no need to proceed further,</span></span><br><span class="line"><span class="comment">	 * but store a possible modification of reset_on_fork.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (unlikely(policy == p-&gt;policy)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (fair_policy(policy) &amp;&amp; attr-&gt;sched_nice != task_nice(p))</span><br><span class="line">			<span class="keyword">goto</span> change;</span><br><span class="line">		<span class="keyword">if</span> (rt_policy(policy) &amp;&amp; attr-&gt;sched_priority != p-&gt;rt_priority)</span><br><span class="line">			<span class="keyword">goto</span> change;</span><br><span class="line">		<span class="keyword">if</span> (dl_policy(policy) &amp;&amp; dl_param_changed(p, attr))</span><br><span class="line">			<span class="keyword">goto</span> change;</span><br><span class="line">		<span class="keyword">if</span> (attr-&gt;sched_flags &amp; SCHED_FLAG_UTIL_CLAMP)</span><br><span class="line">			<span class="keyword">goto</span> change;</span><br><span class="line"></span><br><span class="line">		p-&gt;sched_reset_on_fork = reset_on_fork;</span><br><span class="line">		retval = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line">	&#125;</span><br><span class="line">change:</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (user) &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RT_GROUP_SCHED</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Do not allow realtime tasks into groups that have no runtime</span></span><br><span class="line"><span class="comment">		 * assigned.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (rt_bandwidth_enabled() &amp;&amp; rt_policy(policy) &amp;&amp;</span><br><span class="line">				task_group(p)-&gt;rt_bandwidth.rt_runtime == <span class="number">0</span> &amp;&amp;</span><br><span class="line">				!task_group_is_autogroup(task_group(p))) &#123;</span><br><span class="line">			retval = -EPERM;</span><br><span class="line">			<span class="keyword">goto</span> unlock;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">		<span class="keyword">if</span> (dl_bandwidth_enabled() &amp;&amp; dl_policy(policy) &amp;&amp;</span><br><span class="line">				!(attr-&gt;sched_flags &amp; SCHED_FLAG_SUGOV)) &#123;</span><br><span class="line">			<span class="keyword">cpumask_t</span> *span = rq-&gt;rd-&gt;span;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * Don't allow tasks with an affinity mask smaller than</span></span><br><span class="line"><span class="comment">			 * the entire root_domain to become SCHED_DEADLINE. We</span></span><br><span class="line"><span class="comment">			 * will also fail if there's no bandwidth available.</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="keyword">if</span> (!cpumask_subset(span, p-&gt;cpus_ptr) ||</span><br><span class="line">			    rq-&gt;rd-&gt;dl_bw.bw == <span class="number">0</span>) &#123;</span><br><span class="line">				retval = -EPERM;</span><br><span class="line">				<span class="keyword">goto</span> unlock;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Re-check policy now with rq lock held: */</span></span><br><span class="line">	<span class="keyword">if</span> (unlikely(oldpolicy != <span class="number">-1</span> &amp;&amp; oldpolicy != p-&gt;policy)) &#123;</span><br><span class="line">		policy = oldpolicy = <span class="number">-1</span>;</span><br><span class="line">		task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line">		<span class="keyword">if</span> (pi)</span><br><span class="line">			cpuset_read_unlock();</span><br><span class="line">		<span class="keyword">goto</span> recheck;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If setscheduling to SCHED_DEADLINE (or changing the parameters</span></span><br><span class="line"><span class="comment">	 * of a SCHED_DEADLINE task) we need to check if enough bandwidth</span></span><br><span class="line"><span class="comment">	 * is available.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> ((dl_policy(policy) || dl_task(p)) &amp;&amp; sched_dl_overflow(p, policy, attr)) &#123;</span><br><span class="line">		retval = -EBUSY;</span><br><span class="line">		<span class="keyword">goto</span> unlock;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	p-&gt;sched_reset_on_fork = reset_on_fork;</span><br><span class="line">	oldprio = p-&gt;prio;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pi) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Take priority boosted tasks into account. If the new</span></span><br><span class="line"><span class="comment">		 * effective priority is unchanged, we just store the new</span></span><br><span class="line"><span class="comment">		 * normal parameters and do not touch the scheduler class and</span></span><br><span class="line"><span class="comment">		 * the runqueue. This will be done when the task deboost</span></span><br><span class="line"><span class="comment">		 * itself.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		new_effective_prio = rt_effective_prio(p, newprio);</span><br><span class="line">		<span class="keyword">if</span> (new_effective_prio == oldprio)</span><br><span class="line">			queue_flags &amp;= ~DEQUEUE_MOVE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	queued = task_on_rq_queued(p);</span><br><span class="line">	running = task_current(rq, p);</span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		dequeue_task(rq, p, queue_flags);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		put_prev_task(rq, p);</span><br><span class="line"></span><br><span class="line">	prev_class = p-&gt;sched_class;</span><br><span class="line"></span><br><span class="line">	__setscheduler(rq, p, attr, pi);</span><br><span class="line">	__setscheduler_uclamp(p, attr);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * We enqueue to tail when the priority of a task is</span></span><br><span class="line"><span class="comment">		 * increased (user space view).</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (oldprio &lt; p-&gt;prio)</span><br><span class="line">			queue_flags |= ENQUEUE_HEAD;</span><br><span class="line"></span><br><span class="line">		enqueue_task(rq, p, queue_flags);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		set_next_task(rq, p);</span><br><span class="line"></span><br><span class="line">	check_class_changed(rq, p, prev_class, oldprio);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Avoid rq from going away on us: */</span></span><br><span class="line">	preempt_disable();</span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pi) &#123;</span><br><span class="line">		cpuset_read_unlock();</span><br><span class="line">		rt_mutex_adjust_pi(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Run balance callbacks after we've adjusted the PI chain: */</span></span><br><span class="line">	balance_callback(rq);</span><br><span class="line">	preempt_enable();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">unlock:</span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line">	<span class="keyword">if</span> (pi)</span><br><span class="line">		cpuset_read_unlock();</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> _sched_setscheduler(struct task_struct *p, <span class="keyword">int</span> policy,</span><br><span class="line">			       <span class="keyword">const</span> struct sched_param *param, <span class="keyword">bool</span> check)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_attr</span> <span class="title">attr</span> = &#123;</span></span><br><span class="line">		.sched_policy   = policy,</span><br><span class="line">		.sched_priority = param-&gt;sched_priority,</span><br><span class="line">		.sched_nice	= PRIO_TO_NICE(p-&gt;static_prio),</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Fixup the legacy SCHED_RESET_ON_FORK hack. */</span></span><br><span class="line">	<span class="keyword">if</span> ((policy != SETPARAM_POLICY) &amp;&amp; (policy &amp; SCHED_RESET_ON_FORK)) &#123;</span><br><span class="line">		attr.sched_flags |= SCHED_FLAG_RESET_ON_FORK;</span><br><span class="line">		policy &amp;= ~SCHED_RESET_ON_FORK;</span><br><span class="line">		attr.sched_policy = policy;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> __sched_setscheduler(p, &amp;attr, check, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sched_setscheduler - change the scheduling policy and/or RT priority of a thread.</span></span><br><span class="line"><span class="comment"> * @p: the task in question.</span></span><br><span class="line"><span class="comment"> * @policy: new policy.</span></span><br><span class="line"><span class="comment"> * @param: structure containing the new RT priority.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 0 on success. An error code otherwise.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * NOTE that the task may be already dead.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_setscheduler</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> policy,</span></span></span><br><span class="line"><span class="function"><span class="params">		       <span class="keyword">const</span> struct sched_param *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> _sched_setscheduler(p, policy, param, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(sched_setscheduler);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_setattr</span><span class="params">(struct task_struct *p, <span class="keyword">const</span> struct sched_attr *attr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> __sched_setscheduler(p, attr, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(sched_setattr);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_setattr_nocheck</span><span class="params">(struct task_struct *p, <span class="keyword">const</span> struct sched_attr *attr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> __sched_setscheduler(p, attr, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sched_setscheduler_nocheck - change the scheduling policy and/or RT priority of a thread from kernelspace.</span></span><br><span class="line"><span class="comment"> * @p: the task in question.</span></span><br><span class="line"><span class="comment"> * @policy: new policy.</span></span><br><span class="line"><span class="comment"> * @param: structure containing the new RT priority.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Just like sched_setscheduler, only don't bother checking if the</span></span><br><span class="line"><span class="comment"> * current context has permission.  For example, this is needed in</span></span><br><span class="line"><span class="comment"> * stop_machine(): we create temporary high priority worker threads,</span></span><br><span class="line"><span class="comment"> * but our caller might not have that capability.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 0 on success. An error code otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_setscheduler_nocheck</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> policy,</span></span></span><br><span class="line"><span class="function"><span class="params">			       <span class="keyword">const</span> struct sched_param *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> _sched_setscheduler(p, policy, param, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(sched_setscheduler_nocheck);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">do_sched_setscheduler(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span> policy, struct sched_param __user *param)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_param</span> <span class="title">lparam</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!param || pid &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (copy_from_user(&amp;lparam, param, <span class="keyword">sizeof</span>(struct sched_param)))</span><br><span class="line">		<span class="keyword">return</span> -EFAULT;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	retval = -ESRCH;</span><br><span class="line">	p = find_process_by_pid(pid);</span><br><span class="line">	<span class="keyword">if</span> (likely(p))</span><br><span class="line">		get_task_struct(p);</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (likely(p)) &#123;</span><br><span class="line">		retval = sched_setscheduler(p, policy, &amp;lparam);</span><br><span class="line">		put_task_struct(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Mimics kernel/events/core.c perf_copy_attr().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sched_copy_attr</span><span class="params">(struct sched_attr __user *uattr, struct sched_attr *attr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u32 size;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Zero the full structure, so that a short copy will be nice: */</span></span><br><span class="line">	<span class="built_in">memset</span>(attr, <span class="number">0</span>, <span class="keyword">sizeof</span>(*attr));</span><br><span class="line"></span><br><span class="line">	ret = get_user(size, &amp;uattr-&gt;size);</span><br><span class="line">	<span class="keyword">if</span> (ret)</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ABI compatibility quirk: */</span></span><br><span class="line">	<span class="keyword">if</span> (!size)</span><br><span class="line">		size = SCHED_ATTR_SIZE_VER0;</span><br><span class="line">	<span class="keyword">if</span> (size &lt; SCHED_ATTR_SIZE_VER0 || size &gt; PAGE_SIZE)</span><br><span class="line">		<span class="keyword">goto</span> err_size;</span><br><span class="line"></span><br><span class="line">	ret = copy_struct_from_user(attr, <span class="keyword">sizeof</span>(*attr), uattr, size);</span><br><span class="line">	<span class="keyword">if</span> (ret) &#123;</span><br><span class="line">		<span class="keyword">if</span> (ret == -E2BIG)</span><br><span class="line">			<span class="keyword">goto</span> err_size;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((attr-&gt;sched_flags &amp; SCHED_FLAG_UTIL_CLAMP) &amp;&amp;</span><br><span class="line">	    size &lt; SCHED_ATTR_SIZE_VER1)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">XXX:</span> Do we want to be lenient like existing syscalls; or do we want</span></span><br><span class="line"><span class="comment">	 * to be strict and return an error on out-of-bounds values?</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	attr-&gt;sched_nice = clamp(attr-&gt;sched_nice, MIN_NICE, MAX_NICE);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">err_size:</span><br><span class="line">	put_user(<span class="keyword">sizeof</span>(*attr), &amp;uattr-&gt;size);</span><br><span class="line">	<span class="keyword">return</span> -E2BIG;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_setscheduler - set/change the scheduler policy and RT priority</span></span><br><span class="line"><span class="comment"> * @pid: the pid in question.</span></span><br><span class="line"><span class="comment"> * @policy: new policy.</span></span><br><span class="line"><span class="comment"> * @param: structure containing the new RT priority.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 0 on success. An error code otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE3(sched_setscheduler, <span class="keyword">pid_t</span>, pid, <span class="keyword">int</span>, policy, struct sched_param __user *, param)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (policy &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> do_sched_setscheduler(pid, policy, param);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_setparam - set/change the RT priority of a thread</span></span><br><span class="line"><span class="comment"> * @pid: the pid in question.</span></span><br><span class="line"><span class="comment"> * @param: structure containing the new RT priority.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 0 on success. An error code otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE2(sched_setparam, <span class="keyword">pid_t</span>, pid, struct sched_param __user *, param)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> do_sched_setscheduler(pid, SETPARAM_POLICY, param);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_setattr - same as above, but with extended sched_attr</span></span><br><span class="line"><span class="comment"> * @pid: the pid in question.</span></span><br><span class="line"><span class="comment"> * @uattr: structure containing the extended parameters.</span></span><br><span class="line"><span class="comment"> * @flags: for future extension.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE3(sched_setattr, <span class="keyword">pid_t</span>, pid, struct sched_attr __user *, uattr,</span><br><span class="line">			       <span class="keyword">unsigned</span> <span class="keyword">int</span>, flags)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_attr</span> <span class="title">attr</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!uattr || pid &lt; <span class="number">0</span> || flags)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	retval = sched_copy_attr(uattr, &amp;attr);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">return</span> retval;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((<span class="keyword">int</span>)attr.sched_policy &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (attr.sched_flags &amp; SCHED_FLAG_KEEP_POLICY)</span><br><span class="line">		attr.sched_policy = SETPARAM_POLICY;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	retval = -ESRCH;</span><br><span class="line">	p = find_process_by_pid(pid);</span><br><span class="line">	<span class="keyword">if</span> (likely(p))</span><br><span class="line">		get_task_struct(p);</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (likely(p)) &#123;</span><br><span class="line">		retval = sched_setattr(p, &amp;attr);</span><br><span class="line">		put_task_struct(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_getscheduler - get the policy (scheduling class) of a thread</span></span><br><span class="line"><span class="comment"> * @pid: the pid in question.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: On success, the policy of the thread. Otherwise, a negative error</span></span><br><span class="line"><span class="comment"> * code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE1(sched_getscheduler, <span class="keyword">pid_t</span>, pid)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pid &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	retval = -ESRCH;</span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	p = find_process_by_pid(pid);</span><br><span class="line">	<span class="keyword">if</span> (p) &#123;</span><br><span class="line">		retval = security_task_getscheduler(p);</span><br><span class="line">		<span class="keyword">if</span> (!retval)</span><br><span class="line">			retval = p-&gt;policy</span><br><span class="line">				| (p-&gt;sched_reset_on_fork ? SCHED_RESET_ON_FORK : <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_getparam - get the RT priority of a thread</span></span><br><span class="line"><span class="comment"> * @pid: the pid in question.</span></span><br><span class="line"><span class="comment"> * @param: structure containing the RT priority.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: On success, 0 and the RT priority is in @param. Otherwise, an error</span></span><br><span class="line"><span class="comment"> * code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE2(sched_getparam, <span class="keyword">pid_t</span>, pid, struct sched_param __user *, param)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_param</span> <span class="title">lp</span> = &#123;</span> .sched_priority = <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!param || pid &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	p = find_process_by_pid(pid);</span><br><span class="line">	retval = -ESRCH;</span><br><span class="line">	<span class="keyword">if</span> (!p)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	retval = security_task_getscheduler(p);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_has_rt_policy(p))</span><br><span class="line">		lp.sched_priority = p-&gt;rt_priority;</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * This one might sleep, we cannot do it with a spinlock held ...</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	retval = copy_to_user(param, &amp;lp, <span class="keyword">sizeof</span>(*param)) ? -EFAULT : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line"></span><br><span class="line">out_unlock:</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copy the kernel size attribute structure (which might be larger</span></span><br><span class="line"><span class="comment"> * than what user-space knows about) to user-space.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note that all cases are valid: user-space buffer can be larger or</span></span><br><span class="line"><span class="comment"> * smaller than the kernel-space buffer. The usual case is that both</span></span><br><span class="line"><span class="comment"> * have the same size.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">sched_attr_copy_to_user(struct sched_attr __user *uattr,</span><br><span class="line">			struct sched_attr *kattr,</span><br><span class="line">			<span class="keyword">unsigned</span> <span class="keyword">int</span> usize)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> ksize = <span class="keyword">sizeof</span>(*kattr);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!access_ok(uattr, usize))</span><br><span class="line">		<span class="keyword">return</span> -EFAULT;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * sched_getattr() ABI forwards and backwards compatibility:</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If usize == ksize then we just copy everything to user-space and all is good.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If usize &lt; ksize then we only copy as much as user-space has space for,</span></span><br><span class="line"><span class="comment">	 * this keeps ABI compatibility as well. We skip the rest.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If usize &gt; ksize then user-space is using a newer version of the ABI,</span></span><br><span class="line"><span class="comment">	 * which part the kernel doesn't know about. Just ignore it - tooling can</span></span><br><span class="line"><span class="comment">	 * detect the kernel's knowledge of attributes from the attr-&gt;size value</span></span><br><span class="line"><span class="comment">	 * which is set to ksize in this case.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	kattr-&gt;size = min(usize, ksize);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (copy_to_user(uattr, kattr, kattr-&gt;size))</span><br><span class="line">		<span class="keyword">return</span> -EFAULT;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_getattr - similar to sched_getparam, but with sched_attr</span></span><br><span class="line"><span class="comment"> * @pid: the pid in question.</span></span><br><span class="line"><span class="comment"> * @uattr: structure containing the extended parameters.</span></span><br><span class="line"><span class="comment"> * @usize: sizeof(attr) for fwd/bwd comp.</span></span><br><span class="line"><span class="comment"> * @flags: for future extension.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE4(sched_getattr, <span class="keyword">pid_t</span>, pid, struct sched_attr __user *, uattr,</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">int</span>, usize, <span class="keyword">unsigned</span> <span class="keyword">int</span>, flags)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_attr</span> <span class="title">kattr</span> = &#123;</span> &#125;;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!uattr || pid &lt; <span class="number">0</span> || usize &gt; PAGE_SIZE ||</span><br><span class="line">	    usize &lt; SCHED_ATTR_SIZE_VER0 || flags)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	p = find_process_by_pid(pid);</span><br><span class="line">	retval = -ESRCH;</span><br><span class="line">	<span class="keyword">if</span> (!p)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	retval = security_task_getscheduler(p);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	kattr.sched_policy = p-&gt;policy;</span><br><span class="line">	<span class="keyword">if</span> (p-&gt;sched_reset_on_fork)</span><br><span class="line">		kattr.sched_flags |= SCHED_FLAG_RESET_ON_FORK;</span><br><span class="line">	<span class="keyword">if</span> (task_has_dl_policy(p))</span><br><span class="line">		__getparam_dl(p, &amp;kattr);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (task_has_rt_policy(p))</span><br><span class="line">		kattr.sched_priority = p-&gt;rt_priority;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		kattr.sched_nice = task_nice(p);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_UCLAMP_TASK</span></span><br><span class="line">	kattr.sched_util_min = p-&gt;uclamp_req[UCLAMP_MIN].value;</span><br><span class="line">	kattr.sched_util_max = p-&gt;uclamp_req[UCLAMP_MAX].value;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sched_attr_copy_to_user(uattr, &amp;kattr, usize);</span><br><span class="line"></span><br><span class="line">out_unlock:</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">sched_setaffinity</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">const</span> struct cpumask *in_mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">cpumask_var_t</span> cpus_allowed, new_mask;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line"></span><br><span class="line">	p = find_process_by_pid(pid);</span><br><span class="line">	<span class="keyword">if</span> (!p) &#123;</span><br><span class="line">		rcu_read_unlock();</span><br><span class="line">		<span class="keyword">return</span> -ESRCH;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Prevent p going away */</span></span><br><span class="line">	get_task_struct(p);</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;flags &amp; PF_NO_SETAFFINITY) &#123;</span><br><span class="line">		retval = -EINVAL;</span><br><span class="line">		<span class="keyword">goto</span> out_put_task;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!alloc_cpumask_var(&amp;cpus_allowed, GFP_KERNEL)) &#123;</span><br><span class="line">		retval = -ENOMEM;</span><br><span class="line">		<span class="keyword">goto</span> out_put_task;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!alloc_cpumask_var(&amp;new_mask, GFP_KERNEL)) &#123;</span><br><span class="line">		retval = -ENOMEM;</span><br><span class="line">		<span class="keyword">goto</span> out_free_cpus_allowed;</span><br><span class="line">	&#125;</span><br><span class="line">	retval = -EPERM;</span><br><span class="line">	<span class="keyword">if</span> (!check_same_owner(p)) &#123;</span><br><span class="line">		rcu_read_lock();</span><br><span class="line">		<span class="keyword">if</span> (!ns_capable(__task_cred(p)-&gt;user_ns, CAP_SYS_NICE)) &#123;</span><br><span class="line">			rcu_read_unlock();</span><br><span class="line">			<span class="keyword">goto</span> out_free_new_mask;</span><br><span class="line">		&#125;</span><br><span class="line">		rcu_read_unlock();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	retval = security_task_setscheduler(p);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">goto</span> out_free_new_mask;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	cpuset_cpus_allowed(p, cpus_allowed);</span><br><span class="line">	cpumask_and(new_mask, in_mask, cpus_allowed);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Since bandwidth control happens on root_domain basis,</span></span><br><span class="line"><span class="comment">	 * if admission test is enabled, we only admit -deadline</span></span><br><span class="line"><span class="comment">	 * tasks allowed to run on all the CPUs in the task's</span></span><br><span class="line"><span class="comment">	 * root_domain.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="keyword">if</span> (task_has_dl_policy(p) &amp;&amp; dl_bandwidth_enabled()) &#123;</span><br><span class="line">		rcu_read_lock();</span><br><span class="line">		<span class="keyword">if</span> (!cpumask_subset(task_rq(p)-&gt;rd-&gt;span, new_mask)) &#123;</span><br><span class="line">			retval = -EBUSY;</span><br><span class="line">			rcu_read_unlock();</span><br><span class="line">			<span class="keyword">goto</span> out_free_new_mask;</span><br><span class="line">		&#125;</span><br><span class="line">		rcu_read_unlock();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">again:</span><br><span class="line">	retval = __set_cpus_allowed_ptr(p, new_mask, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!retval) &#123;</span><br><span class="line">		cpuset_cpus_allowed(p, cpus_allowed);</span><br><span class="line">		<span class="keyword">if</span> (!cpumask_subset(new_mask, cpus_allowed)) &#123;</span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * We must have raced with a concurrent cpuset</span></span><br><span class="line"><span class="comment">			 * update. Just reset the cpus_allowed to the</span></span><br><span class="line"><span class="comment">			 * cpuset's cpus_allowed</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			cpumask_copy(new_mask, cpus_allowed);</span><br><span class="line">			<span class="keyword">goto</span> again;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">out_free_new_mask:</span><br><span class="line">	free_cpumask_var(new_mask);</span><br><span class="line">out_free_cpus_allowed:</span><br><span class="line">	free_cpumask_var(cpus_allowed);</span><br><span class="line">out_put_task:</span><br><span class="line">	put_task_struct(p);</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">get_user_cpu_mask</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> __user *user_mask_ptr, <span class="keyword">unsigned</span> len,</span></span></span><br><span class="line"><span class="function"><span class="params">			     struct cpumask *new_mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (len &lt; cpumask_size())</span><br><span class="line">		cpumask_clear(new_mask);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (len &gt; cpumask_size())</span><br><span class="line">		len = cpumask_size();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> copy_from_user(new_mask, user_mask_ptr, len) ? -EFAULT : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_setaffinity - set the CPU affinity of a process</span></span><br><span class="line"><span class="comment"> * @pid: pid of the process</span></span><br><span class="line"><span class="comment"> * @len: length in bytes of the bitmask pointed to by user_mask_ptr</span></span><br><span class="line"><span class="comment"> * @user_mask_ptr: user-space pointer to the new CPU mask</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 0 on success. An error code otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE3(sched_setaffinity, <span class="keyword">pid_t</span>, pid, <span class="keyword">unsigned</span> <span class="keyword">int</span>, len,</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">long</span> __user *, user_mask_ptr)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">cpumask_var_t</span> new_mask;</span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!alloc_cpumask_var(&amp;new_mask, GFP_KERNEL))</span><br><span class="line">		<span class="keyword">return</span> -ENOMEM;</span><br><span class="line"></span><br><span class="line">	retval = get_user_cpu_mask(user_mask_ptr, len, new_mask);</span><br><span class="line">	<span class="keyword">if</span> (retval == <span class="number">0</span>)</span><br><span class="line">		retval = sched_setaffinity(pid, new_mask);</span><br><span class="line">	free_cpumask_var(new_mask);</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">sched_getaffinity</span><span class="params">(<span class="keyword">pid_t</span> pid, struct cpumask *mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line"></span><br><span class="line">	retval = -ESRCH;</span><br><span class="line">	p = find_process_by_pid(pid);</span><br><span class="line">	<span class="keyword">if</span> (!p)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	retval = security_task_getscheduler(p);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;p-&gt;pi_lock, flags);</span><br><span class="line">	cpumask_and(mask, &amp;p-&gt;cpus_mask, cpu_active_mask);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;p-&gt;pi_lock, flags);</span><br><span class="line"></span><br><span class="line">out_unlock:</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_getaffinity - get the CPU affinity of a process</span></span><br><span class="line"><span class="comment"> * @pid: pid of the process</span></span><br><span class="line"><span class="comment"> * @len: length in bytes of the bitmask pointed to by user_mask_ptr</span></span><br><span class="line"><span class="comment"> * @user_mask_ptr: user-space pointer to hold the current CPU mask</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: size of CPU mask copied to user_mask_ptr on success. An</span></span><br><span class="line"><span class="comment"> * error code otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE3(sched_getaffinity, <span class="keyword">pid_t</span>, pid, <span class="keyword">unsigned</span> <span class="keyword">int</span>, len,</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">long</span> __user *, user_mask_ptr)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line">	<span class="keyword">cpumask_var_t</span> mask;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((len * BITS_PER_BYTE) &lt; nr_cpu_ids)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (len &amp; (<span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">long</span>)<span class="number">-1</span>))</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!alloc_cpumask_var(&amp;mask, GFP_KERNEL))</span><br><span class="line">		<span class="keyword">return</span> -ENOMEM;</span><br><span class="line"></span><br><span class="line">	ret = sched_getaffinity(pid, mask);</span><br><span class="line">	<span class="keyword">if</span> (ret == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">int</span> retlen = min(len, cpumask_size());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (copy_to_user(user_mask_ptr, mask, retlen))</span><br><span class="line">			ret = -EFAULT;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			ret = retlen;</span><br><span class="line">	&#125;</span><br><span class="line">	free_cpumask_var(mask);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_yield - yield the current processor to other threads.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function yields the current CPU to other tasks. If there are no</span></span><br><span class="line"><span class="comment"> * other threads running on this CPU then this function will return.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: 0.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">do_sched_yield</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	rq = this_rq_lock_irq(&amp;rf);</span><br><span class="line"></span><br><span class="line">	schedstat_inc(rq-&gt;yld_count);</span><br><span class="line">	current-&gt;sched_class-&gt;yield_task(rq);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Since we are going to call schedule() anyway, there's</span></span><br><span class="line"><span class="comment">	 * no need to preempt or enable interrupts:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	preempt_disable();</span><br><span class="line">	rq_unlock(rq, &amp;rf);</span><br><span class="line">	sched_preempt_enable_no_resched();</span><br><span class="line"></span><br><span class="line">	schedule();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SYSCALL_DEFINE0(sched_yield)</span><br><span class="line">&#123;</span><br><span class="line">	do_sched_yield();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CONFIG_PREEMPTION</span></span><br><span class="line"><span class="keyword">int</span> __sched _cond_resched(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (should_resched(<span class="number">0</span>)) &#123;</span><br><span class="line">		preempt_schedule_common();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	rcu_all_qs();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(_cond_resched);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * __cond_resched_lock() - if a reschedule is pending, drop the given lock,</span></span><br><span class="line"><span class="comment"> * call schedule, and on return reacquire the lock.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This works OK both with and without CONFIG_PREEMPTION. We do strange low-level</span></span><br><span class="line"><span class="comment"> * operations here to prevent schedule() from being called twice (once via</span></span><br><span class="line"><span class="comment"> * spin_unlock(), once by hand).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> __cond_resched_lock(<span class="keyword">spinlock_t</span> *lock)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> resched = should_resched(PREEMPT_LOCK_OFFSET);</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	lockdep_assert_held(lock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (spin_needbreak(lock) || resched) &#123;</span><br><span class="line">		spin_unlock(lock);</span><br><span class="line">		<span class="keyword">if</span> (resched)</span><br><span class="line">			preempt_schedule_common();</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			cpu_relax();</span><br><span class="line">		ret = <span class="number">1</span>;</span><br><span class="line">		spin_lock(lock);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(__cond_resched_lock);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * yield - yield the current processor to other threads.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Do not ever use this function, there's a 99% chance you're doing it wrong.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The scheduler is at all times free to pick the calling task as the most</span></span><br><span class="line"><span class="comment"> * eligible task to run, if removing the yield() call from your code breaks</span></span><br><span class="line"><span class="comment"> * it, its already broken.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Typical broken usage is:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * while (!event)</span></span><br><span class="line"><span class="comment"> *	yield();</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * where one assumes that yield() will let 'the other' process run that will</span></span><br><span class="line"><span class="comment"> * make event true. If the current task is a SCHED_FIFO task that will never</span></span><br><span class="line"><span class="comment"> * happen. Never use yield() as a progress guarantee!!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If you want to use yield() to wait for something, use wait_event().</span></span><br><span class="line"><span class="comment"> * If you want to use yield() to be 'nice' for others, use cond_resched().</span></span><br><span class="line"><span class="comment"> * If you still want to use yield(), do not!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> __sched <span class="title">yield</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	set_current_state(TASK_RUNNING);</span><br><span class="line">	do_sched_yield();</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(yield);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * yield_to - yield the current processor to another thread in</span></span><br><span class="line"><span class="comment"> * your thread group, or accelerate that thread toward the</span></span><br><span class="line"><span class="comment"> * processor it's on.</span></span><br><span class="line"><span class="comment"> * @p: target task</span></span><br><span class="line"><span class="comment"> * @preempt: whether task preemption is allowed or not</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * It's the caller's job to ensure that the target task struct</span></span><br><span class="line"><span class="comment"> * can't go away on us before we can do any checks.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return:</span></span><br><span class="line"><span class="comment"> *	true (&gt;0) if we indeed boosted the target task.</span></span><br><span class="line"><span class="comment"> *	false (0) if we failed to boost the target.</span></span><br><span class="line"><span class="comment"> *	-ESRCH if there's no task to yield to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> __sched <span class="title">yield_to</span><span class="params">(struct task_struct *p, <span class="keyword">bool</span> preempt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">curr</span> = <span class="title">current</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>, *<span class="title">p_rq</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line">	<span class="keyword">int</span> yielded = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	local_irq_save(flags);</span><br><span class="line">	rq = this_rq();</span><br><span class="line"></span><br><span class="line">again:</span><br><span class="line">	p_rq = task_rq(p);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If we're the only runnable task on the rq and target rq also</span></span><br><span class="line"><span class="comment">	 * has only one task, there's absolutely no point in yielding.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;nr_running == <span class="number">1</span> &amp;&amp; p_rq-&gt;nr_running == <span class="number">1</span>) &#123;</span><br><span class="line">		yielded = -ESRCH;</span><br><span class="line">		<span class="keyword">goto</span> out_irq;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	double_rq_lock(rq, p_rq);</span><br><span class="line">	<span class="keyword">if</span> (task_rq(p) != p_rq) &#123;</span><br><span class="line">		double_rq_unlock(rq, p_rq);</span><br><span class="line">		<span class="keyword">goto</span> again;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!curr-&gt;sched_class-&gt;yield_to_task)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (curr-&gt;sched_class != p-&gt;sched_class)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_running(p_rq, p) || p-&gt;state)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	yielded = curr-&gt;sched_class-&gt;yield_to_task(rq, p, preempt);</span><br><span class="line">	<span class="keyword">if</span> (yielded) &#123;</span><br><span class="line">		schedstat_inc(rq-&gt;yld_count);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Make p's CPU reschedule; pick_next_entity takes care of</span></span><br><span class="line"><span class="comment">		 * fairness.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (preempt &amp;&amp; rq != p_rq)</span><br><span class="line">			resched_curr(p_rq);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">out_unlock:</span><br><span class="line">	double_rq_unlock(rq, p_rq);</span><br><span class="line">out_irq:</span><br><span class="line">	local_irq_restore(flags);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (yielded &gt; <span class="number">0</span>)</span><br><span class="line">		schedule();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> yielded;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(yield_to);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">io_schedule_prepare</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> old_iowait = current-&gt;in_iowait;</span><br><span class="line"></span><br><span class="line">	current-&gt;in_iowait = <span class="number">1</span>;</span><br><span class="line">	blk_schedule_flush_plug(current);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> old_iowait;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">io_schedule_finish</span><span class="params">(<span class="keyword">int</span> token)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	current-&gt;in_iowait = token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This task is about to go to sleep on IO. Increment rq-&gt;nr_iowait so</span></span><br><span class="line"><span class="comment"> * that process accounting knows that this is a task in IO wait state.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> __sched <span class="title">io_schedule_timeout</span><span class="params">(<span class="keyword">long</span> timeout)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> token;</span><br><span class="line">	<span class="keyword">long</span> ret;</span><br><span class="line"></span><br><span class="line">	token = io_schedule_prepare();</span><br><span class="line">	ret = schedule_timeout(timeout);</span><br><span class="line">	io_schedule_finish(token);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(io_schedule_timeout);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> __sched <span class="title">io_schedule</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> token;</span><br><span class="line"></span><br><span class="line">	token = io_schedule_prepare();</span><br><span class="line">	schedule();</span><br><span class="line">	io_schedule_finish(token);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(io_schedule);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_get_priority_max - return maximum RT priority.</span></span><br><span class="line"><span class="comment"> * @policy: scheduling class.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: On success, this syscall returns the maximum</span></span><br><span class="line"><span class="comment"> * rt_priority that can be used by a given scheduling class.</span></span><br><span class="line"><span class="comment"> * On failure, a negative error code is returned.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE1(sched_get_priority_max, <span class="keyword">int</span>, policy)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (policy) &#123;</span><br><span class="line">	<span class="keyword">case</span> SCHED_FIFO:</span><br><span class="line">	<span class="keyword">case</span> SCHED_RR:</span><br><span class="line">		ret = MAX_USER_RT_PRIO<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> SCHED_DEADLINE:</span><br><span class="line">	<span class="keyword">case</span> SCHED_NORMAL:</span><br><span class="line">	<span class="keyword">case</span> SCHED_BATCH:</span><br><span class="line">	<span class="keyword">case</span> SCHED_IDLE:</span><br><span class="line">		ret = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_get_priority_min - return minimum RT priority.</span></span><br><span class="line"><span class="comment"> * @policy: scheduling class.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: On success, this syscall returns the minimum</span></span><br><span class="line"><span class="comment"> * rt_priority that can be used by a given scheduling class.</span></span><br><span class="line"><span class="comment"> * On failure, a negative error code is returned.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE1(sched_get_priority_min, <span class="keyword">int</span>, policy)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (policy) &#123;</span><br><span class="line">	<span class="keyword">case</span> SCHED_FIFO:</span><br><span class="line">	<span class="keyword">case</span> SCHED_RR:</span><br><span class="line">		ret = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> SCHED_DEADLINE:</span><br><span class="line">	<span class="keyword">case</span> SCHED_NORMAL:</span><br><span class="line">	<span class="keyword">case</span> SCHED_BATCH:</span><br><span class="line">	<span class="keyword">case</span> SCHED_IDLE:</span><br><span class="line">		ret = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sched_rr_get_interval</span><span class="params">(<span class="keyword">pid_t</span> pid, struct timespec64 *t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> time_slice;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pid &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	retval = -ESRCH;</span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	p = find_process_by_pid(pid);</span><br><span class="line">	<span class="keyword">if</span> (!p)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	retval = security_task_getscheduler(p);</span><br><span class="line">	<span class="keyword">if</span> (retval)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	rq = task_rq_lock(p, &amp;rf);</span><br><span class="line">	time_slice = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (p-&gt;sched_class-&gt;get_rr_interval)</span><br><span class="line">		time_slice = p-&gt;sched_class-&gt;get_rr_interval(rq, p);</span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line"></span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	jiffies_to_timespec64(time_slice, t);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">out_unlock:</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sys_sched_rr_get_interval - return the default timeslice of a process.</span></span><br><span class="line"><span class="comment"> * @pid: pid of the process.</span></span><br><span class="line"><span class="comment"> * @interval: userspace pointer to the timeslice value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * this syscall writes the default timeslice value of a given process</span></span><br><span class="line"><span class="comment"> * into the user-space timespec buffer. A value of '0' means infinity.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: On success, 0 and the timeslice is in @interval. Otherwise,</span></span><br><span class="line"><span class="comment"> * an error code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SYSCALL_DEFINE2(sched_rr_get_interval, <span class="keyword">pid_t</span>, pid,</span><br><span class="line">		struct __kernel_timespec __user *, interval)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">timespec64</span> <span class="title">t</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval = sched_rr_get_interval(pid, &amp;t);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (retval == <span class="number">0</span>)</span><br><span class="line">		retval = put_timespec64(&amp;t, interval);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_COMPAT_32BIT_TIME</span></span><br><span class="line">SYSCALL_DEFINE2(sched_rr_get_interval_time32, <span class="keyword">pid_t</span>, pid,</span><br><span class="line">		struct old_timespec32 __user *, interval)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">timespec64</span> <span class="title">t</span>;</span></span><br><span class="line">	<span class="keyword">int</span> retval = sched_rr_get_interval(pid, &amp;t);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (retval == <span class="number">0</span>)</span><br><span class="line">		retval = put_old_timespec32(&amp;t, interval);</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_show_task</span><span class="params">(struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="built_in">free</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> ppid;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!try_get_task_stack(p))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	printk(KERN_INFO <span class="string">"%-15.15s %c"</span>, p-&gt;comm, task_state_to_char(p));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;state == TASK_RUNNING)</span><br><span class="line">		printk(KERN_CONT <span class="string">"  running task    "</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_STACK_USAGE</span></span><br><span class="line">	<span class="built_in">free</span> = stack_not_used(p);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	ppid = <span class="number">0</span>;</span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	<span class="keyword">if</span> (pid_alive(p))</span><br><span class="line">		ppid = task_pid_nr(rcu_dereference(p-&gt;real_parent));</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	printk(KERN_CONT <span class="string">"%5lu %5d %6d 0x%08lx\n"</span>, <span class="built_in">free</span>,</span><br><span class="line">		task_pid_nr(p), ppid,</span><br><span class="line">		(<span class="keyword">unsigned</span> <span class="keyword">long</span>)task_thread_info(p)-&gt;flags);</span><br><span class="line"></span><br><span class="line">	print_worker_info(KERN_INFO, p);</span><br><span class="line">	show_stack(p, <span class="literal">NULL</span>, KERN_INFO);</span><br><span class="line">	put_task_stack(p);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(sched_show_task);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span></span><br><span class="line">state_filter_match(<span class="keyword">unsigned</span> <span class="keyword">long</span> state_filter, struct task_struct *p)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* no filter, everything matches */</span></span><br><span class="line">	<span class="keyword">if</span> (!state_filter)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* filter, but doesn't match */</span></span><br><span class="line">	<span class="keyword">if</span> (!(p-&gt;state &amp; state_filter))</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * When looking for TASK_UNINTERRUPTIBLE skip TASK_IDLE (allows</span></span><br><span class="line"><span class="comment">	 * TASK_KILLABLE).</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (state_filter == TASK_UNINTERRUPTIBLE &amp;&amp; p-&gt;state == TASK_IDLE)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_state_filter</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> state_filter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">g</span>, *<span class="title">p</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> BITS_PER_LONG == 32</span></span><br><span class="line">	printk(KERN_INFO</span><br><span class="line">		<span class="string">"  task                PC stack   pid father\n"</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	printk(KERN_INFO</span><br><span class="line">		<span class="string">"  task                        PC stack   pid father\n"</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	for_each_process_thread(g, p) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * reset the NMI-timeout, listing all files on a slow</span></span><br><span class="line"><span class="comment">		 * console might take a lot of time:</span></span><br><span class="line"><span class="comment">		 * Also, reset softlockup watchdogs on all CPUs, because</span></span><br><span class="line"><span class="comment">		 * another CPU might be blocked waiting for us to process</span></span><br><span class="line"><span class="comment">		 * an IPI.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		touch_nmi_watchdog();</span><br><span class="line">		touch_all_softlockup_watchdogs();</span><br><span class="line">		<span class="keyword">if</span> (state_filter_match(state_filter, p))</span><br><span class="line">			sched_show_task(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHED_DEBUG</span></span><br><span class="line">	<span class="keyword">if</span> (!state_filter)</span><br><span class="line">		sysrq_sched_debug_show();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Only show locks if all tasks are dumped:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!state_filter)</span><br><span class="line">		debug_show_all_locks();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * init_idle - set up an idle thread for a given CPU</span></span><br><span class="line"><span class="comment"> * @idle: task in question</span></span><br><span class="line"><span class="comment"> * @cpu: CPU the idle task belongs to</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span> this function does not set the idle thread's NEED_RESCHED</span></span><br><span class="line"><span class="comment"> * flag, to make booting more robust.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_idle</span><span class="params">(struct task_struct *idle, <span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line"></span><br><span class="line">	__sched_fork(<span class="number">0</span>, idle);</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;idle-&gt;pi_lock, flags);</span><br><span class="line">	raw_spin_lock(&amp;rq-&gt;lock);</span><br><span class="line"></span><br><span class="line">	idle-&gt;state = TASK_RUNNING;</span><br><span class="line">	idle-&gt;se.exec_start = sched_clock();</span><br><span class="line">	idle-&gt;flags |= PF_IDLE;</span><br><span class="line"></span><br><span class="line">	scs_task_reset(idle);</span><br><span class="line">	kasan_unpoison_task_stack(idle);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Its possible that init_idle() gets called multiple times on a task,</span></span><br><span class="line"><span class="comment">	 * in that case do_set_cpus_allowed() will not do the right thing.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * And since this is boot we can forgo the serialization.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	set_cpus_allowed_common(idle, cpumask_of(cpu));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We're having a chicken and egg problem, even though we are</span></span><br><span class="line"><span class="comment">	 * holding rq-&gt;lock, the CPU isn't yet set to this CPU so the</span></span><br><span class="line"><span class="comment">	 * lockdep check in task_group() will fail.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Similar case to sched_fork(). / Alternatively we could</span></span><br><span class="line"><span class="comment">	 * use task_rq_lock() here and obtain the other rq-&gt;lock.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Silence PROVE_RCU</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	__set_task_cpu(idle, cpu);</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	rq-&gt;idle = idle;</span><br><span class="line">	rcu_assign_pointer(rq-&gt;curr, idle);</span><br><span class="line">	idle-&gt;on_rq = TASK_ON_RQ_QUEUED;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	idle-&gt;on_cpu = <span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	raw_spin_unlock(&amp;rq-&gt;lock);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;idle-&gt;pi_lock, flags);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Set the preempt count _outside_ the spinlocks! */</span></span><br><span class="line">	init_idle_preempt_count(idle, cpu);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The idle tasks have their own, simple scheduling class:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	idle-&gt;sched_class = &amp;idle_sched_class;</span><br><span class="line">	ftrace_graph_init_idle_task(idle, cpu);</span><br><span class="line">	vtime_init_idle(idle, cpu);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	<span class="built_in">sprintf</span>(idle-&gt;comm, <span class="string">"%s/%d"</span>, INIT_TASK_COMM, cpu);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cpuset_cpumask_can_shrink</span><span class="params">(<span class="keyword">const</span> struct cpumask *cur,</span></span></span><br><span class="line"><span class="function"><span class="params">			      <span class="keyword">const</span> struct cpumask *trial)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!cpumask_weight(cur))</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">	ret = dl_cpuset_cpumask_can_shrink(cur, trial);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">task_can_attach</span><span class="params">(struct task_struct *p,</span></span></span><br><span class="line"><span class="function"><span class="params">		    <span class="keyword">const</span> struct cpumask *cs_cpus_allowed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Kthreads which disallow setaffinity shouldn't be moved</span></span><br><span class="line"><span class="comment">	 * to a new cpuset; we don't want to change their CPU</span></span><br><span class="line"><span class="comment">	 * affinity and isolating such threads by their set of</span></span><br><span class="line"><span class="comment">	 * allowed nodes is unnecessary.  Thus, cpusets are not</span></span><br><span class="line"><span class="comment">	 * applicable for such threads.  This prevents checking for</span></span><br><span class="line"><span class="comment">	 * success of set_cpus_allowed_ptr() on all attached tasks</span></span><br><span class="line"><span class="comment">	 * before cpus_mask may be changed.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (p-&gt;flags &amp; PF_NO_SETAFFINITY) &#123;</span><br><span class="line">		ret = -EINVAL;</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (dl_task(p) &amp;&amp; !cpumask_intersects(task_rq(p)-&gt;rd-&gt;span,</span><br><span class="line">					      cs_cpus_allowed))</span><br><span class="line">		ret = dl_task_can_attach(p, cs_cpus_allowed);</span><br><span class="line"></span><br><span class="line">out:</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> sched_smp_initialized __read_mostly;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NUMA_BALANCING</span></span><br><span class="line"><span class="comment">/* Migrate current task p to target_cpu */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">migrate_task_to</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> target_cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">migration_arg</span> <span class="title">arg</span> = &#123;</span> p, target_cpu &#125;;</span><br><span class="line">	<span class="keyword">int</span> curr_cpu = task_cpu(p);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (curr_cpu == target_cpu)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!cpumask_test_cpu(target_cpu, p-&gt;cpus_ptr))</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* <span class="doctag">TODO:</span> This is not properly updating schedstats */</span></span><br><span class="line"></span><br><span class="line">	trace_sched_move_numa(p, curr_cpu, target_cpu);</span><br><span class="line">	<span class="keyword">return</span> stop_one_cpu(curr_cpu, migration_cpu_stop, &amp;arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Requeue a task on a given node and accurately track the number of NUMA</span></span><br><span class="line"><span class="comment"> * tasks on the runqueues</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_setnuma</span><span class="params">(struct task_struct *p, <span class="keyword">int</span> nid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> queued, running;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	rq = task_rq_lock(p, &amp;rf);</span><br><span class="line">	queued = task_on_rq_queued(p);</span><br><span class="line">	running = task_current(rq, p);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		dequeue_task(rq, p, DEQUEUE_SAVE);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		put_prev_task(rq, p);</span><br><span class="line"></span><br><span class="line">	p-&gt;numa_preferred_nid = nid;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		enqueue_task(rq, p, ENQUEUE_RESTORE | ENQUEUE_NOCLOCK);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		set_next_task(rq, p);</span><br><span class="line">	task_rq_unlock(rq, p, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_NUMA_BALANCING */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_HOTPLUG_CPU</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Ensure that the idle task is using init_mm right before its CPU goes</span></span><br><span class="line"><span class="comment"> * offline.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">idle_task_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">mm_struct</span> *<span class="title">mm</span> = <span class="title">current</span>-&gt;<span class="title">active_mm</span>;</span></span><br><span class="line"></span><br><span class="line">	BUG_ON(cpu_online(smp_processor_id()));</span><br><span class="line">	BUG_ON(current != this_rq()-&gt;idle);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (mm != &amp;init_mm) &#123;</span><br><span class="line">		switch_mm(mm, &amp;init_mm, current);</span><br><span class="line">		finish_arch_post_lock_switch();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* finish_cpu(), as ran on the BP, will clean up the active_mm state */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Since this CPU is going 'away' for a while, fold any nr_active delta</span></span><br><span class="line"><span class="comment"> * we might have. Assumes we're called after migrate_tasks() so that the</span></span><br><span class="line"><span class="comment"> * nr_active count is stable. We need to take the teardown thread which</span></span><br><span class="line"><span class="comment"> * is calling this into account, so we hand in adjust = 1 to the load</span></span><br><span class="line"><span class="comment"> * calculation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Also see the comment "Global load-average calculations".</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">calc_load_migrate</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">long</span> delta = calc_load_fold_active(rq, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span> (delta)</span><br><span class="line">		atomic_long_add(delta, &amp;calc_load_tasks);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *__<span class="title">pick_migrate_task</span>(<span class="title">struct</span> <span class="title">rq</span> *<span class="title">rq</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sched_class</span> *<span class="title">class</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">next</span>;</span></span><br><span class="line"></span><br><span class="line">	for_each_class(class) &#123;</span><br><span class="line">		next = class-&gt;pick_next_task(rq);</span><br><span class="line">		<span class="keyword">if</span> (next) &#123;</span><br><span class="line">			next-&gt;sched_class-&gt;put_prev_task(rq, next);</span><br><span class="line">			<span class="keyword">return</span> next;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* The idle class should always have a runnable task */</span></span><br><span class="line">	BUG();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Migrate all tasks from the rq, sleeping tasks will be migrated by</span></span><br><span class="line"><span class="comment"> * try_to_wake_up()-&gt;select_task_rq().</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Called with rq-&gt;lock held even though we'er in stop_machine() and</span></span><br><span class="line"><span class="comment"> * there's no concurrency possible, we hold the required locks anyway</span></span><br><span class="line"><span class="comment"> * because of lock validation efforts.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">migrate_tasks</span><span class="params">(struct rq *dead_rq, struct rq_flags *rf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">dead_rq</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">next</span>, *<span class="title">stop</span> = <span class="title">rq</span>-&gt;<span class="title">stop</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">orf</span> = *<span class="title">rf</span>;</span></span><br><span class="line">	<span class="keyword">int</span> dest_cpu;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Fudge the rq selection such that the below task selection loop</span></span><br><span class="line"><span class="comment">	 * doesn't get stuck on the currently eligible stop task.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * We're currently inside stop_machine() and the rq is either stuck</span></span><br><span class="line"><span class="comment">	 * in the stop_machine_cpu_stop() loop, or we're executing this code,</span></span><br><span class="line"><span class="comment">	 * either way we should never end up calling schedule() until we're</span></span><br><span class="line"><span class="comment">	 * done here.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rq-&gt;stop = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * put_prev_task() and pick_next_task() sched</span></span><br><span class="line"><span class="comment">	 * class method both need to have an up-to-date</span></span><br><span class="line"><span class="comment">	 * value of rq-&gt;clock[_task]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * There's this thread running, bail when that's the only</span></span><br><span class="line"><span class="comment">		 * remaining thread:</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (rq-&gt;nr_running == <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		next = __pick_migrate_task(rq);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Rules for changing task_struct::cpus_mask are holding</span></span><br><span class="line"><span class="comment">		 * both pi_lock and rq-&gt;lock, such that holding either</span></span><br><span class="line"><span class="comment">		 * stabilizes the mask.</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * Drop rq-&gt;lock is not quite as disastrous as it usually is</span></span><br><span class="line"><span class="comment">		 * because !cpu_active at this point, which means load-balance</span></span><br><span class="line"><span class="comment">		 * will not interfere. Also, stop-machine.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		rq_unlock(rq, rf);</span><br><span class="line">		raw_spin_lock(&amp;next-&gt;pi_lock);</span><br><span class="line">		rq_relock(rq, rf);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Since we're inside stop-machine, _nothing_ should have</span></span><br><span class="line"><span class="comment">		 * changed the task, WARN if weird stuff happened, because in</span></span><br><span class="line"><span class="comment">		 * that case the above rq-&gt;lock drop is a fail too.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (WARN_ON(task_rq(next) != rq || !task_on_rq_queued(next))) &#123;</span><br><span class="line">			raw_spin_unlock(&amp;next-&gt;pi_lock);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Find suitable destination for @next, with force if needed. */</span></span><br><span class="line">		dest_cpu = select_fallback_rq(dead_rq-&gt;cpu, next);</span><br><span class="line">		rq = __migrate_task(rq, rf, next, dest_cpu);</span><br><span class="line">		<span class="keyword">if</span> (rq != dead_rq) &#123;</span><br><span class="line">			rq_unlock(rq, rf);</span><br><span class="line">			rq = dead_rq;</span><br><span class="line">			*rf = orf;</span><br><span class="line">			rq_relock(rq, rf);</span><br><span class="line">		&#125;</span><br><span class="line">		raw_spin_unlock(&amp;next-&gt;pi_lock);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	rq-&gt;stop = stop;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_HOTPLUG_CPU */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_rq_online</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!rq-&gt;online) &#123;</span><br><span class="line">		<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sched_class</span> *<span class="title">class</span>;</span></span><br><span class="line"></span><br><span class="line">		cpumask_set_cpu(rq-&gt;cpu, rq-&gt;rd-&gt;online);</span><br><span class="line">		rq-&gt;online = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		for_each_class(class) &#123;</span><br><span class="line">			<span class="keyword">if</span> (class-&gt;rq_online)</span><br><span class="line">				<span class="class"><span class="keyword">class</span>-&gt;<span class="title">rq_online</span>(<span class="title">rq</span>);</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_rq_offline</span><span class="params">(struct rq *rq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;online) &#123;</span><br><span class="line">		<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sched_class</span> *<span class="title">class</span>;</span></span><br><span class="line"></span><br><span class="line">		for_each_class(class) &#123;</span><br><span class="line">			<span class="keyword">if</span> (class-&gt;rq_offline)</span><br><span class="line">				<span class="class"><span class="keyword">class</span>-&gt;<span class="title">rq_offline</span>(<span class="title">rq</span>);</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		cpumask_clear_cpu(rq-&gt;cpu, rq-&gt;rd-&gt;online);</span><br><span class="line">		rq-&gt;online = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * used to mark begin/end of suspend/resume:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> num_cpus_frozen;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Update cpusets according to cpu_active mask.  If cpusets are</span></span><br><span class="line"><span class="comment"> * disabled, cpuset_update_active_cpus() becomes a simple wrapper</span></span><br><span class="line"><span class="comment"> * around partition_sched_domains().</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If we come here as part of a suspend/resume, don't touch cpusets because we</span></span><br><span class="line"><span class="comment"> * want to restore it back to its original state upon resume anyway.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cpuset_cpu_active</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (cpuhp_tasks_frozen) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * num_cpus_frozen tracks how many CPUs are involved in suspend</span></span><br><span class="line"><span class="comment">		 * resume sequence. As long as this is not the last online</span></span><br><span class="line"><span class="comment">		 * operation in the resume sequence, just build a single sched</span></span><br><span class="line"><span class="comment">		 * domain, ignoring cpusets.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		partition_sched_domains(<span class="number">1</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">if</span> (--num_cpus_frozen)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * This is the last CPU online operation. So fall through and</span></span><br><span class="line"><span class="comment">		 * restore the original sched domains by considering the</span></span><br><span class="line"><span class="comment">		 * cpuset configurations.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		cpuset_force_rebuild();</span><br><span class="line">	&#125;</span><br><span class="line">	cpuset_update_active_cpus();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpuset_cpu_inactive</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!cpuhp_tasks_frozen) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dl_cpu_busy(cpu))</span><br><span class="line">			<span class="keyword">return</span> -EBUSY;</span><br><span class="line">		cpuset_update_active_cpus();</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		num_cpus_frozen++;</span><br><span class="line">		partition_sched_domains(<span class="number">1</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_cpu_activate</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHED_SMT</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * When going up, increment the number of cores with SMT present.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (cpumask_weight(cpu_smt_mask(cpu)) == <span class="number">2</span>)</span><br><span class="line">		static_branch_inc_cpuslocked(&amp;sched_smt_present);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	set_cpu_active(cpu, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (sched_smp_initialized) &#123;</span><br><span class="line">		sched_domains_numa_masks_set(cpu);</span><br><span class="line">		cpuset_cpu_active();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Put the rq online, if not already. This happens:</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * 1) In the early boot process, because we build the real domains</span></span><br><span class="line"><span class="comment">	 *    after all CPUs have been brought up.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * 2) At runtime, if cpuset_cpu_active() fails to rebuild the</span></span><br><span class="line"><span class="comment">	 *    domains.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rq_lock_irqsave(rq, &amp;rf);</span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;rd) &#123;</span><br><span class="line">		BUG_ON(!cpumask_test_cpu(cpu, rq-&gt;rd-&gt;span));</span><br><span class="line">		set_rq_online(rq);</span><br><span class="line">	&#125;</span><br><span class="line">	rq_unlock_irqrestore(rq, &amp;rf);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_cpu_deactivate</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line"></span><br><span class="line">	set_cpu_active(cpu, <span class="literal">false</span>);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * We've cleared cpu_active_mask, wait for all preempt-disabled and RCU</span></span><br><span class="line"><span class="comment">	 * users of this state to go away such that all new such users will</span></span><br><span class="line"><span class="comment">	 * observe it.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Do sync before park smpboot threads to take care the rcu boost case.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	synchronize_rcu();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SCHED_SMT</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * When going down, decrement the number of cores with SMT present.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (cpumask_weight(cpu_smt_mask(cpu)) == <span class="number">2</span>)</span><br><span class="line">		static_branch_dec_cpuslocked(&amp;sched_smt_present);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!sched_smp_initialized)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	ret = cpuset_cpu_inactive(cpu);</span><br><span class="line">	<span class="keyword">if</span> (ret) &#123;</span><br><span class="line">		set_cpu_active(cpu, <span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	sched_domains_numa_masks_clear(cpu);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sched_rq_cpu_starting</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line"></span><br><span class="line">	rq-&gt;calc_load_update = calc_load_update;</span><br><span class="line">	update_max_interval();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_cpu_starting</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sched_rq_cpu_starting(cpu);</span><br><span class="line">	sched_tick_start(cpu);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_HOTPLUG_CPU</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sched_cpu_dying</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cpu_rq</span>(<span class="title">cpu</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Handle pending wakeups and then migrate everything off */</span></span><br><span class="line">	sched_tick_stop(cpu);</span><br><span class="line"></span><br><span class="line">	rq_lock_irqsave(rq, &amp;rf);</span><br><span class="line">	<span class="keyword">if</span> (rq-&gt;rd) &#123;</span><br><span class="line">		BUG_ON(!cpumask_test_cpu(cpu, rq-&gt;rd-&gt;span));</span><br><span class="line">		set_rq_offline(rq);</span><br><span class="line">	&#125;</span><br><span class="line">	migrate_tasks(rq, &amp;rf);</span><br><span class="line">	BUG_ON(rq-&gt;nr_running != <span class="number">1</span>);</span><br><span class="line">	rq_unlock_irqrestore(rq, &amp;rf);</span><br><span class="line"></span><br><span class="line">	calc_load_migrate(rq);</span><br><span class="line">	update_max_interval();</span><br><span class="line">	nohz_balance_exit_idle(rq);</span><br><span class="line">	hrtick_clear(rq);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> __init <span class="title">sched_init_smp</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sched_init_numa();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * There's no userspace yet to cause hotplug operations; hence all the</span></span><br><span class="line"><span class="comment">	 * CPU masks are stable and all blatant races in the below code cannot</span></span><br><span class="line"><span class="comment">	 * happen.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	mutex_lock(&amp;sched_domains_mutex);</span><br><span class="line">	sched_init_domains(cpu_active_mask);</span><br><span class="line">	mutex_unlock(&amp;sched_domains_mutex);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Move init over to a non-isolated CPU */</span></span><br><span class="line">	<span class="keyword">if</span> (set_cpus_allowed_ptr(current, housekeeping_cpumask(HK_FLAG_DOMAIN)) &lt; <span class="number">0</span>)</span><br><span class="line">		BUG();</span><br><span class="line">	sched_init_granularity();</span><br><span class="line"></span><br><span class="line">	init_sched_rt_class();</span><br><span class="line">	init_sched_dl_class();</span><br><span class="line"></span><br><span class="line">	sched_smp_initialized = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> __init <span class="title">migration_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sched_cpu_starting(smp_processor_id());</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">early_initcall(migration_init);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> __init <span class="title">sched_init_smp</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sched_init_granularity();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SMP */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">in_sched_functions</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> in_lock_functions(addr) ||</span><br><span class="line">		(addr &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>)__sched_text_start</span><br><span class="line">		&amp;&amp; addr &lt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>)__sched_text_end);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CGROUP_SCHED</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Default task group.</span></span><br><span class="line"><span class="comment"> * Every task in system belongs to this group at bootup.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> <span class="title">root_task_group</span>;</span></span><br><span class="line">LIST_HEAD(task_groups);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Cacheline aligned slab cache for task_group */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">kmem_cache</span> *<span class="title">task_group_cache</span> __<span class="title">read_mostly</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">DECLARE_PER_CPU(<span class="keyword">cpumask_var_t</span>, load_balance_mask);</span><br><span class="line">DECLARE_PER_CPU(<span class="keyword">cpumask_var_t</span>, select_idle_mask);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> __init <span class="title">sched_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> ptr = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">	wait_bit_init();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line">	ptr += <span class="number">2</span> * nr_cpu_ids * <span class="keyword">sizeof</span>(<span class="keyword">void</span> **);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RT_GROUP_SCHED</span></span><br><span class="line">	ptr += <span class="number">2</span> * nr_cpu_ids * <span class="keyword">sizeof</span>(<span class="keyword">void</span> **);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">if</span> (ptr) &#123;</span><br><span class="line">		ptr = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)kzalloc(ptr, GFP_NOWAIT);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line">		root_task_group.se = (struct sched_entity **)ptr;</span><br><span class="line">		ptr += nr_cpu_ids * <span class="keyword">sizeof</span>(<span class="keyword">void</span> **);</span><br><span class="line"></span><br><span class="line">		root_task_group.cfs_rq = (struct cfs_rq **)ptr;</span><br><span class="line">		ptr += nr_cpu_ids * <span class="keyword">sizeof</span>(<span class="keyword">void</span> **);</span><br><span class="line"></span><br><span class="line">		root_task_group.shares = ROOT_TASK_GROUP_LOAD;</span><br><span class="line">		init_cfs_bandwidth(&amp;root_task_group.cfs_bandwidth);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_FAIR_GROUP_SCHED */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RT_GROUP_SCHED</span></span><br><span class="line">		root_task_group.rt_se = (struct sched_rt_entity **)ptr;</span><br><span class="line">		ptr += nr_cpu_ids * <span class="keyword">sizeof</span>(<span class="keyword">void</span> **);</span><br><span class="line"></span><br><span class="line">		root_task_group.rt_rq = (struct rt_rq **)ptr;</span><br><span class="line">		ptr += nr_cpu_ids * <span class="keyword">sizeof</span>(<span class="keyword">void</span> **);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_RT_GROUP_SCHED */</span></span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CPUMASK_OFFSTACK</span></span><br><span class="line">	for_each_possible_cpu(i) &#123;</span><br><span class="line">		per_cpu(load_balance_mask, i) = (<span class="keyword">cpumask_var_t</span>)kzalloc_node(</span><br><span class="line">			cpumask_size(), GFP_KERNEL, cpu_to_node(i));</span><br><span class="line">		per_cpu(select_idle_mask, i) = (<span class="keyword">cpumask_var_t</span>)kzalloc_node(</span><br><span class="line">			cpumask_size(), GFP_KERNEL, cpu_to_node(i));</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_CPUMASK_OFFSTACK */</span></span></span><br><span class="line"></span><br><span class="line">	init_rt_bandwidth(&amp;def_rt_bandwidth, global_rt_period(), global_rt_runtime());</span><br><span class="line">	init_dl_bandwidth(&amp;def_dl_bandwidth, global_rt_period(), global_rt_runtime());</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	init_defrootdomain();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RT_GROUP_SCHED</span></span><br><span class="line">	init_rt_bandwidth(&amp;root_task_group.rt_bandwidth,</span><br><span class="line">			global_rt_period(), global_rt_runtime());</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_RT_GROUP_SCHED */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CGROUP_SCHED</span></span><br><span class="line">	task_group_cache = KMEM_CACHE(task_group, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	list_add(&amp;root_task_group.<span class="built_in">list</span>, &amp;task_groups);</span><br><span class="line">	INIT_LIST_HEAD(&amp;root_task_group.children);</span><br><span class="line">	INIT_LIST_HEAD(&amp;root_task_group.siblings);</span><br><span class="line">	autogroup_init(&amp;init_task);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_CGROUP_SCHED */</span></span></span><br><span class="line"></span><br><span class="line">	for_each_possible_cpu(i) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">		rq = cpu_rq(i);</span><br><span class="line">		raw_spin_lock_init(&amp;rq-&gt;lock);</span><br><span class="line">		rq-&gt;nr_running = <span class="number">0</span>;</span><br><span class="line">		rq-&gt;calc_load_active = <span class="number">0</span>;</span><br><span class="line">		rq-&gt;calc_load_update = jiffies + LOAD_FREQ;</span><br><span class="line">		init_cfs_rq(&amp;rq-&gt;cfs);</span><br><span class="line">		init_rt_rq(&amp;rq-&gt;rt);</span><br><span class="line">		init_dl_rq(&amp;rq-&gt;dl);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line">		INIT_LIST_HEAD(&amp;rq-&gt;leaf_cfs_rq_list);</span><br><span class="line">		rq-&gt;tmp_alone_branch = &amp;rq-&gt;leaf_cfs_rq_list;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * How much CPU bandwidth does root_task_group get?</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * In case of task-groups formed thr' the cgroup filesystem, it</span></span><br><span class="line"><span class="comment">		 * gets 100% of the CPU resources in the system. This overall</span></span><br><span class="line"><span class="comment">		 * system CPU resource is divided among the tasks of</span></span><br><span class="line"><span class="comment">		 * root_task_group and its child task-groups in a fair manner,</span></span><br><span class="line"><span class="comment">		 * based on each entity's (task or task-group's) weight</span></span><br><span class="line"><span class="comment">		 * (se-&gt;load.weight).</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * In other words, if root_task_group has 10 tasks of weight</span></span><br><span class="line"><span class="comment">		 * 1024) and two child groups A0 and A1 (of weight 1024 each),</span></span><br><span class="line"><span class="comment">		 * then A0's share of the CPU resource is:</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 *	A0's bandwidth = 1024 / (10*1024 + 1024 + 1024) = 8.33%</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * We achieve this by letting root_task_group's tasks sit</span></span><br><span class="line"><span class="comment">		 * directly in rq-&gt;cfs (i.e root_task_group-&gt;se[] = NULL).</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		init_tg_cfs_entry(&amp;root_task_group, &amp;rq-&gt;cfs, <span class="literal">NULL</span>, i, <span class="literal">NULL</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_FAIR_GROUP_SCHED */</span></span></span><br><span class="line"></span><br><span class="line">		rq-&gt;rt.rt_runtime = def_rt_bandwidth.rt_runtime;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RT_GROUP_SCHED</span></span><br><span class="line">		init_tg_rt_entry(&amp;root_task_group, &amp;rq-&gt;rt, <span class="literal">NULL</span>, i, <span class="literal">NULL</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">		rq-&gt;sd = <span class="literal">NULL</span>;</span><br><span class="line">		rq-&gt;rd = <span class="literal">NULL</span>;</span><br><span class="line">		rq-&gt;cpu_capacity = rq-&gt;cpu_capacity_orig = SCHED_CAPACITY_SCALE;</span><br><span class="line">		rq-&gt;balance_callback = <span class="literal">NULL</span>;</span><br><span class="line">		rq-&gt;active_balance = <span class="number">0</span>;</span><br><span class="line">		rq-&gt;next_balance = jiffies;</span><br><span class="line">		rq-&gt;push_cpu = <span class="number">0</span>;</span><br><span class="line">		rq-&gt;cpu = i;</span><br><span class="line">		rq-&gt;online = <span class="number">0</span>;</span><br><span class="line">		rq-&gt;idle_stamp = <span class="number">0</span>;</span><br><span class="line">		rq-&gt;avg_idle = <span class="number">2</span>*sysctl_sched_migration_cost;</span><br><span class="line">		rq-&gt;max_idle_balance_cost = sysctl_sched_migration_cost;</span><br><span class="line"></span><br><span class="line">		INIT_LIST_HEAD(&amp;rq-&gt;cfs_tasks);</span><br><span class="line"></span><br><span class="line">		rq_attach_root(rq, &amp;def_root_domain);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NO_HZ_COMMON</span></span><br><span class="line">		rq-&gt;last_blocked_load_update_tick = jiffies;</span><br><span class="line">		atomic_set(&amp;rq-&gt;nohz_flags, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		rq_csd_init(rq, &amp;rq-&gt;nohz_csd, nohz_csd_func);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_SMP */</span></span></span><br><span class="line">		hrtick_rq_init(rq);</span><br><span class="line">		atomic_set(&amp;rq-&gt;nr_iowait, <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	set_load_weight(&amp;init_task, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The boot idle thread does lazy MMU switching as well:</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	mmgrab(&amp;init_mm);</span><br><span class="line">	enter_lazy_tlb(&amp;init_mm, current);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Make us the idle thread. Technically, schedule() should not be</span></span><br><span class="line"><span class="comment">	 * called from this thread, however somewhere below it might be,</span></span><br><span class="line"><span class="comment">	 * but because we are the idle thread, we just pick up running again</span></span><br><span class="line"><span class="comment">	 * when this runqueue becomes "idle".</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	init_idle(current, smp_processor_id());</span><br><span class="line"></span><br><span class="line">	calc_load_update = jiffies + LOAD_FREQ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SMP</span></span><br><span class="line">	idle_thread_set_boot_cpu();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	init_sched_fair_class();</span><br><span class="line"></span><br><span class="line">	init_schedstats();</span><br><span class="line"></span><br><span class="line">	psi_init();</span><br><span class="line"></span><br><span class="line">	init_uclamp();</span><br><span class="line"></span><br><span class="line">	scheduler_running = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_ATOMIC_SLEEP</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">preempt_count_equals</span><span class="params">(<span class="keyword">int</span> preempt_offset)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> nested = preempt_count() + rcu_preempt_depth();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (nested == preempt_offset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> __might_sleep(<span class="keyword">const</span> <span class="keyword">char</span> *file, <span class="keyword">int</span> line, <span class="keyword">int</span> preempt_offset)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Blocking primitives will set (and therefore destroy) current-&gt;state,</span></span><br><span class="line"><span class="comment">	 * since we will exit with TASK_RUNNING make sure we enter with it,</span></span><br><span class="line"><span class="comment">	 * otherwise we will destroy state.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	WARN_ONCE(current-&gt;state != TASK_RUNNING &amp;&amp; current-&gt;task_state_change,</span><br><span class="line">			<span class="string">"do not call blocking ops when !TASK_RUNNING; "</span></span><br><span class="line">			<span class="string">"state=%lx set at [&lt;%p&gt;] %pS\n"</span>,</span><br><span class="line">			current-&gt;state,</span><br><span class="line">			(<span class="keyword">void</span> *)current-&gt;task_state_change,</span><br><span class="line">			(<span class="keyword">void</span> *)current-&gt;task_state_change);</span><br><span class="line"></span><br><span class="line">	___might_sleep(file, line, preempt_offset);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(__might_sleep);</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> ___might_sleep(<span class="keyword">const</span> <span class="keyword">char</span> *file, <span class="keyword">int</span> line, <span class="keyword">int</span> preempt_offset)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* Ratelimiting timestamp: */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> prev_jiffy;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> preempt_disable_ip;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* WARN_ON_ONCE() by default, no rate limit required: */</span></span><br><span class="line">	rcu_sleep_check();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((preempt_count_equals(preempt_offset) &amp;&amp; !irqs_disabled() &amp;&amp;</span><br><span class="line">	     !is_idle_task(current) &amp;&amp; !current-&gt;non_block_count) ||</span><br><span class="line">	    system_state == SYSTEM_BOOTING || system_state &gt; SYSTEM_RUNNING ||</span><br><span class="line">	    oops_in_progress)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (time_before(jiffies, prev_jiffy + HZ) &amp;&amp; prev_jiffy)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	prev_jiffy = jiffies;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Save this before calling printk(), since that will clobber it: */</span></span><br><span class="line">	preempt_disable_ip = get_preempt_disable_ip(current);</span><br><span class="line"></span><br><span class="line">	printk(KERN_ERR</span><br><span class="line">		<span class="string">"BUG: sleeping function called from invalid context at %s:%d\n"</span>,</span><br><span class="line">			file, line);</span><br><span class="line">	printk(KERN_ERR</span><br><span class="line">		<span class="string">"in_atomic(): %d, irqs_disabled(): %d, non_block: %d, pid: %d, name: %s\n"</span>,</span><br><span class="line">			in_atomic(), irqs_disabled(), current-&gt;non_block_count,</span><br><span class="line">			current-&gt;pid, current-&gt;comm);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (task_stack_end_corrupted(current))</span><br><span class="line">		printk(KERN_EMERG <span class="string">"Thread overran stack, or stack corrupted\n"</span>);</span><br><span class="line"></span><br><span class="line">	debug_show_held_locks(current);</span><br><span class="line">	<span class="keyword">if</span> (irqs_disabled())</span><br><span class="line">		print_irqtrace_events(current);</span><br><span class="line">	<span class="keyword">if</span> (IS_ENABLED(CONFIG_DEBUG_PREEMPT)</span><br><span class="line">	    &amp;&amp; !preempt_count_equals(preempt_offset)) &#123;</span><br><span class="line">		pr_err(<span class="string">"Preemption disabled at:"</span>);</span><br><span class="line">		print_ip_sym(KERN_ERR, preempt_disable_ip);</span><br><span class="line">	&#125;</span><br><span class="line">	dump_stack();</span><br><span class="line">	add_taint(TAINT_WARN, LOCKDEP_STILL_OK);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(___might_sleep);</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> __cant_sleep(<span class="keyword">const</span> <span class="keyword">char</span> *file, <span class="keyword">int</span> line, <span class="keyword">int</span> preempt_offset)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> prev_jiffy;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (irqs_disabled())</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!IS_ENABLED(CONFIG_PREEMPT_COUNT))</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (preempt_count() &gt; preempt_offset)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (time_before(jiffies, prev_jiffy + HZ) &amp;&amp; prev_jiffy)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	prev_jiffy = jiffies;</span><br><span class="line"></span><br><span class="line">	printk(KERN_ERR <span class="string">"BUG: assuming atomic context at %s:%d\n"</span>, file, line);</span><br><span class="line">	printk(KERN_ERR <span class="string">"in_atomic(): %d, irqs_disabled(): %d, pid: %d, name: %s\n"</span>,</span><br><span class="line">			in_atomic(), irqs_disabled(),</span><br><span class="line">			current-&gt;pid, current-&gt;comm);</span><br><span class="line"></span><br><span class="line">	debug_show_held_locks(current);</span><br><span class="line">	dump_stack();</span><br><span class="line">	add_taint(TAINT_WARN, LOCKDEP_STILL_OK);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(__cant_sleep);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_MAGIC_SYSRQ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">normalize_rt_tasks</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">g</span>, *<span class="title">p</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_attr</span> <span class="title">attr</span> = &#123;</span></span><br><span class="line">		.sched_policy = SCHED_NORMAL,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	read_lock(&amp;tasklist_lock);</span><br><span class="line">	for_each_process_thread(g, p) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Only normalize user tasks:</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (p-&gt;flags &amp; PF_KTHREAD)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">		p-&gt;se.exec_start = <span class="number">0</span>;</span><br><span class="line">		schedstat_set(p-&gt;se.statistics.wait_start,  <span class="number">0</span>);</span><br><span class="line">		schedstat_set(p-&gt;se.statistics.sleep_start, <span class="number">0</span>);</span><br><span class="line">		schedstat_set(p-&gt;se.statistics.block_start, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!dl_task(p) &amp;&amp; !rt_task(p)) &#123;</span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * Renice negative nice level userspace</span></span><br><span class="line"><span class="comment">			 * tasks back to 0:</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="keyword">if</span> (task_nice(p) &lt; <span class="number">0</span>)</span><br><span class="line">				set_user_nice(p, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		__sched_setscheduler(p, &amp;attr, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	read_unlock(&amp;tasklist_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_MAGIC_SYSRQ */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_IA64) || defined(CONFIG_KGDB_KDB)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * These functions are only useful for the IA64 MCA handling, or kdb.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * They can only be called when the whole system has been</span></span><br><span class="line"><span class="comment"> * stopped - every CPU needs to be quiescent, and no scheduling</span></span><br><span class="line"><span class="comment"> * activity can take place. Using them for anything else would</span></span><br><span class="line"><span class="comment"> * be a serious bug, and as a result, they aren't even visible</span></span><br><span class="line"><span class="comment"> * under any other configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * curr_task - return the current task for a given CPU.</span></span><br><span class="line"><span class="comment"> * @cpu: the processor in question.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ONLY VALID WHEN THE WHOLE SYSTEM IS STOPPED!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Return: The current task for @cpu.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">struct task_struct *<span class="title">curr_task</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> cpu_curr(cpu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* defined(CONFIG_IA64) || defined(CONFIG_KGDB_KDB) */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_IA64</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ia64_set_curr_task - set the current task for a given CPU.</span></span><br><span class="line"><span class="comment"> * @cpu: the processor in question.</span></span><br><span class="line"><span class="comment"> * @p: the task pointer to set.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Description: This function must only be used when non-maskable interrupts</span></span><br><span class="line"><span class="comment"> * are serviced on a separate stack. It allows the architecture to switch the</span></span><br><span class="line"><span class="comment"> * notion of the current task on a CPU in a non-blocking manner. This function</span></span><br><span class="line"><span class="comment"> * must be called with all CPU's synchronized, and interrupts disabled, the</span></span><br><span class="line"><span class="comment"> * and caller must save the original value of the current task (see</span></span><br><span class="line"><span class="comment"> * curr_task() above) and restore that value before reenabling interrupts and</span></span><br><span class="line"><span class="comment"> * re-starting the system.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ONLY VALID WHEN THE WHOLE SYSTEM IS STOPPED!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ia64_set_curr_task</span><span class="params">(<span class="keyword">int</span> cpu, struct task_struct *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cpu_curr(cpu) = p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CGROUP_SCHED</span></span><br><span class="line"><span class="comment">/* task_group_lock serializes the addition/removal of task groups */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">DEFINE_SPINLOCK</span><span class="params">(task_group_lock)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">alloc_uclamp_sched_group</span><span class="params">(struct task_group *tg,</span></span></span><br><span class="line"><span class="function"><span class="params">					    struct task_group *parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_UCLAMP_TASK_GROUP</span></span><br><span class="line">	<span class="keyword">enum</span> uclamp_id clamp_id;</span><br><span class="line"></span><br><span class="line">	for_each_clamp_id(clamp_id) &#123;</span><br><span class="line">		uclamp_se_set(&amp;tg-&gt;uclamp_req[clamp_id],</span><br><span class="line">			      uclamp_none(clamp_id), <span class="literal">false</span>);</span><br><span class="line">		tg-&gt;uclamp[clamp_id] = parent-&gt;uclamp[clamp_id];</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sched_free_group</span><span class="params">(struct task_group *tg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	free_fair_sched_group(tg);</span><br><span class="line">	free_rt_sched_group(tg);</span><br><span class="line">	autogroup_free(tg);</span><br><span class="line">	kmem_cache_free(task_group_cache, tg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* allocate runqueue etc for a new task group */</span></span><br><span class="line"><span class="function">struct task_group *<span class="title">sched_create_group</span><span class="params">(struct task_group *parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span>;</span></span><br><span class="line"></span><br><span class="line">	tg = kmem_cache_alloc(task_group_cache, GFP_KERNEL | __GFP_ZERO);</span><br><span class="line">	<span class="keyword">if</span> (!tg)</span><br><span class="line">		<span class="keyword">return</span> ERR_PTR(-ENOMEM);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!alloc_fair_sched_group(tg, parent))</span><br><span class="line">		<span class="keyword">goto</span> err;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!alloc_rt_sched_group(tg, parent))</span><br><span class="line">		<span class="keyword">goto</span> err;</span><br><span class="line"></span><br><span class="line">	alloc_uclamp_sched_group(tg, parent);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tg;</span><br><span class="line"></span><br><span class="line">err:</span><br><span class="line">	sched_free_group(tg);</span><br><span class="line">	<span class="keyword">return</span> ERR_PTR(-ENOMEM);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_online_group</span><span class="params">(struct task_group *tg, struct task_group *parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line"></span><br><span class="line">	spin_lock_irqsave(&amp;task_group_lock, flags);</span><br><span class="line">	list_add_rcu(&amp;tg-&gt;<span class="built_in">list</span>, &amp;task_groups);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Root should already exist: */</span></span><br><span class="line">	WARN_ON(!parent);</span><br><span class="line"></span><br><span class="line">	tg-&gt;parent = parent;</span><br><span class="line">	INIT_LIST_HEAD(&amp;tg-&gt;children);</span><br><span class="line">	list_add_rcu(&amp;tg-&gt;siblings, &amp;parent-&gt;children);</span><br><span class="line">	spin_unlock_irqrestore(&amp;task_group_lock, flags);</span><br><span class="line"></span><br><span class="line">	online_fair_sched_group(tg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* rcu callback to free various structures associated with a task group */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sched_free_group_rcu</span><span class="params">(struct rcu_head *rhp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* Now it should be safe to free those cfs_rqs: */</span></span><br><span class="line">	sched_free_group(container_of(rhp, struct task_group, rcu));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_destroy_group</span><span class="params">(struct task_group *tg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* Wait for possible concurrent references to cfs_rqs complete: */</span></span><br><span class="line">	call_rcu(&amp;tg-&gt;rcu, sched_free_group_rcu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_offline_group</span><span class="params">(struct task_group *tg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* End participation in shares distribution: */</span></span><br><span class="line">	unregister_fair_sched_group(tg);</span><br><span class="line"></span><br><span class="line">	spin_lock_irqsave(&amp;task_group_lock, flags);</span><br><span class="line">	list_del_rcu(&amp;tg-&gt;<span class="built_in">list</span>);</span><br><span class="line">	list_del_rcu(&amp;tg-&gt;siblings);</span><br><span class="line">	spin_unlock_irqrestore(&amp;task_group_lock, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sched_change_group</span><span class="params">(struct task_struct *tsk, <span class="keyword">int</span> type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * All callers are synchronized by task_rq_lock(); we do not use RCU</span></span><br><span class="line"><span class="comment">	 * which is pointless here. Thus, we pass "true" to task_css_check()</span></span><br><span class="line"><span class="comment">	 * to prevent lockdep warnings.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	tg = container_of(task_css_check(tsk, cpu_cgrp_id, <span class="literal">true</span>),</span><br><span class="line">			  struct task_group, css);</span><br><span class="line">	tg = autogroup_task_group(tsk, tg);</span><br><span class="line">	tsk-&gt;sched_task_group = tg;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line">	<span class="keyword">if</span> (tsk-&gt;sched_class-&gt;task_change_group)</span><br><span class="line">		tsk-&gt;sched_class-&gt;task_change_group(tsk, type);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">#endif</span><br><span class="line">		set_task_rq(tsk, task_cpu(tsk));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Change task's runqueue when it moves between groups.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The caller of this function should have put the task in its new group by</span></span><br><span class="line"><span class="comment"> * now. This function just updates tsk-&gt;se.cfs_rq and tsk-&gt;se.parent to reflect</span></span><br><span class="line"><span class="comment"> * its new group.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sched_move_task</span><span class="params">(struct task_struct *tsk)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> queued, running, queue_flags =</span><br><span class="line">		DEQUEUE_SAVE | DEQUEUE_MOVE | DEQUEUE_NOCLOCK;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	rq = task_rq_lock(tsk, &amp;rf);</span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line"></span><br><span class="line">	running = task_current(rq, tsk);</span><br><span class="line">	queued = task_on_rq_queued(tsk);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		dequeue_task(rq, tsk, queue_flags);</span><br><span class="line">	<span class="keyword">if</span> (running)</span><br><span class="line">		put_prev_task(rq, tsk);</span><br><span class="line"></span><br><span class="line">	sched_change_group(tsk, TASK_MOVE_GROUP);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (queued)</span><br><span class="line">		enqueue_task(rq, tsk, queue_flags);</span><br><span class="line">	<span class="keyword">if</span> (running) &#123;</span><br><span class="line">		set_next_task(rq, tsk);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * After changing group, the running task may have joined a</span></span><br><span class="line"><span class="comment">		 * throttled one but it's still the running task. Trigger a</span></span><br><span class="line"><span class="comment">		 * resched to make sure that task can still run.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		resched_curr(rq);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	task_rq_unlock(rq, tsk, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> struct task_group *<span class="title">css_tg</span><span class="params">(struct cgroup_subsys_state *css)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> css ? container_of(css, struct task_group, css) : <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">cgroup_subsys_state</span> *</span></span><br><span class="line"><span class="class"><span class="title">cpu_cgroup_css_alloc</span>(<span class="title">struct</span> <span class="title">cgroup_subsys_state</span> *<span class="title">parent_css</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">parent</span> = <span class="title">css_tg</span>(<span class="title">parent_css</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!parent) &#123;</span><br><span class="line">		<span class="comment">/* This is early initialization for the top cgroup */</span></span><br><span class="line">		<span class="keyword">return</span> &amp;root_task_group.css;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tg = sched_create_group(parent);</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(tg))</span><br><span class="line">		<span class="keyword">return</span> ERR_PTR(-ENOMEM);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;tg-&gt;css;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Expose task group only after completing cgroup initialization */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_cgroup_css_online</span><span class="params">(struct cgroup_subsys_state *css)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">css</span>);</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">parent</span> = <span class="title">css_tg</span>(<span class="title">css</span>-&gt;<span class="title">parent</span>);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (parent)</span><br><span class="line">		sched_online_group(tg, parent);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_UCLAMP_TASK_GROUP</span></span><br><span class="line">	<span class="comment">/* Propagate the effective uclamp value for the new group */</span></span><br><span class="line">	cpu_util_update_eff(css);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cpu_cgroup_css_released</span><span class="params">(struct cgroup_subsys_state *css)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">css</span>);</span></span><br><span class="line"></span><br><span class="line">	sched_offline_group(tg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cpu_cgroup_css_free</span><span class="params">(struct cgroup_subsys_state *css)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">css</span>);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Relies on the RCU grace period between css_released() and this.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	sched_free_group(tg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is called before wake_up_new_task(), therefore we really only</span></span><br><span class="line"><span class="comment"> * have to set its group bits, all the other stuff does not apply.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cpu_cgroup_fork</span><span class="params">(struct task_struct *task)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span>;</span></span><br><span class="line"></span><br><span class="line">	rq = task_rq_lock(task, &amp;rf);</span><br><span class="line"></span><br><span class="line">	update_rq_clock(rq);</span><br><span class="line">	sched_change_group(task, TASK_SET_GROUP);</span><br><span class="line"></span><br><span class="line">	task_rq_unlock(rq, task, &amp;rf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_cgroup_can_attach</span><span class="params">(struct cgroup_taskset *tset)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cgroup_subsys_state</span> *<span class="title">css</span>;</span></span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	cgroup_taskset_for_each(task, css, tset) &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RT_GROUP_SCHED</span></span><br><span class="line">		<span class="keyword">if</span> (!sched_rt_can_attach(css_tg(css), task))</span><br><span class="line">			<span class="keyword">return</span> -EINVAL;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Serialize against wake_up_new_task() such that if its</span></span><br><span class="line"><span class="comment">		 * running, we're sure to observe its full state.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		raw_spin_lock_irq(&amp;task-&gt;pi_lock);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Avoid calling sched_move_task() before wake_up_new_task()</span></span><br><span class="line"><span class="comment">		 * has happened. This would lead to problems with PELT, due to</span></span><br><span class="line"><span class="comment">		 * move wanting to detach+attach while we're not attached yet.</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (task-&gt;state == TASK_NEW)</span><br><span class="line">			ret = -EINVAL;</span><br><span class="line">		raw_spin_unlock_irq(&amp;task-&gt;pi_lock);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (ret)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cpu_cgroup_attach</span><span class="params">(struct cgroup_taskset *tset)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cgroup_subsys_state</span> *<span class="title">css</span>;</span></span><br><span class="line"></span><br><span class="line">	cgroup_taskset_for_each(task, css, tset)</span><br><span class="line">		sched_move_task(task);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_UCLAMP_TASK_GROUP</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">cpu_util_update_eff</span><span class="params">(struct cgroup_subsys_state *css)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cgroup_subsys_state</span> *<span class="title">top_css</span> = <span class="title">css</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> *<span class="title">uc_parent</span> = <span class="title">NULL</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_se</span> *<span class="title">uc_se</span> = <span class="title">NULL</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> eff[UCLAMP_CNT];</span><br><span class="line">	<span class="keyword">enum</span> uclamp_id clamp_id;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> clamps;</span><br><span class="line"></span><br><span class="line">	css_for_each_descendant_pre(css, top_css) &#123;</span><br><span class="line">		uc_parent = css_tg(css)-&gt;parent</span><br><span class="line">			? css_tg(css)-&gt;parent-&gt;uclamp : <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">		for_each_clamp_id(clamp_id) &#123;</span><br><span class="line">			<span class="comment">/* Assume effective clamps matches requested clamps */</span></span><br><span class="line">			eff[clamp_id] = css_tg(css)-&gt;uclamp_req[clamp_id].value;</span><br><span class="line">			<span class="comment">/* Cap effective clamps with parent's effective clamps */</span></span><br><span class="line">			<span class="keyword">if</span> (uc_parent &amp;&amp;</span><br><span class="line">			    eff[clamp_id] &gt; uc_parent[clamp_id].value) &#123;</span><br><span class="line">				eff[clamp_id] = uc_parent[clamp_id].value;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/* Ensure protection is always capped by limit */</span></span><br><span class="line">		eff[UCLAMP_MIN] = min(eff[UCLAMP_MIN], eff[UCLAMP_MAX]);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Propagate most restrictive effective clamps */</span></span><br><span class="line">		clamps = <span class="number">0x0</span>;</span><br><span class="line">		uc_se = css_tg(css)-&gt;uclamp;</span><br><span class="line">		for_each_clamp_id(clamp_id) &#123;</span><br><span class="line">			<span class="keyword">if</span> (eff[clamp_id] == uc_se[clamp_id].value)</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			uc_se[clamp_id].value = eff[clamp_id];</span><br><span class="line">			uc_se[clamp_id].bucket_id = uclamp_bucket_id(eff[clamp_id]);</span><br><span class="line">			clamps |= (<span class="number">0x1</span> &lt;&lt; clamp_id);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!clamps) &#123;</span><br><span class="line">			css = css_rightmost_descendant(css);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Immediately update descendants RUNNABLE tasks */</span></span><br><span class="line">		uclamp_update_active_tasks(css, clamps);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Integer 10^N with a given N exponent by casting to integer the literal "1eN"</span></span><br><span class="line"><span class="comment"> * C expression. Since there is no way to convert a macro argument (N) into a</span></span><br><span class="line"><span class="comment"> * character constant, use two levels of macros.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _POW10(exp) ((unsigned int)1e##exp)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> POW10(exp) _POW10(exp)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">uclamp_request</span> &#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UCLAMP_PERCENT_SHIFT	2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UCLAMP_PERCENT_SCALE	(100 * POW10(UCLAMP_PERCENT_SHIFT))</span></span><br><span class="line">	s64 percent;</span><br><span class="line">	u64 util;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="class"><span class="keyword">struct</span> <span class="title">uclamp_request</span></span></span><br><span class="line"><span class="class"><span class="title">capacity_from_percent</span>(<span class="title">char</span> *<span class="title">buf</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_request</span> <span class="title">req</span> = &#123;</span></span><br><span class="line">		.percent = UCLAMP_PERCENT_SCALE,</span><br><span class="line">		.util = SCHED_CAPACITY_SCALE,</span><br><span class="line">		.ret = <span class="number">0</span>,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	buf = strim(buf);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, <span class="string">"max"</span>)) &#123;</span><br><span class="line">		req.ret = cgroup_parse_float(buf, UCLAMP_PERCENT_SHIFT,</span><br><span class="line">					     &amp;req.percent);</span><br><span class="line">		<span class="keyword">if</span> (req.ret)</span><br><span class="line">			<span class="keyword">return</span> req;</span><br><span class="line">		<span class="keyword">if</span> ((u64)req.percent &gt; UCLAMP_PERCENT_SCALE) &#123;</span><br><span class="line">			req.ret = -ERANGE;</span><br><span class="line">			<span class="keyword">return</span> req;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		req.util = req.percent &lt;&lt; SCHED_CAPACITY_SHIFT;</span><br><span class="line">		req.util = DIV_ROUND_CLOSEST_ULL(req.util, UCLAMP_PERCENT_SCALE);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> req;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">ssize_t</span> <span class="title">cpu_uclamp_write</span><span class="params">(struct kernfs_open_file *of, <span class="keyword">char</span> *buf,</span></span></span><br><span class="line"><span class="function"><span class="params">				<span class="keyword">size_t</span> nbytes, <span class="keyword">loff_t</span> off,</span></span></span><br><span class="line"><span class="function"><span class="params">				<span class="keyword">enum</span> uclamp_id clamp_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">uclamp_request</span> <span class="title">req</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span>;</span></span><br><span class="line"></span><br><span class="line">	req = capacity_from_percent(buf);</span><br><span class="line">	<span class="keyword">if</span> (req.ret)</span><br><span class="line">		<span class="keyword">return</span> req.ret;</span><br><span class="line"></span><br><span class="line">	mutex_lock(&amp;uclamp_mutex);</span><br><span class="line">	rcu_read_lock();</span><br><span class="line"></span><br><span class="line">	tg = css_tg(of_css(of));</span><br><span class="line">	<span class="keyword">if</span> (tg-&gt;uclamp_req[clamp_id].value != req.util)</span><br><span class="line">		uclamp_se_set(&amp;tg-&gt;uclamp_req[clamp_id], req.util, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Because of not recoverable conversion rounding we keep track of the</span></span><br><span class="line"><span class="comment">	 * exact requested value</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	tg-&gt;uclamp_pct[clamp_id] = req.percent;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Update effective clamps to track the most restrictive value */</span></span><br><span class="line">	cpu_util_update_eff(of_css(of));</span><br><span class="line"></span><br><span class="line">	rcu_read_unlock();</span><br><span class="line">	mutex_unlock(&amp;uclamp_mutex);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> nbytes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">ssize_t</span> <span class="title">cpu_uclamp_min_write</span><span class="params">(struct kernfs_open_file *of,</span></span></span><br><span class="line"><span class="function"><span class="params">				    <span class="keyword">char</span> *buf, <span class="keyword">size_t</span> nbytes,</span></span></span><br><span class="line"><span class="function"><span class="params">				    <span class="keyword">loff_t</span> off)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> cpu_uclamp_write(of, buf, nbytes, off, UCLAMP_MIN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">ssize_t</span> <span class="title">cpu_uclamp_max_write</span><span class="params">(struct kernfs_open_file *of,</span></span></span><br><span class="line"><span class="function"><span class="params">				    <span class="keyword">char</span> *buf, <span class="keyword">size_t</span> nbytes,</span></span></span><br><span class="line"><span class="function"><span class="params">				    <span class="keyword">loff_t</span> off)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> cpu_uclamp_write(of, buf, nbytes, off, UCLAMP_MAX);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">cpu_uclamp_print</span><span class="params">(struct seq_file *sf,</span></span></span><br><span class="line"><span class="function"><span class="params">				    <span class="keyword">enum</span> uclamp_id clamp_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span>;</span></span><br><span class="line">	u64 util_clamp;</span><br><span class="line">	u64 percent;</span><br><span class="line">	u32 rem;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	tg = css_tg(seq_css(sf));</span><br><span class="line">	util_clamp = tg-&gt;uclamp_req[clamp_id].value;</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (util_clamp == SCHED_CAPACITY_SCALE) &#123;</span><br><span class="line">		seq_puts(sf, <span class="string">"max\n"</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	percent = tg-&gt;uclamp_pct[clamp_id];</span><br><span class="line">	percent = div_u64_rem(percent, POW10(UCLAMP_PERCENT_SHIFT), &amp;rem);</span><br><span class="line">	seq_printf(sf, <span class="string">"%llu.%0*u\n"</span>, percent, UCLAMP_PERCENT_SHIFT, rem);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_uclamp_min_show</span><span class="params">(struct seq_file *sf, <span class="keyword">void</span> *v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cpu_uclamp_print(sf, UCLAMP_MIN);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_uclamp_max_show</span><span class="params">(struct seq_file *sf, <span class="keyword">void</span> *v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cpu_uclamp_print(sf, UCLAMP_MAX);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_UCLAMP_TASK_GROUP */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_shares_write_u64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				struct cftype *cftype, u64 shareval)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (shareval &gt; scale_load_down(ULONG_MAX))</span><br><span class="line">		shareval = MAX_SHARES;</span><br><span class="line">	<span class="keyword">return</span> sched_group_set_shares(css_tg(css), scale_load(shareval));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> u64 <span class="title">cpu_shares_read_u64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">			       struct cftype *cft)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">css</span>);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (u64) scale_load_down(tg-&gt;shares);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CFS_BANDWIDTH</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">DEFINE_MUTEX</span><span class="params">(cfs_constraints_mutex)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u64 max_cfs_quota_period = <span class="number">1</span> * NSEC_PER_SEC; <span class="comment">/* 1s */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> u64 min_cfs_quota_period = <span class="number">1</span> * NSEC_PER_MSEC; <span class="comment">/* 1ms */</span></span><br><span class="line"><span class="comment">/* More than 203 days if BW_SHIFT equals 20. */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> u64 max_cfs_runtime = MAX_BW * NSEC_PER_USEC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> __cfs_schedulable(struct task_group *tg, u64 period, u64 runtime);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">tg_set_cfs_bandwidth</span><span class="params">(struct task_group *tg, u64 period, u64 quota)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, ret = <span class="number">0</span>, runtime_enabled, runtime_was_enabled;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cfs_bandwidth</span> *<span class="title">cfs_b</span> = &amp;<span class="title">tg</span>-&gt;<span class="title">cfs_bandwidth</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (tg == &amp;root_task_group)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Ensure we have at some amount of bandwidth every period.  This is</span></span><br><span class="line"><span class="comment">	 * to prevent reaching a state of large arrears when throttled via</span></span><br><span class="line"><span class="comment">	 * entity_tick() resulting in prolonged exit starvation.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (quota &lt; min_cfs_quota_period || period &lt; min_cfs_quota_period)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Likewise, bound things on the otherside by preventing insane quota</span></span><br><span class="line"><span class="comment">	 * periods.  This also allows us to normalize in computing quota</span></span><br><span class="line"><span class="comment">	 * feasibility.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (period &gt; max_cfs_quota_period)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Bound quota to defend quota against overflow during bandwidth shift.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (quota != RUNTIME_INF &amp;&amp; quota &gt; max_cfs_runtime)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Prevent race between setting of cfs_rq-&gt;runtime_enabled and</span></span><br><span class="line"><span class="comment">	 * unthrottle_offline_cfs_rqs().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	get_online_cpus();</span><br><span class="line">	mutex_lock(&amp;cfs_constraints_mutex);</span><br><span class="line">	ret = __cfs_schedulable(tg, period, quota);</span><br><span class="line">	<span class="keyword">if</span> (ret)</span><br><span class="line">		<span class="keyword">goto</span> out_unlock;</span><br><span class="line"></span><br><span class="line">	runtime_enabled = quota != RUNTIME_INF;</span><br><span class="line">	runtime_was_enabled = cfs_b-&gt;quota != RUNTIME_INF;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If we need to toggle cfs_bandwidth_used, off-&gt;on must occur</span></span><br><span class="line"><span class="comment">	 * before making related changes, and on-&gt;off must occur afterwards</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (runtime_enabled &amp;&amp; !runtime_was_enabled)</span><br><span class="line">		cfs_bandwidth_usage_inc();</span><br><span class="line">	raw_spin_lock_irq(&amp;cfs_b-&gt;lock);</span><br><span class="line">	cfs_b-&gt;period = ns_to_ktime(period);</span><br><span class="line">	cfs_b-&gt;quota = quota;</span><br><span class="line"></span><br><span class="line">	__refill_cfs_bandwidth_runtime(cfs_b);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Restart the period timer (if active) to handle new period expiry: */</span></span><br><span class="line">	<span class="keyword">if</span> (runtime_enabled)</span><br><span class="line">		start_cfs_bandwidth(cfs_b);</span><br><span class="line"></span><br><span class="line">	raw_spin_unlock_irq(&amp;cfs_b-&gt;lock);</span><br><span class="line"></span><br><span class="line">	for_each_online_cpu(i) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">cfs_rq</span> *<span class="title">cfs_rq</span> = <span class="title">tg</span>-&gt;<span class="title">cfs_rq</span>[<span class="title">i</span>];</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rq</span> *<span class="title">rq</span> = <span class="title">cfs_rq</span>-&gt;<span class="title">rq</span>;</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rq_flags</span> <span class="title">rf</span>;</span></span><br><span class="line"></span><br><span class="line">		rq_lock_irq(rq, &amp;rf);</span><br><span class="line">		cfs_rq-&gt;runtime_enabled = runtime_enabled;</span><br><span class="line">		cfs_rq-&gt;runtime_remaining = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (cfs_rq-&gt;throttled)</span><br><span class="line">			unthrottle_cfs_rq(cfs_rq);</span><br><span class="line">		rq_unlock_irq(rq, &amp;rf);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (runtime_was_enabled &amp;&amp; !runtime_enabled)</span><br><span class="line">		cfs_bandwidth_usage_dec();</span><br><span class="line">out_unlock:</span><br><span class="line">	mutex_unlock(&amp;cfs_constraints_mutex);</span><br><span class="line">	put_online_cpus();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">tg_set_cfs_quota</span><span class="params">(struct task_group *tg, <span class="keyword">long</span> cfs_quota_us)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u64 quota, period;</span><br><span class="line"></span><br><span class="line">	period = ktime_to_ns(tg-&gt;cfs_bandwidth.period);</span><br><span class="line">	<span class="keyword">if</span> (cfs_quota_us &lt; <span class="number">0</span>)</span><br><span class="line">		quota = RUNTIME_INF;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> ((u64)cfs_quota_us &lt;= U64_MAX / NSEC_PER_USEC)</span><br><span class="line">		quota = (u64)cfs_quota_us * NSEC_PER_USEC;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tg_set_cfs_bandwidth(tg, period, quota);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="title">tg_get_cfs_quota</span><span class="params">(struct task_group *tg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u64 quota_us;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (tg-&gt;cfs_bandwidth.quota == RUNTIME_INF)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	quota_us = tg-&gt;cfs_bandwidth.quota;</span><br><span class="line">	do_div(quota_us, NSEC_PER_USEC);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> quota_us;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">tg_set_cfs_period</span><span class="params">(struct task_group *tg, <span class="keyword">long</span> cfs_period_us)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u64 quota, period;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((u64)cfs_period_us &gt; U64_MAX / NSEC_PER_USEC)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	period = (u64)cfs_period_us * NSEC_PER_USEC;</span><br><span class="line">	quota = tg-&gt;cfs_bandwidth.quota;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tg_set_cfs_bandwidth(tg, period, quota);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="title">tg_get_cfs_period</span><span class="params">(struct task_group *tg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u64 cfs_period_us;</span><br><span class="line"></span><br><span class="line">	cfs_period_us = ktime_to_ns(tg-&gt;cfs_bandwidth.period);</span><br><span class="line">	do_div(cfs_period_us, NSEC_PER_USEC);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> cfs_period_us;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> s64 <span class="title">cpu_cfs_quota_read_s64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				  struct cftype *cft)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> tg_get_cfs_quota(css_tg(css));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_cfs_quota_write_s64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				   struct cftype *cftype, s64 cfs_quota_us)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> tg_set_cfs_quota(css_tg(css), cfs_quota_us);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> u64 <span class="title">cpu_cfs_period_read_u64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				   struct cftype *cft)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> tg_get_cfs_period(css_tg(css));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_cfs_period_write_u64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				    struct cftype *cftype, u64 cfs_period_us)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> tg_set_cfs_period(css_tg(css), cfs_period_us);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cfs_schedulable_data</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span>;</span></span><br><span class="line">	u64 period, quota;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * normalize group quota/period to be quota/max_period</span></span><br><span class="line"><span class="comment"> * note: units are usecs</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> u64 <span class="title">normalize_cfs_quota</span><span class="params">(struct task_group *tg,</span></span></span><br><span class="line"><span class="function"><span class="params">			       struct cfs_schedulable_data *d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u64 quota, period;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (tg == d-&gt;tg) &#123;</span><br><span class="line">		period = d-&gt;period;</span><br><span class="line">		quota = d-&gt;quota;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		period = tg_get_cfs_period(tg);</span><br><span class="line">		quota = tg_get_cfs_quota(tg);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* note: these should typically be equivalent */</span></span><br><span class="line">	<span class="keyword">if</span> (quota == RUNTIME_INF || quota == <span class="number">-1</span>)</span><br><span class="line">		<span class="keyword">return</span> RUNTIME_INF;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> to_ratio(period, quota);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">tg_cfs_schedulable_down</span><span class="params">(struct task_group *tg, <span class="keyword">void</span> *data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cfs_schedulable_data</span> *<span class="title">d</span> = <span class="title">data</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cfs_bandwidth</span> *<span class="title">cfs_b</span> = &amp;<span class="title">tg</span>-&gt;<span class="title">cfs_bandwidth</span>;</span></span><br><span class="line">	s64 quota = <span class="number">0</span>, parent_quota = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!tg-&gt;parent) &#123;</span><br><span class="line">		quota = RUNTIME_INF;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		struct cfs_bandwidth *parent_b = &amp;tg-&gt;parent-&gt;cfs_bandwidth;</span><br><span class="line"></span><br><span class="line">		quota = normalize_cfs_quota(tg, d);</span><br><span class="line">		parent_quota = parent_b-&gt;hierarchical_quota;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Ensure max(child_quota) &lt;= parent_quota.  On cgroup2,</span></span><br><span class="line"><span class="comment">		 * always take the min.  On cgroup1, only inherit when no</span></span><br><span class="line"><span class="comment">		 * limit is set:</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">if</span> (cgroup_subsys_on_dfl(cpu_cgrp_subsys)) &#123;</span><br><span class="line">			quota = min(quota, parent_quota);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (quota == RUNTIME_INF)</span><br><span class="line">				quota = parent_quota;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (parent_quota != RUNTIME_INF &amp;&amp; quota &gt; parent_quota)</span><br><span class="line">				<span class="keyword">return</span> -EINVAL;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	cfs_b-&gt;hierarchical_quota = quota;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> __cfs_schedulable(struct task_group *tg, u64 period, u64 quota)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cfs_schedulable_data</span> <span class="title">data</span> = &#123;</span></span><br><span class="line">		.tg = tg,</span><br><span class="line">		.period = period,</span><br><span class="line">		.quota = quota,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (quota != RUNTIME_INF) &#123;</span><br><span class="line">		do_div(data.period, NSEC_PER_USEC);</span><br><span class="line">		do_div(data.quota, NSEC_PER_USEC);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	rcu_read_lock();</span><br><span class="line">	ret = walk_tg_tree(tg_cfs_schedulable_down, tg_nop, &amp;data);</span><br><span class="line">	rcu_read_unlock();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_cfs_stat_show</span><span class="params">(struct seq_file *sf, <span class="keyword">void</span> *v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">seq_css</span>(<span class="title">sf</span>));</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cfs_bandwidth</span> *<span class="title">cfs_b</span> = &amp;<span class="title">tg</span>-&gt;<span class="title">cfs_bandwidth</span>;</span></span><br><span class="line"></span><br><span class="line">	seq_printf(sf, <span class="string">"nr_periods %d\n"</span>, cfs_b-&gt;nr_periods);</span><br><span class="line">	seq_printf(sf, <span class="string">"nr_throttled %d\n"</span>, cfs_b-&gt;nr_throttled);</span><br><span class="line">	seq_printf(sf, <span class="string">"throttled_time %llu\n"</span>, cfs_b-&gt;throttled_time);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (schedstat_enabled() &amp;&amp; tg != &amp;root_task_group) &#123;</span><br><span class="line">		u64 ws = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">		for_each_possible_cpu(i)</span><br><span class="line">			ws += schedstat_val(tg-&gt;se[i]-&gt;statistics.wait_sum);</span><br><span class="line"></span><br><span class="line">		seq_printf(sf, <span class="string">"wait_sum %llu\n"</span>, ws);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_CFS_BANDWIDTH */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_FAIR_GROUP_SCHED */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RT_GROUP_SCHED</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_rt_runtime_write</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				struct cftype *cft, s64 val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> sched_group_set_rt_runtime(css_tg(css), val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> s64 <span class="title">cpu_rt_runtime_read</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">			       struct cftype *cft)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> sched_group_rt_runtime(css_tg(css));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_rt_period_write_uint</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				    struct cftype *cftype, u64 rt_period_us)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> sched_group_set_rt_period(css_tg(css), rt_period_us);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> u64 <span class="title">cpu_rt_period_read_uint</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				   struct cftype *cft)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> sched_group_rt_period(css_tg(css));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_RT_GROUP_SCHED */</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">cftype</span> <span class="title">cpu_legacy_files</span>[] = &#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"shares"</span>,</span><br><span class="line">		.read_u64 = cpu_shares_read_u64,</span><br><span class="line">		.write_u64 = cpu_shares_write_u64,</span><br><span class="line">	&#125;,</span><br><span class="line">#endif</span><br><span class="line">#ifdef CONFIG_CFS_BANDWIDTH</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"cfs_quota_us"</span>,</span><br><span class="line">		.read_s64 = cpu_cfs_quota_read_s64,</span><br><span class="line">		.write_s64 = cpu_cfs_quota_write_s64,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"cfs_period_us"</span>,</span><br><span class="line">		.read_u64 = cpu_cfs_period_read_u64,</span><br><span class="line">		.write_u64 = cpu_cfs_period_write_u64,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"stat"</span>,</span><br><span class="line">		.seq_show = cpu_cfs_stat_show,</span><br><span class="line">	&#125;,</span><br><span class="line">#endif</span><br><span class="line">#ifdef CONFIG_RT_GROUP_SCHED</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"rt_runtime_us"</span>,</span><br><span class="line">		.read_s64 = cpu_rt_runtime_read,</span><br><span class="line">		.write_s64 = cpu_rt_runtime_write,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"rt_period_us"</span>,</span><br><span class="line">		.read_u64 = cpu_rt_period_read_uint,</span><br><span class="line">		.write_u64 = cpu_rt_period_write_uint,</span><br><span class="line">	&#125;,</span><br><span class="line">#endif</span><br><span class="line">#ifdef CONFIG_UCLAMP_TASK_GROUP</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"uclamp.min"</span>,</span><br><span class="line">		.flags = CFTYPE_NOT_ON_ROOT,</span><br><span class="line">		.seq_show = cpu_uclamp_min_show,</span><br><span class="line">		.write = cpu_uclamp_min_write,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"uclamp.max"</span>,</span><br><span class="line">		.flags = CFTYPE_NOT_ON_ROOT,</span><br><span class="line">		.seq_show = cpu_uclamp_max_show,</span><br><span class="line">		.write = cpu_uclamp_max_write,</span><br><span class="line">	&#125;,</span><br><span class="line">#endif</span><br><span class="line">	&#123; &#125;	<span class="comment">/* Terminate */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_extra_stat_show</span><span class="params">(struct seq_file *sf,</span></span></span><br><span class="line"><span class="function"><span class="params">			       struct cgroup_subsys_state *css)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CFS_BANDWIDTH</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">css</span>);</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">cfs_bandwidth</span> *<span class="title">cfs_b</span> = &amp;<span class="title">tg</span>-&gt;<span class="title">cfs_bandwidth</span>;</span></span><br><span class="line">		u64 throttled_usec;</span><br><span class="line"></span><br><span class="line">		throttled_usec = cfs_b-&gt;throttled_time;</span><br><span class="line">		do_div(throttled_usec, NSEC_PER_USEC);</span><br><span class="line"></span><br><span class="line">		seq_printf(sf, <span class="string">"nr_periods %d\n"</span></span><br><span class="line">			   <span class="string">"nr_throttled %d\n"</span></span><br><span class="line">			   <span class="string">"throttled_usec %llu\n"</span>,</span><br><span class="line">			   cfs_b-&gt;nr_periods, cfs_b-&gt;nr_throttled,</span><br><span class="line">			   throttled_usec);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> u64 <span class="title">cpu_weight_read_u64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">			       struct cftype *cft)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">css</span>);</span></span><br><span class="line">	u64 weight = scale_load_down(tg-&gt;shares);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> DIV_ROUND_CLOSEST_ULL(weight * CGROUP_WEIGHT_DFL, <span class="number">1024</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_weight_write_u64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				struct cftype *cft, u64 weight)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * cgroup weight knobs should use the common MIN, DFL and MAX</span></span><br><span class="line"><span class="comment">	 * values which are 1, 100 and 10000 respectively.  While it loses</span></span><br><span class="line"><span class="comment">	 * a bit of range on both ends, it maps pretty well onto the shares</span></span><br><span class="line"><span class="comment">	 * value used by scheduler and the round-trip conversions preserve</span></span><br><span class="line"><span class="comment">	 * the original value over the entire range.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (weight &lt; CGROUP_WEIGHT_MIN || weight &gt; CGROUP_WEIGHT_MAX)</span><br><span class="line">		<span class="keyword">return</span> -ERANGE;</span><br><span class="line"></span><br><span class="line">	weight = DIV_ROUND_CLOSEST_ULL(weight * <span class="number">1024</span>, CGROUP_WEIGHT_DFL);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sched_group_set_shares(css_tg(css), scale_load(weight));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> s64 <span class="title">cpu_weight_nice_read_s64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				    struct cftype *cft)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> weight = scale_load_down(css_tg(css)-&gt;shares);</span><br><span class="line">	<span class="keyword">int</span> last_delta = INT_MAX;</span><br><span class="line">	<span class="keyword">int</span> prio, delta;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* find the closest nice value to the current weight */</span></span><br><span class="line">	<span class="keyword">for</span> (prio = <span class="number">0</span>; prio &lt; ARRAY_SIZE(sched_prio_to_weight); prio++) &#123;</span><br><span class="line">		delta = <span class="built_in">abs</span>(sched_prio_to_weight[prio] - weight);</span><br><span class="line">		<span class="keyword">if</span> (delta &gt;= last_delta)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		last_delta = delta;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> PRIO_TO_NICE(prio - <span class="number">1</span> + MAX_RT_PRIO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_weight_nice_write_s64</span><span class="params">(struct cgroup_subsys_state *css,</span></span></span><br><span class="line"><span class="function"><span class="params">				     struct cftype *cft, s64 nice)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> weight;</span><br><span class="line">	<span class="keyword">int</span> idx;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (nice &lt; MIN_NICE || nice &gt; MAX_NICE)</span><br><span class="line">		<span class="keyword">return</span> -ERANGE;</span><br><span class="line"></span><br><span class="line">	idx = NICE_TO_PRIO(nice) - MAX_RT_PRIO;</span><br><span class="line">	idx = array_index_nospec(idx, <span class="number">40</span>);</span><br><span class="line">	weight = sched_prio_to_weight[idx];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sched_group_set_shares(css_tg(css), scale_load(weight));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> __maybe_unused <span class="title">cpu_period_quota_print</span><span class="params">(struct seq_file *sf,</span></span></span><br><span class="line"><span class="function"><span class="params">						  <span class="keyword">long</span> period, <span class="keyword">long</span> quota)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (quota &lt; <span class="number">0</span>)</span><br><span class="line">		seq_puts(sf, <span class="string">"max"</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		seq_printf(sf, <span class="string">"%ld"</span>, quota);</span><br><span class="line"></span><br><span class="line">	seq_printf(sf, <span class="string">" %ld\n"</span>, period);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* caller should put the current value in *@periodp before calling */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> __maybe_unused <span class="title">cpu_period_quota_parse</span><span class="params">(<span class="keyword">char</span> *buf,</span></span></span><br><span class="line"><span class="function"><span class="params">						 u64 *periodp, u64 *quotap)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> tok[<span class="number">21</span>];	<span class="comment">/* U64_MAX */</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">sscanf</span>(buf, <span class="string">"%20s %llu"</span>, tok, periodp) &lt; <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	*periodp *= NSEC_PER_USEC;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">sscanf</span>(tok, <span class="string">"%llu"</span>, quotap))</span><br><span class="line">		*quotap *= NSEC_PER_USEC;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(tok, <span class="string">"max"</span>))</span><br><span class="line">		*quotap = RUNTIME_INF;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CFS_BANDWIDTH</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">cpu_max_show</span><span class="params">(struct seq_file *sf, <span class="keyword">void</span> *v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">seq_css</span>(<span class="title">sf</span>));</span></span><br><span class="line"></span><br><span class="line">	cpu_period_quota_print(sf, tg_get_cfs_period(tg), tg_get_cfs_quota(tg));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">ssize_t</span> <span class="title">cpu_max_write</span><span class="params">(struct kernfs_open_file *of,</span></span></span><br><span class="line"><span class="function"><span class="params">			     <span class="keyword">char</span> *buf, <span class="keyword">size_t</span> nbytes, <span class="keyword">loff_t</span> off)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_group</span> *<span class="title">tg</span> = <span class="title">css_tg</span>(<span class="title">of_css</span>(<span class="title">of</span>));</span></span><br><span class="line">	u64 period = tg_get_cfs_period(tg);</span><br><span class="line">	u64 quota;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line"></span><br><span class="line">	ret = cpu_period_quota_parse(buf, &amp;period, &amp;quota);</span><br><span class="line">	<span class="keyword">if</span> (!ret)</span><br><span class="line">		ret = tg_set_cfs_bandwidth(tg, period, quota);</span><br><span class="line">	<span class="keyword">return</span> ret ?: nbytes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">cftype</span> <span class="title">cpu_files</span>[] = &#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_FAIR_GROUP_SCHED</span></span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"weight"</span>,</span><br><span class="line">		.flags = CFTYPE_NOT_ON_ROOT,</span><br><span class="line">		.read_u64 = cpu_weight_read_u64,</span><br><span class="line">		.write_u64 = cpu_weight_write_u64,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"weight.nice"</span>,</span><br><span class="line">		.flags = CFTYPE_NOT_ON_ROOT,</span><br><span class="line">		.read_s64 = cpu_weight_nice_read_s64,</span><br><span class="line">		.write_s64 = cpu_weight_nice_write_s64,</span><br><span class="line">	&#125;,</span><br><span class="line">#endif</span><br><span class="line">#ifdef CONFIG_CFS_BANDWIDTH</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"max"</span>,</span><br><span class="line">		.flags = CFTYPE_NOT_ON_ROOT,</span><br><span class="line">		.seq_show = cpu_max_show,</span><br><span class="line">		.write = cpu_max_write,</span><br><span class="line">	&#125;,</span><br><span class="line">#endif</span><br><span class="line">#ifdef CONFIG_UCLAMP_TASK_GROUP</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"uclamp.min"</span>,</span><br><span class="line">		.flags = CFTYPE_NOT_ON_ROOT,</span><br><span class="line">		.seq_show = cpu_uclamp_min_show,</span><br><span class="line">		.write = cpu_uclamp_min_write,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		.name = <span class="string">"uclamp.max"</span>,</span><br><span class="line">		.flags = CFTYPE_NOT_ON_ROOT,</span><br><span class="line">		.seq_show = cpu_uclamp_max_show,</span><br><span class="line">		.write = cpu_uclamp_max_write,</span><br><span class="line">	&#125;,</span><br><span class="line">#endif</span><br><span class="line">	&#123; &#125;	<span class="comment">/* terminate */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cgroup_subsys</span> <span class="title">cpu_cgrp_subsys</span> = &#123;</span></span><br><span class="line">	.css_alloc	= cpu_cgroup_css_alloc,</span><br><span class="line">	.css_online	= cpu_cgroup_css_online,</span><br><span class="line">	.css_released	= cpu_cgroup_css_released,</span><br><span class="line">	.css_free	= cpu_cgroup_css_free,</span><br><span class="line">	.css_extra_stat_show = cpu_extra_stat_show,</span><br><span class="line">	.fork		= cpu_cgroup_fork,</span><br><span class="line">	.can_attach	= cpu_cgroup_can_attach,</span><br><span class="line">	.attach		= cpu_cgroup_attach,</span><br><span class="line">	.legacy_cftypes	= cpu_legacy_files,</span><br><span class="line">	.dfl_cftypes	= cpu_files,</span><br><span class="line">	.early_init	= <span class="literal">true</span>,</span><br><span class="line">	.threaded	= <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>	<span class="comment">/* CONFIG_CGROUP_SCHED */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dump_cpu_task</span><span class="params">(<span class="keyword">int</span> cpu)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	pr_info(<span class="string">"Task dump for CPU %d:\n"</span>, cpu);</span><br><span class="line">	sched_show_task(cpu_curr(cpu));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Nice levels are multiplicative, with a gentle 10% change for every</span></span><br><span class="line"><span class="comment"> * nice level changed. I.e. when a CPU-bound task goes from nice 0 to</span></span><br><span class="line"><span class="comment"> * nice 1, it will get ~10% less CPU time than another CPU-bound task</span></span><br><span class="line"><span class="comment"> * that remained on nice 0.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The "10% effect" is relative and cumulative: from _any_ nice level,</span></span><br><span class="line"><span class="comment"> * if you go up 1 level, it's -10% CPU usage, if you go down 1 level</span></span><br><span class="line"><span class="comment"> * it's +10% CPU usage. (to achieve that we use a multiplier of 1.25.</span></span><br><span class="line"><span class="comment"> * If a task goes up by ~10% and another task goes down by ~10% then</span></span><br><span class="line"><span class="comment"> * the relative distance between them is ~25%.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> sched_prio_to_weight[<span class="number">40</span>] = &#123;</span><br><span class="line"> <span class="comment">/* -20 */</span>     <span class="number">88761</span>,     <span class="number">71755</span>,     <span class="number">56483</span>,     <span class="number">46273</span>,     <span class="number">36291</span>,</span><br><span class="line"> <span class="comment">/* -15 */</span>     <span class="number">29154</span>,     <span class="number">23254</span>,     <span class="number">18705</span>,     <span class="number">14949</span>,     <span class="number">11916</span>,</span><br><span class="line"> <span class="comment">/* -10 */</span>      <span class="number">9548</span>,      <span class="number">7620</span>,      <span class="number">6100</span>,      <span class="number">4904</span>,      <span class="number">3906</span>,</span><br><span class="line"> <span class="comment">/*  -5 */</span>      <span class="number">3121</span>,      <span class="number">2501</span>,      <span class="number">1991</span>,      <span class="number">1586</span>,      <span class="number">1277</span>,</span><br><span class="line"> <span class="comment">/*   0 */</span>      <span class="number">1024</span>,       <span class="number">820</span>,       <span class="number">655</span>,       <span class="number">526</span>,       <span class="number">423</span>,</span><br><span class="line"> <span class="comment">/*   5 */</span>       <span class="number">335</span>,       <span class="number">272</span>,       <span class="number">215</span>,       <span class="number">172</span>,       <span class="number">137</span>,</span><br><span class="line"> <span class="comment">/*  10 */</span>       <span class="number">110</span>,        <span class="number">87</span>,        <span class="number">70</span>,        <span class="number">56</span>,        <span class="number">45</span>,</span><br><span class="line"> <span class="comment">/*  15 */</span>        <span class="number">36</span>,        <span class="number">29</span>,        <span class="number">23</span>,        <span class="number">18</span>,        <span class="number">15</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Inverse (2^32/x) values of the sched_prio_to_weight[] array, precalculated.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * In cases where the weight does not change often, we can use the</span></span><br><span class="line"><span class="comment"> * precalculated inverse to speed up arithmetics by turning divisions</span></span><br><span class="line"><span class="comment"> * into multiplications:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> u32 sched_prio_to_wmult[<span class="number">40</span>] = &#123;</span><br><span class="line"> <span class="comment">/* -20 */</span>     <span class="number">48388</span>,     <span class="number">59856</span>,     <span class="number">76040</span>,     <span class="number">92818</span>,    <span class="number">118348</span>,</span><br><span class="line"> <span class="comment">/* -15 */</span>    <span class="number">147320</span>,    <span class="number">184698</span>,    <span class="number">229616</span>,    <span class="number">287308</span>,    <span class="number">360437</span>,</span><br><span class="line"> <span class="comment">/* -10 */</span>    <span class="number">449829</span>,    <span class="number">563644</span>,    <span class="number">704093</span>,    <span class="number">875809</span>,   <span class="number">1099582</span>,</span><br><span class="line"> <span class="comment">/*  -5 */</span>   <span class="number">1376151</span>,   <span class="number">1717300</span>,   <span class="number">2157191</span>,   <span class="number">2708050</span>,   <span class="number">3363326</span>,</span><br><span class="line"> <span class="comment">/*   0 */</span>   <span class="number">4194304</span>,   <span class="number">5237765</span>,   <span class="number">6557202</span>,   <span class="number">8165337</span>,  <span class="number">10153587</span>,</span><br><span class="line"> <span class="comment">/*   5 */</span>  <span class="number">12820798</span>,  <span class="number">15790321</span>,  <span class="number">19976592</span>,  <span class="number">24970740</span>,  <span class="number">31350126</span>,</span><br><span class="line"> <span class="comment">/*  10 */</span>  <span class="number">39045157</span>,  <span class="number">49367440</span>,  <span class="number">61356676</span>,  <span class="number">76695844</span>,  <span class="number">95443717</span>,</span><br><span class="line"> <span class="comment">/*  15 */</span> <span class="number">119304647</span>, <span class="number">148102320</span>, <span class="number">186737708</span>, <span class="number">238609294</span>, <span class="number">286331153</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> CREATE_TRACE_POINTS</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>å…³äºæœ¬ç«™</title>
    <url>/about/index.html</url>
    <content><![CDATA[<p>#æˆ‘æ˜¯ä¸€åä¸å­¦æ— æ•°çš„ä¼ªç¨‹åºçŒ¿</p>]]></content>
  </entry>
  <entry>
    <title>schedule</title>
    <url>/schedule/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>categories</title>
    <url>/categories/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>tags</title>
    <url>/tags/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
</search>
